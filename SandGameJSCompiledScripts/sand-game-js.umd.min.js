/* Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).SandGameJS={})}(this,(function(e){"use strict";class t{static#e(e,t=1400,r=800){let n;n=window.innerWidth<=575?window.innerWidth:e.clientWidth;let i=Math.min(t,n),s=Math.min(r,Math.trunc(.7*window.innerHeight));return i/s<.75&&(s=Math.trunc(i/.75)),{width:i,height:s}}static#t(){return navigator.maxTouchPoints||"ontouchstart"in document.documentElement?75e3:window.screen.width>=2560&&window.screen.height>=1440?2e5:window.screen.width>=2048&&window.screen.height>=1080?175e3:window.screen.width>=1920&&window.screen.height>=1080?15e4:125e3}static#r(e,t,r){function n(r){return Math.trunc(e*r)*Math.trunc(t*r)}return n(.75)<r?.75:n(.5)<r?.5:n(.375)<r?.375:.25}static determineOptimalSizes(e,r=void 0){const n=void 0!==r?r.maxWidthPx:void 0,i=void 0!==r?r.maxHeightPx:void 0,{width:s,height:a}=t.#e(e,n,i),o=void 0!==r?r.scale:void 0;return{width:s,height:a,scale:void 0===o?t.#r(s,a,t.#t()):o}}}class r{elementHead;elementTail;constructor(e=0,t=0){this.elementHead=e,this.elementTail=t}}class n{static FIELD_TYPE_CLASS_SIZE=3;static TYPE_AIR=0;static TYPE_EFFECT=1;static TYPE_GAS=2;static TYPE_POWDER_FLOATING=3;static TYPE_FLUID=4;static TYPE_POWDER=5;static TYPE_POWDER_WET=6;static TYPE_STATIC=7;static FIELD_TYPE_MODIFIERS_SIZE=5;static FIELD_BEHAVIOUR_SIZE=4;static BEHAVIOUR_NONE=0;static BEHAVIOUR_SOIL=1;static BEHAVIOUR_GRASS=2;static BEHAVIOUR_3=3;static BEHAVIOUR_4=4;static BEHAVIOUR_TREE=5;static BEHAVIOUR_TREE_ROOT=6;static BEHAVIOUR_TREE_TRUNK=7;static BEHAVIOUR_TREE_LEAF=8;static BEHAVIOUR_FIRE=9;static BEHAVIOUR_FIRE_SOURCE=10;static BEHAVIOUR_METEOR=11;static BEHAVIOUR_LIQUID=12;static BEHAVIOUR_ENTITY=13;static BEHAVIOUR_E=14;static BEHAVIOUR_F=15;static FIELD_SPECIAL_SIZE=4;static SPECIAL_LIQUID_WATER=0;static SPECIAL_LIQUID_LIGHT_OIL=5;static SPECIAL_LIQUID_HEAVY_MOLTEN=10;static FIELD_HMI_SIZE=8;static FIELD_TEMPERATURE_SIZE=8;static of(e,t=0,r=0,n=0){let i=n<<8;return i=(i|r)<<8,i=(i|t)<<8,i|=e,i}static type8(e,t=0){return e|t<<3}static type8Powder(e,t=0,r=0,n=0){let i=t<<1;return i=(i|n)<<1,i=(i|r)<<3,i|=e,i}static type8Fluid(e){return e}static type8Solid(e,t=0,r=!0){let n=t<<1;return n=(n|(r?0:1))<<3,n|=e,n}static behaviour8(e=0,t=0){return e|t<<4}static modifiers8(e=0){return e}static getType(e){return 255&e}static getTypeClass(e){return 7&e}static getTypeModifierPowderSliding(e){return e>>3&1}static getTypeModifierPowderDirection(e){return e>>4&1}static getTypeModifierPowderMomentum(e){return e>>5&7}static getTypeModifierSolidNeighbourhoodType(e){return e>>3&1}static getTypeModifierSolidBodyId(e){return e>>4&15}static getBehaviour(e){return e>>8&15}static getSpecial(e){return e>>12&15}static getHeatModIndex(e){return e>>16&255}static getTemperature(e){return e>>24&255}static setType(e,t){return 4294967040&e|t}static setTypeClass(e,t){return 4294967288&e|t}static setTypeModifierPowderSliding(e,t){return 4294967287&e|t<<3}static setTypeModifierPowderDirection(e,t){return 4294967279&e|t<<4}static setTypeModifierPowderMomentum(e,t){return 4294967071&e|t<<5}static setTypeModifierSolidNeighbourhoodType(e,t){return 4294967287&e|t<<3}static setTypeModifierSolidBodyId(e,t){return 4294967055&e|t<<4}static setBehaviour(e,t){return 4294963455&e|t<<8}static setSpecial(e,t){return 4294905855&e|t<<12}static setHeatModIndex(e,t){return 4278255615&e|t<<16}static setTemperature(e,t){return 16777215&e|t<<24}static#n=16;static#i=Array(n.#n);static#s({i:e,conductiveIndex:t=.2,heatLossChanceTo10000:r=2500,flammableChanceTo10000:i=0,selfIgnitionChanceTo10000:s=0,flameHeat:a=0,burnDownChanceTo10000:o=0,meltingTemperature:l=256,meltingHMI:h=0,hardeningTemperature:c=0,hardeningHMI:d=0}){const u=Array(10);return u[0]=t,u[1]=r,u[2]=i,u[3]=s,u[4]=a,u[5]=o,u[6]=l,u[7]=h,u[8]=c,u[9]=d,n.#i[e]=u,e}static HMI_DEFAULT=n.#s({i:0});static HMI_CONDUCTIVE_1=n.#s({i:1,conductiveIndex:.25,heatLossChanceTo10000:500});static HMI_CONDUCTIVE_2=n.#s({i:2,conductiveIndex:.3,heatLossChanceTo10000:20});static HMI_CONDUCTIVE_3=n.#s({i:3,conductiveIndex:.45,heatLossChanceTo10000:10});static HMI_GRASS_LIKE=n.#s({i:4,flammableChanceTo10000:4500,selfIgnitionChanceTo10000:3,flameHeat:165,burnDownChanceTo10000:1e3});static HMI_WOOD_LIKE=n.#s({i:5,flammableChanceTo10000:100,selfIgnitionChanceTo10000:2,flameHeat:165,burnDownChanceTo10000:2});static HMI_LEAF_LIKE=n.#s({i:6,flammableChanceTo10000:4500,selfIgnitionChanceTo10000:3,flameHeat:165,burnDownChanceTo10000:100});static HMI_METAL=n.#s({i:7,conductiveIndex:.45,heatLossChanceTo10000:10,meltingTemperature:200,meltingHMI:8});static HMI_MOLTEN=n.#s({i:8,conductiveIndex:.45,heatLossChanceTo10000:10,hardeningTemperature:150,hardeningHMI:7});static HMI_COAL=n.#s({i:9,conductiveIndex:.3,heatLossChanceTo10000:20,flammableChanceTo10000:500,selfIgnitionChanceTo10000:3,flameHeat:190,burnDownChanceTo10000:50});static HMI_THERMITE=n.#s({i:10,conductiveIndex:.45,heatLossChanceTo10000:10,flammableChanceTo10000:8e3,selfIgnitionChanceTo10000:500,flameHeat:250,burnDownChanceTo10000:1e3});static HMI_OIL=n.#s({i:11,conductiveIndex:.45,heatLossChanceTo10000:10,flammableChanceTo10000:1e4,selfIgnitionChanceTo10000:2500,flameHeat:220,burnDownChanceTo10000:1e3});static{for(let e=0;e<n.#n;e++)void 0===n.#i[e]&&n.#s(e)}static hmiToConductiveIndex(e){return n.#i[15&e][0]}static hmiToHeatLossChanceTo10000(e){return n.#i[15&e][1]}static hmiToFlammableChanceTo10000(e){return n.#i[15&e][2]}static hmiToSelfIgnitionChanceTo10000(e){return n.#i[15&e][3]}static hmiToFlameHeat(e){return n.#i[15&e][4]}static hmiToBurnDownChanceTo10000(e){return n.#i[15&e][5]}static hmiToMeltingTemperature(e){return n.#i[15&e][6]}static hmiToMeltingHMI(e){return n.#i[15&e][7]}static hmiToHardeningTemperature(e){return n.#i[15&e][8]}static hmiToHardeningHMI(e){return n.#i[15&e][9]}}class i{static DEFAULT=new i(106244033);static next(e){let t=e+1831565813;return t=Math.imul(t^t>>>15,1|t),t^=t+Math.imul(t^t>>>7,61|t),((t^t>>>14)>>>0)/4294967296}#a;constructor(e){this.#a=e}next(){let e=this.#a+=1831565813;return e=Math.imul(e^e>>>15,1|e),e^=e+Math.imul(e^e>>>7,61|e),((e^e>>>14)>>>0)/4294967296}nextInt(e){return Math.trunc(this.next()*e)}getState(){return this.#a}}class s{apply(e,t,r=void 0,n=void 0){throw"Not implemented"}}class a extends s{#o;constructor(e){super(),this.#o=e}apply(e,t,r,n){if(this.#o.length>1){const s=(r||i.DEFAULT).nextInt(this.#o.length);return this.#o[s].apply(e,t,r,n)}if(1===this.#o.length){return this.#o[0].apply(e,t,r,n)}return null}}class o extends s{#l;constructor(e){super(),this.#l=e}apply(e,t,r,n){if(this.#l.length>1){const e=(r||i.DEFAULT).nextInt(this.#l.length);return this.#l[e]}return 1===this.#l.length?this.#l[0]:null}}class l extends s{#h;constructor(e){super(),this.#h=e}_retrieveElement(e,t,r,n){return void 0!==this.#h?this.#h.apply(e,t,r):n}}class h{static BLUR_TYPE_NONE=0;static BLUR_TYPE_BACKGROUND=1;static BLUR_TYPE_1=2;static HEAT_EFFECT_NONE=0;static HEAT_EFFECT_1=1;static HEAT_EFFECT_2=2;static HEAT_EFFECT_3=3;static of(e,t,r,n=h.BLUR_TYPE_NONE,i=0,s=0){let a=0;return a=(a|3&i)<<2,a=(a|3&s)<<2,a=(a|3&n)<<8,a=(a|255&e)<<8,a=(a|255&t)<<8,a|=255&r,a}static getColorRed(e){return e>>16&255}static getColorGreen(e){return e>>8&255}static getColorBlue(e){return 255&e}static getBlurType(e){return e>>24&3}static getBurntLevel(e){return e>>26&3}static getHeatEffect(e){return e>>28&3}static setColor(e,t,r,n){return e=-256&(e=-65281&(e=-16711681&e|t<<16)|r<<8)|n}static setBlurType(e,t){return 4244635647&e|t<<24}static setBurntLevel(e,t){return 4093640703&e|t<<26}}class c extends l{#c;#d;#u;constructor(e,t,r,n){super(n),this.#c=e,this.#d=t,this.#u=r}apply(e,t,n,i){const s=this._retrieveElement(e,t,n,i),a=h.setColor(s.elementTail,this.#c,this.#d,this.#u);return new r(s.elementHead,a)}}class d extends l{#m;constructor(e,t){super(e),this.#m="string"==typeof t?t.split("\n").map((e=>e.split(",").map(Number))):t}apply(e,t,n,s){const a=this._retrieveElement(e,t,n,s),o=(n||i.DEFAULT).nextInt(this.#m.length),[l,c,d]=this.#m[o],u=h.setColor(a.elementTail,l,c,d);return new r(a.elementHead,u)}}class u{static asImageData(e,t=void 0,r=void 0){return new Promise(((n,i)=>{try{let s=new Image;s.onload=()=>{let e=document.createElement("canvas"),[i,a]=function(e,n){let i=e,s=n;if(void 0!==t&&i>t){const e=i/t;i=t,s/=e}if(void 0!==r&&s>r){const e=s/r;s=r,i/=e}return[Math.trunc(i),Math.trunc(s)]}(s.width,s.height);e.width=i,e.height=a;let o=e.getContext("2d");o.drawImage(s,0,0,e.width,e.height);let l=o.getImageData(0,0,e.width,e.height);n(l)},s.onerror=()=>{i("Cannot load image")},s.src=e}catch(e){i(e)}}))}}class m extends l{#E=null;constructor(e,t){super(e),u.asImageData(t).then((e=>this.#E=e))}apply(e,t,n,i){const s=this._retrieveElement(e,t,n,i);if(null!=this.#E){const n=e%this.#E.width,i=4*(t%this.#E.height*this.#E.width+n),a=this.#E.data[i],o=this.#E.data[i+1],l=this.#E.data[i+2],c=h.setColor(s.elementTail,a,o,l);return new r(s.elementHead,c)}return s}}const E=.5*(Math.sqrt(3)-1),g=(3-Math.sqrt(3))/6,p=e=>0|Math.floor(e),A=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]);function f(e=Math.random){const t=function(e){const t=512,r=new Uint8Array(t);for(let e=0;e<t/2;e++)r[e]=e;for(let n=0;n<t/2-1;n++){const t=n+~~(e()*(256-n)),i=r[n];r[n]=r[t],r[t]=i}for(let e=256;e<t;e++)r[e]=r[e-256];return r}(e),r=new Float64Array(t).map((e=>A[e%12*2])),n=new Float64Array(t).map((e=>A[e%12*2+1]));return function(e,i){let s=0,a=0,o=0;const l=(e+i)*E,h=p(e+l),c=p(i+l),d=(h+c)*g,u=e-(h-d),m=i-(c-d);let A,f;u>m?(A=1,f=0):(A=0,f=1);const T=u-A+g,C=m-f+g,y=u-1+2*g,R=m-1+2*g,S=255&h,v=255&c;let I=.5-u*u-m*m;if(I>=0){const e=S+t[v];I*=I,s=I*I*(r[e]*u+n[e]*m)}let w=.5-T*T-C*C;if(w>=0){const e=S+A+t[v+f];w*=w,a=w*w*(r[e]*T+n[e]*C)}let O=.5-y*y-R*R;if(O>=0){const e=S+1+t[v+1];O*=O,o=O*O*(r[e]*y+n[e]*R)}return 70*(s+a+o)}}class T{static isVisualBurnApplicable(e){const t=n.getTypeClass(e);return t>n.TYPE_FLUID||t===n.TYPE_POWDER_FLOATING}static visualBurn(e,t=1,r=3){const n=h.getBurntLevel(e);if(n>=3)return e;let i=e,s=n+t;s=Math.min(s,r),s=Math.max(s,0);const a=s-n;if(a>0){i=h.setBurntLevel(i,s);let t=h.getColorRed(e),r=h.getColorGreen(e),n=h.getColorBlue(e),o=1.8-.5*Math.random();a>1&&(o*=1.8-.5*Math.random()),a>2&&(o*=1.8-.5*Math.random()),t=Math.trunc(t/o),r=Math.trunc(r/o),n=Math.trunc(n/o),i=h.setColor(i,t,r,n)}return i}static visualNoiseProvider(e=0){if(Array.isArray(e)){const t=e.map((e=>{const t=new i(e);return f((()=>t.next()))}));return new C(t)}{const t=new i(e),r=f((()=>t.next()));return new C([r])}}}class C{#g;constructor(e){this.#g=e}visualNoise(e,t,r,n=1,i=.5,s=.1,a=0,o=0,l=0){let c=((0,this.#g[0])(t/n,r/n)+1)/2;if(c<i)return e;c=1/(1-i)*(c-i);const d=1-c*s;let u=h.getColorRed(e),m=h.getColorGreen(e),E=h.getColorBlue(e);return u=Math.trunc(u*d)+a*(1-d),m=Math.trunc(m*d)+o*(1-d),E=Math.trunc(E*d)+l*(1-d),h.setColor(e,u,m,E)}visualNoiseCombined(e,t,r,n,i=0,s=0,a=0){let o=0;for(let e=0;e<n.length;e++){const{factor:i,threshold:s,force:a}=n[e];let l=((0,this.#g[e%this.#g.length])(t/i,r/i)+1)/2;l<s?l=0:(l=1/(1-s)*(l-s),l*=a,o+=l)}o=Math.min(o,1);const l=1-o;let c=h.getColorRed(e),d=h.getColorGreen(e),u=h.getColorBlue(e);return c=Math.trunc(c*l)+i*(1-l),d=Math.trunc(d*l)+s*(1-l),u=Math.trunc(u*l)+a*(1-l),h.setColor(e,c,d,u)}}class y extends l{#c;#d;#u;#p;#A;constructor(e,t,r,n,i){super(e),this.#p=t,this.#c=r,this.#d=n,this.#u=i,Array.isArray(t)?this.#A=T.visualNoiseProvider(t.map((e=>e.seed))):this.#A=T.visualNoiseProvider(t.seed)}apply(e,t,n,i){const s=this._retrieveElement(e,t,n,i),a=this.#p,o=this.#c,l=this.#d,h=this.#u;let c;if(Array.isArray(a))c=this.#A.visualNoiseCombined(s.elementTail,e,t,a,o,l,h);else{const r=a.factor,n=a.threshold,i=a.force;c=this.#A.visualNoise(s.elementTail,e,t,r,n,i,o,l,h)}return new r(s.elementHead,c)}}class R extends l{#m;#f;#T=0;#C=1;#y=0;constructor(e,t,r){super(e),this.#m=t,this.#f=r}apply(e,t,n,i){const s=this._retrieveElement(e,t,n,i);if(0===this.#m.length)return s;const[a,o,l]=this.#m[this.#T];this.#m.length>1&&(this.#y+=1,this.#y>=this.#f&&(this.#y=0,this.#T+=this.#C,this.#T<0?(this.#C=1,this.#T=1):this.#T>=this.#m.length&&(this.#C=-1,this.#T=this.#m.length-2)));const c=h.setColor(s.elementTail,a,o,l);return new r(s.elementHead,c)}}class S extends l{#R;constructor(e,t){super(e),this.#R=t}apply(e,t,n,i){const s=this._retrieveElement(e,t,n,i);let a=h.getColorRed(s.elementTail),o=h.getColorGreen(s.elementTail),l=h.getColorBlue(s.elementTail);a+=n.nextInt(this.#R)*(0===n.nextInt(2)?1:-1),o+=n.nextInt(this.#R)*(0===n.nextInt(2)?1:-1),l+=n.nextInt(this.#R)*(0===n.nextInt(2)?1:-1),a=Math.max(0,Math.min(255,a)),o=Math.max(0,Math.min(255,o)),l=Math.max(0,Math.min(255,l));const c=h.setColor(s.elementTail,a,o,l);return new r(s.elementHead,c)}}class v extends s{#S;constructor(e){super(),this.#S=e}apply(e,t,r,n){return this.#S(e,t,r,n)}}class I extends s{static#v=function(e,t){return!1};#I;#w=0;#O=0;constructor(e=I.#v){super(),this.#I=e}apply(e,t,r,n){return this.#O++,null!==n&&this.#I(n.elementHead,n.elementTail)&&this.#w++,null}getPositives(){return this.#w}getTotal(){return this.#O}reset(){this.#O=0,this.#w=0}}class w{static and(e,t){return function(r,n){return e(r,n)&&t(r,n)}}static or(e,t){return function(r,n){return e(r,n)||t(r,n)}}static not(e){return function(t,r){return!e(t,r)}}static TRUE=function(e,t){return!0};static IS_AIR=function(e,t){return n.getTypeClass(e)===n.TYPE_AIR};static IS_EFFECT=function(e,t){return n.getTypeClass(e)===n.TYPE_EFFECT};static IS_GAS=function(e,t){return n.getTypeClass(e)===n.TYPE_GAS};static IS_FLUID=function(e,t){return n.getTypeClass(e)===n.TYPE_FLUID};static IS_WATER=function(e,t){return n.getBehaviour(e)===n.BEHAVIOUR_LIQUID&&n.getTypeClass(e)===n.TYPE_FLUID};static IS_POWDER=function(e,t){const r=n.getTypeClass(e);return r===n.TYPE_POWDER||r===n.TYPE_POWDER_FLOATING||r===n.TYPE_POWDER_WET};static IS_SAND=function(e,t){return!!w.IS_POWDER(e,t)&&(0===n.getBehaviour(e)&&6===n.getTypeModifierPowderMomentum(e))};static IS_SOIL=function(e,t){if(w.IS_POWDER(e,t)){return n.getBehaviour(e)===n.BEHAVIOUR_SOIL}return!1};static IS_GRAVEL=function(e,t){return!!w.IS_POWDER(e,t)&&(0===n.getBehaviour(e)&&3===n.getTypeModifierPowderMomentum(e))};static IS_STATIC=function(e,t){return n.getTypeClass(e)===n.TYPE_STATIC};static IS_SOLID_BODY=function(e,t){return n.getTypeClass(e)===n.TYPE_STATIC&&n.getTypeModifierSolidBodyId(e)>0};static IS_ENTITY=function(e,t){return n.getBehaviour(e)===n.BEHAVIOUR_ENTITY};static IS_BIOMASS=function(e,t){const r=n.getBehaviour(e);return r===n.BEHAVIOUR_GRASS||r===n.BEHAVIOUR_TREE||r===n.BEHAVIOUR_TREE_LEAF||r===n.BEHAVIOUR_TREE_TRUNK||r===n.BEHAVIOUR_TREE_ROOT||r===n.BEHAVIOUR_ENTITY};static IS_TREE_PART=function(e,t){const r=n.getBehaviour(e);return r===n.BEHAVIOUR_TREE||r===n.BEHAVIOUR_TREE_LEAF||r===n.BEHAVIOUR_TREE_TRUNK||r===n.BEHAVIOUR_TREE_ROOT}}class O extends l{constructor(e){super(e)}apply(e,t,i,s){const a=this._retrieveElement(e,t,i,s);if(null===a)return null;const o=n.getHeatModIndex(a.elementHead);if(n.hmiToMeltingTemperature(o)<1<<n.FIELD_TEMPERATURE_SIZE){let e=a.elementHead;e=n.setHeatModIndex(e,n.hmiToMeltingHMI(o)),e=n.setType(e,n.TYPE_FLUID);let t=h.setBlurType(a.elementTail,h.BLUR_TYPE_1);return new r(e,t)}return a}}class b extends l{#b;#_;constructor(e,t,r){super(r),this.#b=e,this.#_=t}apply(e,t,i,s){const a=this._retrieveElement(e,t,i,s);let o=a.elementHead;const l=n.type8Solid(n.TYPE_STATIC,this.#b,this.#_);return o=n.setType(o,l),new r(o,a.elementTail)}}class _ extends l{constructor(e){super(e)}apply(e,t,i,s){const a=this._retrieveElement(e,t,i,s);if(null===a)return null;if(n.getBehaviour(a.elementHead)===n.BEHAVIOUR_FIRE_SOURCE){const e=n.setBehaviour(a.elementHead,n.BEHAVIOUR_NONE);return new r(e,a.elementTail)}return null}}class M{static#M(e){return e.split("\n").filter((e=>""!==e.trim())).map((e=>e.split(",").map(Number)))}static counting(e){return new I(e)}static custom(e){return new v(e)}static random(e){let t;for(let n of e)if(n instanceof r){if(!0===t)throw"Mixing Element and Brush instances";t=!1}else{if(!(n instanceof s))throw"Element or Brush instances expected";if(!1===t)throw"Mixing Element and Brush instances";t=!0}return t?new a(e):new o(e)}static color(e=0,t=0,r=0,n=void 0){return new c(e,t,r,n)}static colorTexture(e,t=void 0){return new m(t,e)}static colorPaletteRandom(e,t=void 0){return"string"==typeof e&&(e=M.#M(e)),new d(t,e)}static colorPaletteCyclic(e,t=1,r=void 0){return"string"==typeof e&&(e=M.#M(e)),new R(r,e,t)}static colorRandomize(e,t=void 0){return new S(t,e)}static colorNoise(e,t=void 0,r=void 0,n=void 0,i=void 0){return new y(i,e,t,r,n)}static withIntensity(e,t){return M.custom(((r,n,s,a)=>(s||i.DEFAULT).next()<e?t.apply(r,n,s,a):null))}static gentle(e){return M.conditional(w.IS_AIR,e)}static conditional(e,t){return M.custom(((r,n,i,s)=>null===s?null:e(s.elementHead,s.elementTail)?t.apply(r,n,i,s):null))}static temperature(e){return M.custom(((t,i,s,a)=>{if(null===a)return null;const o=n.setTemperature(a.elementHead,255&e);return new r(o,a.elementTail)}))}static temperatureOrBrush(e,t){return M.custom(((i,s,a,o)=>{if(null===o)return t.apply(i,s,a,null);switch(n.getTypeClass(o.elementHead)){case n.TYPE_AIR:case n.TYPE_EFFECT:return t.apply(i,s,a,o);case n.TYPE_POWDER:case n.TYPE_POWDER_WET:case n.TYPE_POWDER_FLOATING:case n.TYPE_FLUID:case n.TYPE_GAS:case n.TYPE_STATIC:const l=n.setTemperature(o.elementHead,255&e);return new r(l,o.elementTail);default:return t.apply(i,s,a,null)}}))}static concat(e,t){return M.custom(((r,n,i,s)=>{const a=e.apply(r,n,i,s),o=t.apply(r,n,i,null!==a?a:s);return null!==o?o:a}))}static join(e){return M.custom(((t,r,n,i)=>{let s=i;for(let i of e){const e=i.apply(t,r,n,s);null!==e&&(s=e)}return s}))}static molten(e){return new O(e)}static extinguished(e){return new _(e)}static toSolidBody(e,t=void 0,r=void 0){return new b(e,t,r)}}class x{static NOT_DEFINED=new x;#x;constructor(e={}){this.#x=e}derive(e){const t={};return Object.assign(t,this.#x),Object.assign(t,e),new x(t)}getCategory(){return this.#x.category}getDisplayName(){return this.#x.displayName}getCodeName(){return this.#x.codeName}getBadgeStyle(){return this.#x.badgeStyle}getSvgIcon(){return this.#x.icon?.svg}}class H{getWidth(){throw"Not implemented"}getHeight(){throw"Not implemented"}}class D{#x;constructor(e=x.NOT_DEFINED){this.#x=e}getInfo(){return this.#x}hasCursor(){return!1}createCursor(){return null}isRepeatingEnabled(){return!1}applyPoint(e,t,r,n){}isLineModeEnabled(){return!1}onDragStart(e,t,r,n){}onDragEnd(e,t,r,n){}applyStroke(e,t,r,n,i,s){}isAreaModeEnabled(){return!1}applyArea(e,t,r,n,i,s){}applySpecial(e,t,r,n){}isSecondaryActionEnabled(){return!1}applySecondaryAction(e,t,r,n){}}class N extends D{#H;#D;constructor(e,t,r){super(e),this.#H=t,this.#D=r}getBrush(){return this.#H}isLineModeEnabled(){return!0}isAreaModeEnabled(){return!0}isRepeatingEnabled(){return!0}applyPoint(e,t,r,n){this.applyStroke(e,t,e,t,r,n)}applyStroke(e,t,r,n,i,s){const a=this.#N(s);i.drawLine(e,t,r,n,this.#D,a,!0)}applyArea(e,t,r,n,i,s){const a=this.#N(s);i.drawRectangle(e,t,r,n,a)}applySpecial(e,t,r,n){const i=this.#N(n);r.floodFill(e,t,i,1)}#N(e){let t=this.#H;return e&&(t=M.gentle(t)),t}}class L extends D{#H;#L=M.conditional(w.IS_STATIC,M.toSolidBody(2,!1));#D;#U=!1;#B=[];constructor(e,t,r){super(e),this.#H=t,this.#D=r}getBrush(){return this.#H}isLineModeEnabled(){return!0}isAreaModeEnabled(){return!0}isRepeatingEnabled(){return!1}applyPoint(e,t,r,n){}applyStroke(e,t,r,n,i,s){const a=this.#N(s);i.drawLine(e,t,r,n,this.#D,a,!0)}applyArea(e,t,r,n,i,s){const a=this.#N(s);i.drawRectangle(e,t,r,n,a)}applySpecial(e,t,r,n){const i=this.#N(n);r.floodFill(e,t,i,1)}onDragStart(e,t,r,n){this.#U=!0}onDragEnd(e,t,r,n){this.#U=!1;for(const[e,t]of this.#B)r.draw(e,t,this.#L);this.#B=[]}#N(e){let t=this.#H;return e&&(t=M.gentle(t)),this.#U?M.custom(((e,i,s,a)=>{const o=t.apply(e,i,s,a);if(null!==o){const t=n.setType(o.elementHead,n.TYPE_STATIC);return this.#B.push([e,i]),new r(t,o.elementTail)}return null})):t}}class U extends D{#P;constructor(e,t){super(e),this.#P=t}applyPoint(e,t,r,n){for(const{dx:n,dy:i,brush:s}of this.#P)r.draw(e+n,t+i,s)}}class B extends D{#F;#k;#Y;constructor(e,t,r,n){super(e),this.#F=t,this.#k=r,this.#Y=n}applyPoint(e,t,r,n){const s=Math.trunc(t/4);e<s+10?r.draw(e+s,1,this.#Y):e>r.getWidth()-s-10?r.draw(e-s,1,this.#k):e<r.getWidth()/2?i.DEFAULT.next()<.8?r.draw(e+s,1,this.#Y):r.draw(e,1,this.#F):i.DEFAULT.next()<.8?r.draw(e-s,1,this.#k):r.draw(e,1,this.#F)}}class P{static TRANSPARENT_ELEMENT=new r(4294967295,4294967295);static LITTLE_ENDIAN=!0;static create(e,t,r){let n=new DataView(new ArrayBuffer(e*t*4)),i=new DataView(new ArrayBuffer(e*t*4)),s=new P(e,t,n,i);for(let e=0;e<s.#V;e++)for(let t=0;t<s.#W;t++)s.setElement(t,e,r);return s}static from(e,t,r,n){return new P(e,t,new DataView(r),new DataView(n))}#W;#V;#G;#z;constructor(e,t,r,n){this.#W=e,this.#V=t,this.#G=r,this.#z=n}isValidPosition(e,t){return!(e<0||t<0)&&!(e>=this.#W||t>=this.#V)}setElement(e,t,r){null!==r&&this.setElementHeadAndTail(e,t,r.elementHead,r.elementTail)}setElementHeadAndTail(e,t,r,n){const i=4*(this.#W*t+e);this.#G.setUint32(i,r,P.LITTLE_ENDIAN),this.#z.setUint32(i,n,P.LITTLE_ENDIAN)}setElementHead(e,t,r){const n=4*(this.#W*t+e);this.#G.setUint32(n,r,P.LITTLE_ENDIAN)}setElementTail(e,t,r){const n=4*(this.#W*t+e);this.#z.setUint32(n,r,P.LITTLE_ENDIAN)}getElement(e,t){const n=4*(this.#W*t+e),i=this.#G.getUint32(n,P.LITTLE_ENDIAN),s=this.#z.getUint32(n,P.LITTLE_ENDIAN);return new r(i,s)}getElementHead(e,t){const r=4*(this.#W*t+e);return this.#G.getUint32(r,P.LITTLE_ENDIAN)}getElementHeadOrNull(e,t){return this.isValidPosition(e,t)?this.getElementHead(e,t):null}getElementTail(e,t){const r=4*(this.#W*t+e);return this.#z.getUint32(r,P.LITTLE_ENDIAN)}getElementTailOrNull(e,t){return this.isValidPosition(e,t)?this.getElementTail(e,t):null}swap(e,t,r,n){const i=this.getElementHead(e,t),s=this.getElementHead(r,n);this.setElementHead(r,n,i),this.setElementHead(e,t,s);const a=this.getElementTail(e,t),o=this.getElementTail(r,n);this.setElementTail(r,n,a),this.setElementTail(e,t,o)}getDataHeads(){return this.#G.buffer}getDataTails(){return this.#z.buffer}getWidth(){return this.#W}getHeight(){return this.#V}}class F extends H{#K;constructor(e){super(),this.#K=e}getWidth(){return this.#K.getWidth()}getHeight(){return this.#K.getHeight()}getElementArea(){return this.#K}}class k extends D{static asElementArea(e){return e.createElementArea(k.DEFAULT_W,k.DEFAULT_H,P.TRANSPARENT_ELEMENT)}static DEFAULT_W=30;static DEFAULT_H=30;#K;#X;#j;constructor(e,t,r,n){super(e),this.#K=t,this.#X=r,this.#j=n}applyPoint(e,t,r,n){const i=this.#K,s=e-Math.trunc(i.getWidth()/2),a=t-Math.trunc(i.getHeight()/2);let o=M.custom(((e,t)=>{const r=i.getElement(e-s,t-a);return r.elementHead!==P.TRANSPARENT_ELEMENT.elementHead&&r.elementTail!==P.TRANSPARENT_ELEMENT.elementTail?r:null}));n&&(o=M.gentle(o));for(let e=0;e<i.getWidth()&&s+e<r.getWidth();e++){const t=s+e;if(!(t<0))for(let e=0;e<i.getHeight()&&a+e<r.getHeight();e++){const n=a+e;n<0||r.draw(t,n,o)}}for(const e of this.#X){const t=Object.assign({},e);"number"==typeof t.x&&(t.x+=s),"number"==typeof t.y&&(t.y+=a),r.entities().insertEntity(t)}void 0!==this.#j&&this.#j()}hasCursor(){return!0}createCursor(){return new F(this.#K)}}class Y extends D{#J;#q;#j;constructor(e,t,r){super(e),this.#J=t,this.#j=r,this.#Z()}#Z(){if(void 0===this.#J.length||0===this.#J.length)throw"Scenes not set";const e=i.DEFAULT.nextInt(this.#J.length),t=this.#J[e],r=k.asElementArea(t),n=t.createEntities(),s=null!==n?n:[];this.#q=new k(this.getInfo(),r,s,this.#j)}applyPoint(e,t,r,n){this.#q.applyPoint(e,t,r,n),this.#Z()}hasCursor(){return!0}createCursor(){return this.#q.createCursor()}}class V extends D{#Q;constructor(e,t){super(e),this.#Q=t}applyPoint(e,t,r,n){this.#Q(e,t,r,n)}}class W extends r{x;y;constructor(e,t,r,n){super(r,n),this.x=e,this.y=t}}class G{static NEIGHBOURHOOD_VON_NEUMANN=0;static NEIGHBOURHOOD_MOORE=1;static NEIGHBOURHOOD_SOLID_BODY=2;#K;#$;#ee;constructor(e,t=G.NEIGHBOURHOOD_VON_NEUMANN,r){this.#K=e,this.#ee=t,this.#$=r}#te(){return this.#ee===G.NEIGHBOURHOOD_SOLID_BODY?255:4071}paint(e,t,r){const i=this.#te(),s=this.#re(this.#K.getElementHead(e,t))&i,a=this.#K.getWidth(),o=new Set,l=[];let h=e+t*a;do{let e=h%a,t=Math.trunc(h/a);if(o.has(h))continue;this.#$.draw(e,t,r),o.add(h),this.#ne(e,t-1,i,s,o,l),this.#ne(e+1,t,i,s,o,l),this.#ne(e,t+1,i,s,o,l),this.#ne(e-1,t,i,s,o,l);let c=!1;if(this.#ee===G.NEIGHBOURHOOD_MOORE)c=!0;else if(this.#ee===G.NEIGHBOURHOOD_SOLID_BODY){const r=this.#K.getElementHead(e,t);0===n.getTypeModifierSolidNeighbourhoodType(r)&&(c=!0)}c&&(this.#ne(e+1,t+1,i,s,o,l),this.#ne(e+1,t-1,i,s,o,l),this.#ne(e-1,t+1,i,s,o,l),this.#ne(e-1,t-1,i,s,o,l))}while(null!=(h=l.pop()))}#ne(e,t,r,n,i,s){const a=this.#K.getWidth(),o=this.#K.getHeight();if(e<0||t<0)return;if(e>=a||t>=o)return;if(!this.#ie(e,t,r,n))return;const l=e+t*a;i.has(l)||s.push(l)}#ie(e,t,r,n){let i=this.#K.getElementHead(e,t);return i=this.#re(i),(i&r)===n}#re(e){return n.getTypeClass(e)===n.TYPE_POWDER_WET&&(e=n.setTypeClass(e,n.TYPE_POWDER)),e}}class z{static copyNonSolidElements(e,t=null){const r=[];return e(M.custom(((e,i,s,a)=>function(e){const t=n.getTypeClass(e);return t>n.TYPE_AIR&&t<n.TYPE_STATIC}(a.elementHead)?(r.push(new W(e,i,a.elementHead,a.elementTail)),t):null))),r}static copySolidBodies(e,t,r,i){const s=[];return e(M.custom(((e,a,o,l)=>{if(n.getTypeClass(l.elementHead)===n.TYPE_STATIC&&0!==n.getTypeModifierSolidBodyId(l.elementHead)){const n=z.copySolidBody(e,a,t,r,i);for(const e of n)s.push(e)}return null}))),s}static copySolidBody(e,t,r,n,i=null){const s=[],a=M.custom(((e,t,r,n)=>(s.push(new W(e,t,n.elementHead,n.elementTail)),null)));if(r.floodFill(e,t,a,G.NEIGHBOURHOOD_SOLID_BODY),s.length>n)return[];for(let e of s)r.draw(e.x,e.y,i);return s}static copyEntities(e,t,r){const n=[],i=[];return e(M.custom(((e,s,a,o)=>{for(const a of t.entities().getAt(e,s))if(a.isActive()){const[e,t]=a.extract(r,0,0);i.push(e),n.push(...t)}return null}))),[i,n]}static trimmed(e,t){if(0===e.length)return[null,null];let r=Number.MAX_VALUE,n=Number.MIN_VALUE,i=Number.MAX_VALUE,s=Number.MIN_VALUE;for(const t of e)r=Math.min(r,t.x),n=Math.max(n,t.x),i=Math.min(i,t.y),s=Math.max(s,t.y);const a=n-r+1,o=s-i+1,l=P.create(a,o,P.TRANSPARENT_ELEMENT);for(const t of e){const e=t.x-r,n=t.y-i;l.setElement(e,n,t)}for(let e of t)"number"==typeof e.x&&(e.x-=r),"number"==typeof e.y&&(e.y-=i);return[l,t]}}class K extends D{#D;#se;#ae=null;constructor(e,t,r){super(e),this.#D=t,this.#se=r}applyPoint(e,t,r,n){null===this.#ae?this.#ae=this.#oe(e,t,r):(this.#ae.applyPoint(e,t,r,n),this.#ae=null)}onDragStart(e,t,r,n){}onDragEnd(e,t,r,n){null!==this.#ae&&(this.#ae.applyPoint(e,t,r,n),this.#ae=null)}#oe(e,t,r){const[n,i]=this.#le(e,t,r);return null!==n?new k(new x,n,i):null}#le(e,t,r){const n=r.getDefaults().getDefaultElement(),i=n=>r.drawLine(e,t,e,t,this.#D,n,!0),s=[];s.push(...z.copyNonSolidElements(i,n)),s.push(...z.copySolidBodies(i,r,this.#se,n));const[a,o]=z.copyEntities(i,r,n);return s.push(...o),z.trimmed(s,a)}isAreaModeEnabled(){return!0}applyArea(e,t,r,n,i,s){this.#ae=this.#he(e,t,r,n,i)}#he(e,t,r,n,i){const[s,a]=this.#ce(e,t,r,n,i);return null!==s?new k(new x,s,a):null}#ce(e,t,r,i,s){const a=Math.abs(e-r)+1,o=Math.abs(t-i)+1,l=P.create(a,o,P.TRANSPARENT_ELEMENT),h=[],c=s.getDefaults().getDefaultElement();let d=!0;const u=M.custom(((a,o,u,m)=>{for(const r of s.entities().getAt(a,o))if(r.isActive()){const[n]=r.extract(c,e,t);h.push(n)}if(n.getTypeClass(m.elementHead)>n.TYPE_AIR){let n=a-Math.min(e,r),s=o-Math.min(t,i);return l.setElement(n,s,m),d=!1,c}return null}));return s.drawRectangle(e,t,r,i,u,!1),d?null:[l,h]}isSecondaryActionEnabled(){return null!==this.#ae}applySecondaryAction(e,t,r,n){this.#ae=null}hasCursor(){return null!==this.#ae}createCursor(){return null!==this.#ae?this.#ae.createCursor():null}}class X extends D{#de;constructor(e,t){super(e),this.#de=t}getTools(){return this.#de}}class j extends D{#ue;constructor(e,t){super(e),this.#ue=t}getTemplateDefinitions(){return this.#ue}}class J extends D{#Q;constructor(e,t){super(e),this.#Q=t}getHandler(){return this.#Q}}class q{static OPT_CYCLES_PER_SECOND=120;static OPT_FRAMES_PER_SECOND=60;getIteration(){throw"Not implemented"}getDefaults(){throw"Not implemented"}isFallThroughEnabled(){throw"Not implemented"}isErasingEnabled(){throw"Not implemented"}trigger(e,t){throw"Not implemented"}triggerSolidCreated(e,t,r){throw"Not implemented"}}class Z{elementArea;random;processorContext;entityManager;constructor(e,t,r,n){this.elementArea=e,this.random=t,this.processorContext=r,this.entityManager=n}}class Q extends D{#me;#Ee;constructor(e,t){super(e),this.#me=t,this.#ge()}#ge(){const e=P.create(1,1,P.TRANSPARENT_ELEMENT),t=i.DEFAULT,r=new q,n=new Z(e,t,r);this.#Ee=this.#me({},n)}applyPoint(e,t,r,n){const i=this.#Ee.serialize();i.x=e,i.y=t,r.entities().insertEntity(i),this.#ge()}hasCursor(){return!0}createCursor(){const[e,t]=this.#Ee.countMaxBoundaries(),r=P.TRANSPARENT_ELEMENT,n=P.create(e+4,t+4,r),s=Math.trunc(n.getWidth()/2),a=Math.trunc(n.getHeight()/2);return this.#Ee.paint(s,a,n,i.DEFAULT),new F(n)}}class ${static#x(e){if(e instanceof x)return e;if(void 0===e)return x.NOT_DEFINED;if("object"==typeof e)return new x(e);throw"Incorrect tool info type: "+typeof e}static roundBrushTool(e,t,r){return new N($.#x(r),e,t)}static roundBrushToolForSolidBody(e,t,r){return new L($.#x(r),e,t)}static pointBrushTool(e,t){return new U($.#x(t),[{dx:0,dy:0,brush:e}])}static multiPointBrushTool(e,t){return new U($.#x(t),e)}static meteorTool(e,t,r,n){return new B($.#x(n),e,t,r)}static insertScenesTool(e,t,r){if(1===e.length){const n=e[0],i=k.asElementArea(n),s=n.createEntities(),a=null!==s?s:[];return new k($.#x(r),i,a,t)}return new Y($.#x(r),e,t)}static actionTool(e,t){return new V($.#x(t),e)}static globalActionTool(e,t){return new J($.#x(t),e)}static moveTool(e,t,r){return new K($.#x(r),e,t)}static templateSelectionTool(e,t){return new j($.#x(t),e)}static selectionTool(e,t){return new X($.#x(t),e)}static insertEntityTool(e,t){return new Q($.#x(t),e)}static grouping(e,t){const r=[],n={};for(const i of e){const e=i.getInfo().getCategory();if(void 0!==e&&void 0!==t[e]){let t=n[e];void 0===t&&(t=[],n[e]=t,r.push(t)),t.push(i)}else r.push(i)}const i=[];for(const e of r)if(Array.isArray(e)){const r=e[0].getInfo().getCategory(),n=t[r];i.push($.selectionTool(e,$.#x({...n,codeName:"category_"+r})))}else i.push(e);return i}}var ee=[{entriesCount:310,entries:[[0,-1,4],[0,1,1],[0,2,1],[0,3,1],[0,4,1],[0,5,1],[0,6,1],[0,7,1],[0,8,1],[0,9,1],[0,10,1],[0,11,1],[0,12,1],[0,13,1],[0,14,1],[0,15,1],[0,16,1],[0,17,1],[-1,17,1],[0,18,1],[1,18,1],[2,18,1],[3,19,1],[4,20,1],[5,21,2],[0,19,1],[0,20,1],[0,21,1],[0,22,1],[0,23,1],[-1,23,1],[-2,23,1],[-3,24,1],[-4,25,1],[-5,25,1],[-6,25,1],[-7,25,2],[0,24,1],[1,25,1],[1,26,1],[1,27,1],[2,28,1],[3,29,1],[4,30,1],[5,30,2],[0,28,1],[0,29,1],[-1,30,1,[[-2,31,1],[-3,31,1],[-4,31,2],[-2,32,1],[-1,33,1],[-1,34,1],[0,35,1],[0,36,2]]],[1,-1,4],[1,0,1],[1,1,1],[1,2,1],[1,3,1],[1,4,1],[1,5,1],[1,6,1],[1,7,1],[1,8,1],[1,9,1],[1,10,1],[1,11,1],[1,12,1],[1,13,1],[1,14,1],[1,15,1],[1,16,1],[1,17,1],[2,19,1],[1,19,1],[1,20,1],[1,21,1],[1,22,1],[1,23,1],[1,24,1],[2,25,1],[2,26,1],[2,27,1],[1,28,1],[1,29,1],[1,30,1],[1,31,1],[2,32,1],[2,33,1],[2,34,1],[3,34,1],[3,35,1],[4,35,1],[5,35,1],[6,36,1,[[7,36,1],[8,37,1],[8,38,2],[9,38,1],[10,39,1],[11,39,1],[12,40,1],[13,40,1],[14,40,1],[15,40,1],[16,40,2]]],[3,36,1],[3,37,1],[4,38,1],[5,39,1,[[6,40,1],[6,41,1],[6,42,1],[7,43,1],[8,44,2]]],[2,38,1,[[1,39,1],[0,39,1],[-1,40,1],[-2,40,1],[-2,41,2],[-3,41,1],[-4,41,1],[-5,42,1],[-6,42,1],[-7,43,1],[-8,43,1],[-9,43,2]]],[3,20,1],[4,21,1],[5,21,2],[5,22,1],[6,23,1],[7,24,1],[8,25,1],[8,26,2],[9,26,1,[]],[-1,-1,4],[-1,0,1],[-1,1,1],[-1,2,1],[-1,3,1],[-1,4,1],[-1,5,1],[-1,6,1],[-1,7,1],[-1,8,1],[-1,9,1],[-1,10,1],[-1,11,1],[-1,12,1],[-1,13,1],[-1,14,1],[-1,15,1],[-1,16,1],[-1,24,1],[-2,25,1],[-3,26,1],[-4,27,1],[-5,27,1],[-6,28,1],[-7,29,1],[-8,30,1],[-9,31,1],[-10,31,1,[[-9,32,1],[-9,33,1],[-9,34,1],[-9,35,1],[-8,36,1],[-7,36,1],[-6,36,1],[-5,37,2],[-8,37,1],[-7,38,1],[-7,39,1],[-6,40,1],[-6,41,1],[-9,38,1],[-10,38,2]]],[9,27,1],[10,28,1],[11,29,1],[12,30,1],[13,31,1],[13,32,1],[14,33,2],[10,30,1],[10,31,1],[9,32,1],[8,33,2],[12,41,1],[12,42,1],[13,43,1],[13,44,1],[13,45,1],[14,46,2],[-6,43,1],[-5,44,1],[-4,44,1],[-3,45,1],[-2,46,1],[-1,46,1],[0,47,1],[1,48,1],[2,48,1],[3,48,2],[-3,47,2],[-2,-1,4],[-2,0,1],[-2,1,1],[-2,2,1],[-2,3,1],[-2,4,1],[-2,5,1],[-2,6,1],[-2,7,1],[-2,8,1],[-2,9,1],[-2,10,1],[-2,11,1],[-2,12,1],[-2,13,1],[-2,14,1],[-2,15,1],[-2,16,1],[-2,17,1],[-1,18,1],[-1,19,1],[-1,20,1],[-1,21,1],[-1,22,1],[-2,24,1],[-3,25,1],[-4,26,1],[-5,26,1],[-6,27,1],[-7,28,1],[-8,29,1],[-9,30,1],[-10,30,2],[-10,31,1,[[-11,32,1],[-12,32,1],[-13,33,1],[-14,34,1],[-15,35,1],[-16,35,1],[-17,35,2],[-14,36,1],[-14,37,1],[-14,38,1],[-14,39,1],[-15,40,1],[-15,41,1],[-16,41,2],[-15,42,1],[-15,43,1,[[-16,44,1],[-16,45,1],[-15,45,1],[-14,46,1],[-13,46,1],[-12,47,1],[-12,48,2],[-11,48,1],[-10,49,1],[-9,49,1],[-8,50,1],[-7,51,1],[-6,52,2],[-16,46,1],[-16,47,1],[-17,48,1],[-17,49,1],[-18,50,2]]]]],[4,39,1],[4,40,1],[4,41,1],[4,42,1],[3,42,1],[4,43,1],[5,44,1],[5,45,1],[5,46,1],[6,47,1],[7,48,1],[8,49,1],[8,50,2],[5,48,1,[[4,49,1],[3,50,1],[2,51,1],[1,52,1],[1,53,1],[0,53,2],[0,54,1],[0,55,1],[0,56,1],[1,57,1],[2,57,1],[3,57,1],[4,58,2],[-1,57,1],[-2,57,1],[-3,58,1],[-4,59,2]]],[2,43,2]]},{entriesCount:319,entries:[[0,-1,4],[0,1,1],[0,2,1],[0,3,1],[0,4,1],[0,5,1],[0,6,1],[0,7,1],[0,8,1],[0,9,1],[0,10,1],[0,11,1],[0,12,1],[0,13,1],[0,14,1],[0,15,1],[0,16,1],[0,17,1],[0,18,1],[-1,18,1],[-2,18,1],[-3,19,1],[-4,20,1],[-5,21,2],[0,19,1],[0,20,1],[0,21,1],[0,22,1],[0,23,1],[1,23,1],[2,23,1],[3,24,1],[4,25,1],[5,25,1],[6,25,1],[7,25,2],[0,24,1],[-1,25,1],[-1,26,1],[-1,27,1],[0,28,1],[0,29,1],[1,30,1,[[2,31,1],[3,31,1],[4,31,2],[2,32,1],[1,33,1],[1,34,1],[0,35,1],[0,36,2]]],[-2,28,1],[-3,29,1],[-4,30,1],[-5,30,2],[-1,-1,4],[-1,0,1],[-1,1,1],[-1,2,1],[-1,3,1],[-1,4,1],[-1,5,1],[-1,6,1],[-1,7,1],[-1,8,1],[-1,9,1],[-1,10,1],[-1,11,1],[-1,12,1],[-1,13,1],[-1,14,1],[-1,15,1],[-1,16,1],[-1,17,1],[-1,19,1],[-2,19,1],[-1,20,1],[-1,21,1],[-1,22,1],[-1,23,1],[-1,24,1],[-2,25,1],[-2,26,1],[-2,27,1],[-1,28,1],[-1,29,1],[-1,30,1],[-1,31,1],[-2,32,1],[-2,33,1],[-2,34,1],[-3,34,1],[-3,35,1],[-4,35,1],[-5,35,1],[-6,36,1,[[-7,36,1],[-8,37,1],[-9,38,1],[-9,39,2],[-10,39,1],[-11,39,1],[-12,40,1],[-13,40,1],[-14,40,1],[-15,40,1],[-16,40,2]]],[-3,36,1],[-3,37,1],[-2,38,1,[[-1,39,1],[0,39,1],[1,40,1],[2,40,1],[3,41,1],[4,41,1],[5,42,1],[6,42,1],[7,43,1],[8,43,1],[9,44,2],[3,42,2],[-2,40,2]]],[-4,38,1],[-5,39,1,[[-6,40,1],[-6,41,1],[-6,42,1],[-7,43,1],[-7,44,2]]],[-3,20,1],[-4,21,1],[-5,21,2],[-5,22,1],[-6,23,1],[-7,24,1],[-8,25,1],[-8,26,2],[-9,26,1,[]],[1,-1,4],[1,0,1],[1,1,1],[1,2,1],[1,3,1],[1,4,1],[1,5,1],[1,6,1],[1,7,1],[1,8,1],[1,9,1],[1,10,1],[1,11,1],[1,12,1],[1,13,1],[1,14,1],[1,15,1],[1,16,1],[1,17,1],[1,18,1],[1,19,1],[1,24,1],[2,25,1],[3,26,1],[4,27,1],[5,27,1],[6,28,1],[7,29,1],[8,30,1],[9,31,1],[9,32,1],[9,33,1],[9,34,1],[8,34,2],[9,35,1],[8,36,1],[7,36,1],[6,36,1],[5,37,2],[8,37,1],[9,38,1],[7,38,1],[7,39,1],[6,40,1],[6,41,1],[-9,27,1],[-10,28,1],[-11,29,1],[-12,30,1],[-13,31,1],[-13,32,1],[-14,33,2],[-12,41,1],[-12,42,1],[-13,43,1],[-13,44,1],[-13,45,1],[-14,46,2],[6,43,1],[5,44,1],[4,44,1],[3,45,1],[2,45,1],[1,45,1],[0,45,2],[1,46,1],[0,47,1],[-1,48,1],[-2,48,1],[-3,48,2],[4,46,1],[5,47,2],[2,-1,4],[2,0,1],[2,1,1],[2,2,1],[2,3,1],[2,4,1],[2,5,1],[2,6,1],[2,7,1],[2,8,1],[2,9,1],[2,10,1],[2,11,1],[2,12,1],[2,13,1],[2,14,1],[2,15,1],[2,16,1],[2,17,1],[2,18,1],[2,19,1],[2,20,1],[1,20,1],[1,21,1],[1,22,1],[2,24,1],[3,25,1],[4,26,1],[5,26,1],[6,27,1],[7,28,1],[8,29,1],[9,30,1],[10,30,2],[10,31,1],[11,32,1],[12,33,1],[13,34,1],[14,35,1],[15,35,1],[16,35,2],[14,36,1],[14,37,1],[14,38,1],[14,39,1],[15,40,1],[15,41,1],[16,41,2],[8,38,1],[9,39,1],[10,40,1],[11,40,1],[12,41,1],[12,42,1],[13,43,1],[14,44,1],[15,45,1],[16,46,1],[16,47,1],[17,48,1],[17,49,1],[18,50,2],[14,46,1],[13,46,1],[12,47,1],[12,48,2],[11,48,1],[10,49,1],[9,49,1],[8,50,1],[7,51,1],[6,52,2],[-4,39,1],[-5,39,1,[[-4,40,1],[-4,41,1],[-4,42,1],[-4,43,1],[-5,44,1],[-5,45,1],[-5,46,1],[-6,47,1],[-6,48,1],[-6,49,1],[-6,50,1],[-7,50,2],[-6,51,1],[-7,52,1],[-8,52,1],[-9,53,1],[-9,54,1],[-10,55,2]]],[-2,49,1],[-2,50,1],[-2,51,1],[-2,52,1],[-1,53,1],[-1,54,1],[0,54,2],[-1,55,1],[0,56,1],[1,56,1],[2,57,1],[3,58,2],[-2,56,1],[-3,56,1],[-4,56,1],[-5,57,2]]},{entriesCount:269,entries:[[0,-1,4],[0,1,1],[0,2,1],[0,3,1],[0,4,1],[0,5,1],[0,6,1],[0,7,1],[0,8,1],[0,9,1],[0,10,1],[0,11,1],[0,12,1],[0,13,1],[0,14,1],[0,15,1],[0,16,1],[0,17,1],[0,18,1],[0,19,1],[0,20,1,[[-1,20,1],[0,21,1],[1,21,1],[2,22,1],[2,23,1],[3,24,1],[3,25,1],[2,25,2],[4,26,1],[5,27,1],[6,28,1],[7,28,1],[8,29,1],[9,30,1],[10,31,1],[11,32,2],[3,27,1],[3,28,1],[3,29,1],[2,30,1],[1,31,1],[0,31,2],[0,22,1],[0,23,1],[-1,24,1],[-2,25,1],[-2,26,1],[-3,27,1],[-4,28,1],[-5,29,1],[-6,29,2],[-5,30,1],[-6,31,1],[-7,31,1],[-8,31,1],[-9,32,1],[-10,32,1],[-11,33,2],[-2,21,1],[-3,22,1],[-4,23,1],[-5,23,2]]],[1,-1,4],[1,0,1],[1,1,1],[1,2,1],[1,3,1],[1,4,1],[1,5,1],[1,6,1],[1,7,1],[1,8,1],[1,9,1],[1,10,1],[1,11,1],[1,12,1],[1,13,1],[1,14,1],[1,15,1],[1,16,1],[1,17,1],[1,18,1],[1,19,1],[1,20,1],[0,20,1,[[-1,21,1],[-1,22,1],[-1,23,1]]],[-1,25,1],[-1,26,1],[-1,27,1],[-2,27,1],[-3,28,1],[-4,29,1],[0,28,1,[[1,29,1],[1,30,1],[2,31,1],[3,32,1],[3,33,1],[3,34,1],[4,35,1],[4,36,1],[4,37,1],[3,37,2],[0,31,2]]],[-5,31,1],[-5,32,1],[-5,33,1],[-6,34,1,[[-7,35,1],[-8,36,1],[-8,37,2],[-9,37,1],[-10,38,1],[-10,39,1],[-11,40,1],[-12,41,1],[-11,42,2]]],[-1,-1,4],[-1,0,1],[-1,1,1],[-1,2,1],[-1,3,1],[-1,4,1],[-1,5,1],[-1,6,1],[-1,7,1],[-1,8,1],[-1,9,1],[-1,10,1],[-1,11,1],[-1,12,1],[-1,13,1],[-1,14,1],[-1,15,1],[-1,16,1],[-1,17,1],[-1,18,1],[-1,19,1],[0,20,1,[]],[2,21,1],[3,22,1],[3,23,1],[4,24,1],[4,25,1],[5,26,1],[6,27,1],[6,29,1],[6,30,1],[7,31,1],[7,32,1],[7,33,1],[8,34,1],[8,35,1],[8,36,1],[8,37,1],[9,37,2],[8,38,1],[8,39,1],[9,40,1],[9,41,1],[9,42,1],[10,43,2],[-4,34,1],[-4,35,1],[-4,36,1],[-4,37,1],[-3,38,1],[-2,38,2],[-3,39,1],[-3,40,1],[-3,41,1],[-3,42,1],[-2,42,1],[-1,42,1],[0,43,1],[1,43,1],[2,43,1],[3,44,2],[-3,43,1],[-4,44,2],[2,-1,4],[2,0,1],[2,1,1],[2,2,1],[2,3,1],[2,4,1],[-2,5,1],[-2,6,1],[-2,7,1],[-2,8,1],[-2,9,1],[-2,10,1],[-2,11,1],[-2,12,1],[2,13,1],[2,14,1],[2,15,1],[2,16,1],[2,17,1],[2,18,1],[2,19,1],[2,20,1],[-5,27,1],[-6,27,1],[-7,28,1],[-8,28,1],[-9,29,1],[-10,29,1],[-11,29,1],[-12,29,1],[-13,29,1],[-14,29,2],[-14,30,1],[-15,31,1],[-15,32,1],[-16,33,1],[-16,34,1],[-17,35,1],[-17,36,1],[-18,37,2],[-6,29,2],[9,34,1],[10,35,1],[11,35,1],[12,36,1],[13,37,1],[14,37,1],[15,38,1],[16,38,1],[17,38,2],[-5,38,1],[-6,39,1],[-6,40,1],[-7,41,1],[-7,42,1],[-8,43,1],[-8,44,1],[-9,45,1],[-9,46,1],[-8,47,2],[-10,47,1],[-10,48,1],[-11,49,1],[-11,50,1],[-12,51,2],[7,39,1],[7,40,1],[6,41,1],[6,42,1],[6,43,1],[6,44,1],[5,45,1],[5,46,1],[5,47,1],[4,47,1],[5,48,1],[5,49,1],[4,50,1],[3,51,2],[3,48,1],[2,48,1],[1,48,1],[0,48,1],[-1,49,1],[-2,49,1],[-3,49,2]]},{entriesCount:268,entries:[[0,-1,4],[0,1,1],[0,2,1],[0,3,1],[0,4,1],[0,5,1],[0,6,1],[0,7,1],[0,8,1],[0,9,1],[0,10,1],[0,11,1],[0,12,1],[0,13,1],[0,14,1],[0,15,1],[0,16,1],[0,17,1],[0,18,1],[0,19,1],[0,20,1,[[1,20,1],[2,21,1],[3,22,1],[4,23,1],[5,23,2],[0,21,1],[-1,21,1],[0,22,1],[0,23,1],[1,24,1],[2,25,1],[2,26,1],[3,27,1],[4,28,1],[5,29,1],[6,29,2],[5,30,1],[6,31,1],[7,31,1],[8,31,1],[9,32,1],[10,32,1],[11,33,2],[-2,22,1],[-2,23,1],[-3,24,1],[-3,25,1],[-2,25,2],[-4,26,1],[-3,27,1],[-3,28,1],[-3,29,1],[-2,30,1],[-1,31,1],[0,31,2],[-5,27,1],[-6,28,1],[-7,28,1],[-8,29,1],[-9,30,1],[-10,31,1],[-11,31,1],[-12,31,1],[-13,31,2]]],[-1,-1,4],[-1,0,1],[-1,1,1],[-1,2,1],[-1,3,1],[-1,4,1],[-1,5,1],[-1,6,1],[-1,7,1],[-1,8,1],[-1,9,1],[-1,10,1],[-1,11,1],[-1,12,1],[-1,13,1],[-1,14,1],[-1,15,1],[-1,16,1],[-1,17,1],[-1,18,1],[-1,19,1],[-1,20,1],[0,20,1,[[1,21,1],[1,22,1],[1,23,1]]],[1,25,1],[1,26,1],[2,27,1],[3,28,1],[4,29,1],[4,30,1],[5,31,1],[5,32,1],[5,33,1],[6,34,1,[[7,35,1],[8,36,1],[8,37,2],[9,37,1],[10,38,1],[10,39,1],[11,40,1],[12,41,2]]],[-4,27,1],[-4,28,1],[-4,29,1],[-4,30,1],[-4,31,1],[-3,32,1],[-3,33,1],[-3,34,1],[-3,35,1],[-3,36,1],[-3,37,2],[1,-1,4],[1,0,1],[1,1,1],[1,2,1],[1,3,1],[1,4,1],[1,5,1],[1,6,1],[1,7,1],[1,8,1],[1,9,1],[1,10,1],[1,11,1],[1,12,1],[1,13,1],[1,14,1],[1,15,1],[1,16,1],[1,17,1],[1,18,1],[1,19,1],[0,20,1,[]],[-2,21,1],[-3,22,1],[-3,23,1],[-4,24,1],[-4,25,1],[-5,26,1],[-6,27,1],[-6,29,1],[-6,30,1],[-7,31,1],[-7,32,1],[-7,33,1],[-8,34,1],[-8,35,1],[-8,36,1],[-8,37,1],[-9,37,2],[-8,38,1],[-8,39,1],[-9,40,1],[-9,41,1],[-9,42,1],[-10,43,2],[4,34,1],[4,35,1],[4,36,1],[4,37,1],[3,38,1],[2,38,2],[3,39,1],[3,40,1],[3,41,1],[3,42,1],[2,42,1],[1,42,1],[0,43,1],[-1,43,1],[-2,43,1],[-3,44,2],[3,43,1],[4,44,2],[-2,-1,4],[-2,0,1],[-2,1,1],[-2,2,1],[-2,3,1],[-2,4,1],[-2,5,1],[-2,6,1],[-2,7,1],[-2,8,1],[-2,9,1],[-2,10,1],[-2,11,1],[-2,12,1],[-2,13,1],[-2,14,1],[-2,15,1],[-2,16,1],[-2,17,1],[-2,18,1],[-2,19,1],[-2,20,1],[6,25,1],[5,25,1],[4,25,1],[3,25,1],[7,26,1],[8,26,1],[9,27,1],[10,27,1],[11,27,2],[11,28,1],[12,28,1],[13,29,1],[14,30,1],[15,31,1],[16,31,2],[15,32,1],[16,33,1],[16,34,1],[17,35,1],[17,36,1],[17,37,2],[-9,34,1],[-10,35,1],[-11,35,1],[-12,36,1],[-13,37,1],[-14,37,1],[-15,38,1],[-16,39,2],[5,38,1],[6,39,1],[6,40,1],[7,41,1],[7,42,1],[8,43,1],[8,44,1],[9,45,1],[9,46,1],[10,47,1],[10,48,1],[11,49,1],[11,50,1],[12,51,2],[8,47,2],[-7,39,1],[-7,40,1],[-6,41,1],[-6,42,1],[-6,43,1],[-6,44,1],[-5,45,1],[-5,46,1],[-5,47,1],[-5,48,1],[-4,49,1],[-3,49,1],[-2,49,1],[-1,49,1],[0,49,1],[1,49,1],[2,49,2],[-4,50,1],[-5,51,2]]},{entriesCount:169,entries:[[0,-1,4],[0,1,1],[0,2,1],[0,3,1],[0,4,1],[0,5,1],[0,6,1],[0,7,1],[0,8,1],[0,9,1],[0,10,1],[0,11,1],[0,12,1],[0,13,1],[0,14,1],[0,15,1],[0,16,1],[0,17,1],[0,18,1],[0,19,1],[0,20,1,[[-1,20,1],[0,21,1],[1,21,1],[2,22,1],[2,23,1],[3,24,1],[3,25,1],[3,26,1],[4,27,1],[4,28,1],[4,29,2],[0,22,1],[0,23,1],[0,24,2],[-2,21,1],[-3,22,1],[-4,23,1],[-4,24,1],[-5,25,1],[-6,26,2]]],[1,-1,4],[1,0,1],[1,1,1],[1,2,1],[1,3,1],[1,4,1],[1,5,1],[1,6,1],[1,7,1],[1,8,1],[1,9,1],[1,10,1],[1,11,1],[1,12,1],[1,13,1],[1,14,1],[1,15,1],[1,16,1],[1,17,1],[1,18,1],[1,19,1],[1,20,1],[0,20,1,[[-1,21,1],[-1,22,1],[-1,23,1],[-1,24,1],[0,24,2],[-2,25,1],[-2,26,1],[-2,27,1],[-2,28,1],[-3,29,1],[-4,30,1],[-5,30,1],[-4,31,1],[-4,32,1],[-3,33,1],[-2,34,1],[-2,35,1],[-1,36,1],[0,36,1],[1,36,2],[-5,33,2],[-6,31,1],[-7,31,1],[-8,31,1],[-9,31,1],[-10,31,2]]],[-1,-1,4],[-1,0,1],[-1,1,1],[-1,2,1],[-1,3,1],[-1,4,1],[-1,5,1],[-1,6,1],[-1,7,1],[-1,8,1],[-1,9,1],[-1,10,1],[-1,11,1],[-1,12,1],[-1,13,1],[-1,14,1],[-1,15,1],[-1,16,1],[-1,17,1],[-1,18,1],[-1,19,1],[0,20,1,[]],[-5,24,1],[-6,24,1],[-7,24,1],[-8,24,1],[-9,24,1],[-10,24,1],[-11,24,2],[6,25,1],[5,25,1],[4,25,1],[7,26,1],[8,26,1],[9,26,2],[-1,25,1],[-1,26,1],[-1,27,1],[-1,28,1],[0,28,1],[1,29,1],[2,30,1],[3,31,1],[4,32,1],[5,32,1],[6,33,1],[7,33,1],[8,34,1],[9,34,2],[5,34,1],[5,35,1],[5,36,1],[5,37,1],[5,38,1],[6,39,2],[-1,29,1],[-1,30,1],[-1,31,1],[-1,32,1],[-1,33,1],[-1,34,1],[-1,35,1],[-3,35,1],[-4,36,1],[-5,37,1],[-6,38,1],[-7,39,2],[-1,37,1],[-1,38,1],[-1,39,1],[-1,40,1],[-2,40,1],[-1,41,1],[-1,42,2],[-3,41,1],[-4,42,1],[-5,42,1],[-6,43,1],[-7,43,2]]},{entriesCount:73,entries:[[0,-1,4],[0,1,1],[0,2,1],[0,3,1],[0,4,1],[0,5,1],[0,6,1],[0,7,1],[0,8,1],[0,9,1],[0,10,1],[0,11,1],[0,12,1],[0,13,1],[0,14,1],[-1,14,1,[[-2,14,1],[-3,14,1],[-4,15,1],[-5,16,2],[0,15,1],[0,16,1],[0,17,1],[0,18,1],[1,18,1,[[2,18,1],[3,19,1],[4,20,1],[5,20,2],[0,19,1],[-1,20,1],[-1,21,1],[-1,22,1],[0,23,1],[0,24,1],[1,25,1],[2,26,1],[3,26,1],[4,26,2],[-1,25,1],[-1,26,1],[-1,27,1],[-1,28,1],[0,29,1],[0,30,1],[0,31,2],[-2,23,1],[-3,24,1],[-4,25,1],[-5,25,2]]]]],[1,-1,4],[1,0,1],[1,1,1],[1,2,1],[1,3,1],[1,4,1],[1,5,1],[1,6,1],[1,7,1],[1,8,1],[1,9,1],[1,10,1],[1,11,1],[1,12,1],[1,13,1],[1,14,1],[1,15,1],[1,16,1],[1,17,1],[1,18,1,[]],[0,20,1],[0,21,1],[0,22,1]]},{entriesCount:60,entries:[[0,-1,4],[0,1,1],[0,2,1],[0,3,1],[0,4,1],[0,5,1],[0,6,1],[0,7,1],[0,8,1],[0,9,1],[0,10,1],[0,11,1],[0,12,1],[0,13,1],[0,14,1],[0,15,1],[-1,15,1],[0,16,1],[0,17,1],[1,18,1],[2,19,1],[3,20,1],[4,20,2],[1,20,1],[0,21,1],[0,22,1],[-1,22,1],[-2,23,1],[-3,24,2],[1,23,1],[2,24,1],[2,25,1],[3,26,2],[-2,16,1],[-3,17,1],[-3,18,1],[-3,19,2],[1,-1,4],[1,0,1],[1,1,1],[1,2,1],[1,3,1],[1,4,1],[-1,4,1],[-1,5,1],[-1,6,1],[-1,7,1],[-1,8,1],[-1,9,1],[-1,10,1],[1,10,1],[1,11,1],[1,12,1],[1,13,1],[1,14,1],[1,15,1],[1,16,1],[1,17,1],[0,18,1],[1,19,1]]},{entriesCount:55,entries:[[0,-1,4],[0,1,1],[0,2,1],[0,3,1],[0,4,1],[0,5,1],[0,6,1],[0,7,1],[-1,7,1],[-1,8,1],[-1,9,1],[-1,10,1],[-1,11,1],[-1,12,1],[-1,13,1],[-1,14,1],[-1,15,1],[0,15,1,[[1,16,1],[2,17,1],[3,18,2],[-1,16,1],[-1,17,1],[-1,18,1],[-1,19,1],[-1,20,1],[-1,21,1],[-1,22,1],[0,23,1],[1,24,1],[2,25,2],[-2,23,1],[-3,24,1],[-4,25,2]]],[-2,15,1,[[-3,16,1],[-4,17,1],[-5,18,2]]],[-1,-1,4],[-1,0,1],[-1,1,1],[-1,2,1],[-1,3,1],[-1,4,1],[-1,5,1],[-1,6,1],[-2,7,1],[-2,8,1],[-2,9,1],[-2,10,1],[-2,11,1],[-2,12,1],[-2,13,1],[-2,14,1],[-2,15,1,[]]]}],te=[{entriesCount:49,entries:[[1,0,3,[[2,0,3],[1,-1,3],[2,-1,3],[3,0,3],[2,1,3],[3,-1,3],[3,1,3],[4,0,3],[3,-2,3],[3,2,3],[4,1,3],[4,-2,3]]],[-1,0,3,[[-2,0,3],[-3,0,3],[-2,1,3],[-2,-1,3],[-3,1,3],[-3,-1,3],[-4,0,3],[-2,2,3],[-3,2,3],[-2,3,3]]],[0,-1,3,[[-1,-1,3],[0,-2,3],[-1,-2,3],[0,-3,3],[1,-2,3],[-2,-2,3],[-1,-3,3],[1,-3,3],[2,-2,3],[2,-3,3],[3,-3,3]]],[0,1,3,[[1,1,3],[-1,1,3],[0,2,3],[1,2,3],[-1,2,3],[0,3,3],[2,2,3],[1,3,3],[2,3,3],[1,4,3],[3,3,3],[2,4,3]]]]},{entriesCount:55,entries:[[0,-1,3,[[0,-2,3],[-1,-1,3],[0,-3,3],[-1,-2,3],[1,-2,3],[-1,-3,3],[1,-3,3],[-2,-2,3],[2,-2,3]]],[-1,0,3,[[-2,0,3],[-2,-1,3],[-3,0,3],[-3,-1,3],[-4,0,3],[-3,1,3],[-4,-1,3],[-3,-2,3],[-4,1,3],[-3,2,3],[-4,-2,3]]],[1,0,3,[[1,-1,3],[1,1,3],[2,0,3],[2,-1,3],[2,1,3],[3,0,3],[3,-1,3],[3,1,3],[4,0,3],[4,-1,3],[3,-2,3],[4,1,3],[5,0,3],[5,-1,3],[4,-2,3]]],[0,1,3,[[0,2,3],[-1,1,3],[1,2,3],[-1,2,3],[0,3,3],[-2,1,3],[2,2,3],[1,3,3],[-2,2,3],[-1,3,3],[0,4,3],[2,3,3],[3,2,3],[1,4,3],[-1,4,3],[0,5,3]]]]},{entriesCount:82,entries:[[-1,0,3,[[-2,0,3],[-2,1,3],[-3,0,3],[-3,1,3],[-4,0,3],[-3,-1,3],[-4,1,3],[-4,-1,3],[-5,0,3],[-5,1,3],[-4,2,3],[-5,-1,3],[-4,-2,3],[-6,0,3],[-5,2,3],[-6,1,3],[-4,3,3],[-5,3,3]]],[0,1,3,[[0,2,3],[-1,1,3],[1,1,3],[-1,2,3],[1,2,3],[0,3,3],[-2,2,3],[-1,3,3],[1,3,3],[2,2,3],[0,4,3],[-2,3,3],[-1,4,3],[1,4,3],[2,3,3],[0,5,3],[3,3,3],[0,6,3],[3,4,3]]],[0,-1,3,[[1,-1,3],[0,-2,3],[-1,-1,3],[1,-2,3],[-1,-2,3],[0,-3,3],[-2,-1,3],[2,-2,3],[1,-3,3],[-1,-3,3],[-2,-2,3],[0,-4,3],[2,-3,3],[-1,-4,3],[-3,-2,3],[3,-3,3],[4,-3,3]]],[1,0,3,[[2,0,3],[3,0,3],[2,1,3],[2,-1,3],[3,1,3],[3,-1,3],[4,0,3],[4,1,3],[3,2,3],[4,-1,3],[3,-2,3],[5,0,3],[4,2,3],[5,1,3],[5,-1,3],[4,-2,3],[6,0,3],[4,3,3],[6,-1,3],[7,0,3],[4,4,3],[7,-1,3],[5,4,3],[4,5,3]]]]},{entriesCount:63,entries:[[1,0,3,[[2,0,3],[2,1,3],[2,-1,3],[3,0,3],[3,1,3],[3,-1,3],[4,0,3],[4,1,3],[4,-1,3],[3,-2,3],[5,0,3],[5,1,3],[5,-1,3],[6,0,3]]],[0,-1,3,[[-1,-1,3],[0,-2,3],[1,-1,3],[-2,-1,3],[-1,-2,3],[0,-3,3],[1,-2,3],[-2,-2,3],[-1,-3,3],[1,-3,3],[2,-2,3],[-3,-2,3],[2,-3,3]]],[0,1,3,[[1,1,3],[-1,1,3],[0,2,3],[1,2,3],[-1,2,3],[0,3,3],[2,2,3],[1,3,3],[-1,3,3],[-2,2,3],[3,2,3],[-2,3,3],[-1,4,3],[-3,2,3],[-3,3,3],[-2,4,3],[-4,2,3],[-4,3,3]]],[-1,0,3,[[-2,0,3],[-2,1,3],[-3,0,3],[-3,1,3],[-3,-1,3],[-4,0,3],[-4,1,3],[-4,-1,3],[-5,0,3],[-5,1,3],[-5,-1,3],[-6,0,3],[-6,1,3],[-5,2,3]]]]},{entriesCount:48,entries:[[-1,0,3,[[-1,-1,3],[-2,0,3],[-2,-1,3],[-3,0,3],[-3,-1,3],[-4,0,3],[-3,1,3],[-4,-1,3],[-3,-2,3],[-4,1,3],[-3,-3,3]]],[0,-1,3,[[1,-1,3],[0,-2,3],[1,-2,3],[0,-3,3],[-1,-2,3],[2,-2,3],[0,-4,3],[-1,-3,3],[-2,-2,3],[2,-3,3],[-1,-4,3],[-2,-3,3]]],[0,1,3,[[0,2,3],[-1,1,3],[1,2,3],[0,3,3],[-1,2,3],[-2,1,3],[-1,3,3],[-2,2,3],[-3,2,3]]],[1,0,3,[[1,1,3],[2,0,3],[2,1,3],[3,0,3],[2,-1,3],[3,1,3],[2,2,3],[4,0,3],[3,-1,3],[4,1,3],[3,2,3],[5,1,3]]]]},{entriesCount:57,entries:[[0,1,3,[[1,1,3],[0,2,3],[1,2,3],[-1,2,3],[0,3,3],[1,3,3],[2,2,3],[-1,3,3],[0,4,3],[2,3,3],[1,4,3],[-1,4,3],[-2,3,3],[0,5,3],[3,3,3],[2,4,3],[-1,5,3],[3,4,3]]],[-1,0,3,[[-2,0,3],[-1,-1,3],[-1,1,3],[-2,1,3],[-3,0,3],[-2,-1,3],[-2,2,3],[-3,1,3],[-3,-1,3],[-2,-2,3]]],[0,-1,3,[[0,-2,3],[-1,-2,3],[0,-3,3],[1,-2,3],[-1,-3,3],[1,-3,3],[0,-4,3],[-1,-4,3],[-2,-3,3],[2,-3,3],[1,-4,3],[0,-5,3],[-2,-4,3],[-1,-5,3],[3,-3,3],[2,-4,3],[1,-5,3],[3,-4,3]]],[1,0,3,[[1,-1,3],[2,0,3],[2,-1,3],[3,0,3],[2,1,3],[2,-2,3],[3,1,3]]]]},{entriesCount:86,entries:[[0,1,3,[[0,2,3],[-1,1,3],[0,3,3],[1,2,3],[-1,2,3],[1,3,3],[-1,3,3],[2,2,3],[-2,2,3],[2,3,3],[-2,3,3],[-3,2,3]]],[1,0,3,[[1,1,3],[2,0,3],[2,1,3],[3,0,3],[3,1,3],[3,-1,3],[4,0,3],[4,1,3],[3,2,3],[4,-1,3],[5,0,3],[4,2,3],[4,-2,3],[5,-1,3],[5,-2,3],[4,-3,3],[6,-1,3],[5,-3,3],[6,-2,3],[4,-4,3],[7,-1,3],[6,-3,3],[5,-4,3],[7,-2,3],[4,-5,3],[5,-5,3]]],[-1,0,3,[[-2,0,3],[-1,-1,3],[-3,0,3],[-2,1,3],[-2,-1,3],[-4,0,3],[-3,-1,3],[-3,1,3],[-2,-2,3],[-4,1,3],[-4,-1,3],[-3,-2,3],[-4,-2,3],[-3,-3,3],[-4,-3,3],[-5,-2,3],[-4,-4,3],[-5,-3,3],[-5,-4,3],[-6,-3,3],[-6,-4,3]]],[0,-1,3,[[1,-1,3],[0,-2,3],[1,-2,3],[2,-1,3],[-1,-2,3],[0,-3,3],[1,-3,3],[2,-2,3],[-1,-3,3],[1,-4,3],[2,-3,3],[3,-2,3],[-1,-4,3],[-2,-3,3],[2,-4,3],[3,-3,3],[-2,-4,3],[-1,-5,3],[2,-5,3],[-2,-5,3],[-3,-4,3],[-3,-5,3],[-2,-6,3]]]]},{entriesCount:41,entries:[[1,0,3,[[2,0,3],[1,1,3],[3,0,3],[2,1,3],[2,-1,3],[3,1,3],[3,-1,3],[4,0,3],[2,2,3],[4,1,3],[3,-2,3],[4,-2,3]]],[-1,0,3,[[-2,0,3],[-3,0,3],[-2,1,3],[-3,1,3],[-4,1,3],[-4,2,3]]],[0,1,3,[[0,2,3],[-1,1,3],[-1,2,3],[-1,3,3],[-2,2,3],[-2,3,3],[-3,2,3],[-2,4,3],[-3,3,3],[-3,4,3]]],[0,-1,3,[[0,-2,3],[1,-1,3],[-1,-1,3],[-1,-2,3],[1,-2,3],[2,-2,3],[2,-3,3],[3,-3,3],[3,-4,3]]]]},{entriesCount:47,entries:[[0,1,3,[[0,2,3],[1,1,3],[1,2,3],[-1,2,3],[1,3,3],[2,2,3],[-2,2,3]]],[-1,0,3,[[-1,-1,3],[-1,1,3],[-2,0,3],[-2,-1,3],[-2,1,3],[-3,0,3],[-3,-1,3],[-3,1,3],[-4,0,3],[-4,-1,3],[-4,1,3],[-5,0,3],[-5,1,3]]],[0,-1,3,[[1,-1,3],[0,-2,3],[1,-2,3],[-1,-2,3],[0,-3,3],[1,-3,3],[2,-2,3],[2,-3,3],[3,-2,3],[2,-4,3],[3,-3,3],[4,-2,3],[3,-4,3]]],[1,0,3,[[2,0,3],[2,1,3],[2,-1,3],[3,0,3],[3,1,3],[3,-1,3],[4,0,3],[4,-1,3],[5,0,3],[5,-1,3]]]]}];class re{static TREE_TRUNK_TEMPLATES=ee;static TREE_CLUSTER_TEMPLATES=te}var ne="94,70,42\r\n109,82,53";class ie{static NONE=M.custom((()=>null));static _TEST_SOLID=M.random([new r(n.of(n.type8(n.TYPE_STATIC)),h.of(255,0,125))]);static _TEST_AIR=M.random([new r(n.of(n.type8(n.TYPE_AIR)),h.of(255,0,125))]);static AIR=M.random([new r(n.of(n.type8(n.TYPE_AIR)),h.of(255,255,255,h.BLUR_TYPE_BACKGROUND))]);static WALL=M.colorPaletteRandom("55,55,55\r\n57,57,57",M.random([new r(n.of(n.type8(n.TYPE_STATIC),n.behaviour8(0),n.modifiers8(n.HMI_CONDUCTIVE_1)),h.of(0,0,0,h.BLUR_TYPE_NONE,h.HEAT_EFFECT_2))]));static ROCK=M.join([M.random([new r(n.of(n.type8(n.type8Solid(n.TYPE_STATIC,1,!1)),n.behaviour8(),n.modifiers8(n.HMI_CONDUCTIVE_1)),h.of(155,155,155,h.BLUR_TYPE_NONE,h.HEAT_EFFECT_2))]),M.colorNoise([{seed:40,factor:60,threshold:.4,force:.9},{seed:41,factor:30,threshold:.4,force:.9},{seed:42,factor:15,threshold:.4,force:.5},{seed:43,factor:3,threshold:.1,force:.1}],79,69,63),M.colorNoise([{seed:51,factor:30,threshold:.4,force:.9},{seed:52,factor:15,threshold:.4,force:.5},{seed:53,factor:3,threshold:.1,force:.1}],55,48,46),M.colorNoise([{seed:61,factor:30,threshold:.4,force:.9},{seed:62,factor:15,threshold:.4,force:.5},{seed:63,factor:3,threshold:.1,force:.1}],33,29,28)]);static BRICK=M.join([M.random([new r(n.of(n.type8(n.type8Solid(n.TYPE_STATIC,4,!1)),n.behaviour8(),n.modifiers8(n.HMI_CONDUCTIVE_1)),h.of(0,0,0,h.BLUR_TYPE_NONE,h.HEAT_EFFECT_2))]),M.colorTexture("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAAXNSR0IArs4c6QAAALtJREFUKFNjvHz++P+vn98zfPzwjgEE+AWEwDQ3ryDDs8d3GRi35qb8Bwk8evWawTA7neH81JkMcmKiDL9+/WJgY2NjYJwe7v+fk4sbrEsy0Ivh4pI1DGLcXAz8bCxgMcausID/vIxgQxjkwrwZHq3ayvD5PyNY0fdvXxkYCboBpODRvLlgE0D2gsCLDx8ZQNaCTThxaNv/G/OXgO28/f4T2OhXX7+BFYKsBltxpKMDrAMkARIEuQFEg8QA9mBbK1rMQigAAAAOZVhJZk1NACoAAAAIAAAAAAAAANJTkwAAAABJRU5ErkJggg=="),M.colorNoise({seed:4011,factor:10,threshold:.5,force:.2})]);static WOOD=M.join([M.random([new r(n.of(n.type8(n.type8Solid(n.TYPE_STATIC,3)),n.behaviour8(),n.modifiers8(n.HMI_WOOD_LIKE)),h.of(0,0,0,h.BLUR_TYPE_NONE,h.HEAT_EFFECT_1))]),M.colorTexture("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAICAYAAAAvOAWIAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAAySURBVChTYyyKsP8vIMTPQAxggtJEAbDJUDZBQJLJYMVcnCxEYdJN/vb9D1GYBJMZGABQ9iJQOWTXQgAAAABJRU5ErkJggg=="),M.colorNoise({seed:1515,factor:10,threshold:.5,force:.1},255,255,255)]);static METAL=M.join([M.random([new r(n.of(n.type8(n.type8Solid(n.TYPE_STATIC,2,!1)),n.behaviour8(n.BEHAVIOUR_LIQUID,n.SPECIAL_LIQUID_HEAVY_MOLTEN),n.modifiers8(n.HMI_METAL)),h.of(155,155,155,h.BLUR_TYPE_NONE,h.HEAT_EFFECT_3))]),M.colorNoise([{seed:40,factor:40,threshold:.4,force:.75},{seed:40,factor:20,threshold:.5,force:.4},{seed:40,factor:10,threshold:.4,force:.2},{seed:40,factor:5,threshold:.4,force:.1}],135,135,135),M.colorNoise([{seed:41,factor:10,threshold:.4,force:.4},{seed:41,factor:6,threshold:.3,force:.3},{seed:41,factor:4,threshold:.5,force:.3}],130,130,130)]);static METAL_MOLTEN=M.join([ie.METAL,M.temperature(180),M.molten()]);static SAND=M.colorPaletteRandom("214,212,154\r\n214,212,154\r\n214,212,154\r\n214,212,154\r\n225,217,171\r\n225,217,171\r\n225,217,171\r\n225,217,171\r\n203,201,142\r\n203,201,142\r\n203,201,142\r\n203,201,142\r\n195,194,134\r\n195,194,134\r\n218,211,165\r\n218,211,165\r\n223,232,201\r\n186,183,128",M.custom(((e,t,i)=>{const s=i.nextInt(100)<60?n.TYPE_POWDER:n.TYPE_POWDER_WET,a=n.of(n.type8Powder(s,6),n.behaviour8(),n.modifiers8(n.HMI_CONDUCTIVE_2)),o=h.of(0,0,0,h.BLUR_TYPE_1,h.HEAT_EFFECT_2);return new r(a,o)})));static SOIL=M.colorPaletteRandom("142,104,72\r\n142,104,72\r\n142,104,72\r\n142,104,72\r\n142,104,72\r\n142,104,72\r\n114,81,58\r\n114,81,58\r\n114,81,58\r\n114,81,58\r\n114,81,58\r\n114,81,58\r\n82,64,30\r\n82,64,30\r\n82,64,30\r\n177,133,87\r\n177,133,87\r\n177,133,87\r\n102,102,102",M.custom(((e,t,i)=>{const s=i.nextInt(100)<40?n.TYPE_POWDER:n.TYPE_POWDER_WET,a=n.of(n.type8Powder(s,5),n.behaviour8(n.BEHAVIOUR_SOIL),n.modifiers8(n.HMI_CONDUCTIVE_1)),o=h.of(0,0,0,h.BLUR_TYPE_1,h.HEAT_EFFECT_1);return new r(a,o)})));static GRAVEL=M.colorPaletteRandom("97,94,88\r\n111,110,106\r\n117,116,112\r\n117,117,113\r\n120,118,115\r\n104,102,97\r\n113,112,107\r\n129,128,125\r\n124,124,121\r\n81,80,75\r\n80,76,69\r\n123,119,111\r\n105,104,99\r\n84,82,78\r\n77,74,69\r\n91,88,82\r\n68,65,60\r\n79,75,69\r\n85,82,77\r\n98,94,88\r\n105,102,96\r\n104,97,86\r\n60,55,47\r\n93,89,81",M.custom(((e,t,i)=>{const s=i.nextInt(100)<20?n.TYPE_POWDER:n.TYPE_POWDER_WET,a=n.of(n.type8Powder(s,3),n.behaviour8(),n.modifiers8(n.HMI_CONDUCTIVE_2)),o=h.of(0,0,0,h.BLUR_TYPE_1,h.HEAT_EFFECT_2);return new r(a,o)})));static COAL=M.colorPaletteRandom("31,31,31\r\n46,44,41\r\n13,13,13\r\n17,17,15",M.custom(((e,t,i)=>{const s=i.nextInt(100)<40?n.TYPE_POWDER:n.TYPE_POWDER_WET,a=n.of(n.type8Powder(s,4),n.behaviour8(),n.modifiers8(n.HMI_COAL)),o=h.of(0,0,0,h.BLUR_TYPE_1,h.HEAT_EFFECT_2,3);return new r(a,o)})));static THERMITE=M.colorPaletteRandom("137,86,89\r\n137,86,89\r\n137,86,89\r\n137,86,89\r\n137,86,89\r\n137,86,89\r\n125,70,72\r\n125,70,72\r\n147,93,96\r\n147,93,96\r\n138,84,86\r\n138,84,86\r\n118,72,75\r\n118,72,75\r\n101,61,65\r\n151,104,106",M.custom(((e,t,i)=>{const s=i.nextInt(100)<60?n.TYPE_POWDER:n.TYPE_POWDER_WET,a=n.of(n.type8Powder(s,5),n.behaviour8(),n.modifiers8(n.HMI_THERMITE)),o=h.of(0,0,0,h.BLUR_TYPE_1,h.HEAT_EFFECT_2,3);return new r(a,o)})));static WATER=M.colorPaletteRandom("4,135,186",M.random([new r(n.of(n.type8Fluid(n.TYPE_FLUID),n.behaviour8(n.BEHAVIOUR_LIQUID,n.SPECIAL_LIQUID_WATER),n.modifiers8(n.HMI_CONDUCTIVE_3)),h.of(0,0,0,h.BLUR_TYPE_1,h.HEAT_EFFECT_NONE))]));static STEAM=M.colorPaletteRandom("147,182,217",M.random([new r(n.of(n.type8Fluid(n.TYPE_GAS),n.behaviour8(n.BEHAVIOUR_LIQUID,n.SPECIAL_LIQUID_WATER),n.modifiers8(n.HMI_CONDUCTIVE_3)),h.of(0,0,0,h.BLUR_TYPE_1,h.HEAT_EFFECT_NONE))]));static OIL=M.colorPaletteRandom("36,26,1",M.random([new r(n.of(n.type8Fluid(n.TYPE_FLUID),n.behaviour8(n.BEHAVIOUR_LIQUID,n.SPECIAL_LIQUID_LIGHT_OIL),n.modifiers8(n.HMI_OIL)),h.of(0,0,0,h.BLUR_TYPE_1,h.HEAT_EFFECT_NONE,3))]));static GRASS=M.random([new r(n.of(n.type8Powder(n.TYPE_POWDER,0),n.behaviour8(n.BEHAVIOUR_GRASS,5),n.modifiers8(n.HMI_GRASS_LIKE)),h.of(56,126,38,h.BLUR_TYPE_1,h.HEAT_EFFECT_1)),new r(n.of(n.type8Powder(n.TYPE_POWDER,0),n.behaviour8(n.BEHAVIOUR_GRASS,3),n.modifiers8(n.HMI_GRASS_LIKE)),h.of(46,102,31,h.BLUR_TYPE_1,h.HEAT_EFFECT_1)),new r(n.of(n.type8Powder(n.TYPE_POWDER,0),n.behaviour8(n.BEHAVIOUR_GRASS,4),n.modifiers8(n.HMI_GRASS_LIKE)),h.of(72,130,70,h.BLUR_TYPE_1,h.HEAT_EFFECT_1))]);static TREE=M.colorPaletteRandom(ne,M.custom(((e,t,i)=>{let s=i.nextInt(re.TREE_TRUNK_TEMPLATES.length);return new r(n.of(n.type8(n.type8Solid(n.TYPE_STATIC,3)),n.behaviour8(n.BEHAVIOUR_TREE,s),n.modifiers8(n.HMI_WOOD_LIKE)),h.of(0,0,0,h.BLUR_TYPE_NONE,h.HEAT_EFFECT_1))})));static TREE_ROOT=M.colorPaletteRandom("75,54,31\r\n67,53,38",M.random([new r(n.of(n.type8(n.type8Solid(n.TYPE_STATIC,3)),n.behaviour8(n.BEHAVIOUR_TREE_ROOT,8),n.modifiers8(n.HMI_WOOD_LIKE)),h.of(0,0,0,h.BLUR_TYPE_NONE,h.HEAT_EFFECT_1)),new r(n.of(n.type8(n.type8Solid(n.TYPE_STATIC,3)),n.behaviour8(n.BEHAVIOUR_TREE_ROOT,5),n.modifiers8(n.HMI_WOOD_LIKE)),h.of(0,0,0,h.BLUR_TYPE_NONE,h.HEAT_EFFECT_1))]));static TREE_WOOD=M.colorPaletteRandom("133,108,80\r\n124,97,67",M.random([new r(n.of(n.type8(n.type8Solid(n.TYPE_STATIC,3)),n.behaviour8(n.BEHAVIOUR_TREE_TRUNK,0),n.modifiers8(n.HMI_WOOD_LIKE)),h.of(0,0,0,h.BLUR_TYPE_NONE,h.HEAT_EFFECT_1))]));static TREE_WOOD_DARK=M.colorPaletteRandom(ne,M.random([new r(n.of(n.type8(n.type8Solid(n.TYPE_STATIC,3)),n.behaviour8(n.BEHAVIOUR_TREE_TRUNK,0),n.modifiers8(n.HMI_WOOD_LIKE)),h.of(0,0,0,h.BLUR_TYPE_NONE,h.HEAT_EFFECT_1))]));static TREE_LEAF_LIGHTER=M.colorPaletteRandom("128,137,79\r\n128,137,79\r\n128,137,79\r\n128,137,79\r\n128,137,79\r\n141,149,91\r\n141,149,91\r\n117,128,71\r\n99,110,65\r\n111,123,68\r\n121,132,73\r\n111,123,74",M.random([new r(n.of(n.type8(n.type8Solid(n.TYPE_STATIC,3)),n.behaviour8(n.BEHAVIOUR_TREE_LEAF,0),n.modifiers8(n.HMI_LEAF_LIKE)),h.of(0,0,0,h.BLUR_TYPE_NONE,h.HEAT_EFFECT_1))]));static TREE_LEAF_DARKER=M.colorPaletteRandom("74,86,47\r\n74,86,47\r\n74,86,47\r\n74,86,47\r\n68,77,40\r\n68,77,40\r\n68,77,40\r\n70,82,42\r\n70,82,42\r\n70,82,42\r\n72,82,46\r\n72,82,46\r\n78,90,48\r\n78,90,48\r\n95,106,60\r\n88,100,57\r\n66,74,36\r\n66,67,35\r\n76,87,52\r\n86,100,53\r\n75,89,47",M.random([new r(n.of(n.type8(n.type8Solid(n.TYPE_STATIC,3)),n.behaviour8(n.BEHAVIOUR_TREE_LEAF,0),n.modifiers8(n.HMI_LEAF_LIKE)),h.of(0,0,0,h.BLUR_TYPE_NONE,h.HEAT_EFFECT_1))]));static#pe=n.of(n.type8(n.TYPE_EFFECT),n.behaviour8(n.BEHAVIOUR_FIRE,0));static FIRE=M.random([new r(n.setTemperature(ie.#pe,255),h.of(249,219,30)),new r(n.setTemperature(ie.#pe,255),h.of(249,219,30)),new r(n.setTemperature(ie.#pe,120),h.of(249,219,30))]);static ASH=M.colorPaletteRandom("131,131,131\r\n131,131,131\r\n131,131,131\r\n131,131,131\r\n131,131,131\r\n131,131,131\r\n135,135,135\r\n135,135,135\r\n135,135,135\r\n135,135,135\r\n135,135,135\r\n135,135,135\r\n145,145,145\r\n145,145,145\r\n145,145,145\r\n145,145,145\r\n145,145,145\r\n145,145,145\r\n148,148,148\r\n148,148,148\r\n148,148,148\r\n148,148,148\r\n148,148,148\r\n148,148,148\r\n160,160,160\r\n160,160,160\r\n160,160,160\r\n160,160,160\r\n160,160,160\r\n160,160,160\r\n114,114,114\r\n193,193,193",M.custom(((e,t,i)=>{const s=i.nextInt(100)<80?n.TYPE_POWDER:n.TYPE_POWDER_WET,a=n.of(n.type8Powder(s,6),n.behaviour8(),n.modifiers8(n.HMI_CONDUCTIVE_2)),o=h.of(0,0,0,h.BLUR_TYPE_1,h.HEAT_EFFECT_2,3);return new r(a,o)})));static METEOR=M.random([new r(n.of(n.type8(n.TYPE_STATIC),n.behaviour8(n.BEHAVIOUR_METEOR,0)),h.of(249,219,30))]);static METEOR_FROM_LEFT=M.random([new r(n.of(n.type8(n.TYPE_STATIC),n.behaviour8(n.BEHAVIOUR_METEOR,2)),h.of(249,219,30))]);static METEOR_FROM_RIGHT=M.random([new r(n.of(n.type8(n.TYPE_STATIC),n.behaviour8(n.BEHAVIOUR_METEOR,4)),h.of(249,219,30))]);static EFFECT_BURNT=M.custom(((e,t,n,i)=>{if(T.isVisualBurnApplicable(i.elementHead)){if(h.getBurntLevel(i.elementTail)<3)return new r(i.elementHead,T.visualBurn(i.elementTail,1))}return null}));static EFFECT_NOISE_LG=M.colorNoise({seed:0,factor:40,threshold:.5,force:.25});static EFFECT_NOISE_MD=M.colorNoise({seed:0,factor:10,threshold:.5,force:.25});static EFFECT_NOISE_SM=M.colorNoise({seed:0,factor:4,threshold:.5,force:.25});static EFFECT_TEMP_0=M.temperature(0);static EFFECT_TEMP_127=M.temperature(127);static EFFECT_TEMP_200=M.temperature(200);static EFFECT_TEMP_255=M.temperature(255);static EFFECT_WET=M.custom(((e,t,i,s)=>{if(null!==s){if(n.getTypeClass(s.elementHead)===n.TYPE_POWDER){const e=n.setTypeClass(s.elementHead,n.TYPE_POWDER_WET);return new r(e,s.elementTail)}return s}return null}));static EFFECT_MOLTEN=M.molten();static EFFECT_EXTINGUISH=M.extinguished();static _LIST={none:ie.NONE,air:ie.AIR,ash:ie.ASH,sand:ie.SAND,soil:ie.SOIL,gravel:ie.GRAVEL,wall:ie.WALL,rock:ie.ROCK,wood:ie.WOOD,brick:ie.BRICK,metal:ie.METAL,metal_molten:ie.METAL_MOLTEN,water:ie.WATER,steam:ie.STEAM,oil:ie.OIL,grass:ie.GRASS,tree:ie.TREE,tree_wood:ie.TREE_WOOD,tree_wood_dark:ie.TREE_WOOD_DARK,tree_leaf:ie.TREE_LEAF_LIGHTER,tree_leaf_dark:ie.TREE_LEAF_DARKER,tree_root:ie.TREE_ROOT,fire:ie.FIRE,meteor:ie.METEOR,meteor_l:ie.METEOR_FROM_LEFT,meteor_r:ie.METEOR_FROM_RIGHT,effect_temp_0:ie.EFFECT_TEMP_0,effect_temp_127:ie.EFFECT_TEMP_127,effect_temp_200:ie.EFFECT_TEMP_200,effect_temp_255:ie.EFFECT_TEMP_255,effect_burnt:ie.EFFECT_BURNT,effect_wet:ie.EFFECT_WET,effect_molten:ie.EFFECT_MOLTEN,effect_extinguished:ie.EFFECT_EXTINGUISH};static byCodeName(e){const t=ie._LIST[e];return void 0!==t?t:null}}class se{static ROCK_SM={info:{displayName:"Small Rock",category:"template"},action:{type:"random-template",actions:[{type:"image-template",imageData:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAATCAYAAACdkl3yAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC7UlEQVQ4T62UPW9cRRiFn5k793Pt682yzoq4wOAoFBEyihA0Bgk6CoqkMBU/gAYpQhR0KdOlhAJRpcF/gC5IKCiYEBnHGCKEsVMYO9rY3t27vp8zdyjAa6+ddJzyaM6j94zeGcX/JHXaAFi89oGtdAaiphFNEDVaLC/fZ3VtXZw+e6QzoHfeftPmRYI2FcbkDAYDXpqdotO5wDzY58HU0tKSt7i4WB4Z0tYMDxOkBCktQsD+XpdGI+Dl2TlW19ZP5kdSJyE3bnz2+k/3fqSscoypKMqS2kjS4RPiyRZ1bZh/7fIzpxqr9nSnu/LGlSs8evQb3W4XB4cyKzFVRTz9Ivu9HtPN1snISGOgYZIQxxM0okn2ZQ9TgRISARRZjjUGAby3sGDv3L07NtUYSGtNmh4y1Zxie3uH0lQox8NKzTDpUwsQAkpdnak4BgrCgCRJ6HQu4AhBXRtcRyGFIMtz/DDAWouUknNx82T0GPTRh9esEJL0MOXg6R5BEJANU4zWSEcS+j7GWoqypNU+z2CYjE01AimlaLdfoMwyHEfSbrfZ3d5BOhIHBwAhBFCjTYVyXebmjtdhBHKwNIKIIPCpipzA85iYCNHGYkpzdAyAPM8JopCNjY2RpwA+//QT+9eff2Ctpq4NeZqhteZ8p0O/N2BQJqOAsFCkKY0oojXZ5Itbt2Y/vn59SwGsPviZdrvFw5U1ZmZmcKVHnue4ro9SPmnexfV90jRHa40fhvT2DximGV9+/dUmIBTA3kGfKApI05zNrU2KosBoTRw36ff7xHGM53lkWYFUCmtrhFDUdc3Dtd+PL3t5dV0AFuDixVcIKsPW48c4rk9a5GAlaVGSpilBFOL6Icrx8IKIb2/enH3/6tV/qx3B3l1YsH8/OQAgmogxViCVS1EUKKEIopDp6Q67u10e/HpPANz54Xvg1EJ+99/avzV/2UaT59A1KC/AcX2KouDVS5e4/c3SmQcLz/iPYFT1jO6v/HLaGukfK6ZXUFEV3tAAAAAASUVORK5CYII=",brush:"rock",threshold:50,randomFlipHorizontally:!0},{type:"image-template",imageData:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAALCAYAAACQy8Z9AAAACXBIWXMAAAsTAAALEwEAmpwYAAAB6klEQVQoU7WSzU4TURiGnzNz5qfTMkEMaFkg0XgXbePCcAWscKXeSG+GRAVvgLgw6J4ASwKr0kCBTmf6M2dmzum4aKhQY1z57M57zvfkTb4j+Q/IxWCRVqNZKjVmefkJtVqVMAzR2lAUOZ/3vorF9/AXaavRLAE8zyHPc4SwiOOYm5sbpLSZ3Xm0Gs1yOIw5Oj55JJ9LW41m+XRlhSxP0dpgjKYoCqS08TwPYzSTyexs25KyLBkOY+r15xwdnzx0zqT3zZIkQTqzJq7rYts2taDKZDxmkqYk05hBP8KREum52LYkSRLetJrl98Mf87YSYL1eZ5KmZFnG0lIVAK0LsixDKYXruqyurvJsbY1Op0OeF0yyFKUUWhcEQZWtrbflwcE3MZcCVHwfKW3G4xFhGOJ5NaR02NzYoNPpcHnZpdfrkRc5QgiwBI4jUUohhCBKBrx++ao8uzgXEuDT3hfx8f2HsuL75IUiDEOMmTIYRJyenNLrXSOEhTaaqTEIYSGwwALf99HaUA2qjOIRj5qqPGNj8wXRXZ9u94rrq2uGoyFRPyKoBjjSwbZsUpUDhnc7O3a73Z7ezz9kLt3d3RXb29ulyQtu726pVAKifkR9fZ3Dn7+XcE+73V6M5jz6p/v7+38Mn12cL0b/5Bf4ONku8uljuAAAAABJRU5ErkJggg==",brush:"rock",threshold:50,randomFlipHorizontally:!0,randomFlipVertically:!0},{type:"image-template",imageData:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAASCAYAAABfJS4tAAAACXBIWXMAAAsTAAALEwEAmpwYAAADFklEQVQ4T7XUz2ucRRzH8fc8z+zMs88++yvG1GRrhUKLWOKhxTZYqeBBinrwUr34X4l4lyLoqQcFxZLakJb+sF7ExkAuSmh2m/3R7JN95vk9HpYkVkJsDn6Ow3xfDDMfRvI/Rf574ahceuuiPTH/Ckop4shQrwdsbm4CMBgMefzHmtjb+0LwtWvXrNaa4XafJEkYDQakacZoOMSVEsdxmJubY2Fh3t5cXhZwCHz50kWrtQZgYhLuP3wgJuMQ/ZICYH7uBOrkqxRZxsbGBtJxMcagqh5PnmztO/vwB1fftzWvSmQMVc9DCMG8Upx7/awd7jxjNwyx1rKzs4MrJVpKTp16jbW1NVrtFiaOcR2HxTfO2d8e/y4kTO9u1B8Sex5SCl6eaSOEi+/7rK+vI5XCWovWinD8jLIsGQwGaK1pNAPKMqe0lloQYK09OHEYhniug680eZLxtNslTQsAlFK4rkteFNRrAXFkyPJ8OuxKhBCEYYiu+vh+jTiOD+A3Fxfpd7fob/XwfR+bQxD4AGitkLoCgC1yZmfaJFlKq9HEdV1MmlD1PIKgxqDfx1XTvRKg2+sx6j2l3WphjKEoCiITAyVe1SOODMJ1sNbSarWZnZ1lYmKstRSjEYXOUUpRlCVSTBsnAX5euS3eu3zFRvEuwquw8ugXcfXKuzbcDTFJhhCCdr3O9vY2Qgji2JDlGdJ1SbOYWuCTJAnNZpOFkx1W7947aMXynZX9cgP8sHJbLF04b+M4RimF79c4fbrOeDwmtwWeVyUIakRJTKfT4c7qXc6cOctX178+vMf/zL1Hv4qlC+dtsyIZ704QQiCES7PeJM9z/vpzk6DZoLvVo9Fu41Tc/dkjYTjApZQsdDoUZUGcJoQ7YxzHwUSGSTSZVq/R2J/7Txim+GeffmK7vS6TKMJxHMqyxHEcsjTFcVzaszN8/sWXx/srAK5/8634+KMPbUVWSNOUNEuxpUVrjTERt26sPvdGLwwD3Pjue/HO20tWCEHQaLAzHHJr9XlwL8eCAbKsRCmXH3+6eSi4l2PD9x8+OBLcy99QElUk8fCpxwAAAABJRU5ErkJggg==",brush:"rock",threshold:50,randomFlipHorizontally:!0}]}};static ROCK_MD={info:{displayName:"Medium Rock",category:"template"},action:{type:"random-template",actions:[{type:"image-template",imageData:"data:image/png;base64,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",brush:"rock",threshold:50,randomFlipHorizontally:!0},{type:"image-template",imageData:"data:image/png;base64,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",brush:"rock",threshold:50,randomFlipHorizontally:!0,randomFlipVertically:!0},{type:"image-template",imageData:"data:image/png;base64,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",brush:"rock",threshold:50,randomFlipHorizontally:!0,randomFlipVertically:!0},{type:"image-template",imageData:"data:image/png;base64,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",brush:"rock",threshold:50,randomFlipHorizontally:!0,randomFlipVertically:!0},{type:"image-template",imageData:"data:image/png;base64,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",brush:"rock",threshold:50,randomFlipHorizontally:!0},{type:"image-template",imageData:"data:image/png;base64,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",brush:"rock",threshold:50,randomFlipHorizontally:!0,randomFlipVertically:!0}]}};static ROCK_LG={info:{displayName:"Large Rock",category:"template"},action:{type:"random-template",actions:[{type:"image-template",imageData:"data:image/png;base64,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",brush:"rock",threshold:50},{type:"image-template",imageData:"data:image/png;base64,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",brush:"rock",threshold:50,randomFlipHorizontally:!0}]}};static CABIN={info:{displayName:"Cabin",category:"template"},action:{type:"image-template",imageData:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC4AAAAkCAYAAAD2IghRAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAFcUlEQVRYR82Y3W4TRxTHf7vetb2Osd2AY18kogqpKkETSC7sUEEAqep9L7jhEfoYfYA+BqqUN6hUKNyUQgnioxcVigOqIR84ITHGG3u9M73YzHr9tXZIgP5udj1n9sx/Zs7MmbHBR2Jp6YpsNBrEYjHu3r2jdduPitFdcFQKhaKMRCIIITCjJq5wKRYXpXBdHvz14Ng6cGzCFxcvSiklZtRESsne3h5CCPSITjqdRkqDQqEodV3n3r0/Ojrww/ffyWjcwjRNIhqsr67x66NHoZ08kvCrV69JIQQArnABqO5VAZg91fDrPduuIqUkeSKJrutcvrwkTdPk1q3fNAApdVxNx2jYtAwTDc9nGB8k/NKly9JxHFzXE4sWFNwCXBJWEoBkMsY3bAMRnlZqaJpGOp2m6TQpFhclQHlnh7NGlpZpEDUMNEIHGzik8Pn5BRkxImi6hhk1/XDQNK1HcCrlPROWQa3mvc+eqgHw5I1A13VS6RS6piOiJk/WN4jHY3w1cRLDjDOMocILhaJ0HAdN00ilUriuy9udtwghuJCTgDfqSrAiYRnU7RZRa4x8zivb2PSec9kaEOHx1luklEQMgy8yGVzh8uzf9fZMhjBQ+MWL30p73yYej2NZFltbW+zv7wP4goNi1Qgr6nYLgN2dPb9M1UkmY9RqDc5PeDMAksdb28RiMVKpFFJKLlyYl/F4vGchK3qEFwpF2Wg2MAyDdCpNpVJBCMF8Xo1ChIRlkc9lfHGHRddN8jnLnwHgoBOCv3dcHMchm80ipGB2dk5alsX9+392dMAXfuXKVbm/v080GsWMmlSrVYQQnJ9wgHYo5HMZ9QmZ8bT/Dt7oqrLgSHfXU+RzELXGAGja79nY3OXcuFoH2+i6TjrjfVssLsp4PM6dO79rAEahUJQArutimIa/4OayLuAykT1JrdboEKxo2u+7i0YuUwQ7mM9l2Nj0QmmOXcDlaWUPNDiRSuEKl0KhKKUQGG6rhSsFTsvBaTrMZZu+I4CtN9sAlF6oePz41O12W7OnvBB9WqliRk2EK7xBfrjy0I+dG9fOyukvJ/2PwFtkCatnKXwG1rl5+4mvtUfRxubuwZTtAt60qWrK9qlRWoL0CK/btY6wqNs1tt607Z8yZDqJdPzqEa52j7ptk7CsLuunJaihbtsdth7h7TDpzV7BvTszng7dLRT9pnl03I6wDdIjPMigbAid21gY3T5GJWEZlF7UBia5UOFBNjY3uosAyOfy3UUjcVR/ocLVQSkznubnX/pfv3768WvZXaYyaPAJXnip95u3/wn1NywMQ4Urwpw07ff+dKqOQjuU1DNhGSOFl/I3LHeEWw8YFGfQaRu1Xhij1gsVHrXGiFrhCzFhGf5BKXjI6mbQAawfg3wECRUeDINB1O0WdbstJExUmC3I7s7e0UJlmOiPybC2Q4VXq7WRLwxqYQ4aqaBtmL+EZfRNOkH6t3JAKpUc2ohC1QurH2YLUrdb5HOZ0HNRqPDg9vZ/I1S42lUAblzrTTQw2g7Qj2H+wnIHDBEeTAbdFwxFdwIKI1hvFH9hhLd0wCiO4HjrDRuEcCsfHgqHYadSASA5ZnXc+sMYKnyYg+MgOda+sHS3l7AMqt7fkh30CC+9KPd9/1y0NQy4ui0tLcnGeBYpJeVymcnJSXRdR9O802epVOLMmTM4jkO5XGZqaopIxHOmaRpS9t0kBqL8qj9Ng5RKJaanpwFotVq8evWKqakprl8/J5eXlzU4ED4/Py+r1Srv3r1DSommabx8+RLw/ihSjp8/fw6AlJK1tTUOy8zMTMdAqM7qus7k5CSvX7/m9OnTzMzM4Louq6ur/rerq6vous7CwoJcWVnR/gMS6rip19cCIwAAAABJRU5ErkJggg==",brush:"wood",threshold:50,randomFlipHorizontally:!0}};static SAND_CASTLE={info:{displayName:"Sand Castle",category:"template"},action:{type:"image-template",imageData:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAAOCAIAAACtuNvgAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAB5UlEQVQoz1XPy04UURAG4Ko6t+6eGRkl0dGFLly5cOv7+AY+itEVCStDfBg1JhICbCQIiAmCc6FP97mXi9EJXZtK/sqXqkJmhv91/PktM7x49QaGdXm4x0pnZ5++fL1OaDM7P9xTciyFPjv4cNecfNsNXNq+db7bjP6x7193gm+ZgtYm39l/9OW9QIyu7RZXRCJEu87luuWcfAqCBI4m2S83rGqmSjYo+8RBCIopDpjSejJ9kktw3UKresNyDq1tkaCutr1bNM10wLgU2/8uIIiZVLVh3t4KIgAjuDeqRlSD33rf3c7n7B0i9N31yf7OOp9OtsfjSVOJ5eImINjuarDtwfaz7Nu2W6ZUtBzZdnV6sAfF5ZRzSYXTw9lzSiUgDdhq+ROZiFDryvteG/3j9Hz2eAqcYvKVHvlu7r1HMoMjjW6kFjFGH3pTVecXNyH4s4s5AxOqEJ2WtRSKsx8w26+8d1LKVLK1rTENQ/ZuRUjj5p5UCjAT4mRrNmBaGYGaGaaTR3XdWLtS0milS4JbO/fe9a6PzDEsTvd3AQCZ+ejTu7oaMRdEijGQaUK3ICRCAYBAzBliDve3Zi4scyopR/nr+CMAh9gJKQVr57sGBQNoo4Gxd50RlaxlA+M/y0sSJiUrSf0F+OQcr89DEA8AAAAASUVORK5CYII=",brush:"sand",threshold:1}}}class ae{static#Ae(e,t){const r=[];for(let n=0;n<e.length;n++){const[i,s]=e[n],[a,o]=t[n];i===a&&s===o||r.push([[i,s],[a,o]])}return r}static#fe(e){const t=[];for(let r=0;r<e.length;r++)t.push(ae.#Ae(e[r],e[r+1<e.length?r+1:0]));return t}static createCyclic(e){const t=ae.#fe(e);let r=Number.MAX_VALUE,n=Number.MAX_VALUE,i=Number.MIN_VALUE,s=Number.MIN_VALUE;for(let t of e)for(let[e,a]of t)r=Math.min(r,e),n=Math.min(n,a),i=Math.max(i,e),s=Math.max(s,a);const a=[];for(let t of e)a.push(new oe(t,r,i,n,s));return new ae(e,a,t,r,i,n,s)}#Te;#Ce;#ye;#Re;#Se;#ve;#Ie;constructor(e,t,r,n,i,s,a){this.#Te=e,this.#Ce=t,this.#ye=r,this.#Re=n,this.#Se=i,this.#ve=s,this.#Ie=a}getStates(){return this.#Te}getStatesCount(){return this.#Te.length}getMasks(){return this.#Ce}getTransitions(){return this.#ye}getMinX(){return this.#Re}getMaxX(){return this.#Se}getMinY(){return this.#ve}getMaxY(){return this.#Ie}}class oe{#Re;#Se;#ve;#Ie;#we;constructor(e,t,r,n,i){this.#Re=t,this.#Se=r,this.#ve=n,this.#Ie=i;const s=Math.abs(t)+1+r,a=Math.abs(n)+1+i,o=new Uint8Array(s*a);for(const[t,r]of e){o[t-this.#Re+s*(r-this.#ve)]=1}this.#we=o}matches(e,t){if(e<this.#Re||t<this.#ve||e>this.#Se||t>this.#Ie)return!1;const r=Math.abs(this.#Re)+1+this.#Se,n=e-this.#Re+r*(t-this.#ve);return 1===this.#we[n]}}class le{static isElementFallingHeavy(e){if(null===e)return!1;const t=n.getTypeClass(e);if(t===n.TYPE_POWDER||t===n.TYPE_POWDER_WET)return!0;if(t===n.TYPE_STATIC){if(n.getBehaviour(e)===n.BEHAVIOUR_ENTITY)return!1;if(n.getTypeModifierSolidBodyId(e)>0)return!0}return!1}static isElementLight(e){if(null===e)return!1;return n.getTypeClass(e)<=n.TYPE_GAS}static isElementWater(e){if(null===e)return!1;return n.getTypeClass(e)===n.TYPE_FLUID&&n.getBehaviour(e)===n.BEHAVIOUR_LIQUID&&n.getSpecial(e)===n.SPECIAL_LIQUID_WATER}static isElementEntity(e){if(null===e)return!1;return n.getBehaviour(e)===n.BEHAVIOUR_ENTITY}}class he{getType(){throw"Not implemented"}getX(){throw"Not implemented"}getY(){throw"Not implemented"}isActive(){throw"Not implemented"}serialize(){throw"Not implemented"}initialize(){throw"Not implemented"}performBeforeProcessing(){throw"Not implemented"}performAfterProcessing(){throw"Not implemented"}extract(e,t,r){throw"Not implemented"}paint(e,t,r,n){throw"Not implemented"}countMaxBoundaries(){throw"Not implemented"}}class ce extends he{_elementArea;_random;_processorContext;_stateDefinition;_brush;_areaBoundary;_type;_iteration=0;_x=0;_y=0;_waypoint=null;_state=0;_stuck=0;constructor(e,t,r,n,i){super(),this._type=e,this._stateDefinition=r,this._brush=n,this._areaBoundary=2*(Math.abs(this._stateDefinition.getMinX()-this._stateDefinition.getMaxX())+1),this._elementArea=i.elementArea,this._random=i.random,this._processorContext=i.processorContext,void 0!==t.iteration?this._iteration=t.iteration:this._iteration=this._random.nextInt(this._stateDefinition.getStatesCount()),void 0!==t.x&&(this._x=t.x),void 0!==t.y&&(this._y=t.y),void 0!==t.state?this._state=t.state:this._state=this._random.nextInt(this._stateDefinition.getStatesCount()),void 0!==t.stuck&&(this._stuck=t.stuck)}_checkIsSpace(e){throw"Not implemented"}performBeforeProcessing(){return-1!==this._state}performAfterProcessing(){return-1!==this._state}serialize(){return{entity:this._type,iteration:this._iteration,x:this._x,y:this._y,state:this._state,stuck:this._stuck}}getType(){return this._type}getX(){return this._x}getY(){return this._y}assignWaypoint(e,t){this._waypoint={x:e,y:t,stuck:0}}unassignWaypoint(){this._waypoint=null}isActive(){return-1!==this._state}initialize(){this.paint(this._x,this._y,this._elementArea,this._random)}_incrementState(){const e=this._x,t=this._y,r=this._stateDefinition.getTransitions()[this._state];let n=!0;for(const[[i,s],[a,o]]of r)if(!this._elementArea.isValidPosition(e+i,t+s)||!this._checkIsSpaceAt(e+a,t+o)){n=!1;break}if(n){for(const[[n,i],[s,a]]of r)this._elementArea.swap(e+n,t+i,e+s,t+a);this._stuck=0,this._state++,this._state===this._stateDefinition.getStates().length&&(this._state=0)}else this._stuck++}_moveRandom(e){const t=this._random.nextInt(3)-1,r=this._random.nextInt(3)-1;return this._move(t,r,e)}_moveInWaypointDirection(e){let t=this._waypoint.x-this._x,r=0;t>0?r+=1:t<0&&(r-=1);let n=this._waypoint.y-this._y,i=0;n>0?i+=1:n<0&&(i-=1);this._move(r,i,e)?this._waypoint.stuck=0:this._waypoint.stuck++}_move(e,t,r){const n=this._x,i=this._y,s=this.#Oe(n,i,e,t,r);if(null!==s){const[e,t]=s;return this.#be(this._stateDefinition.getStates()[this._state],n,i,e,t),this._x=e,this._y=t,!0}return!1}#Oe(e,t,r,n,i){if(e+r<this._areaBoundary&&r<0&&(r=0),e+r>this._elementArea.getWidth()-this._areaBoundary&&r>0&&(r=0),t+n<this._areaBoundary&&n<0&&(n=0),t+n>this._elementArea.getHeight()-this._areaBoundary&&n>0&&(n=0),0===r&&0===n)return null;if(r>0||r<0)for(let s=this._stateDefinition.getMinY()-i;s<=this._stateDefinition.getMaxY()+i;s++)if(!this._checkIsSpaceAt(e+5*r,t+n+s)){r=0;break}if(n>0||n<0)for(let s=this._stateDefinition.getMinX()-i;s<=this._stateDefinition.getMaxX()+i;s++)if(!this._checkIsSpaceAt(e+r+s,t+5*n)){n=0;break}if(0===r&&0===n)return null;const s=this._stateDefinition.getMasks()[this._state];for(const[i,a]of this._stateDefinition.getStates()[this._state])if(s.matches(r+i,n+a));else if(!this._checkIsSpaceAt(e+r+i,t+n+a))return null;return[e+r,t+n]}_moveForced(e,t){const r=this._x,n=this._y,i=this.#_e(r,n,e,t);if(null!==i){const[e,t]=i;return this.#be(this._stateDefinition.getStates()[this._state],r,n,e,t),this._x=e,this._y=t,!0}return!1}#_e(e,t,r,i){if(e+r<0&&r<0&&(r=0),e+r>this._elementArea.getWidth()&&r>0&&(r=0),t+i<0&&i<0&&(i=0),t+i>this._elementArea.getHeight()&&i>0&&(i=0),0===r&&0===i)return null;for(const[s,a]of this._stateDefinition.getStates()[this._state]){const o=e+s+r,l=t+a+i,h=this._elementArea.getElementHeadOrNull(o,l);if(null===h)return null;if(n.getBehaviour(h)!==n.BEHAVIOUR_ENTITY&&n.getTypeClass(h)>n.TYPE_FLUID)return null}return[e+r,t+i]}_checkIsSpaceAt(e,t){const r=this._elementArea.getElementHeadOrNull(e,t);return null!==r&&this._checkIsSpace(r)}#be(e,t,r,n,i){const s=[...e];n>t?s.sort(((e,t)=>t[0]-e[0])):n<t&&s.sort(((e,t)=>e[0]-t[0])),i>r?s.sort(((e,t)=>t[1]-e[1])):i<r&&s.sort(((e,t)=>e[1]-t[1]));for(const[e,a]of s)this._elementArea.swap(t+e,r+a,n+e,i+a)}_kill(){const e=this._x,t=this._y;for(const[r,i]of this._stateDefinition.getStates()[this._state]){const s=e+r,a=t+i,o=this._elementArea.getElementHeadOrNull(s,a);if(null===o)continue;if(n.getBehaviour(o)!==n.BEHAVIOUR_ENTITY)continue;let l=o;l=n.setType(l,n.type8Solid(n.TYPE_STATIC,4,!0)),l=n.setBehaviour(l,n.BEHAVIOUR_NONE),l=n.setSpecial(l,0),this._elementArea.setElementHead(s,a,l)}return this._state=-1,!1}paint(e,t,r,n){for(const[i,s]of this._stateDefinition.getStates()[this._state]){const a=e+i,o=t+s;if(!r.isValidPosition(a,o))continue;const l=this._brush.apply(i,s,n);r.setElement(a,o,l)}}extract(e,t,r){const i=this._x,s=this._y,a=[];for(const[t,r]of this._stateDefinition.getStates()[this._state]){const o=i+t,l=s+r,h=this._elementArea.getElementHeadOrNull(o,l);if(null===h)continue;if(n.getBehaviour(h)!==n.BEHAVIOUR_ENTITY)continue;const c=this._elementArea.getElementTail(o,l);a.push(new W(o,l,h,c)),this._elementArea.setElement(o,l,e)}const o=this.serialize();return o.x-=t,o.y-=r,this._state=-1,[o,a]}countMaxBoundaries(){return[Math.abs(this._stateDefinition.getMinX()-this._stateDefinition.getMaxX())+1,Math.abs(this._stateDefinition.getMinY()-this._stateDefinition.getMaxY())+1]}}class de extends ce{static#Me=10;static#xe=15;constructor(e,t,r,n,i){super(e,t,r,n,i)}_checkIsSpace(e){return!(n.getTypeClass(e)>n.TYPE_GAS)&&n.getBehaviour(e)!==n.BEHAVIOUR_FIRE}performAfterProcessing(){this._iteration++;let e=-1!==this._state,t=!1;if(e){const[r,n]=this.#He();e=r,t=n}if(e)if(t||this._stuck>0){const e=this._random.nextInt(3)-1,t=1;this._moveForced(e,t)}else this._iteration%11==0&&(null!==this._waypoint?(10===this._waypoint.stuck&&(this._waypoint.stuck=-20),this._waypoint.stuck>=0?this._moveInWaypointDirection(2):(this._waypoint.stuck++,this._moveRandom(2))):this._moveRandom(2));return e&&this._stateDefinition.getStatesCount()>1&&this._iteration%10==0&&this._incrementState(),e}#He(){const e=this._x,t=this._y,r=this._stateDefinition.getStates()[this._state];let i=!1,s=0;for(const[a,o]of r){const r=e+a,l=t+o,h=this._elementArea.getElementHeadOrNull(r,l);if(null===h)return[this._kill(),!1];if(n.getBehaviour(h)!==n.BEHAVIOUR_ENTITY)return[this._kill(),!1];s+=n.getTemperature(h),this._elementArea.setElementHead(r,l,n.setSpecial(h,0)),i||(i=le.isElementFallingHeavy(this._elementArea.getElementHeadOrNull(r,l-1)))}return s/r.length>de.#Me||this._stuck>de.#xe?[this._kill(),!1]:[!0,i]}}class ue extends ce{static#Me=10;static#xe=1e3;constructor(e,t,r,n,i){super(e,t,r,n,i)}_checkIsSpace(e){return n.getTypeClass(e)===n.TYPE_FLUID}performAfterProcessing(){this._iteration++;let e=-1!==this._state,t=!1;if(e){const[r,n]=this.#He();e=r,t=n}return e&&(t?this._moveForced(0,1):this._iteration%14==0&&(null!==this._waypoint?(3===this._waypoint.stuck&&(this._waypoint.stuck=-10),this._waypoint.stuck>=0?this._moveInWaypointDirection(1):(this._waypoint.stuck++,this._moveRandom(1))):this._moveRandom(1))),e&&this._stateDefinition.getStatesCount()>1&&this._iteration%10==0&&this._incrementState(),e}#He(){const e=this._x,t=this._y,r=this._stateDefinition.getStates()[this._state];let i=!1,s=!0,a=!0,o=!0,l=!0,h=0;for(const[c,d]of r){const r=e+c,u=t+d,m=this._elementArea.getElementHeadOrNull(r,u);if(null===m)return[this._kill(),!1];if(n.getBehaviour(m)!==n.BEHAVIOUR_ENTITY)return[this._kill(),!1];if(h+=n.getTemperature(m),this._elementArea.setElementHead(r,u,n.setSpecial(m,0)),!i||s||a){const e=this._elementArea.getElementHeadOrNull(r,u-1);i||(i=le.isElementFallingHeavy(e)),s&&(s=le.isElementLight(e)),a&&(a=le.isElementWater(e)||le.isElementEntity(e))}if(o||l){const e=this._elementArea.getElementHeadOrNull(r,u+1);o&&(o=le.isElementLight(e)),l&&(l=le.isElementWater(e)||le.isElementEntity(e))}}if(h/r.length>ue.#Me)return[this._kill(),!1];if(a&&l||this._stuck++,this._stuck>ue.#xe)return[this._kill(),!1];return[!0,i||o||s&&l]}}class me{static#De=ae.createCyclic([[[0,0],[1,-1],[-1,-1],[2,-1],[-2,-1],[3,-1],[-3,-1]],[[0,0],[1,-1],[-1,-1],[2,-1],[-2,-1],[3,-2],[-3,-2]],[[0,0],[1,-1],[-1,-1],[2,-2],[-2,-2],[3,-2],[-3,-2]],[[0,0],[1,-1],[-1,-1],[2,-2],[-2,-2],[3,-1],[-3,-1]],[[0,0],[1,-1],[-1,-1],[2,-1],[-2,-1],[3,-1],[-3,-1]],[[0,0],[1,-1],[-1,-1],[2,0],[-2,0],[3,0],[-3,0]],[[0,0],[1,-1],[-1,-1],[2,0],[-2,0],[3,1],[-3,1]],[[0,0],[1,-1],[-1,-1],[2,0],[-2,0],[3,0],[-3,0]]]);static#Ne=M.custom(((e,t)=>{const i=Math.abs(e)<2?h.BLUR_TYPE_NONE:h.BLUR_TYPE_1;return new r(n.of(n.type8(n.TYPE_STATIC),n.behaviour8(n.BEHAVIOUR_ENTITY,0),n.modifiers8(n.HMI_CONDUCTIVE_1)),h.of(0,0,0,i))}));static birdFactory(e,t){return new de("bird",e,me.#De,me.#Ne,t)}static#Le=ae.createCyclic([[[0,0],[1,-1],[-1,-1]],[[0,0],[1,-1],[-1,-1]],[[0,0],[1,0],[-1,0]],[[0,0],[1,1],[-1,1]],[[0,0],[1,1],[-1,1]]]);static#Ue=M.custom(((e,t)=>{const i=0===Math.abs(e)?h.BLUR_TYPE_NONE:h.BLUR_TYPE_1,s=0===Math.abs(e)?0:200;return new r(n.of(n.type8(n.TYPE_STATIC),n.behaviour8(n.BEHAVIOUR_ENTITY,0),n.modifiers8(n.HMI_CONDUCTIVE_1)),h.of(s,0,0,i))}));static butterflyFactory(e,t){return new de("butterfly",e,me.#Le,me.#Ue,t)}static#Be=ae.createCyclic([[[0,0],[1,0]]]);static#Pe=M.custom(((e,t)=>new r(n.of(n.type8(n.TYPE_STATIC),n.behaviour8(n.BEHAVIOUR_ENTITY,0),n.modifiers8(n.HMI_CONDUCTIVE_1)),h.of(0,0,0,h.BLUR_TYPE_NONE))));static fishFactory(e,t){return new ue("fish",e,me.#Be,me.#Pe,t)}static findFactoryByEntityType(e){switch(e){case"bird":return me.birdFactory;case"butterfly":return me.butterflyFactory;case"fish":return me.fishFactory}return null}}class Ee{static DEFAULT_SIZE=6;static CATEGORY_NONE=void 0;static CATEGORY_POWDER="powders";static CATEGORY_FLUIDS="fluids";static CATEGORY_SOLIDS="solids";static CATEGORY_EFFECTS="effects";static CATEGORY_BIOLOGICAL="biological";static DEFAULT_CATEGORY_DEFINITIONS={};static{Ee.DEFAULT_CATEGORY_DEFINITIONS[Ee.CATEGORY_POWDER]={displayName:"Powders",icon:{svg:'<svg class="bi" width="16" height="16" fill="currentColor" xmlns="http://www.w3.org/2000/svg">\r\n  <path fill-rule="evenodd" d="M.96 11.78c.44-.76 1.74-5.69 3.38-5.3l1.74.98C7.8 8.64 9.7.4 10.78 1.05l4.96 13.93H.2c.06 0 .14-1.85.75-3.2z"/>\r\n</svg>'},badgeStyle:{color:"black",backgroundColor:"#d9bc7a"}},Ee.DEFAULT_CATEGORY_DEFINITIONS[Ee.CATEGORY_FLUIDS]={displayName:"Fluids",icon:{svg:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-droplet-fill" viewBox="0 0 16 16">\r\n  <path d="M8 16a6 6 0 0 0 6-6c0-1.655-1.122-2.904-2.432-4.362C10.254 4.176 8.75 2.503 8 0c0 0-6 5.686-6 10a6 6 0 0 0 6 6M6.646 4.646l.708.708c-.29.29-1.128 1.311-1.907 2.87l-.894-.448c.82-1.641 1.717-2.753 2.093-3.13"/>\r\n</svg>'},badgeStyle:{color:"black",backgroundColor:"#6aa6bd"}},Ee.DEFAULT_CATEGORY_DEFINITIONS[Ee.CATEGORY_SOLIDS]={displayName:"Solids",icon:{svg:'<svg class="bi" width="16" height="16" viewBox="0 0 297 297" xml:space="preserve" xmlns="http://www.w3.org/2000/svg">\r\n    <path d="M165 233H75c-3 0-6 2-6 6v41c0 3 3 6 6 6h90c3 0 6-3 6-6v-41c0-4-3-6-6-6zM291 231h-91c-3 0-6 3-6 6v41c0 3 3 6 6 6h91c3 0 6-3 6-6v-41c0-3-3-6-6-6zM75 137h87c4 0 7-2 7-5V91c0-3-3-5-7-5H75c-3 0-6 2-6 5v41c0 3 3 5 6 5zM289 85h-90c-3 0-6 3-6 6v40c0 3 3 6 6 6h90c4 0 7-3 7-6V91c0-3-3-6-7-6zM135 68h88c4 0 6-3 6-6V23c0-3-2-6-6-6h-88c-4 0-6 3-6 6v39c0 3 2 6 6 6zM138 163v42a6 6 0 0 0 6 6h85a6 6 0 0 0 6-6v-42a6 6 0 0 0-6-6h-85a6 6 0 0 0-6 6zM117 203v-41c0-3-3-6-7-6H13c-4 0-7 3-7 6v41c0 3 3 6 7 6h97c4 0 7-3 7-6z"/>\r\n</svg>'},badgeStyle:{color:"black",backgroundColor:"#adadad"}},Ee.DEFAULT_CATEGORY_DEFINITIONS[Ee.CATEGORY_EFFECTS]={displayName:"Effects",icon:{svg:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-fire" viewBox="0 0 16 16">\r\n  <path d="M8 16c3.314 0 6-2 6-5.5 0-1.5-.5-4-2.5-6 .25 1.5-1.25 2-1.25 2C11 4 9 .5 6 0c.357 2 .5 4-2 6-1.25 1-2 2.729-2 4.5C2 14 4.686 16 8 16m0-1c-1.657 0-3-1-3-2.75 0-.75.25-2 1.25-3C6.125 10 7 10.5 7 10.5c-.375-1.25.5-3.25 2-3.5-.179 1-.25 2 1 3 .625.5 1 1.364 1 2.25C11 14 9.657 15 8 15"/>\r\n</svg>'},badgeStyle:{color:"black",backgroundColor:"#ff945b"}}}static NONE=$.actionTool((()=>{}),{codeName:"none",displayName:"None",category:Ee.CATEGORY_NONE});static ERASE=$.roundBrushTool(ie.AIR,Ee.DEFAULT_SIZE,{codeName:"erase",displayName:"Erase",category:Ee.CATEGORY_NONE,badgeStyle:{backgroundColor:"#e6e6e6",color:"black"}});static MOVE=$.moveTool(13,2048,{codeName:"move",displayName:"Move",category:Ee.CATEGORY_NONE,badgeStyle:{backgroundColor:"#e6e6e6",color:"black"}});static FLIP_VERTICALLY=$.globalActionTool((e=>e.graphics().flipVertically()),{codeName:"flip_vertically",displayName:"Flip ↕",category:Ee.CATEGORY_NONE,badgeStyle:{backgroundColor:"#e6e6e6",color:"black"}});static FLIP_HORIZONTALLY=$.globalActionTool((e=>e.graphics().flipHorizontally()),{codeName:"flip_horizontally",displayName:"Flip ↔",category:Ee.CATEGORY_NONE,badgeStyle:{backgroundColor:"#e6e6e6",color:"black"}});static SAND=$.roundBrushTool(ie.SAND,Ee.DEFAULT_SIZE,{codeName:"sand",displayName:"Sand",category:Ee.CATEGORY_POWDER,badgeStyle:{backgroundColor:"#b7a643"}});static SOIL=$.roundBrushTool(ie.SOIL,Ee.DEFAULT_SIZE,{codeName:"soil",displayName:"Soil",category:Ee.CATEGORY_POWDER,badgeStyle:{backgroundColor:"#8e6848"}});static GRAVEL=$.roundBrushTool(ie.GRAVEL,Ee.DEFAULT_SIZE,{codeName:"gravel",displayName:"Gravel",category:Ee.CATEGORY_POWDER,badgeStyle:{backgroundColor:"#656565"}});static COAL=$.roundBrushTool(ie.COAL,Ee.DEFAULT_SIZE,{codeName:"coal",displayName:"Coal",category:Ee.CATEGORY_POWDER,badgeStyle:{backgroundColor:"#343434"}});static THERMITE=$.roundBrushTool(ie.THERMITE,Ee.DEFAULT_SIZE,{codeName:"thermite",displayName:"Thermite",category:Ee.CATEGORY_POWDER,badgeStyle:{backgroundColor:"#914e47"}});static WALL=$.roundBrushTool(ie.WALL,Ee.DEFAULT_SIZE,{codeName:"wall",displayName:"Static Wall",category:Ee.CATEGORY_SOLIDS,badgeStyle:{backgroundColor:"#383838"}});static BRICK=$.roundBrushToolForSolidBody(ie.BRICK,Ee.DEFAULT_SIZE,{codeName:"brick",displayName:"Brick",category:Ee.CATEGORY_SOLIDS,badgeStyle:{backgroundColor:"#B56D64"}});static WOOD=$.roundBrushToolForSolidBody(ie.WOOD,Ee.DEFAULT_SIZE,{codeName:"wood",displayName:"Wood",category:Ee.CATEGORY_SOLIDS,badgeStyle:{backgroundColor:"#7b6043"}});static ROCK=$.roundBrushToolForSolidBody(ie.ROCK,Ee.DEFAULT_SIZE,{codeName:"rock",displayName:"Rock",category:Ee.CATEGORY_SOLIDS,badgeStyle:{backgroundColor:"#383838"}});static ROCK_TEMPLATES_SM=$.templateSelectionTool(se.ROCK_SM,{codeName:"rock_templates_sm",displayName:"Rock •",category:Ee.CATEGORY_SOLIDS,badgeStyle:{backgroundColor:"#574F48"}});static ROCK_TEMPLATES_MD=$.templateSelectionTool(se.ROCK_MD,{codeName:"rock_templates_md",displayName:"Rock ●",category:Ee.CATEGORY_SOLIDS,badgeStyle:{backgroundColor:"#574F48"}});static ROCK_TEMPLATES_LG=$.templateSelectionTool(se.ROCK_LG,{codeName:"rock_templates_lg",displayName:"Rock ⬤",category:Ee.CATEGORY_SOLIDS,badgeStyle:{backgroundColor:"#574F48"}});static METAL=$.roundBrushToolForSolidBody(ie.METAL,Ee.DEFAULT_SIZE,{codeName:"metal",displayName:"Metal",category:Ee.CATEGORY_SOLIDS,badgeStyle:{backgroundColor:"#7c7c7c"}});static METAL_MOLTEN=$.roundBrushTool(ie.METAL_MOLTEN,Ee.DEFAULT_SIZE,{codeName:"metal_molten",displayName:"M. Metal",category:Ee.CATEGORY_FLUIDS,badgeStyle:{backgroundColor:"#e67d00"}});static WATER=$.roundBrushTool(ie.WATER,Ee.DEFAULT_SIZE,{codeName:"water",displayName:"Water",category:Ee.CATEGORY_FLUIDS,badgeStyle:{backgroundColor:"#0487ba"}});static OIL=$.roundBrushTool(ie.OIL,Ee.DEFAULT_SIZE,{codeName:"oil",displayName:"Oil",category:Ee.CATEGORY_FLUIDS,badgeStyle:{backgroundColor:"rgb(36,26,1)"}});static FIRE=$.roundBrushTool(M.temperatureOrBrush(50,ie.FIRE),Ee.DEFAULT_SIZE,{codeName:"fire",displayName:"Fire",category:Ee.CATEGORY_EFFECTS,badgeStyle:{backgroundColor:"#ff5900"}});static METEOR=$.meteorTool(ie.METEOR,ie.METEOR_FROM_LEFT,ie.METEOR_FROM_RIGHT,{codeName:"meteor",displayName:"Meteor",category:Ee.CATEGORY_EFFECTS,badgeStyle:{backgroundColor:"#ff5900"}});static EFFECT_TEMP_MINUS=$.roundBrushTool(M.concat(ie.EFFECT_TEMP_0,ie.EFFECT_EXTINGUISH),Ee.DEFAULT_SIZE,{codeName:"effect_temp_minus",displayName:"°C −",category:Ee.CATEGORY_EFFECTS,badgeStyle:{backgroundColor:"#63cffa"}});static EFFECT_TEMP_PLUS=$.roundBrushTool(ie.EFFECT_TEMP_200,Ee.DEFAULT_SIZE,{codeName:"effect_temp_plus",displayName:"°C +",category:Ee.CATEGORY_EFFECTS,badgeStyle:{backgroundColor:"#fa9b4e"}});static EFFECT_TEMP_PLUS2=$.roundBrushTool(ie.EFFECT_TEMP_255,Ee.DEFAULT_SIZE,{codeName:"effect_temp_plus2",displayName:"°C ⧺",category:Ee.CATEGORY_EFFECTS,badgeStyle:{backgroundColor:"#fa9b4e"}});static DEFAULT_TOOLS=[this.ERASE,this.MOVE,this.SAND,this.SOIL,this.GRAVEL,this.COAL,this.THERMITE,this.WALL,this.BRICK,this.WOOD,this.METAL,this.ROCK_TEMPLATES_SM,this.ROCK_TEMPLATES_MD,this.ROCK_TEMPLATES_LG,this.WATER,this.OIL,this.METAL_MOLTEN,this.FIRE,this.METEOR,this.EFFECT_TEMP_MINUS,this.EFFECT_TEMP_PLUS,this.EFFECT_TEMP_PLUS2];static BIRD=$.insertEntityTool(me.birdFactory,{codeName:"bird",displayName:"Bird",category:Ee.CATEGORY_BIOLOGICAL});static BUTTERFLY=$.insertEntityTool(me.butterflyFactory,{codeName:"butterfly",displayName:"Butterfly",category:Ee.CATEGORY_BIOLOGICAL});static FISH=$.insertEntityTool(me.fishFactory,{codeName:"fish",displayName:"Fish",category:Ee.CATEGORY_BIOLOGICAL});static _LIST={};static{const e=[Ee.NONE,Ee.FLIP_HORIZONTALLY,Ee.FLIP_VERTICALLY,...Ee.DEFAULT_TOOLS,Ee.ROCK,Ee.BIRD,Ee.BUTTERFLY,Ee.FISH];for(const t of e)Ee._LIST[t.getInfo().getCodeName()]=t}static byCodeName(e){const t=Ee._LIST[e];return void 0!==t?t:null}}class ge{static EVENT_NAME="app_sand_game_js";static FEATURE_APP_INITIALIZED="initialized";static FEATURE_SCENARIO_COMPLETED="s_completed";static FEATURE_RENDERER_FALLBACK="renderer_fallback";static FEATURE_PAUSE="pause";static FEATURE_DRAW_PRIMARY="draw_primary";static FEATURE_DRAW_SECONDARY="draw_secondary";static FEATURE_DRAW_TERTIARY="draw_tertiary";static FEATURE_DRAW_LINE="draw_line";static FEATURE_DRAW_RECT="draw_rect";static FEATURE_DRAW_FLOOD="draw_flood";static FEATURE_STATUS_DISPLAYED="status_displayed";static FEATURE_OPTIONS_DISPLAYED="options_displayed";static FEATURE_RENDERER_PIXELATED="renderer_pixelated";static FEATURE_RENDERER_SHOW_CHUNKS="renderer_show_chunks";static FEATURE_RENDERER_SHOW_HEATMAP="renderer_show_heatmap";static FEATURE_CANVAS_SIZE_CHANGE="canvas_size_change";static FEATURE_SWITCH_SCENE="switch_scene";static FEATURE_RESTART_SCENE="restart_scene";static FEATURE_SWITCH_SCALE="switch_scale";static FEATURE_IO_EXPORT="io_export";static FEATURE_IO_IMPORT="io_import";static FEATURE_IO_IMAGE_TEMPLATE="io_image_template";static#Fe=new Set;static triggerToolUsed(e){let t=e.getInfo().getCodeName();if(void 0===t&&(e instanceof k||e instanceof Y?t="template":e instanceof Q&&(t="entity")),void 0!==t){const e="brush_"+t;ge.triggerFeatureUsed(e)}}static triggerFeatureUsed(e){ge.#Fe.has(e)||(ge.#Fe.add(e),ge.#ke({app_sand_game_js_feature:e}))}static#ke(e){if("function"==typeof gtag)try{gtag("event",ge.EVENT_NAME,e)}catch(e){console.warn(e)}}}class pe{static addContent(e,t){if(null===t);else if("string"==typeof t)e.textContent=t;else if(t instanceof Node)e.appendChild(t);else{if(!Array.isArray(t))throw"Content type not supported: "+typeof t;for(const r of t)if(r instanceof Node)e.appendChild(r);else if("string"==typeof r)e.insertAdjacentText("beforeend",r);else if(null!==r)throw"Content type not supported: "+typeof r}}static setContent(e,t){e.innerHTML="",pe.addContent(e,t)}static putAttributes(e,t){for(const r in t){const n=t[r],i=typeof n;if("string"===i||"boolean"===i||"number"===i)e.setAttribute(r,n);else if("style"===r&&"object"===i)Object.assign(e.style,n);else if(null!==n)throw"Unsupported attribute type: "+typeof n}}static create(e){const t=document.createElement("template");return t.innerHTML=e.trim(),t.content.firstElementChild}static element(e,t=null,r=null){const n=document.createElement(e);return pe.putAttributes(n,t),pe.addContent(n,r),n}static div(e=null,t=null){return pe.element("div",e,t)}static par(e=null,t=null){return pe.element("p",e,t)}static span(e=null,t=null){return pe.element("span",t,e)}static link(e,t=null,r=null){const n=pe.element("a",t,e);return null!==r&&(n.href="javascript:void(0)",n.addEventListener("click",r)),n}static button(e,t=null,r=null){null===t&&(t={}),t.type="button";const n=pe.element("button",t,e);return null!==r&&n.addEventListener("click",r),n}static bootstrapAlertInfo(e){const t=pe.div({class:"alert alert-info alert-dismissible fade show",role:"alert"});return pe.addContent(t,e),t.append(pe.button(null,{type:"button",class:"btn-close","data-bs-dismiss":"alert","aria-label":"Close"})),t}static bootstrapCard(e,t,r=null){null===r&&(r={}),void 0===r.class&&(r.class="card");const n=pe.div(r);return e&&n.append(pe.div({class:"card-header"},e)),n.append(pe.div({class:"card-body"},t)),n}static bootstrapCardCollapsable(e,t,r){const n="collapsable_"+Math.floor(999999999*Math.random());return pe.div({class:"card"},[pe.div({class:"card-header"},[pe.element("a",{class:"card-link","data-bs-toggle":"collapse",href:"#"+n},e)]),pe.div({id:n,class:t?"collapse":"collapse show"},[pe.div({class:"card-body"},r)])])}static bootstrapInitTooltip(e,t){if(void 0===window.bootstrap)return console.error("Bootstrap library not available"),t;const r=new window.bootstrap.Tooltip(t);return r&&r.dispose(),t.setAttribute("data-bs-toggle","tooltip"),t.setAttribute("data-bs-placement","top"),"object"==typeof e?(t.setAttribute("data-bs-html","true"),t.setAttribute("title",e.innerHTML)):t.setAttribute("title",e),new window.bootstrap.Tooltip(t),t}static bootstrapSwitchButton(e,t,r=null){const n="switch-button_"+Math.floor(999999999*Math.random()),i=pe.element("input",{type:"checkbox",id:n,class:"form-check-input",role:"switch",checked:t}),s=pe.div({class:"form-check form-switch"},[i,pe.element("label",{class:"form-check-label",for:n},e)]);return null!==r&&i.addEventListener("click",(()=>{r(i.checked)})),s}static bootstrapToggleButton(e,t,r,n=null){const i="toggle-button_"+Math.floor(999999999*Math.random()),s=pe.element("input",{type:"checkbox",class:"btn-check",checked:r,id:i}),a=pe.element("label",{class:"btn "+t,for:i},e);return s.addEventListener("change",(e=>{null!==n&&n(s.checked)})),[s,a]}static bootstrapTableBuilder(){return new Ae}static bootstrapDialogBuilder(){return new fe}static bootstrapToastBuilder(){return new Te}static bootstrapSimpleFormBuilder(){return new Ce}}class Ae{#Ye=pe.element("tbody");addRow(e){this.#Ye.appendChild(e)}addRowBefore(e){this.#Ye.insertBefore(e,this.#Ye.firstChild)}createNode(){const e=pe.element("table",{class:"table table-striped"});e.appendChild(this.#Ye);const t=pe.div({class:"table-responsive"});return t.appendChild(e),t}}class fe{#Ve=!1;#We="";#Ge=null;#ze=null;#Ke=[];#Xe=null;#je=null;setPersistent(e){this.#Ve=e}setSizeLarge(){this.#We="modal-lg"}setSizeExtraLarge(){this.#We="modal-xl"}setHeaderContent(e){this.#Ge="string"==typeof e?pe.element("strong",null,e):e}setBodyContent(e){this.#ze=e}addCloseButton(e){const t=pe.element("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},e);this.#Ke.push(t)}addSubmitButton(e,t){const r=pe.element("button",{type:"button",class:"btn btn-primary","data-bs-dismiss":"modal"},e);r.addEventListener("click",t),this.#Ke.push(r)}addButton(e){this.#Ke.push(e)}show(e){void 0!==window.bootstrap?(null===this.#Xe&&(this.#Xe=pe.div({class:"modal fade",tabindex:"-1",role:"dialog","aria-hidden":"true"},[pe.div({class:`modal-dialog modal-dialog-centered ${this.#We}`},[pe.div({class:"modal-content"},[pe.div({class:"modal-header"},this.#Ge),pe.div({class:"modal-body"},this.#ze),pe.div({class:"modal-footer"},this.#Ke)])])]),e.appendChild(this.#Xe)),this.#je=new window.bootstrap.Modal(this.#Xe),this.#Ve||this.#Xe.addEventListener("hidden.bs.modal",(()=>{e.removeChild(this.#Xe)})),this.#je.show()):console.error("Bootstrap library not available")}hide(){null!==this.#Xe&&this.#je.hide()}}class Te{#Ge=null;#ze=null;#Je=null;#qe=null;#Ze=36e5;setHeaderContent(e){"string"==typeof e&&(e=pe.element("strong",e)),this.#Ge=pe.span(e,{class:"me-auto"})}setBodyContent(e){this.#ze=e}setDelay(e){this.#Ze=e}show(e){if(void 0===window.bootstrap)return void console.error("Bootstrap library not available");const t={class:"toast hide",role:"alert","aria-live":"assertive","aria-atomic":"true","data-bs-delay":this.#Ze},r=pe.div({class:"position-fixed bottom-0 right-0 p-3",style:"z-index: 5; right: 0; bottom: 0;"},[this.#Je=pe.div(t,[pe.div({class:"toast-header"},[this.#Ge,pe.button("",{type:"button",class:"btn-close","data-bs-dismiss":"toast","aria-label":"Close"})]),pe.div({class:"toast-body"},[this.#ze])])]);e.append(r),this.#qe=new window.bootstrap.Toast(this.#Je),this.#Je.addEventListener("hidden.bs.toast",(()=>{e.removeChild(r)})),this.#qe.show()}hide(){null!==this.#Je&&this.#qe.hide()}}class Ce{#Qe=[];#$e=null;addTextArea(e,t,r="",n=8){let i=pe.element("textarea",{class:"form-control",rows:n},r);return this.#Qe.push({key:t,label:e,input:i}),i}addInput(e,t,r=""){let n=pe.element("input",{class:"form-control"});return r&&(n.value=r),this.#Qe.push({key:t,label:e,input:n}),n}addSubmitButton(e,t){this.#$e=pe.button(e,{class:"btn btn-primary"},(e=>{t(this.getData())}))}createNode(){let e=pe.element("form",{action:"javascript:void(0);"});for(let t of this.#Qe)e.append(pe.div({class:"mb-3"},[pe.element("label",null,t.label),t.input]));return this.#$e&&e.append(this.#$e),e}getData(){let e={};for(let t of this.#Qe)e[t.key]=t.input.value;return e}}class ye{#et=0;#tt=0;#rt=0;tick(e){this.#et++,e-this.#rt>=1e3&&(this.#tt=this.#et,this.#et=0,this.#rt=e)}getValue(){return this.#tt}clear(){this.#tt=0}}class Re{#nt;#W;#V;constructor(e,t,r){this.#W=t,this.#V=r;const n=new Map;for(const r of e){const e=r.getY()*t+r.getX();let i=n.get(e);void 0===i&&(i=[],n.set(e,i)),i.push(r)}this.#nt=n}getAt(e,t){if(e<0||t<0)return[];if(e>=this.#W||t>=this.#V)return[];const r=this.#nt.get(t*this.#W+e);return void 0!==r?r:[]}}class Se{#it;#st=[];#at=null;constructor(e,t){this.#it=t;for(let t of e)this.addSerializedEntity(t,!1)}addSerializedEntity(e,t=!0){try{const r=this.#ot(e);return this.#st.push(r),t&&r.initialize(),r}catch(e){return console.warn("Cannot deserialize entity",e),null}}#ot(e){if("object"!=typeof e)throw"Serialized entity must be an object";const t=me.findFactoryByEntityType(e.entity);if(null!==t)return t(e,this.#it);throw"Entity not recognized"}performBeforeProcessing(){for(let e=0;e<this.#st.length;e++){this.#st[e].performBeforeProcessing()}this.#at=null}performAfterProcessing(){let e=null;for(let t=0;t<this.#st.length;t++){const r=this.#st[t];let n;try{n=r.performAfterProcessing()}catch(e){console.error("Entity error",e),n=!1}!1===n&&(null===e&&(e=[]),e.push())}if(null!==e)for(let t=e.length-1;t>=0;t--){const r=e[t];this.#st.splice(r,1)}this.#at=null}serializeEntities(){const e=[];for(let t of this.#st)e.push(t.serialize());return e}getAt(e,t){if(null===this.#at){const e=this.#it.elementArea.getWidth(),t=this.#it.elementArea.getHeight();this.#at=new Re(this.#st,e,t)}return this.#at.getAt(e,t)}countEntities(e){let t=0;for(let r=0;r<this.#st.length;r++){e===this.#st[r].getType()&&t++}return t}getEntities(){return this.#st}}class ve{getExtensionsFactory(){throw"Not implemented"}getBrushCollection(){throw"Not implemented"}getDefaultElement(){throw"Not implemented"}getBrushWater(){throw"Not implemented"}getBrushSteam(){throw"Not implemented"}getBrushGrass(){throw"Not implemented"}getBrushTree(){throw"Not implemented"}getBrushTreeWood(){throw"Not implemented"}getBrushTreeWoodDark(){throw"Not implemented"}getBrushTreeRoot(){throw"Not implemented"}getBrushTreeLeaf(){throw"Not implemented"}getBrushTreeLeafDark(){throw"Not implemented"}getBrushFire(){throw"Not implemented"}getBrushAsh(){throw"Not implemented"}getTreeTrunkTemplates(){throw"Not implemented"}getTreeLeafClusterTemplates(){throw"Not implemented"}}class Ie{static#lt=255;static#ht=254;static#ct=8192;static#dt=32;#K;#ut;#mt;#Et;#gt;constructor(e,t,r){this.#K=e,this.#ut=t,this.#mt=r,this.#Et=new Uint8Array(e.getWidth()*e.getHeight()),this.#gt=new Set,this.#pt=new Uint16Array(e.getWidth())}onSolidCreated(e,t,r){this.#Et[t+r*this.#K.getWidth()]=Ie.#ht}onNextIteration(){this.#Et.fill(0),this.#gt.clear()}behaviourSolid(e,t,r){const i=n.getTypeModifierSolidBodyId(e),s=t+r*this.#K.getWidth(),a=this.#Et[s];if(a===Ie.#ht)return!0;if(a===i)return this.#gt.has(i);const[o,l,h,c,d]=this.#At(t,r,e,i);if(this.#mt.isFallThroughEnabled()&&this.#ft(h.shadowClone(),i))return!0;this.#Tt(l,c,i);const[u,m]=this.#Ct(h.shadowClone(),i);if(d.tree){if(u===m)return this.#yt(i,h),this.#gt.add(i),!0}else{if(m/u>.95)return this.#yt(i,h),this.#gt.add(i),!0;if(m/u>.75)return this.#Rt(i,h),!1}return!1}#St(e,t){const r=this.#K.getWidth();let i;for(;null!==(i=t.pop());){if(4294967295===i)continue;const t=i%r,s=Math.trunc(i/r);let a=0;for(;;){let i=this.#K.getElementHead(t,s+a);const o=this.#ut.nextInt(100)<20?n.TYPE_POWDER:n.TYPE_POWDER_WET;i=n.setType(i,n.type8Powder(o,4));let l=this.#K.getElementTail(t,s+a);if(this.#K.setElementHead(t,s+a,i),this.#K.setElementTail(t,s+a,l),!(s+a>=0))break;if(this.#Et[t+(s+a-1)*r]!==e)break;a--}}}#yt(e,t){const r=this.#K.getWidth(),i=this.#K.getHeight();let s;for(;null!==(s=t.pop());){if(4294967295===s)continue;const t=s%r,a=Math.trunc(s/r);let o=null,l=null;a+1<i&&(o=this.#K.getElementHead(t,a+1),l=this.#K.getElementTail(t,a+1));let h=0;for(;;){const n=a+1+h;if(n<i&&(this.#K.setElementHead(t,n,this.#K.getElementHead(t,a+h)),this.#K.setElementTail(t,n,this.#K.getElementTail(t,a+h)),this.#Et[t+n*r]=e),!(a+h>=0))break;if(this.#Et[t+(a+h-1)*r]!==e)break;h--}let c=!1;if(null!=o){const e=n.getTypeClass(o);e===n.TYPE_AIR?c=!0:e<=n.TYPE_FLUID&&(c=this.#vt(Math.abs(h)))}c?(this.#K.setElementHead(t,a+h,o),this.#K.setElementTail(t,a+h,l)):this.#K.setElement(t,a+h,this.#mt.getDefaults().getDefaultElement()),this.triggerPowderElement(t,a+2)}}#vt(e){let t=1-1/(1+Math.exp(-.1*(e-50)));return this.#ut.next()<t}#Rt(e,t){const r=this.#K.getWidth();let n;for(;null!==(n=t.pop());){if(4294967295===n)continue;const e=n%r,t=Math.trunc(n/r);this.triggerPowderElement(e,t+1)}}triggerPowderElement(e,t){if(this.#K.isValidPosition(e,t)){const r=this.#K.getElementHead(e,t),i=n.getTypeClass(r);if(i===n.TYPE_POWDER||i===n.TYPE_POWDER_WET){let i=r;i=n.setTypeModifierPowderSliding(i,1),0===this.#ut.nextInt(15)&&(i=n.setTypeModifierPowderDirection(i,this.#ut.nextInt(2))),this.#K.setElementHead(e,t,i)}}}#Ct(e,t){const r=this.#K.getWidth(),i=this.#K.getHeight();let s,a=0,o=0;for(;null!==(s=e.pop());){const l=s%r,h=Math.trunc(s/r);if(h+1<i){const i=this.#K.getElementHead(l,h+1);if(this.#Et[l+(h+1)*r]===t){e.removePrevious();continue}a++;switch(n.getTypeClass(i)){case n.TYPE_AIR:case n.TYPE_EFFECT:case n.TYPE_GAS:case n.TYPE_FLUID:o++}}else a++}return[a,o]}#ft(e,t){const r=this.#K.getWidth(),i=this.#K.getHeight();let s,a=!1;for(;null!==(s=e.pop());){const e=s%r,t=Math.trunc(s/r);if(t===i-1){let r=this.#K.getElementHead(e,t);r=n.setType(r,n.type8Powder(n.TYPE_POWDER,5));let i=this.#K.getElementTail(e,t);i=h.setBlurType(i,h.BLUR_TYPE_1),this.#K.setElementHeadAndTail(e,t,r,i),a=!0}}return a}#Tt(e,t,r){const i=this.#K.getWidth();this.#K.getHeight();let s,a=0;for(;null!==(s=e.pop());){const e=s%i,o=Math.trunc(s/i),l=t[e];if(l>=o)continue;let h,c=0;for(;(h=o-(c+1))>=0&&h>l;){const t=this.#Et[e+h*i];if(t===r)break;if(0!==t)break;const s=this.#K.getElementHead(e,h);if(!(n.getTypeClass(s)<n.TYPE_STATIC))break;this.#Et[e+h*i]=r,a++,c++}}return a}#It=new we;#wt=new we;#Ot=new we;#pt;#At(e,t,r,i){const s=247,a=this.#K.getElementHead(e,t)&s,o=this.#K.getWidth(),l=this.#It;l.reset();const h=this.#wt;h.reset();const c=this.#Ot;c.reset();const d=this.#pt;d.fill(65535);const u={tree:n.getBehaviour(r)===n.BEHAVIOUR_TREE};let m=0,E=e+t*o;do{const e=E%o,t=Math.trunc(E/o);this.#Et[E]=i,m++;this.#bt(e,t-1,s,a,l,i,u)&&h.push(E),this.#bt(e+1,t,s,a,l,i,u),this.#bt(e-1,t,s,a,l,i,u),0===n.getTypeModifierSolidNeighbourhoodType(this.#K.getElementHead(e,t))&&(this.#bt(e+1,t-1,s,a,l,i,u),this.#bt(e-1,t-1,s,a,l,i,u),this.#bt(e+1,t+1,s,a,l,i,u),this.#bt(e-1,t+1,s,a,l,i,u));if(this.#bt(e,t+1,s,a,l,i,u)){c.push(E);const r=d[e];d[e]=65535===r?t:Math.min(r,t)}}while(null!=(E=l.pop()));return[m,h,c,d,u]}#bt(e,t,r,i,s,a,o){if(e<0||t<0)return!0;const l=this.#K.getWidth(),h=this.#K.getHeight();if(e>=l||t>=h)return!0;const c=e+t*l,d=this.#Et[c];if(d===Ie.#lt)return!1;if(d===a)return!1;const u=this.#K.getElementHead(e,t);return o.tree||n.getBehaviour(u)===n.BEHAVIOUR_TREE&&(o.tree=!0),(u&r)!==i||(this.#Et[c]=Ie.#lt,s.push(c),!1)}}class we{static create(e){return new we(new Uint32Array(Math.max(1,e)))}#we;#T=-1;constructor(e=new Uint32Array(1)){this.#we=e}push(e){if(this.#we.length===this.#T+1){const e=new Uint32Array(2*this.#we.length);e.set(this.#we),this.#we=e}this.#we[++this.#T]=e}pop(){return-1===this.#T?null:this.#we[this.#T--]}shadowClone(){const e=new we(this.#we);return e.#T=this.#T,e}removePrevious(){this.#we[this.#T+1]=4294967295}reset(){this.#T=-1}}class Oe{#K;#ut;#mt;constructor(e,t,r){this.#K=e,this.#ut=t,this.#mt=r}behaviourEntity(e,t,r){const i=n.getSpecial(e);if(i<5){const s=n.setSpecial(e,i+1);this.#K.setElementHead(t,r,s)}else{const i=this.#ut.nextInt(100)<20?n.TYPE_POWDER:n.TYPE_POWDER_WET;let s=e;s=n.setType(s,n.type8Powder(i,4)),s=n.setBehaviour(s,n.BEHAVIOUR_NONE),s=n.setSpecial(s,0),this.#K.setElementHead(t,r,s)}}}class be{static#_t=34;static createFireElementHead(e){let t=n.of(n.TYPE_EFFECT,n.BEHAVIOUR_FIRE);return t=n.setTemperature(t,e),t}static createFireElementTail(e){let t=h.of(0,0,0);return t=e>213?h.setColor(t,249,219,30):e>170?h.setColor(t,248,201,7):e>128?h.setColor(t,250,150,3):e>85?h.setColor(t,255,111,0):e>80?h.setColor(t,255,37,0):e>75?h.setColor(t,250,4,5):h.setColor(t,125,0,0),t}#K;#ut;#mt;constructor(e,t,r){this.#K=e,this.#ut=t,this.#mt=r}behaviourFire(e,t,r){if(0!==this.#ut.nextInt(4))return;const i=n.getTemperature(e),s=this.#Mt(t,r,i);if(s<be.#_t)return void this.#K.setElement(t,r,this.#mt.getDefaults().getDefaultElement());const a=this.#K.getElementHeadOrNull(t,r-1);n.getTypeClass(a)!==n.TYPE_FLUID?(null!==a&&this.#xt(a)?(this.#K.setElementHead(t,r-1,be.createFireElementHead(s)),this.#K.setElementTail(t,r-1,be.createFireElementTail(s))):(this.#K.setElementHead(t,r,n.setTemperature(e,s)),this.#K.setElementTail(t,r,be.createFireElementTail(s))),this.#Ht(t+1,r-1,s),this.#Ht(t-1,r-1,s),this.#Ht(t+1,r,s),this.#Ht(t-1,r,s),this.#Ht(t,r+1,s)):this.#K.setElement(t,r,this.#mt.getDefaults().getDefaultElement())}#Mt(e,t,r){let n=r+this.#Dt(e,t+1)+this.#Dt(e+1,t+1)+this.#Dt(e-1,t+1);return n/=4,n<76?0===this.#ut.nextInt(2)&&(n-=this.#ut.nextInt(10)):0===this.#ut.nextInt(2)&&(n-=this.#ut.nextInt(50)),n<0&&(n=0),n}#Dt(e,t){const r=this.#K.getElementHeadOrNull(e,t);return null!==r?n.getTemperature(r):null}#xt(e){return n.getTypeClass(e)===n.TYPE_AIR}#Ht(e,t,r){const i=this.#K.getElementHeadOrNull(e,t);if(null==i)return;if(n.getBehaviour(i)===n.BEHAVIOUR_FIRE){const s=n.getTemperature(i);if(s<r){const n=Math.trunc((r-s)/2);n>be.#_t&&(this.#K.setElementHead(e,t,be.createFireElementHead(n)),this.#K.setElementTail(e,t,be.createFireElementTail(n)))}return}if(n.getTypeClass(i)===n.TYPE_AIR){const n=Math.trunc(.7*r);return void(n>be.#_t&&(this.#K.setElementHead(e,t,be.createFireElementHead(n)),this.#K.setElementTail(e,t,be.createFireElementTail(n))))}const s=n.getHeatModIndex(i),a=n.hmiToFlammableChanceTo10000(s);if(0!==a){if(n.getBehaviour(i)===n.BEHAVIOUR_FIRE_SOURCE)return;if(this.#ut.nextInt(1e4)<a)return void this.ignite(i,e,t)}if(0===this.#ut.nextInt(5)){if(n.getTemperature(i)<r){const s=n.setTemperature(i,r);this.#K.setElementHead(e,t,s)}}if(T.isVisualBurnApplicable(i)&&0===this.#ut.nextInt(10)){const r=this.#K.getElementTail(e,t);this.#K.setElementTail(e,t,T.visualBurn(r,1,2))}}behaviourFireSource(e,t,r){const i=n.getHeatModIndex(e),s=n.hmiToFlameHeat(i),a=n.hmiToBurnDownChanceTo10000(i);if(this.#ut.nextInt(1e4)<a){if(n.getTypeClass(e)>=n.TYPE_POWDER&&this.#ut.nextInt(100)<8){const i=n.getTemperature(e),s=this.#mt.getDefaults().getBrushAsh().apply(t,r,this.#ut),a=n.setTemperature(s.elementHead,i),o=s.elementTail;this.#K.setElementHeadAndTail(t,r,a,o)}else this.#K.setElementHead(t,r,be.createFireElementHead(s)),this.#K.setElementTail(t,r,be.createFireElementTail(s));return}const o=this.#Nt(t,r-1,s)|this.#Nt(t,r+1,s)|this.#Nt(t-1,r,s)|this.#Nt(t+1,r,s);if(0!==o&&0==(2&o))if(n.getTypeClass(e)===n.TYPE_STATIC&&this.#ut.nextInt(1e4)<2){const i=n.type8Powder(n.TYPE_POWDER,5,1,this.#ut.nextInt(2));this.#K.setElementHead(t,r,n.setType(e,i))}else this.#K.setElementHead(t,r,n.setTemperature(e,s));else this.#K.setElementHead(t,r,n.setBehaviour(e,n.BEHAVIOUR_NONE))}#Nt(e,t,r){const i=this.#K.getElementHeadOrNull(e,t);if(null===i)return 0;if(n.getBehaviour(i)===n.BEHAVIOUR_LIQUID&&n.getSpecial(i)===n.SPECIAL_LIQUID_WATER)return 2;if(n.getTypeClass(i)<=n.TYPE_EFFECT){const n=this.#ut.nextInt(r);return n>=be.#_t&&(this.#K.setElementHead(e,t,be.createFireElementHead(n)),this.#K.setElementTail(e,t,be.createFireElementTail(n))),1}if(T.isVisualBurnApplicable(i)&&0===this.#ut.nextInt(1e3)){const r=this.#K.getElementTail(e,t);this.#K.setElementTail(e,t,T.visualBurn(r,1,2))}return 0}ignite(e,t,r,i){let s=n.setBehaviour(e,n.BEHAVIOUR_FIRE_SOURCE);s=n.setTemperature(s,n.hmiToFlameHeat(i)),this.#K.setElementHead(t,r,s);const a=this.#K.getElementTail(t,r);this.#K.setElementTail(t,r,T.visualBurn(a,2))}}class _e{static BLUEPRINT_3=["  333"," 32223","3211123","3210123","3211123"," 32223","  333"];static BLUEPRINT_4=["   444   ","  43334"," 4322234","432111234","432101234","432111234"," 4322234","  43334","   444"];static BLUEPRINT_9=["       99999       ","     998888899","   9988777778899","  998776666677899","  987665555566789"," 98766554445566789"," 98765543334556789","9876554322234556789","9876543211123456789","9876543210123456789","9876543211123456789","9876554322234556789"," 98765543334556789"," 98766554445566789","  987665555566789","  998776666677899","   9988777778899","     998888899","       99999"];static iterate(e,t){const r=e[0].length,n=e.length,i=Math.trunc(r/2),s=Math.trunc(n/2);for(let r=0;r<e.length;r++){const n=e[r];for(let e=0;e<n.length;e++){const a=n.charAt(e);" "!==a&&t(e-i,r-s,+a)}}}}class Me{static DIRECTION_FROM_TOP=0;static DIRECTION_FROM_LEFT=1;static DIRECTION_FROM_RIGHT=2;static#Lt=100;static#Ut=255;static#Bt=220;static#Pt=60;#K;#ut;#mt;constructor(e,t,r){this.#K=e,this.#ut=t,this.#mt=r}behaviourMeteor(e,t,r){this.#Ft(e,t,r);const i=n.getSpecial(e),s=1&i;let a=i^!s;if(e=n.setSpecial(e,a),this.#K.setElementHead(t,r,e),!s)return;const o=(-2&i)>>1;let l,h;o===Me.DIRECTION_FROM_TOP?(h=r+1,l=t):o===Me.DIRECTION_FROM_LEFT?(h=r+1,l=t+(h%4==0?1:0)):o===Me.DIRECTION_FROM_RIGHT?(h=r+1,l=t-(h%4==0?1:0)):(h=r+1,l=t),this.#K.isValidPosition(l,h)?this.#mt.isFallThroughEnabled()&&h===this.#K.getHeight()-1?this.#kt(l,0)&&(this.#K.swap(t,r,l,0),this.#mt.trigger(l,0)):this.#kt(l,h)?this.#K.swap(t,r,l,h):this.#Yt(e,t,r):this.#Yt(e,t,r)}#kt(e,t){const r=this.#K.getElementHead(e,t),i=n.getTypeClass(r);if(i<=n.TYPE_GAS||i===n.TYPE_FLUID)return!0;const s=n.getBehaviour(r);return s===n.BEHAVIOUR_TREE_LEAF||s===n.BEHAVIOUR_GRASS}#Ft(e,t,r){_e.iterate(_e.BLUEPRINT_4,((e,i,s)=>{if(0===s)return;const a=t+e,o=r+i;if(this.#K.isValidPosition(a,o)){let e=this.#K.getElementHead(a,o);if(n.getTypeClass(e)<=n.TYPE_GAS){const e=this.#mt.getDefaults().getBrushFire();this.#K.setElement(a,o,e.apply(a,o,this.#ut))}else{const t=n.setTemperature(e,Me.#Lt);this.#K.setElementHead(a,o,t)}}}))}#Yt(e,t,r){_e.iterate(_e.BLUEPRINT_9,((e,i,s)=>{const a=t+e,o=r+i;if(this.#K.isValidPosition(a,o)){let e=this.#K.getElementHead(a,o);if(0!==s&&n.getBehaviour(e)===n.BEHAVIOUR_METEOR)return;if(s<=7){const e=this.#mt.getDefaults().getBrushFire();this.#K.setElement(a,o,e.apply(a,o,this.#ut))}else{const t=(8===s?Me.#Ut:Me.#Bt)-this.#ut.nextInt(Me.#Pt);if(e=n.setTemperature(e,t),T.isVisualBurnApplicable(e)){let e=this.#K.getElementTail(a,o);e=8===s?T.visualBurn(e,2):T.visualBurn(e,1),this.#K.setElementTail(a,o,e)}if(n.getTypeClass(e)===n.TYPE_STATIC&&(8===s||9===s&&this.#ut.nextInt(10)<3)){const t=n.type8Powder(n.TYPE_POWDER,5);e=n.setType(e,t)}this.#K.setElementHead(a,o,e)}}}))}}class xe{static#Vt=20;static canGrowUpHere(e,t,r){if(t<0||r-1<0)return!1;if(t>=e.getWidth()||r+1>=e.getHeight())return!1;let i=e.getElementHead(t,r);if(n.getTypeClass(i)!==n.TYPE_AIR)return!1;if(n.getTemperature(i)>=this.#Vt)return!1;let s=e.getElementHead(t,r+1);if(n.getBehaviour(s)!==n.BEHAVIOUR_SOIL)return!1;if(n.getTemperature(s)>=this.#Vt)return!1;let a=e.getElementHead(t,r-1);return n.getTypeClass(a)===n.TYPE_AIR}static spawnHere(e,t,r,i,s){let a=i.apply(t,r,s),o=0;for(let i=n.getSpecial(a.elementHead);i>=0&&!(r-o<0);i--)e.setElementHead(t,r-o,n.setSpecial(a.elementHead,i)),e.setElementTail(t,r-o,a.elementTail),o++}#K;#ut;#mt;constructor(e,t,r){this.#K=e,this.#ut=t,this.#mt=r}behaviourGrass(e,t,r){if(n.getTemperature(e)>xe.#Vt){this.#K.setElementHead(t,r,n.setBehaviour(e,0));const i=this.#K.getElementTail(t,r),s=this.#ut.nextInt(2)+1;this.#K.setElementTail(t,r,T.visualBurn(i,s))}let i=this.#ut.nextInt(100);if(i<3){if(r>0){let e=this.#K.getElementHead(t,r-1);if(n.getBehaviour(e)!==n.BEHAVIOUR_GRASS){let i=n.getTypeClass(e);if(i>n.TYPE_FLUID||i===n.TYPE_FLUID&&0===this.#ut.nextInt(100))return void this.#K.setElement(t,r,this.#mt.getDefaults().getDefaultElement())}}if(0===i){let i=n.getSpecial(e);if(0===i)return void(0===this.#ut.nextInt(5)&&this.#K.setElement(t,r,this.#mt.getDefaults().getDefaultElement()));if(0===r)return;let s=this.#K.getElementHead(t,r-1);if(n.getTypeClass(s)!==n.TYPE_AIR)return;if(r>1){let e=this.#K.getElementHead(t,r-2);if(n.getTypeClass(e)!==n.TYPE_AIR)return}this.#K.setElementHead(t,r-1,n.setSpecial(e,i-1)),this.#K.setElementTail(t,r-1,this.#K.getElementTail(t,r))}else if(1===i){if(xe.canGrowUpHere(this.#K,t+1,r+1)){const e=this.#mt.getDefaults().getBrushGrass();this.#K.setElement(t+1,r+1,e.apply(t,r,this.#ut))}}else if(2===i&&xe.canGrowUpHere(this.#K,t-1,r+1)){const e=this.#mt.getDefaults().getBrushGrass();this.#K.setElement(t-1,r+1,e.apply(t,r,this.#ut))}}}}class He{static TYPE_TRUNK=1;static TYPE_BRANCH=2;static TYPE_LEAF=3;static TYPE_ROOT=4;static#Wt=100;static#Gt=50;static#zt=40;static#Kt=T.visualNoiseProvider(7616891641);static#Xt=(e,t,r)=>He.#Kt.visualNoise(e,t,r,10,.5,1,68,77,40);static#jt=(e,t,r)=>He.#Kt.visualNoise(e,t,r,4,.5,.9,87,61,39);static spawnHere(e,t,r,i,s,a,o,l=-1){i%=1<<n.FIELD_SPECIAL_SIZE;const h=s.apply(t,r,a);h.elementHead=n.setSpecial(h.elementHead,i),e.setElement(t,r,h);const c=o.getDefaults().getTreeTrunkTemplates()[i];if(void 0===c)throw"Tree template not found: "+i;const d=new He(e,a,o);d.#Jt(h.elementHead,t,r,c,l);for(let i=1;i<10;i++)for(let s=0;s<9;s++){const o=t+s-4,l=r+i;if(!e.isValidPosition(o,l))continue;const h=e.getElementHead(o,l);if(n.getBehaviour(h)!==n.BEHAVIOUR_TREE_ROOT)continue;const c=n.getSpecial(h);if(0===c)continue;const u=a.nextInt(10);d.#qt(o,l,h,c,u)}}#K;#ut;#mt;#Zt;#Qt;constructor(e,t,r){this.#K=e,this.#ut=t,this.#mt=r,this.#Zt=this.#mt.getDefaults().getTreeTrunkTemplates(),this.#Qt=this.#mt.getDefaults().getTreeLeafClusterTemplates()}behaviourTree(e,t,r){if(n.getTemperature(e)>He.#Wt)return void this.#K.setElementHead(t,r,n.setBehaviour(e,0));if(0===this.#ut.nextInt(q.OPT_CYCLES_PER_SECOND)){const i=n.getSpecial(e),s=this.#Zt[i];if(void 0===s)throw"Tree template not found: "+i;const a=this.#Jt(e,t,r,s,1);this.#$t(t,r,a,s)}}#Jt(e,t,r,s,a=1){let o=this.#er(t,r-2),l=0,h=0,c=[{entries:s.entries,index:0,x:0,y:0,brush:null}],d=(e,n,i,s,a)=>{let o=i.apply(e,n,this.#ut);if(null===s)this.#K.setElement(e,n,o);else{const i=t-e+10*t,a=r-n+10*r,l=s(o.elementTail,i,a);this.#K.setElementHeadAndTail(e,n,o.elementHead,l)}this.#mt.trigger(e,n),this.#mt.triggerSolidCreated(o.elementHead,e,n),a&&(l++,h++)};for(;c.length>0;){const e=c.length;let s=!1;for(let a=0;a<e;a++){const e=c[a];if(e.index>=e.entries.length){s=!0;continue}const h=e.entries[e.index++],[u,m,E]=h,g=t+u+e.x,p=r-m-e.y;if(this.#K.isValidPosition(g,p)){const t=this.#K.getElementHead(g,p),r=n.getBehaviour(t);switch(E){case He.TYPE_LEAF:r===n.BEHAVIOUR_TREE_LEAF?n.getSpecial(t)<15&&this.#K.setElementHead(g,p,n.setSpecial(t,0)):(r===n.BEHAVIOUR_TREE_TRUNK||n.getTypeClass(t)===n.TYPE_AIR)&&d(g,p,e.brush,He.#Xt,!1);break;case He.TYPE_TRUNK:(r===n.BEHAVIOUR_TREE_TRUNK||r===n.BEHAVIOUR_TREE_LEAF)&&l++;let s=!1;if((n.getTypeClass(t)===n.TYPE_AIR||r===n.BEHAVIOUR_SOIL||r===n.BEHAVIOUR_GRASS||m<5&&n.getTypeClass(t)!==n.TYPE_STATIC)&&(s=!0),s){d(g,p,m>0?this.#mt.getDefaults().getBrushTreeWood():this.#mt.getDefaults().getBrushTreeWoodDark(),He.#jt,!0),2===m&&0===u&&this.#tr(g,p,o)}break;case He.TYPE_BRANCH:let a=!1;if(r===n.BEHAVIOUR_TREE_LEAF)l++,n.getSpecial(t)<15&&this.#K.setElementHead(g,p,n.setSpecial(t,0));else if(r===n.BEHAVIOUR_TREE_TRUNK)l++;else{if(n.getTypeClass(t)!==n.TYPE_AIR)break;a=!0}let h=i.next(o+u+m),A=Math.trunc(h*this.#Qt.length),f=this.#Qt[A],T=Math.trunc(1024*h)%2==0?this.#mt.getDefaults().getBrushTreeLeaf():this.#mt.getDefaults().getBrushTreeLeafDark();c.push({entries:f.entries,index:0,x:u,y:m,brush:T}),a&&d(g,p,T,He.#Xt,!0);break;case He.TYPE_ROOT:r===n.BEHAVIOUR_TREE_ROOT?l++:d(g,p,this.#mt.getDefaults().getBrushTreeRoot(),null,!0);break;default:throw"Unknown type: "+E}}let A=h.length>3?h[3]:void 0;void 0!==A&&c.push({entries:A,index:0,x:e.x,y:e.y,brush:e.brush})}if(-1!==a&&h>=a)break;if(s)for(let e=c.length-1;e>=0;e--){let t=c[e];t.index>=t.entries.length&&c.splice(e,1)}}return l}#er(e,t){if(this.#K.isValidPosition(e,t)){let r=this.#K.getElementHead(e,t);if(n.getBehaviour(r)===n.BEHAVIOUR_TREE_TRUNK)return n.getSpecial(r)}return this.#ut.nextInt(1<<n.FIELD_SPECIAL_SIZE)}#tr(e,t,r){let i=this.#K.getElementHead(e,t);i=n.setSpecial(i,r),this.#K.setElementHead(e,t,i)}#$t(e,t,r,i){if(t>0){let s=this.#K.getElementHead(e,t-1);if(n.getBehaviour(s)===n.BEHAVIOUR_TREE_TRUNK){const a=15;let o=n.getSpecial(s),l=Math.trunc(r/i.entriesCount*a);if(o-l>5){this.#K.setElementHead(e,t-1,n.setSpecial(s,0));const r=this.#mt.getDefaults().getBrushTreeWoodDark();this.#K.setElement(e,t,r.apply(e,t,this.#ut))}else this.#K.setElementHead(e,t-1,n.setSpecial(s,l))}}}behaviourTreeRoot(e,t,r){if(n.getTemperature(e)>He.#Wt)return void this.#K.setElementHead(t,r,n.setBehaviour(e,0));let i=n.getSpecial(e);if(0===i)return void(this.#mt.getIteration()%1e3==0&&this.#rr(t,r));let s=this.#ut.nextInt(10*q.OPT_CYCLES_PER_SECOND);s<10&&this.#qt(t,r,e,i,s)}#rr(e,t){const r=e+this.#ut.nextInt(3)-1,i=t+this.#ut.nextInt(3)-1;if(this.#K.isValidPosition(r,i)){let e=this.#K.getElementHead(r,i),t=n.getTypeClass(e);if(t===n.TYPE_POWDER||t===n.TYPE_POWDER_WET||t===n.TYPE_POWDER_FLOATING){let t=n.type8(n.type8Solid(n.TYPE_STATIC,3)),s=n.setType(e,t);this.#K.setElementHead(r,i,s)}}}#qt(e,t,r,i,s){let a=(s,a)=>{this.#K.setElementHead(e,t,n.setSpecial(r,0));let o=this.#mt.getDefaults().getBrushTreeRoot().apply(s,a,this.#ut),l=n.setSpecial(o.elementHead,i-1);this.#K.setElementHead(s,a,l),this.#K.setElementTail(s,a,o.elementTail)};if(t<this.#K.getHeight()-1){let r=this.#K.getElementHead(e,t+1);if(n.getTypeClass(r)===n.TYPE_AIR)return void a(e,t+1)}let o=e,l=t;if(9===s||8===s||7===s?(o+=1,l+=1):6===s||5===s||4===s?(o+=-1,l+=1):l+=1,this.#K.isValidPosition(o,l)){let e=this.#K.getElementHead(o,l);n.getTypeClass(e)!==n.TYPE_STATIC&&a(o,l)}}behaviourTreeLeaf(e,t,r){let i=n.getSpecial(e);if(i<15){if(n.getTemperature(e)>He.#zt)return void this.#nr(e,t,r);if(this.#mt.getIteration()%32==0&&0===this.#ut.nextInt(10)){if(i++,i>=15)return void this.#nr(e,t,r);e=n.setSpecial(e,i),this.#K.setElementHead(t,r,e)}}if(this.#mt.getIteration()%4==0&&0===this.#ut.nextInt(10)){const e=[[0,-1],[0,-1],[-1,0],[1,0],[-1,-1],[1,-1]],i=e[this.#ut.nextInt(e.length)],s=t+i[0],a=r+i[1],o=this.#K.getElementHeadOrNull(s,a);if(null!==o&&n.getTypeClass(o)>=n.TYPE_FLUID&&n.getTypeClass(o)<n.TYPE_STATIC){let e=t,i=r;for(let t=0;t<25;t++){e+=this.#ut.nextInt(3)-1,i+=1;const t=this.#K.getElementHeadOrNull(e,i);if(null===t)break;if(n.getBehaviour(t)===n.BEHAVIOUR_TREE_LEAF)continue;if(n.getTypeClass(t)<=n.TYPE_GAS)return void this.#K.swap(s,a,e,i);break}0===this.#ut.nextInt(20)&&this.#K.setElement(t,r,this.#mt.getDefaults().getDefaultElement())}}}#nr(e,t,r){const i=this.#K.getElementTail(t,r),s=.85,a=255*(1-s);let o=h.setColor(255&Math.trunc(1.4*h.getColorRed(i)*s+a),255&Math.trunc(.9*h.getColorGreen(i)*s+a),255&Math.trunc(.8*h.getColorBlue(i)*s+a));const l=n.setSpecial(e,15);this.#K.setElementHeadAndTail(t,r,l,o)}}class De{static RET_FLAG_ACTIVE=2;static RET_FLAG_SKIP_TEMP=1;static FIRST_LIGHT=n.SPECIAL_LIQUID_LIGHT_OIL;static FIRST_HEAVY=n.SPECIAL_LIQUID_HEAVY_MOLTEN;#K;#ut;#mt;constructor(e,t,r){this.#K=e,this.#ut=t,this.#mt=r}behaviourLiquid(e,t,r){switch(n.getSpecial(e)){case n.SPECIAL_LIQUID_WATER:return this.#ir(e,t,r);case n.SPECIAL_LIQUID_LIGHT_OIL:return this.#sr(e,t,r);case n.SPECIAL_LIQUID_HEAVY_MOLTEN:return this.#ar(e,t,r)}return 0}testBehaviourLiquid(e,t,r){switch(n.getSpecial(e)){case n.SPECIAL_LIQUID_WATER:return this.#or(e,t,r);case n.SPECIAL_LIQUID_LIGHT_OIL:return this.#lr(e,t,r);case n.SPECIAL_LIQUID_HEAVY_MOLTEN:return this.#hr(e,t,r)}return!1}#ir(e,t,r){const i=n.getTypeClass(e),s=n.getTemperature(e);if(i===n.TYPE_FLUID){if(s>20){const e=this.#mt.getDefaults().getBrushSteam().apply(t,r,this.#ut),i=n.setTemperature(e.elementHead,s);return this.#K.setElementHeadAndTail(t,r,i,e.elementTail),De.RET_FLAG_ACTIVE|De.RET_FLAG_SKIP_TEMP}}else if(i===n.TYPE_GAS&&s<10){const e=this.#mt.getDefaults().getBrushWater().apply(t,r,this.#ut),i=n.setTemperature(e.elementHead,s);return this.#K.setElementHeadAndTail(t,r,i,e.elementTail),De.RET_FLAG_ACTIVE|De.RET_FLAG_SKIP_TEMP}return 0}#or(e,t,r){const i=n.getTypeClass(e),s=n.getTemperature(e);return i===n.TYPE_FLUID?s>20:i===n.TYPE_GAS&&s<10}#ar(e,t,r){if(n.getTypeClass(e)!==n.TYPE_FLUID)return 0;let i=0;const s=this.#ut.nextInt(8);s%4==0&&(this.#cr(t,r+1)?(this.#K.swap(t,r,t,r+1),i=De.RET_FLAG_SKIP_TEMP):4===s?this.#cr(t+1,r)&&(this.#K.swap(t,r,t+1,r),i=De.RET_FLAG_SKIP_TEMP):this.#cr(t-1,r)&&(this.#K.swap(t,r,t-1,r),i=De.RET_FLAG_SKIP_TEMP));return De.RET_FLAG_ACTIVE|i}#hr(e,t,r){return n.getTypeClass(e)===n.TYPE_FLUID}#sr(e,t,r){if(n.getTypeClass(e)!==n.TYPE_FLUID)return 0;let i=0;const s=this.#ut.nextInt(32);if(s%16==0&&(this.#dr(t,r-1)?(this.#K.swap(t,r,t,r-1),i=De.RET_FLAG_SKIP_TEMP):0===s?this.#dr(t+1,r)&&(this.#K.swap(t,r,t+1,r),i=De.RET_FLAG_SKIP_TEMP):this.#dr(t-1,r)&&(this.#K.swap(t,r,t-1,r),i=De.RET_FLAG_SKIP_TEMP)),7===s){const e=this.#K.getElementHeadOrNull(t,r+1);if(null!==e&&n.getTypeClass(e)>=n.TYPE_FLUID){let e=this.#K.getElementTail(t,r+1);e=T.visualBurn(e,1,1),this.#K.setElementTail(t,r+1,e)}}return i}#lr(e,t,r){return n.getTypeClass(e)===n.TYPE_FLUID&&(this.#dr(t,r-1)||this.#dr(t+1,r)||this.#dr(t-1,r))}#cr(e,t){const r=this.#K.getElementHeadOrNull(e,t);if(null===r)return!1;if(n.getTypeClass(r)!==n.TYPE_FLUID)return!1;return n.getSpecial(r)<De.FIRST_HEAVY}#dr(e,t){const r=this.#K.getElementHeadOrNull(e,t);if(null===r)return!1;if(n.getTypeClass(r)!==n.TYPE_FLUID)return!1;const i=n.getSpecial(r);return!(i>=De.FIRST_LIGHT&&i<=De.FIRST_HEAVY)}}class Ne extends q{#K;#W;#V;#ur;#mr;#Er;#gr;#pr;#Ar;#fr=0;#ut;#Tr=!1;#Cr=!1;#yr;static RANDOM_DATA_COUNT=32;#Rr=[];#Sr=[];#vr=[];#Ir;#wr;#Or;#br;#_r;#Mr;#xr;#Hr=[];constructor(e,t,r,n,s){if(super(),this.#K=e,this.#W=e.getWidth(),this.#V=e.getHeight(),this.#ur=t,this.#ur>255)throw"Chunk size limit: 255";this.#mr=Math.ceil(this.#W/this.#ur),this.#Er=Math.ceil(this.#V/this.#ur),this.#gr=new Array(this.#mr*this.#Er).fill(!0),this.#pr=new Array(this.#mr*this.#Er).fill(!0),this.#Ar=new Array(this.#mr*this.#Er).fill(-1);let a=new i(0);this.#Rr=Ne.#Dr(Ne.RANDOM_DATA_COUNT,this.#mr,a),this.#Sr=Ne.#Nr(Ne.RANDOM_DATA_COUNT,this.#ur,this.#ur,a),this.#vr=Ne.#Dr(Ne.RANDOM_DATA_COUNT,this.#ur,a),this.#ut=r,this.#yr=n,this.#Ir=new Ie(e,r,this),this.#wr=new Oe(e,r,this),this.#Or=new De(e,r,this),this.#br=new be(e,r,this),this.#_r=new Me(e,r,this),this.#Mr=new xe(e,r,this),this.#xr=new He(e,r,this),s&&(this.#fr=s.iteration,this.#Tr=s.fallThroughEnabled,this.#Cr=s.erasingEnabled)}static#Lr(e,t,r){for(let n=0;n<t;n++){let t=r.nextInt(e.length),n=r.nextInt(e.length);[e[t],e[n]]=[e[n],e[t]]}}static#Dr(e,t,r){let n=Ne.#Ur(t);Ne.#Lr(n,e,r);let i=Array(e);for(let t=0;t<e;t++)Ne.#Lr(n,Math.ceil(e/4),r),i[t]=new Uint8Array(n);return i}static#Ur(e){let t=new Uint8Array(e);for(let r=0;r<e;r++)t[r]=r;return t}static#Nr(e,t,r,n){let i=Array(e);for(let s=0;s<e;s++)i[s]=Ne.#Br(t,r,n);return i}static#Br(e,t,r){let n=new Uint8Array(e);for(let i=0;i<e;i++)n[i]=r.nextInt(t);return n}getIteration(){return this.#fr}getDefaults(){return this.#yr}setFallThroughEnabled(e){this.#Tr=e}setErasingEnabled(e){this.#Cr=e}isFallThroughEnabled(){return this.#Tr}isErasingEnabled(){return this.#Cr}addExtension(e){this.#Hr.push(e)}trigger(e,t){const r=Math.floor(e/this.#ur),n=Math.floor(t/this.#ur)*this.#mr+r;this.#gr[n]=!0}triggerSolidCreated(e,t,r){this.#Ir.onSolidCreated(e,t,r)}getActiveChunks(){return this.#gr}getChangedChunks(){return this.#pr}cleanChangedChunks(){this.#pr.fill(!1)}next(){this.#Ir.onNextIteration();const e=Array.from(this.#gr);this.#gr.fill(!1);const t=this.#fr%9,r=Math.trunc(t/3),n=t%3;for(let t=this.#Er-1;t>=0;t--){const i=t*this.#ur,s=Math.min((t+1)*this.#ur-1,this.#V-1),a=this.#Rr[this.#ut.nextInt(Ne.RANDOM_DATA_COUNT)],o=0===this.#ut.nextInt(2),l=new Uint16Array(this.#mr);for(let h=s;h>=i;h--)for(let i=0;i<this.#mr;i++){const s=a[i],c=t*this.#mr+s,d=this.#ut.nextInt(Ne.RANDOM_DATA_COUNT),u=o?this.#vr[d]:this.#Sr[d];if(e[c]){let e=l[s];for(let t=0;t<this.#ur;t++){let i=s*this.#ur+u[t];if(i<this.#W){const t=i%3===n&&h%3===r;this.#Pr(i,h,t)&&e++}}l[s]=e}}for(let r=0;r<this.#mr;r++){const n=t*this.#mr+r;e[n]||this.#Fr(r,t,e)&&(e[n]=!0,l[r]=1)}if(o)for(let r=0;r<this.#mr;r++){const n=t*this.#mr+r;if(e[n]&&0===l[r]){const i=this.#Ar[n];(-1===i||this.#fr-i>=10)&&(this.#kr(r,t)||(e[n]=!1,this.#pr[n]=!0,this.#Ar[n]=this.#fr))}}}if(this.#Cr){const e=this.#yr.getDefaultElement();for(let t=0;t<this.#W;t++)this.#K.setElement(t,0,e),this.#K.setElement(t,this.#V-1,e);for(let t=1;t<this.#V-1;t++)this.#K.setElement(0,t,e),this.#K.setElement(this.#W-1,t,e)}for(let t=0;t<this.#mr*this.#Er;t++){e[t]&&(this.#gr[t]=!0,this.#pr[t]=!0)}for(let e of this.#Hr)e.run();this.#fr++}#Fr(e,t,r){if(e>0&&r[t*this.#mr+e-1]){const r=e*this.#ur,n=Math.min((t+1)*this.#ur,this.#V);for(let e=t*this.#ur;e<n;e++)if(this.#Yr(r,e))return!0}if(e<this.#mr-1&&r[t*this.#mr+e+1]){const r=Math.min((e+1)*this.#ur-1,this.#W-1),n=Math.min((t+1)*this.#ur,this.#V);for(let e=t*this.#ur;e<n;e++)if(this.#Yr(r,e))return!0}if(t>0&&r[(t-1)*this.#mr+e]||this.#Tr&&0===t&&r[(this.#Er-1)*this.#mr+e]){const r=t*this.#ur,n=Math.min((e+1)*this.#ur,this.#W);for(let t=e*this.#ur;t<n;t++)if(this.#Yr(t,r))return!0}if(t<this.#Er-1&&r[(t+1)*this.#mr+e]){const r=(t+1)*this.#ur-1,n=Math.min((e+1)*this.#ur,this.#W);for(let t=e*this.#ur;t<n;t++)if(this.#Yr(t,r))return!0}}#kr(e,t){const r=Math.min((e+1)*this.#ur,this.#W),n=Math.min((t+1)*this.#ur,this.#V);for(let i=t*this.#ur;i<n;i++)for(let t=e*this.#ur;t<r;t++)if(this.#Yr(t,i))return!0;return!1}#Yr(e,t){const r=this.#K.getElementHead(e,t);if(n.getTemperature(r)>0)return!0;if(this.#Vr(r,e,t))return!0;switch(n.getBehaviour(r)){case n.BEHAVIOUR_NONE:case n.BEHAVIOUR_SOIL:case n.BEHAVIOUR_TREE_TRUNK:return!1;case n.BEHAVIOUR_LIQUID:return this.#Or.testBehaviourLiquid(r,e,t);default:return!0}}#Vr(e,t,r){const i=n.getTypeClass(e);switch(i){case n.TYPE_AIR:return!1;case n.TYPE_POWDER:case n.TYPE_POWDER_FLOATING:case n.TYPE_POWDER_WET:return!!n.getTypeModifierPowderSliding(e)||this.#Wr(e,t,r,t,r+1);case n.TYPE_FLUID:return this.#Wr(e,t,r,t,r+1)||this.#Wr(e,t,r,t+1,r)||this.#Wr(e,t,r,t-1,r);case n.TYPE_GAS:return this.#Wr(e,t,r,t,r-1)||this.#Wr(e,t,r,t+1,r)||this.#Wr(e,t,r,t-1,r);case n.TYPE_STATIC:return 0!==n.getTypeModifierSolidBodyId(e);default:return!0}throw"Unknown element type: "+i}#Wr(e,t,r,n,i){if(!this.#K.isValidPosition(n,i)){if(!this.#Tr||r!==this.#V-1)return!1;if(i=0,!this.#K.isValidPosition(n,i))return!1}let s=this.#K.getElementHead(n,i);return this.#kt(e,s)}#Pr(e,t,r){const i=this.#K.getElementHead(e,t);if(this.#Gr(i,e,t))return!0;const s=n.getBehaviour(i);let a=!1;switch(s){case n.BEHAVIOUR_NONE:case n.BEHAVIOUR_SOIL:break;case n.BEHAVIOUR_LIQUID:const o=this.#Or.behaviourLiquid(i,e,t);(o&De.RET_FLAG_ACTIVE)===De.RET_FLAG_ACTIVE&&(a=!0),(o&De.RET_FLAG_SKIP_TEMP)===De.RET_FLAG_SKIP_TEMP&&(r=!1);break;case n.BEHAVIOUR_FIRE:this.#br.behaviourFire(i,e,t),a=!0,r=!1;break;case n.BEHAVIOUR_GRASS:this.#Mr.behaviourGrass(i,e,t),a=!0;break;case n.BEHAVIOUR_TREE:this.#xr.behaviourTree(i,e,t),a=!0;break;case n.BEHAVIOUR_TREE_LEAF:this.#xr.behaviourTreeLeaf(i,e,t),a=!0;break;case n.BEHAVIOUR_TREE_TRUNK:break;case n.BEHAVIOUR_TREE_ROOT:this.#xr.behaviourTreeRoot(i,e,t),a=!0;break;case n.BEHAVIOUR_FIRE_SOURCE:this.#br.behaviourFireSource(i,e,t),a=!0,r=!1;break;case n.BEHAVIOUR_METEOR:this.#_r.behaviourMeteor(i,e,t),a=!0,r=!1;break;case n.BEHAVIOUR_ENTITY:this.#wr.behaviourEntity(i,e,t),r=!0,a=!0;break;default:throw"Unknown element behaviour: "+s}if(r){const r=this.#zr(i,e,t);return a||r}return a}#zr(e,t,r){const i=n.getTemperature(e);if(0===i){const s=n.getHeatModIndex(e);return i<n.hmiToHardeningTemperature(s)&&(this.#Kr(e,t,r,s,!0),!0)}let s=t,a=r;switch(this.#ut.nextInt(4)){case 0:a--;break;case 1:s++;break;case 2:a++;break;case 3:s--}const o=n.getHeatModIndex(e),l=this.#ut.nextInt(1e4)<n.hmiToHeatLossChanceTo10000(o);let c;if(this.#K.isValidPosition(s,a)){const h=this.#K.getElementHead(s,a),d=n.getTemperature(h);if(i+d>1){const e=n.hmiToConductiveIndex(o);c=Math.trunc(e*d+(1-e)*i)}if(i-c!=0){let o;l&&c--,c=Math.max(c,0),o=d-c>10?d-10:d+(i-c),o=Math.max(o,0),this.#K.setElementHead(s,a,n.setTemperature(h,o)),this.trigger(s,a),i-c>10&&(c=i-10),e=n.setTemperature(e,c),this.#K.setElementHead(t,r,e)}}else l&&(c=Math.max(i-1,0),e=n.setTemperature(e,c),this.#K.setElementHead(t,r,e));const d=n.hmiToSelfIgnitionChanceTo10000(o);if(c>100&&d>0)if(n.getBehaviour(e)===n.BEHAVIOUR_FIRE_SOURCE);else if(this.#ut.nextInt(1e4)<d)return this.#br.ignite(e,t,r,o),!0;if(c>n.hmiToMeltingTemperature(o)){e=n.setType(e,n.TYPE_FLUID),e=n.setHeatModIndex(e,n.hmiToMeltingHMI(o));let i=this.#K.getElementTail(t,r);return i=h.setBlurType(i,h.BLUR_TYPE_1),this.#K.setElementHeadAndTail(t,r,e,i),!0}return c<n.hmiToHardeningTemperature(o)&&this.#Kr(e,t,r,o,!1),!0}#Kr(e,t,r,i,s){if(s||this.#Xr(t,r)){e=n.setType(e,n.type8Solid(n.TYPE_STATIC,2)),e=n.setHeatModIndex(e,n.hmiToHardeningHMI(i));let s=this.#K.getElementTail(t,r);s=h.setBlurType(s,h.BLUR_TYPE_NONE),this.#K.setElementHeadAndTail(t,r,e,s)}}#Xr(e,t){if(t!==this.#V-1){if(this.#jr(this.#K.getElementHead(e,t+1)))return!0}else if(!this.#Tr&&!this.#Cr)return!0;return!(!this.#K.isValidPosition(e-1,t)||!this.#jr(this.#K.getElementHead(e-1,t)))||!(!this.#K.isValidPosition(e+1,t)||!this.#jr(this.#K.getElementHead(e+1,t)))}#jr(e){return n.getTypeClass(e)>n.TYPE_FLUID}#Gr(e,t,r){const i=n.getTypeClass(e);switch(i){case n.TYPE_AIR:return!1;case n.TYPE_POWDER:case n.TYPE_POWDER_WET:case n.TYPE_POWDER_FLOATING:if(this.#Jr(e,t,r,t,r+1))return r%2==0?this.#qr(t-1,r+1,0):this.#qr(t+1,r+1,1),this.#qr(t,r+1,r%2),r%2==0?this.#qr(t+1,r,0):this.#qr(t-1,r,1),!0;if(1===n.getTypeModifierPowderSliding(e)){const i=n.getTypeModifierPowderMomentum(e);if(this.#ut.nextInt(1e6)>Ne.#Zr(i))return this.#K.setElementHead(t,r,n.setTypeModifierPowderSliding(e,0)),!1;const s=n.getTypeModifierPowderDirection(e);this.#qr(t,r+1,s);const a=0===s?-1:1;return this.#Jr(e,t,r,t+a,r)?(this.#qr(t+a,r+1,s),this.#qr(t-a,r,s),!0):(this.#qr(t+a,r+1,s),this.#K.setElementHead(t,r,n.setTypeModifierPowderSliding(e,0)),!1)}return!1;case n.TYPE_FLUID:if(!this.#Jr(e,t,r,t,r+1)){return 0===this.#ut.nextInt(2)?!!this.#Jr(e,t,r,t+1,r)&&(this.#qr(t+1,r+1,1),this.#Jr(e,t+1,r,t+2,r)&&(this.#Jr(e,t+2,r,t+3,r)?this.trigger(t+3,r):this.trigger(t+2,r)),!0):!!this.#Jr(e,t,r,t-1,r)&&(this.#qr(t-1,r+1,0),this.#Jr(e,t-1,r,t-2,r)&&(this.#Jr(e,t-2,r,t-3,r)?this.trigger(t-3,r):this.trigger(t-2,r)),!0)}return!0;case n.TYPE_GAS:let i=this.#ut.nextInt(8);return 0!==i&&2!==i||!this.#Jr(e,t,r,t,r-1)?3===i&&this.#Jr(e,t,r,t+1,r)?(this.trigger(t+1,r),!0):!(4!==i||!this.#Jr(e,t,r,t-1,r))&&(this.trigger(t-1,r),!0):(this.trigger(t,r-1),!0);case n.TYPE_STATIC:return 0!==n.getTypeModifierSolidBodyId(e)&&this.#Ir.behaviourSolid(e,t,r);case n.TYPE_EFFECT:return!1}throw"Unknown element type: "+i}#Jr(e,t,r,i,s){if(!this.#K.isValidPosition(i,s)){if(!this.#Tr||r!==this.#V-1)return!1;if(s=0,!this.#K.isValidPosition(i,s))return!1}const a=this.#K.getElementHead(i,s),o=n.getTypeClass(a);if(o===n.TYPE_POWDER_FLOATING||o===n.TYPE_POWDER)return!1;const l=n.getTypeClass(e);if(l>o){if(l===n.TYPE_POWDER&&o===n.TYPE_FLUID){const o=n.setTypeClass(e,n.TYPE_POWDER_WET),l=this.#K.getElementTail(t,r);if(this.#ut.nextInt(100)>9)this.#K.setElement(t,r,this.#yr.getDefaultElement());else{const e=this.#K.getElementTail(i,s);this.#K.setElementHead(t,r,a),this.#K.setElementTail(t,r,e)}this.#K.setElementHead(i,s,o),this.#K.setElementTail(i,s,l)}else{const n=this.#K.getElementTail(t,r),o=this.#K.getElementTail(i,s);this.#K.setElementHead(i,s,e),this.#K.setElementHead(t,r,a),this.#K.setElementTail(i,s,n),this.#K.setElementTail(t,r,o)}return!0}return!1}#kt(e,t){const r=n.getTypeClass(t);if(r===n.TYPE_POWDER_FLOATING||r===n.TYPE_POWDER)return!1;return n.getTypeClass(e)>r}#qr(e,t,r){if(this.#K.isValidPosition(e,t)){let i=this.#K.getElementHead(e,t);const s=n.getTypeClass(i);if(s===n.TYPE_POWDER||s===n.TYPE_POWDER_WET||s===n.TYPE_POWDER_FLOATING){const s=n.getTypeModifierPowderMomentum(i);if(0===s)return;const a=0===r?-1:1;if(this.#K.isValidPosition(e+a,t)){const r=this.#K.getElementHead(e+a,t);if(!this.#kt(i,r))return}if(this.#ut.nextInt(1e6)>Ne.#Qr(s))return;i=n.setTypeModifierPowderSliding(i,1),i=n.setTypeModifierPowderDirection(i,r),this.#K.setElementHead(e,t,i)}}}static#Zr(e){return[0,4e5,6e5,7e5,7e5,8e5,95e4,95e4][e]}static#Qr(e){return[0,4e5,4e5,4e5,6e5,6e5,85e4,9e5][e]}}class Le{trigger(e,t){throw"Not implemented"}render(e){throw"Not implemented"}}class Ue{getContextType(){throw"Not implemented"}initialize(e,t,r){throw"Not implemented"}}class Be{#$r;#en;#tn;#rn;#nn;#in=!0;#sn=[];constructor(e,t,r,n,i){this.#$r=e,this.#en=t,this.#tn=r,this.#rn=n,this.#nn=i,this.#in=!0===i.visible}getPosition(){return[this.#$r,this.#en,this.#tn,this.#rn]}getConfig(){return this.#nn}isVisible(){return this.#in}setVisible(e){if(this.#in!==e){this.#in=e;for(let t of this.#sn)t(e)}}addOnVisibleChanged(e){this.#sn.push(e)}}class Pe{#K;#st;#ut;#yr;#an;constructor(e,t,r,n,i){this.#K=e,this.#st=t,this.#ut=r,this.#yr=n,this.#an=i}swap(e,t,r,n){e=Math.trunc(e),t=Math.trunc(t),r=Math.trunc(r),n=Math.trunc(n),this.#K.isValidPosition(e,t)&&this.#K.isValidPosition(r,n)&&(this.#K.swap(e,t,r,n),this.#an(e,t),this.#an(r,n))}draw(e,t,n){if(e=Math.trunc(e),t=Math.trunc(t),this.#K.isValidPosition(e,t))if(null===n)this.#K.setElement(e,t,this.#yr.getDefaultElement()),this.#an(e,t);else if(n instanceof r)this.#K.setElement(e,t,n),this.#an(e,t);else{if(!(n instanceof s))throw"Brush or Element expected";{let r=this.#K.getElement(e,t),i=n.apply(e,t,this.#ut,r);this.#K.setElement(e,t,i),this.#an(e,t)}}}drawRectangle(e,t,n,i,a,o=!1){if(!(a instanceof s||a instanceof r))throw"Brush expected";e=Math.trunc(e),t=Math.trunc(t),n=Math.trunc(n),i=Math.trunc(i),o&&(e=e>=0?e:this.getWidth()+e+1,n=n>=0?n:this.getWidth()+n+1,t=t>=0?t:this.getHeight()+t+1,i=i>=0?i:this.getHeight()+i+1),e=Math.max(Math.min(e,this.getWidth()),0),n=Math.max(Math.min(n,this.getWidth()),0),t=Math.max(Math.min(t,this.getHeight()),0),i=Math.max(Math.min(i,this.getHeight()),0);for(let r=t;r<i;r++)for(let t=e;t<n;t++)this.draw(t,r,a)}drawRectangleWH(e,t,r,n,i){this.drawRectangle(e,t,e+r,t+n,i,!1)}drawLine(e,t,n,i,a,o,l=!1){if(!(o instanceof s||o instanceof r))throw"Brush expected";let h;if(e=Math.trunc(e),t=Math.trunc(t),n=Math.trunc(n),i=Math.trunc(i),l){let e,t=Math.trunc(a/2);e=t<=3?_e.BLUEPRINT_3:4===t?_e.BLUEPRINT_4:_e.BLUEPRINT_9,h=(r,n)=>{_e.iterate(e,((e,i,s)=>{s<=t&&this.draw(r+e,n+i,o)}))}}else{const e=Math.ceil(a/2);h=(t,r)=>{this.drawRectangle(t-e,r-e,t+e,r+e,o)}}Pe.#on(e,t,n,i,h)}static#on(e,t,r,n,i){if(i(e,t),e!==r||t!==n){const s=e<r?1:-1,a=t<n?1:-1,o=Math.abs(r-e),l=Math.abs(n-t);let h=o-l;for(;e!==r||t!==n;){const r=2*h;r>-l&&(h-=l,e+=s),r<o&&(h+=o,t+=a),i(e,t)}}}drawShape(e,t){if(!(e instanceof Be))throw"Shape not supported";{const[r,n,i,s]=e.getPosition();this.drawRectangle(r,n,i,s,t,!1)}}fill(e){this.drawRectangle(0,0,this.#K.getWidth(),this.#K.getHeight(),e)}floodFill(e,t,r,n){e=Math.trunc(e),t=Math.trunc(t),new G(this.#K,n,this).paint(e,t,r)}replace(e,t){const r=this.getWidth(),n=this.getHeight();for(let i=0;i<n;i++)for(let n=0;n<r;n++){const r=this.#K.getElement(n,i);r.elementHead===e.elementHead&&r.elementTail===e.elementTail&&this.#K.setElement(n,i,t)}}flipVertically(){const e=this.getWidth(),t=this.getHeight(),r=Math.trunc(t/2);for(let n=0;n<e;n++)for(let e=0;e<r;e++)this.swap(n,e,n,t-e-1)}flipHorizontally(){const e=this.getWidth(),t=this.getHeight(),r=Math.trunc(e/2);for(let n=0;n<t;n++)for(let t=0;t<r;t++)this.swap(t,n,e-t-1,n)}insertElementArea(e,t=0,r=0){for(let n=0;n<e.getHeight();n++)for(let i=0;i<e.getWidth();i++)if(this.#K.isValidPosition(i+t,n+r)){const s=e.getElementHead(i,n),a=e.getElementTail(i,n);this.#K.setElementHeadAndTail(i+t,n+r,s,a),this.#an(i+t,n+r)}}getWidth(){return this.#K.getWidth()}getHeight(){return this.#K.getHeight()}entities(){return this.#st}getDefaults(){return this.#yr}}class Fe{#W;#V;#ln;#an;constructor(e,t,r,n){this.#W=e,this.#V=t,this.#ln=r,this.#an=n}insertEntity(e){if(e instanceof he)throw"Entity instance not supported here";"number"==typeof e.y&&(e.y<0||e.y>=this.#V)||"number"==typeof e.x&&(e.x<0||e.x>=this.#W)||(this.#ln.addSerializedEntity(e),"number"==typeof e.x&&"number"==typeof e.y&&this.#an(e.x,e.y))}getAt(e,t){return this.#ln.getAt(e,t)}assignWaypoint(e,t){for(const r of this.#ln.getEntities())"function"==typeof r.assignWaypoint&&r.assignWaypoint(e,t)}}class ke{#W;#V;#hn=[];#cn=[];constructor(e,t){this.#W=e,this.#V=t}createRectangle(e,t,r,n,i,s=!1){e=Math.trunc(e),t=Math.trunc(t),r=Math.trunc(r),n=Math.trunc(n),s&&(e=e>=0?e:this.#W+e+1,r=r>=0?r:this.#W+r+1,t=t>=0?t:this.#V+t+1,n=n>=0?n:this.#V+n+1),e=Math.max(Math.min(e,this.#W-1),0),r=Math.max(Math.min(r,this.#W-1),0),t=Math.max(Math.min(t,this.#V-1),0),n=Math.max(Math.min(n,this.#V-1),0);const a=new Be(e,t,r,n,i);this.#hn.push(a);for(let e of this.#cn)e(a);return a}createRectangleWH(e,t,r,n,i){return this.createRectangle(e,t,e+r,t+n,i)}getMarkers(e=void 0){return void 0===e?[...this.#hn]:this.#hn.filter((t=>t.getConfig().group===e))}addOnMarkerAdded(e){this.#cn.push(e)}getWidth(){return this.#W}getHeight(){return this.#V}}class Ye{#nn;#in;#sn=[];constructor(e){this.#nn=e,this.#in=!0===e.visible}getConfig(){return this.#nn}isVisible(){return this.#in}setVisible(e){if(this.#in!==e){this.#in=e;for(let t of this.#sn)t(e)}}addOnVisibleChanged(e){this.#sn.push(e)}}class Ve{#nn;#in;#sn=[];#dn;#un=[];#mn=!1;#En=[];constructor(e){this.#nn=e,this.#in=!0===e.visible,this.#dn=!0===e.active}getConfig(){return this.#nn}isVisible(){return this.#in}setVisible(e){if(this.#in!==e){this.#in=e;for(let t of this.#sn)t(e)}}addOnVisibleChanged(e){this.#sn.push(e)}isActive(){return this.#dn}setActive(e){if(this.#dn!==e){this.#dn=e;for(let t of this.#un)t(e)}}addOnActiveChanged(e){this.#un.push(e)}isCompleted(){return this.#mn}setCompleted(e){if(this.#mn!==e){this.#mn=e;for(let t of this.#En)t(e)}}addOnCompleted(e){this.#En.push(e)}}class We{#gn=[];#pn=[];#An=[];#fn=[];#Tn=!1;#Cn=[];constructor(){}createSplash(e){const t=new Ye(e);this.#gn.push(t);for(let e of this.#pn)e(t);return t}getSplashes(){return[...this.#gn]}addOnSplashAdded(e){this.#pn.push(e)}createObjective(e){const t=new Ve(e);this.#An.push(t);for(let e of this.#fn)e(t);return t}getObjectives(){return[...this.#An]}addOnObjectiveAdded(e){this.#fn.push(e)}setCompleted(){if(!this.#Tn){this.#Tn=!0,ge.triggerFeatureUsed(ge.FEATURE_SCENARIO_COMPLETED);for(let e of this.#Cn)e()}}addOnStatusCompleted(e){this.#Cn.push(e)}}class Ge{metadata;dataHeads;dataTails;serializedEntities}class ze{static CURRENT_FORMAT_VERSION=7;formatVersion;appVersion;created;width;height;scale;random;iteration;fallThroughEnabled;erasingEnabled}class Ke{#$;#yn=null;#Rn=null;#Sn=Number.MAX_SAFE_INTEGER;#vn="bottom";constructor(e){this.#$=e}withBlueprint(e){return this.#yn=e,this}withBrushes(e){return this.#Rn=e,this}withMaxHeight(e,t="bottom"){return this.#Sn=e,this.#vn=t,this}paint(){if(null===this.#yn||0===this.#yn.length)throw"Blueprint not set";if(null===this.#Rn)throw"Brushes not set";const e="string"==typeof this.#yn?this.#yn.split("\n"):this.#yn,t=e[0].length,r=e.length,n=Math.ceil(this.#$.getWidth()/t),i=Math.ceil(Math.min(this.#$.getHeight(),this.#Sn)/r),s="bottom"===this.#vn?this.#$.getHeight()-i*r:0;for(let a=0;a<r;a++){const r=e[a];for(let e=0;e<Math.min(t,r.length);e++){const t=r.charAt(e);let o=this.#Rn[t];if(void 0===o){if(" "===t)continue;throw"Brush not found: "+t}this.#$.drawRectangle(e*n,s+a*i,e*n+n+1,s+a*i+i+1,o)}}}}var Xe="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function je(e,t,r){let n=e[t];e[t]=e[r],e[r]=n}class Je{#K;#$;#ut;#mt;#In;constructor(e,t,r,n){this.#K=e,this.#$=t,this.#ut=r,this.#mt=n,this.#In=new Array(e.getWidth()).fill(0)}layer(e,t,r,n=0){return this.layerFunction((function(t){return Math.trunc(e)}),t,r,n),this}layerSpline(e,t,r,n=0){const i=new Array(e.length),s=new Array(e.length);for(let t=0;t<e.length;t++)i[t]=e[t][0],s[t]=e[t][1];const a=new class{constructor(e,t){this.xs=e,this.ys=t,this.ks=this.getNaturalKs(new Float64Array(this.xs.length))}getNaturalKs(e){const t=this.xs.length-1,r=function(e,t){const r=[];for(let n=0;n<e;n++)r.push(new Float64Array(t));return r}(t+1,t+2);for(let e=1;e<t;e++)r[e][e-1]=1/(this.xs[e]-this.xs[e-1]),r[e][e]=2*(1/(this.xs[e]-this.xs[e-1])+1/(this.xs[e+1]-this.xs[e])),r[e][e+1]=1/(this.xs[e+1]-this.xs[e]),r[e][t+1]=3*((this.ys[e]-this.ys[e-1])/((this.xs[e]-this.xs[e-1])*(this.xs[e]-this.xs[e-1]))+(this.ys[e+1]-this.ys[e])/((this.xs[e+1]-this.xs[e])*(this.xs[e+1]-this.xs[e])));return r[0][0]=2/(this.xs[1]-this.xs[0]),r[0][1]=1/(this.xs[1]-this.xs[0]),r[0][t+1]=3*(this.ys[1]-this.ys[0])/((this.xs[1]-this.xs[0])*(this.xs[1]-this.xs[0])),r[t][t-1]=1/(this.xs[t]-this.xs[t-1]),r[t][t]=2/(this.xs[t]-this.xs[t-1]),r[t][t+1]=3*(this.ys[t]-this.ys[t-1])/((this.xs[t]-this.xs[t-1])*(this.xs[t]-this.xs[t-1])),function(e,t){const r=e.length;let n=0,i=0;for(;n<r&&i<=r;){let t=0,s=-1/0;for(let a=n;a<r;a++){const r=Math.abs(e[a][i]);r>s&&(t=a,s=r)}if(0===e[t][i])i++;else{je(e,n,t);for(let t=n+1;t<r;t++){const s=e[t][i]/e[n][i];e[t][i]=0;for(let a=i+1;a<=r;a++)e[t][a]-=e[n][a]*s}n++,i++}}for(let n=r-1;n>=0;n--){var s=0;e[n][n]&&(s=e[n][r]/e[n][n]),t[n]=s;for(let t=n-1;t>=0;t--)e[t][r]-=e[t][n]*s,e[t][n]=0}return t}(r,e)}getIndexBefore(e){let t=0,r=this.xs.length,n=0;for(;t<r;)n=Math.floor((t+r)/2),this.xs[n]<e&&n!==t?t=n:r=this.xs[n]>=e&&n!==r?n:t;return t+1}at(e){let t=this.getIndexBefore(e);const r=(e-this.xs[t-1])/(this.xs[t]-this.xs[t-1]),n=this.ks[t-1]*(this.xs[t]-this.xs[t-1])-(this.ys[t]-this.ys[t-1]),i=-this.ks[t]*(this.xs[t]-this.xs[t-1])+(this.ys[t]-this.ys[t-1]);return(1-r)*this.ys[t-1]+r*this.ys[t]+r*(1-r)*(n*(1-r)+i*r)}}(i,s);return this.layerFunction((function(e){return Math.max(Math.trunc(a.at(e)),0)}),t,r,n),this}layerPerlin(e,t,r,n=0){const s=[];for(let t of e){if(void 0===t.seed&&(i.DEFAULT.next(),t.seed=i.DEFAULT.getState()),void 0===t.factor)throw"factor not defined";if(void 0===t.threshold)throw"threshold not defined";if(void 0===t.force)throw"force not defined";const e=new i(t.seed),r=f((()=>e.next()));s.push({instance:r,levelConfig:t})}return this.layerFunction((function(e){let t=0;for(const{instance:r,levelConfig:n}of s){const{factor:i,threshold:s,force:a}=n;let o=(r(e/i,0)+1)/2;o<s&&(o=0),o=1/(1-s)*(o-s),o*=a,t+=o}return Math.trunc(t)}),t,r,n),this}layerFunction(e,t,r,n=0){for(let i=0;i<this.#K.getWidth();i++){const s=this.#In[i],a=t?s+e(i):e(i);if(s<a){let e=0;for(let t=s;t<a&&t<this.#K.getHeight();t++){let n=this.#K.getHeight()-1-t;this.#$.draw(i,n,r),e++}if(n>0&&e>0)for(let t=0;t<n;t++){const t=Math.min(Math.trunc(e/2),10);if(t>1){const e=this.#ut.nextInt(Math.ceil(t))-Math.trunc(t/2),r=this.#K.getHeight()-1-s+e,n=this.#K.getHeight()-1-s+e+1;r<this.#K.getHeight()&&n<this.#K.getHeight()&&this.#K.swap(i,r,i,n)}}this.#In[i]=a}}return this}grass(e=0,t=-1){-1===t&&(t=this.#K.getWidth());for(let r=e;r<t;r++){const e=this.#In[r],t=this.#K.getHeight()-1-e;if(xe.canGrowUpHere(this.#K,r,t)){const e=this.#mt.getDefaults().getBrushGrass();xe.spawnHere(this.#K,r,t,e,this.#ut)}}return this}tree(e,t=void 0,r=void 0,i=!1){if(e<=5||e>=this.#K.getWidth()-5)return this;const s=this.#In[e],a=this.#K.getHeight()-1-s,o=this.#mt.getDefaults().getBrushTree();if(!this.#K.isValidPosition(e,a+1))return this;if(!i){const t=this.#K.getElementHead(e,a+1);if(n.getBehaviour(t)!==n.BEHAVIOUR_SOIL)return this}return void 0===t&&(t=this.#ut.nextInt(8)),He.spawnHere(this.#K,e,a,t,o,this.#ut,this.#mt,r),this}tool(e,t,r){if(e<0||e>=this.#K.getWidth())return this;const n=this.#In[e],i=this.#K.getHeight()-t-n;return i<0||i>=this.#K.getHeight()||r.applyPoint(e,i,this.#$,!1),this}}class qe{#K;#W;#V;#ln;#ut;#wn;#On;#bn;#_n;#Mn=null;#xn=null;#Hn=[];#Dn=[];#Nn=[];#$;#st;#Ln;#Un;constructor(e,t,r,n,s,a){this.#ut=new i(r?r.random:0),this.#K=e,this.#W=e.getWidth(),this.#V=e.getHeight(),this.#wn=new ye,this.#On=new ye,this.#bn=new Ne(this.#K,16,this.#ut,n,r),this.#_n=a.initialize(this.#K,16,s),this.#ln=new Se(t,new Z(e,this.#ut,this.#bn,null));const o=(e,t)=>{this.#bn.trigger(e,t),this.#_n.trigger(e,t)};this.#st=new Fe(e.getWidth(),e.getHeight(),this.#ln,o),this.#$=new Pe(this.#K,this.#st,this.#ut,n,o),this.#Ln=new ke(e.getWidth(),e.getHeight()),this.#Un=new We,this.#Bn(n),this.#Pn()}#Pn(){let e=[];const t=()=>{e=this.#Un.getObjectives().filter((e=>e.isActive()&&"function"==typeof e.getConfig().checkHandler))};this.#Un.addOnObjectiveAdded((e=>{t(),e.addOnActiveChanged((()=>t())),e.addOnCompleted((()=>t()))})),this.#Nn.push((()=>{for(let t of e)t.getConfig().checkHandler(this.#bn.getIteration()-1)}))}#Bn(e){const t=new Z(this.#K,this.#ut,this.#bn,this.#ln),r=e.getExtensionsFactory()(t);for(const e of r)this.#bn.addExtension(e)}getBrushCollection(){return this.#bn.getDefaults().getBrushCollection()}startProcessing(){if(null===this.#Mn){const e=Math.trunc(1e3/Ne.OPT_CYCLES_PER_SECOND);this.#Mn=setInterval((()=>this.doProcessing()),e)}}startRendering(){if(null===this.#xn){const e=Math.trunc(1e3/Ne.OPT_FRAMES_PER_SECOND);this.#xn=setInterval((()=>this.doRendering()),e)}}stopProcessing(){null!==this.#Mn&&(clearInterval(this.#Mn),this.#Mn=null),this.#On.clear()}stopRendering(){null!==this.#xn&&(clearInterval(this.#xn),this.#xn=null),this.#wn.clear()}doProcessing(){this.#ln.performBeforeProcessing(),this.#bn.next(),this.#ln.performAfterProcessing();const e=Date.now();this.#On.tick(e);for(let e of this.#Nn)e(this.#bn.getIteration())}doRendering(){const e=this.#bn.getChangedChunks();try{this.#_n.render(e)}catch(e){this.stopRendering();for(let t of this.#Dn)t(e);return}const t=Date.now();this.#wn.tick(t);for(let t of this.#Hn)t(e);this.#bn.cleanChangedChunks()}graphics(){return this.#$}entities(){return this.#st}overlay(){return this.#Ln}scenario(){return this.#Un}blockTemplate(){return new Ke(this.graphics())}layeredTemplate(){return new Je(this.#K,this.graphics(),this.#ut,this.#bn)}setBoxedMode(){this.#bn.setFallThroughEnabled(!1),this.#bn.setErasingEnabled(!1)}setFallThroughMode(){this.#bn.setFallThroughEnabled(!0),this.#bn.setErasingEnabled(!1)}setErasingMode(){this.#bn.setFallThroughEnabled(!1),this.#bn.setErasingEnabled(!0)}addOnProcessed(e){this.#Nn.push(e)}addOnRendered(e){this.#Hn.push(e)}addOnRenderingFailed(e){this.#Dn.push(e)}getFramesPerSecond(){return this.#wn.getValue()}getIterationsPerSecond(){return this.#On.getValue()}getWidth(){return this.#W}getHeight(){return this.#V}getChunkSize(){return 16}createSnapshot(){let e=new ze;e.formatVersion=ze.CURRENT_FORMAT_VERSION,e.created=(new Date).getTime(),e.width=this.#W,e.height=this.#V,e.random=this.#ut.getState(),e.iteration=this.#bn.getIteration(),e.fallThroughEnabled=this.#bn.isFallThroughEnabled(),e.erasingEnabled=this.#bn.isErasingEnabled();let t=new Ge;return t.metadata=e,t.dataHeads=this.#K.getDataHeads(),t.dataTails=this.#K.getDataTails(),t.serializedEntities=this.#ln.serializeEntities(),t}debugElementAt(e,t){if(!this.#K.isValidPosition(e,t))return"Out of bounds";const r=this.#K.getElementHead(e,t),i=this.#K.getElementTail(e,t);function s(e){return"0x"+e.toString(16).padStart(8,"0")}let a=s(r)+" "+s(i);const o={type:{class:n.getTypeClass(r)},behaviour:{type:n.getBehaviour(r),special:n.getSpecial(r)},heatModIndex:n.getHeatModIndex(r),temperature:n.getTemperature(r),color:[h.getColorRed(i),h.getColorGreen(i),h.getColorBlue(i)],blurType:h.getBlurType(i),burntLevel:h.getBurntLevel(i),heatEffect:h.getHeatEffect(i)};o.type.class===n.TYPE_STATIC&&(o.type.neighbourhood=n.getTypeModifierSolidNeighbourhoodType(r),o.type.body=n.getTypeModifierSolidBodyId(r));let l=JSON.stringify(o).replaceAll('"',"").replaceAll(",",", ").replaceAll(":","=");return l=l.substring(1,l.length-1),a+"\n"+l}}class Ze{countSize(e,t){throw"Not implemented"}createSandGame(e,t,r,n,i){throw"Not implemented"}createElementArea(e,t,r){throw"Not implemented"}createEntities(){return null}executeOnOpened(e){}}class Qe extends Ze{#Fn;constructor(e){super(),this.#Fn=e}countSize(e,t){return[e,t]}async createSandGame(e,t,r,n,i){const s=this.#Fn.metadata.width,a=this.#Fn.metadata.height,o=this.#Fn.metadata,l=P.from(s,a,this.#Fn.dataHeads,this.#Fn.dataTails),h=this.#Fn.serializedEntities,c=this.createElementArea(e,t,r.getDefaultElement()),d=new qe(c,[],o,r,n,i);let u;u=t===a?0:t>a?t-a:-(a-t),d.graphics().insertElementArea(l,0,u);for(let e of h){const t=Object.assign({},e);0!==u&&"number"==typeof t.y&&(t.y+=u),d.entities().insertEntity(t)}return d}createElementArea(e,t,r){return P.create(e,t,r)}}class $e{#kn;#Yn;#Vn;#Wn=[];#Gn;#zn=[];constructor(e,t,r){this.#kn=e,this.#Yn=t,this.#Vn=r}setPrimaryTool(e){this.#kn=e;for(let t of this.#Wn)t(e)}setSecondaryTool(e){this.#Yn=e}setTertiaryTool(e){this.#Vn=e}getPrimaryTool(){return this.#kn}getSecondaryTool(){return this.#Yn}getTertiaryTool(){return this.#Vn}addOnPrimaryToolChanged(e){this.#Wn.push(e)}isInputDisabled(){return this.#Gn}addOnInputDisabledChanged(e){this.#zn.push(e)}setInputDisabled(e){if(this.#Gn!==e){this.#Gn=e;for(let t of this.#zn)t(e)}}createRevertAction(){const e=this.getPrimaryTool(),t=this.getSecondaryTool(),r=this.getTertiaryTool();return()=>{this.setPrimaryTool(e),this.setSecondaryTool(t),this.setTertiaryTool(r)}}}class et extends Ze{#Fn;constructor(e){super(),this.#Fn=e}countSize(e,t){return[this.#Fn.metadata.width,this.#Fn.metadata.height]}async createSandGame(e,t,r,n,i){const s=this.createElementArea(e,t,r.getDefaultElement()),a=this.createEntities(),o=this.#Fn.metadata;return new qe(s,a,o,r,n,i)}createElementArea(e,t,r){return P.from(this.#Fn.metadata.width,this.#Fn.metadata.height,this.#Fn.dataHeads,this.#Fn.dataTails)}createEntities(){return this.#Fn.serializedEntities}}var tt=Uint8Array,rt=Uint16Array,nt=Uint32Array,it=new tt([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),st=new tt([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),at=new tt([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),ot=function(e,t){for(var r=new rt(31),n=0;n<31;++n)r[n]=t+=1<<e[n-1];var i=new nt(r[30]);for(n=1;n<30;++n)for(var s=r[n];s<r[n+1];++s)i[s]=s-r[n]<<5|n;return[r,i]},lt=ot(it,2),ht=lt[0],ct=lt[1];ht[28]=258,ct[258]=28;for(var dt=ot(st,0),ut=dt[0],mt=dt[1],Et=new rt(32768),gt=0;gt<32768;++gt){var pt=(43690&gt)>>>1|(21845&gt)<<1;pt=(61680&(pt=(52428&pt)>>>2|(13107&pt)<<2))>>>4|(3855&pt)<<4,Et[gt]=((65280&pt)>>>8|(255&pt)<<8)>>>1}var At=function(e,t,r){for(var n=e.length,i=0,s=new rt(t);i<n;++i)e[i]&&++s[e[i]-1];var a,o=new rt(t);for(i=0;i<t;++i)o[i]=o[i-1]+s[i-1]<<1;if(r){a=new rt(1<<t);var l=15-t;for(i=0;i<n;++i)if(e[i])for(var h=i<<4|e[i],c=t-e[i],d=o[e[i]-1]++<<c,u=d|(1<<c)-1;d<=u;++d)a[Et[d]>>>l]=h}else for(a=new rt(n),i=0;i<n;++i)e[i]&&(a[i]=Et[o[e[i]-1]++]>>>15-e[i]);return a},ft=new tt(288);for(gt=0;gt<144;++gt)ft[gt]=8;for(gt=144;gt<256;++gt)ft[gt]=9;for(gt=256;gt<280;++gt)ft[gt]=7;for(gt=280;gt<288;++gt)ft[gt]=8;var Tt=new tt(32);for(gt=0;gt<32;++gt)Tt[gt]=5;var Ct=At(ft,9,0),yt=At(ft,9,1),Rt=At(Tt,5,0),St=At(Tt,5,1),vt=function(e){for(var t=e[0],r=1;r<e.length;++r)e[r]>t&&(t=e[r]);return t},It=function(e,t,r){var n=t/8|0;return(e[n]|e[n+1]<<8)>>(7&t)&r},wt=function(e,t){var r=t/8|0;return(e[r]|e[r+1]<<8|e[r+2]<<16)>>(7&t)},Ot=function(e){return(e+7)/8|0},bt=function(e,t,r){(null==t||t<0)&&(t=0),(null==r||r>e.length)&&(r=e.length);var n=new(2==e.BYTES_PER_ELEMENT?rt:4==e.BYTES_PER_ELEMENT?nt:tt)(r-t);return n.set(e.subarray(t,r)),n},_t=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Mt=function(e,t,r){var n=new Error(t||_t[e]);if(n.code=e,Error.captureStackTrace&&Error.captureStackTrace(n,Mt),!r)throw n;return n},xt=function(e,t,r){var n=e.length;if(!n||r&&r.f&&!r.l)return t||new tt(0);var i=!t||r,s=!r||r.i;r||(r={}),t||(t=new tt(3*n));var a=function(e){var r=t.length;if(e>r){var n=new tt(Math.max(2*r,e));n.set(t),t=n}},o=r.f||0,l=r.p||0,h=r.b||0,c=r.l,d=r.d,u=r.m,m=r.n,E=8*n;do{if(!c){o=It(e,l,1);var g=It(e,l+1,3);if(l+=3,!g){var p=e[(O=Ot(l)+4)-4]|e[O-3]<<8,A=O+p;if(A>n){s&&Mt(0);break}i&&a(h+p),t.set(e.subarray(O,A),h),r.b=h+=p,r.p=l=8*A,r.f=o;continue}if(1==g)c=yt,d=St,u=9,m=5;else if(2==g){var f=It(e,l,31)+257,T=It(e,l+10,15)+4,C=f+It(e,l+5,31)+1;l+=14;for(var y=new tt(C),R=new tt(19),S=0;S<T;++S)R[at[S]]=It(e,l+3*S,7);l+=3*T;var v=vt(R),I=(1<<v)-1,w=At(R,v,1);for(S=0;S<C;){var O,b=w[It(e,l,I)];if(l+=15&b,(O=b>>>4)<16)y[S++]=O;else{var _=0,M=0;for(16==O?(M=3+It(e,l,3),l+=2,_=y[S-1]):17==O?(M=3+It(e,l,7),l+=3):18==O&&(M=11+It(e,l,127),l+=7);M--;)y[S++]=_}}var x=y.subarray(0,f),H=y.subarray(f);u=vt(x),m=vt(H),c=At(x,u,1),d=At(H,m,1)}else Mt(1);if(l>E){s&&Mt(0);break}}i&&a(h+131072);for(var D=(1<<u)-1,N=(1<<m)-1,L=l;;L=l){var U=(_=c[wt(e,l)&D])>>>4;if((l+=15&_)>E){s&&Mt(0);break}if(_||Mt(2),U<256)t[h++]=U;else{if(256==U){L=l,c=null;break}var B=U-254;if(U>264){var P=it[S=U-257];B=It(e,l,(1<<P)-1)+ht[S],l+=P}var F=d[wt(e,l)&N],k=F>>>4;F||Mt(3),l+=15&F;H=ut[k];if(k>3){P=st[k];H+=wt(e,l)&(1<<P)-1,l+=P}if(l>E){s&&Mt(0);break}i&&a(h+131072);for(var Y=h+B;h<Y;h+=4)t[h]=t[h-H],t[h+1]=t[h+1-H],t[h+2]=t[h+2-H],t[h+3]=t[h+3-H];h=Y}}r.l=c,r.p=L,r.b=h,r.f=o,c&&(o=1,r.m=u,r.d=d,r.n=m)}while(!o);return h==t.length?t:bt(t,0,h)},Ht=function(e,t,r){r<<=7&t;var n=t/8|0;e[n]|=r,e[n+1]|=r>>>8},Dt=function(e,t,r){r<<=7&t;var n=t/8|0;e[n]|=r,e[n+1]|=r>>>8,e[n+2]|=r>>>16},Nt=function(e,t){for(var r=[],n=0;n<e.length;++n)e[n]&&r.push({s:n,f:e[n]});var i=r.length,s=r.slice();if(!i)return[Yt,0];if(1==i){var a=new tt(r[0].s+1);return a[r[0].s]=1,[a,1]}r.sort((function(e,t){return e.f-t.f})),r.push({s:-1,f:25001});var o=r[0],l=r[1],h=0,c=1,d=2;for(r[0]={s:-1,f:o.f+l.f,l:o,r:l};c!=i-1;)o=r[r[h].f<r[d].f?h++:d++],l=r[h!=c&&r[h].f<r[d].f?h++:d++],r[c++]={s:-1,f:o.f+l.f,l:o,r:l};var u=s[0].s;for(n=1;n<i;++n)s[n].s>u&&(u=s[n].s);var m=new rt(u+1),E=Lt(r[c-1],m,0);if(E>t){n=0;var g=0,p=E-t,A=1<<p;for(s.sort((function(e,t){return m[t.s]-m[e.s]||e.f-t.f}));n<i;++n){var f=s[n].s;if(!(m[f]>t))break;g+=A-(1<<E-m[f]),m[f]=t}for(g>>>=p;g>0;){var T=s[n].s;m[T]<t?g-=1<<t-m[T]++-1:++n}for(;n>=0&&g;--n){var C=s[n].s;m[C]==t&&(--m[C],++g)}E=t}return[new tt(m),E]},Lt=function(e,t,r){return-1==e.s?Math.max(Lt(e.l,t,r+1),Lt(e.r,t,r+1)):t[e.s]=r},Ut=function(e){for(var t=e.length;t&&!e[--t];);for(var r=new rt(++t),n=0,i=e[0],s=1,a=function(e){r[n++]=e},o=1;o<=t;++o)if(e[o]==i&&o!=t)++s;else{if(!i&&s>2){for(;s>138;s-=138)a(32754);s>2&&(a(s>10?s-11<<5|28690:s-3<<5|12305),s=0)}else if(s>3){for(a(i),--s;s>6;s-=6)a(8304);s>2&&(a(s-3<<5|8208),s=0)}for(;s--;)a(i);s=1,i=e[o]}return[r.subarray(0,n),t]},Bt=function(e,t){for(var r=0,n=0;n<t.length;++n)r+=e[n]*t[n];return r},Pt=function(e,t,r){var n=r.length,i=Ot(t+2);e[i]=255&n,e[i+1]=n>>>8,e[i+2]=255^e[i],e[i+3]=255^e[i+1];for(var s=0;s<n;++s)e[i+s+4]=r[s];return 8*(i+4+n)},Ft=function(e,t,r,n,i,s,a,o,l,h,c){Ht(t,c++,r),++i[256];for(var d=Nt(i,15),u=d[0],m=d[1],E=Nt(s,15),g=E[0],p=E[1],A=Ut(u),f=A[0],T=A[1],C=Ut(g),y=C[0],R=C[1],S=new rt(19),v=0;v<f.length;++v)S[31&f[v]]++;for(v=0;v<y.length;++v)S[31&y[v]]++;for(var I=Nt(S,7),w=I[0],O=I[1],b=19;b>4&&!w[at[b-1]];--b);var _,M,x,H,D=h+5<<3,N=Bt(i,ft)+Bt(s,Tt)+a,L=Bt(i,u)+Bt(s,g)+a+14+3*b+Bt(S,w)+(2*S[16]+3*S[17]+7*S[18]);if(D<=N&&D<=L)return Pt(t,c,e.subarray(l,l+h));if(Ht(t,c,1+(L<N)),c+=2,L<N){_=At(u,m,0),M=u,x=At(g,p,0),H=g;var U=At(w,O,0);Ht(t,c,T-257),Ht(t,c+5,R-1),Ht(t,c+10,b-4),c+=14;for(v=0;v<b;++v)Ht(t,c+3*v,w[at[v]]);c+=3*b;for(var B=[f,y],P=0;P<2;++P){var F=B[P];for(v=0;v<F.length;++v){var k=31&F[v];Ht(t,c,U[k]),c+=w[k],k>15&&(Ht(t,c,F[v]>>>5&127),c+=F[v]>>>12)}}}else _=Ct,M=ft,x=Rt,H=Tt;for(v=0;v<o;++v)if(n[v]>255){k=n[v]>>>18&31;Dt(t,c,_[k+257]),c+=M[k+257],k>7&&(Ht(t,c,n[v]>>>23&31),c+=it[k]);var Y=31&n[v];Dt(t,c,x[Y]),c+=H[Y],Y>3&&(Dt(t,c,n[v]>>>5&8191),c+=st[Y])}else Dt(t,c,_[n[v]]),c+=M[n[v]];return Dt(t,c,_[256]),c+M[256]},kt=new nt([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Yt=new tt(0),Vt=function(){for(var e=new Int32Array(256),t=0;t<256;++t){for(var r=t,n=9;--n;)r=(1&r&&-306674912)^r>>>1;e[t]=r}return e}(),Wt=function(){var e=-1;return{p:function(t){for(var r=e,n=0;n<t.length;++n)r=Vt[255&r^t[n]]^r>>>8;e=r},d:function(){return~e}}},Gt=function(e,t,r,n,i){return function(e,t,r,n,i,s){var a=e.length,o=new tt(n+a+5*(1+Math.ceil(a/7e3))+i),l=o.subarray(n,o.length-i),h=0;if(!t||a<8)for(var c=0;c<=a;c+=65535){var d=c+65535;d>=a&&(l[h>>3]=s),h=Pt(l,h+1,e.subarray(c,d))}else{for(var u=kt[t-1],m=u>>>13,E=8191&u,g=(1<<r)-1,p=new rt(32768),A=new rt(g+1),f=Math.ceil(r/3),T=2*f,C=function(t){return(e[t]^e[t+1]<<f^e[t+2]<<T)&g},y=new nt(25e3),R=new rt(288),S=new rt(32),v=0,I=0,w=(c=0,0),O=0,b=0;c<a;++c){var _=C(c),M=32767&c,x=A[_];if(p[M]=x,A[_]=M,O<=c){var H=a-c;if((v>7e3||w>24576)&&H>423){h=Ft(e,l,0,y,R,S,I,w,b,c-b,h),w=v=I=0,b=c;for(var D=0;D<286;++D)R[D]=0;for(D=0;D<30;++D)S[D]=0}var N=2,L=0,U=E,B=M-x&32767;if(H>2&&_==C(c-B))for(var P=Math.min(m,H)-1,F=Math.min(32767,c),k=Math.min(258,H);B<=F&&--U&&M!=x;){if(e[c+N]==e[c+N-B]){for(var Y=0;Y<k&&e[c+Y]==e[c+Y-B];++Y);if(Y>N){if(N=Y,L=B,Y>P)break;var V=Math.min(B,Y-2),W=0;for(D=0;D<V;++D){var G=c-B+D+32768&32767,z=G-p[G]+32768&32767;z>W&&(W=z,x=G)}}}B+=(M=x)-(x=p[M])+32768&32767}if(L){y[w++]=268435456|ct[N]<<18|mt[L];var K=31&ct[N],X=31&mt[L];I+=it[K]+st[X],++R[257+K],++S[X],O=c+N,++v}else y[w++]=e[c],++R[e[c]]}}h=Ft(e,l,s,y,R,S,I,w,b,c-b,h),!s&&7&h&&(h=Pt(l,h+1,Yt))}return bt(o,0,n+Ot(h)+i)}(e,null==t.level?6:t.level,null==t.mem?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(e.length)))):12+t.mem,r,n,!i)},zt=function(e,t){var r={};for(var n in e)r[n]=e[n];for(var n in t)r[n]=t[n];return r},Kt=function(e,t){return e[t]|e[t+1]<<8},Xt=function(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0},jt=function(e,t){return Xt(e,t)+4294967296*Xt(e,t+4)},Jt=function(e,t,r){for(;r;++t)e[t]=r,r>>>=8};function qt(e,t){return Gt(e,t||{},0,0)}function Zt(e,t){return xt(e,t)}var Qt=function(e,t,r,n){for(var i in e){var s=e[i],a=t+i,o=n;Array.isArray(s)&&(o=zt(n,s[1]),s=s[0]),s instanceof tt?r[a]=[s,o]:(r[a+="/"]=[new tt(0),o],Qt(s,a,r,n))}},$t="undefined"!=typeof TextEncoder&&new TextEncoder,er="undefined"!=typeof TextDecoder&&new TextDecoder;try{er.decode(Yt,{stream:!0}),1}catch(e){}function tr(e,t){if(t){for(var r=new tt(e.length),n=0;n<e.length;++n)r[n]=e.charCodeAt(n);return r}if($t)return $t.encode(e);var i=e.length,s=new tt(e.length+(e.length>>1)),a=0,o=function(e){s[a++]=e};for(n=0;n<i;++n){if(a+5>s.length){var l=new tt(a+8+(i-n<<1));l.set(s),s=l}var h=e.charCodeAt(n);h<128||t?o(h):h<2048?(o(192|h>>6),o(128|63&h)):h>55295&&h<57344?(o(240|(h=65536+(1047552&h)|1023&e.charCodeAt(++n))>>18),o(128|h>>12&63),o(128|h>>6&63),o(128|63&h)):(o(224|h>>12),o(128|h>>6&63),o(128|63&h))}return bt(s,0,a)}function rr(e,t){if(t){for(var r="",n=0;n<e.length;n+=16384)r+=String.fromCharCode.apply(null,e.subarray(n,n+16384));return r}if(er)return er.decode(e);var i=function(e){for(var t="",r=0;;){var n=e[r++],i=(n>127)+(n>223)+(n>239);if(r+i>e.length)return[t,bt(e,r-1)];i?3==i?(n=((15&n)<<18|(63&e[r++])<<12|(63&e[r++])<<6|63&e[r++])-65536,t+=String.fromCharCode(55296|n>>10,56320|1023&n)):t+=1&i?String.fromCharCode((31&n)<<6|63&e[r++]):String.fromCharCode((15&n)<<12|(63&e[r++])<<6|63&e[r++]):t+=String.fromCharCode(n)}}(e),s=i[0];return i[1].length&&Mt(8),s}var nr=function(e,t){return t+30+Kt(e,t+26)+Kt(e,t+28)},ir=function(e,t,r){var n=Kt(e,t+28),i=rr(e.subarray(t+46,t+46+n),!(2048&Kt(e,t+8))),s=t+46+n,a=Xt(e,t+20),o=r&&4294967295==a?sr(e,s):[a,Xt(e,t+24),Xt(e,t+42)],l=o[0],h=o[1],c=o[2];return[Kt(e,t+10),l,h,i,s+Kt(e,t+30)+Kt(e,t+32),c]},sr=function(e,t){for(;1!=Kt(e,t);t+=4+Kt(e,t+2));return[jt(e,t+12),jt(e,t+4),jt(e,t+20)]},ar=function(e){var t=0;if(e)for(var r in e){var n=e[r].length;n>65535&&Mt(9),t+=n+4}return t},or=function(e,t,r,n,i,s,a,o){var l=n.length,h=r.extra,c=o&&o.length,d=ar(h);Jt(e,t,null!=a?33639248:67324752),t+=4,null!=a&&(e[t++]=20,e[t++]=r.os),e[t]=20,t+=2,e[t++]=r.flag<<1|(s<0&&8),e[t++]=i&&8,e[t++]=255&r.compression,e[t++]=r.compression>>8;var u=new Date(null==r.mtime?Date.now():r.mtime),m=u.getFullYear()-1980;if((m<0||m>119)&&Mt(10),Jt(e,t,m<<25|u.getMonth()+1<<21|u.getDate()<<16|u.getHours()<<11|u.getMinutes()<<5|u.getSeconds()>>>1),t+=4,-1!=s&&(Jt(e,t,r.crc),Jt(e,t+4,s<0?-s-2:s),Jt(e,t+8,r.size)),Jt(e,t+12,l),Jt(e,t+14,d),t+=16,null!=a&&(Jt(e,t,c),Jt(e,t+6,r.attrs),Jt(e,t+10,a),t+=14),e.set(n,t),t+=l,d)for(var E in h){var g=h[E],p=g.length;Jt(e,t,+E),Jt(e,t+2,p),e.set(g,t+4),t+=4+p}return c&&(e.set(o,t),t+=c),t};function lr(e,t){t||(t={});var r={},n=[];Qt(e,"",r,t);var i=0,s=0;for(var a in r){var o=r[a],l=o[0],h=o[1],c=0==h.level?0:8,d=(S=tr(a)).length,u=h.comment,m=u&&tr(u),E=m&&m.length,g=ar(h.extra);d>65535&&Mt(11);var p=c?qt(l,h):l,A=p.length,f=Wt();f.p(l),n.push(zt(h,{size:l.length,crc:f.d(),c:p,f:S,m:m,u:d!=a.length||m&&u.length!=E,o:i,compression:c})),i+=30+d+g+A,s+=76+2*(d+g)+(E||0)+A}for(var T=new tt(s+22),C=i,y=s-i,R=0;R<n.length;++R){var S=n[R];or(T,S.o,S,S.f,S.u,S.c.length);var v=30+S.f.length+ar(S.extra);T.set(S.c,S.o+v),or(T,i,S,S.f,S.u,S.c.length,S.o,S.m),i+=16+v+(S.m?S.m.length:0)}return function(e,t,r,n,i){Jt(e,t,101010256),Jt(e,t+8,r),Jt(e,t+10,r),Jt(e,t+12,n),Jt(e,t+16,i)}(T,i,n.length,y,C),T}class hr{static METADATA_JSON_NAME="snapshot.json";static LEGACY_METADATA_JSON_NAME="metadata.json";static createZip(e){const t=tr(JSON.stringify(e.metadata,null,2)),r=tr(JSON.stringify(e.serializedEntities,null,2));return lr({"snapshot.json":t,"data-heads.bin":new Uint8Array(e.dataHeads),"data-tails.bin":new Uint8Array(e.dataTails),"data-entities.json":r},{level:9})}static parse(e){function t(t){return JSON.parse(rr(e[t]))}let r;if(e[hr.METADATA_JSON_NAME])r=t(hr.METADATA_JSON_NAME);else{if(!e[hr.LEGACY_METADATA_JSON_NAME])throw"Metadata not found";r=t(hr.LEGACY_METADATA_JSON_NAME)}let n=new Ge;if(n.metadata=Object.assign(new ze,r),"number"!=typeof n.metadata.width)throw"Metadata property wrong format: width";if("number"!=typeof n.metadata.height)throw"Metadata property wrong format: height";if(n.metadata.formatVersion<3){const t=e["data.bin"];if(!t)throw"data.bin not found";{if(t.byteLength%8!=0)throw"Buffer length is not divisible by 8";const e=t.byteLength/8,r=new Uint8Array(new ArrayBuffer(4*e)),i=new Uint8Array(new ArrayBuffer(4*e));for(let n=0;n<e;n++)for(let e=0;e<4;e++)r[4*n+e]=t[8*n+e],i[4*n+e]=t[8*n+e+4];n.dataHeads=r.buffer,n.dataTails=i.buffer}}else{const t=e["data-heads.bin"];if(!t)throw"data-heads.bin not found";n.dataHeads=t.buffer;const r=e["data-tails.bin"];if(!r)throw"data-tails.bin not found";n.dataTails=r.buffer}if(n.metadata.formatVersion>6){if(n.serializedEntities=t("data-entities.json"),!Array.isArray(n.serializedEntities))throw"Entities corrupted"}else n.serializedEntities=[];return 1===n.metadata.formatVersion&&(hr.#Kn(n),n.metadata.formatVersion=2),2===n.metadata.formatVersion&&(n.metadata.formatVersion=3),3===n.metadata.formatVersion&&(hr.#Xn(n),n.metadata.formatVersion=4),4===n.metadata.formatVersion&&(hr.#jn(n),n.metadata.formatVersion=5),5===n.metadata.formatVersion&&(hr.#Jn(n),n.metadata.formatVersion=6),6===n.metadata.formatVersion&&(hr.#qn(n),n.metadata.formatVersion=7),n}static#Kn(e){const t=P.from(e.metadata.width,e.metadata.height,e.dataHeads,e.dataTails);for(let r=0;r<e.metadata.height;r++)for(let i=0;i<e.metadata.width;i++){let e=t.getElementHead(i,r),s=7&e;0===s&&0===(e>>4&15)||(0===s?t.setElementHead(i,r,n.setType(e,7)):1===s?t.setElementHead(i,r,n.setType(e,5)):2===s?t.setElementHead(i,r,n.setType(e,133)):3===s?t.setElementHead(i,r,n.setType(e,197)):4!==s&&5!==s||t.setElementHead(i,r,n.setType(e,3)))}e.dataHeads=t.getDataHeads(),e.dataTails=t.getDataTails()}static#Xn(e){const t=P.from(e.metadata.width,e.metadata.height,e.dataHeads,e.dataTails);for(let r=0;r<e.metadata.height;r++)for(let n=0;n<e.metadata.width;n++){let e=t.getElementHead(n,r),i=t.getElementTail(n,r),s=7&e;switch(s>1&&s<7&&(s++,e=4294967288&e|s),s){case 5:case 6:case 7:e|=4194304,i|=268435456}4===s&&(e=4294963455&e|3072),t.setElementHead(n,r,e),t.setElementTail(n,r,i)}e.dataHeads=t.getDataHeads(),e.dataTails=t.getDataTails()}static#jn(e){const t=P.from(e.metadata.width,e.metadata.height,e.dataHeads,e.dataTails);for(let r=0;r<e.metadata.height;r++)for(let n=0;n<e.metadata.width;n++){let e=t.getElementHead(n,r),i=e>>8&15;5!==i&&8!==i||(e&=4294902015),t.setElementHead(n,r,e)}e.dataHeads=t.getDataHeads(),e.dataTails=t.getDataTails()}static#Jn(e){const t=P.from(e.metadata.width,e.metadata.height,e.dataHeads,e.dataTails);for(let r=0;r<e.metadata.height;r++)for(let n=0;n<e.metadata.width;n++){const e=t.getElementHead(n,r),i=e>>16&3,s=e>>18&3,a=e>>20&3,o=e>>22&3;let l=0;0===i&&0===s&&0===a&&0===o?l=0:0===i&&0===s&&0===a&&1===o?l=1:0===i&&0===s&&0===a&&2===o?l=2:0===i&&0===s&&0===a&&3===o?l=3:2===i&&1===s&&3===a&&0===o?l=4:1===i&&1===s&&1===a&&0===o?l=5:2===i&&1===s&&2===a&&0===o&&(l=6);const h=4278255615&e|l<<16;t.setElementHead(n,r,h)}e.dataHeads=t.getDataHeads(),e.dataTails=t.getDataTails()}static#qn(e){const t=P.from(e.metadata.width,e.metadata.height,e.dataHeads,e.dataTails);for(let r=0;r<e.metadata.height;r++)for(let n=0;n<e.metadata.width;n++){let i=t.getElementHead(n,r),s=i>>8&15;3===s&&e.serializedEntities.push({entity:"fish",x:n,y:r}),3!==s&&4!==s||(i=4294902015&i|3328),t.setElementHead(n,r,i)}e.dataHeads=t.getDataHeads(),e.dataTails=t.getDataTails()}}class cr extends Ze{#Zn;#Qn;#$n;constructor(e,t,r){super(),this.#Zn=e,this.#Qn=t,this.#$n=r}countSize(e,t){this.#Zn.countSize(e,t)}async createSandGame(e,t,r,n,i){let s=this.createElementArea(e,t,r.getDefaultElement());return new qe(s,[],null,r,n,i)}createElementArea(e,t,r){const n=this.#Zn.createElementArea(e,t,r),i=n.getWidth(),s=n.getHeight();if(this.#Qn)for(let e=0;e<s;e++)for(let t=0;t<Math.trunc(i/2);t++)n.swap(t,e,i-1-t,e);if(this.#$n)for(let e=0;e<Math.trunc(s/2);e++)for(let t=0;t<i;t++)n.swap(t,e,t,s-1-e);return n}}class dr extends Ze{#K;constructor(e){super(),this.#K=e}countSize(e,t){return[this.#K.getWidth(),this.#K.getHeight()]}async createSandGame(e,t,r,n,i){let s=this.createElementArea(e,t,r.getDefaultElement());return new qe(s,[],null,r,n,i)}createElementArea(e,t,r){return P.from(this.#K.getWidth(),this.#K.getHeight(),this.#K.getDataHeads(),this.#K.getDataTails())}}class ur{static loadImageData(e,t,r){return u.asImageData(e,t,r)}static asObjectUrl(e,t="image/png"){const r=new Uint8Array(e),n=new Blob([r],{type:t});return(window.URL||window.webkitURL).createObjectURL(n)}static createSceneFromImageTemplate(e,t,r,n){const s=e.width,a=e.height,o=P.create(s,a,r),l=new i(0);for(let r=0;r<a;r++)for(let i=0;i<s;i++){const a=4*(r*s+i);let c=e.data[a],d=e.data[a+1],u=e.data[a+2];const m=e.data[a+3];if(255!==m&&(c=Math.trunc(c*m/255)+255-m,d=Math.trunc(d*m/255)+255-m,u=Math.trunc(u*m/255)+255-m),c>255-n&&d>255-n&&u>255-n)continue;const E=t.apply(i,r,l),g=E.elementHead,p=h.setColor(E.elementTail,c,d,u);o.setElementHeadAndTail(i,r,g,p)}return new dr(o)}static getImageTypeOrNull(e){return(e=e.toLowerCase()).endsWith(".png")?"image/png":e.endsWith(".jpg")||e.endsWith(".jpeg")?"image/jpg":e.endsWith(".bmp")?"image/bmp":e.endsWith(".gif")?"image/gif":null}}class mr{static METADATA_JSON_NAME="tool.json";static async parse(e,t){const r=e.info,n=e.action;if(void 0===n)throw"Tool definition: action not set";const i=n.type;if("image-template"===i){const e=await this.#ei(n,t);return $.insertScenesTool(e,void 0,r)}if("random-template"===i){const e=await this.#ti(n,t);return $.insertScenesTool(e,void 0,r)}throw"Tool action not supported: "+i}static async#ti(e,t){const r=e.actions;if(void 0===r||void 0===r.length||0===r.length)throw"Image template: actions not set";let n=[];for(let e=0;e<r.length;e++){const i=r[e],s=i.type;if("image-template"!==s)throw"Tool action not supported: "+s;{const e=await this.#ei(i,t);n.push(...e)}}return n}static async#ei(e,t){let r=await this.#ri(e,t);const n=e.threshold;if(void 0===n)throw"Image template: threshold not set";const i=parseInt(n),a=e.brush;if(void 0===a)throw"Image template: brush not set";let o=null;if("string"==typeof a?o=ie.byCodeName(a):"object"==typeof a&&a instanceof s&&(o=a),null===o)throw"Image template: brush not found: "+a;const l=P.TRANSPARENT_ELEMENT,h=ur.createSceneFromImageTemplate(r,o,l,i),c=[h];e.randomFlipHorizontally&&c.push(new cr(h,!0,!1));if(e.randomFlipVertically)for(const e of[...c])c.push(new cr(e,!1,!0));return c}static async#ri(e,t){const r=e.imageData;if(void 0!==r)return await ur.loadImageData(r,void 0,void 0);const n=e.imageFile;if(void 0!==n&&null!==t&&t[n]){if(null!==ur.getImageTypeOrNull(n)){const e=ur.asObjectUrl(t[n].buffer);return ur.loadImageData(e,void 0,void 0)}}throw"Image template: imageData/imageFile not set"}}class Er{static JSON_RESOURCE_TYPE_FIELD="resourceType";static createResourceFromSnapshot(e){return hr.createZip(e)}static async parseZipResource(e){const t=function(e,t){for(var r={},n=e.length-22;101010256!=Xt(e,n);--n)(!n||e.length-n>65558)&&Mt(13);var i=Kt(e,n+8);if(!i)return{};var s=Xt(e,n+16),a=4294967295==s||65535==i;if(a){var o=Xt(e,n-12);(a=101075792==Xt(e,o))&&(i=Xt(e,o+32),s=Xt(e,o+48))}for(var l=t&&t.filter,h=0;h<i;++h){var c=ir(e,s,a),d=c[0],u=c[1],m=c[2],E=c[3],g=c[4],p=c[5],A=nr(e,p);s=g,l&&!l({name:E,size:u,originalSize:m,compression:d})||(d?8==d?r[E]=Zt(e.subarray(A,A+u),new tt(m)):Mt(14,"unknown compression type "+d):r[E]=bt(e,A,A+u))}return r}(new Uint8Array(e));if(t[hr.METADATA_JSON_NAME]||t[hr.LEGACY_METADATA_JSON_NAME]){const e=hr.parse(t);return new et(e)}if(t[mr.METADATA_JSON_NAME]){const e=(r=mr.METADATA_JSON_NAME,JSON.parse(rr(t[r])));return await mr.parse(e,t)}var r;throw"Wrong format"}static async parseJsonResource(e){const t=rr(new Uint8Array(e)),r=JSON.parse(t);if("tool"===r[Er.JSON_RESOURCE_TYPE_FIELD])return await mr.parse(r,null);throw"Wrong json format"}static async parseToolDefinition(e){return mr.parse(e,null)}}class gr{createNode(e){throw"Not implemented"}}class pr extends gr{#ni=50;#ii=300;#Sn=200;#si="sand";#ai=ie.SAND;createNode(){return pe.element("form",null,[pe.element("fieldset",{class:"mb-3 row"},[pe.element("legend",{class:"col-form-label col-sm-3 float-sm-left pt-0"},"Material"),pe.div({class:"col-sm-9",style:"column-count: 2;"},[this.#oi(ie.SAND,Ee.SAND.getInfo()),this.#oi(ie.SOIL,Ee.SOIL.getInfo()),this.#oi(ie.THERMITE,Ee.THERMITE.getInfo()),this.#oi(ie.WALL,Ee.WALL.getInfo()),this.#oi(ie.METAL,Ee.METAL.getInfo()),this.#oi(ie.WOOD,Ee.WOOD.getInfo())])]),pe.element("fieldset",{class:"mb-3 row"},[pe.element("legend",{class:"col-form-label col-sm-3 float-sm-left pt-0"},"Background threshold"),pe.div({class:"col-sm-9"},[this.#li()])]),pe.element("fieldset",{class:"mb-3 row"},[pe.element("legend",{class:"col-form-label col-sm-3 float-sm-left pt-0"},"Max size"),pe.div({class:"col-sm-9"},[this.#hi(),this.#ci()])])])}#li(){const e="image-template_threshold-slider",t=pe.element("label",{for:e},"Value: "+this.#ni),r=pe.element("input",{id:e,class:"form-range",type:"range",min:0,max:255,value:this.#ni});return r.addEventListener("input",(e=>{this.#ni=e.target.value,t.textContent="Value: "+this.#ni})),pe.div({class:"mb-3"},[r,pe.element("small",null,t)])}#hi(){const e="image-template_max-width",t=pe.element("label",{for:e},"Width: "+this.#ii),r=pe.element("input",{id:e,class:"form-range",type:"range",min:25,max:800,value:this.#ii});return r.addEventListener("input",(e=>{this.#ii=e.target.value,t.textContent="Width: "+this.#ii})),pe.div({class:"mb-3"},[r,pe.element("small",null,t)])}#ci(){const e="image-template_max-height",t=pe.element("label",{for:e},"Height: "+this.#Sn),r=pe.element("input",{id:e,class:"form-range",type:"range",min:25,max:800,value:this.#Sn});return r.addEventListener("input",(e=>{this.#Sn=e.target.value,t.textContent="Height: "+this.#Sn})),pe.div({class:"mb-3"},[r,pe.element("small",null,t)])}#oi(e,t){const r=t.getCodeName(),n=this.#si===r,i="image-template_checkbox-material-"+r,s=pe.element("input",{class:"form-check-input",type:"radio",name:"template-material",id:i,value:r,checked:n||null});s.addEventListener("click",(()=>{this.#ai=e,this.#si=r}));const a={class:"form-check-label btn btn-secondary btn-sm",for:i,style:t.getBadgeStyle()};return pe.div({class:"form-check"},[s,pe.element("label",a,t.getDisplayName())])}getThresholdValue(){return this.#ni}getMaterialBrush(){return this.#ai}getMaxWidth(){return this.#ii}getMaxHeight(){return this.#Sn}}class Ar{#di;#ui;constructor(e){this.#di=e,this.#ui=new pr}initFileDragAndDrop(e){["dragenter","dragover"].forEach((t=>{e.addEventListener(t,(t=>{t.preventDefault(),t.stopPropagation(),e.classList.add("drag-and-drop-highlight")}))})),e.addEventListener("dragleave",(t=>{t.preventDefault(),t.stopPropagation(),e.classList.remove("drag-and-drop-highlight")})),e.addEventListener("drop",(t=>{t.preventDefault(),t.stopPropagation(),e.classList.remove("drag-and-drop-highlight"),this.loadFromFiles(t.dataTransfer.files)}))}loadFromFiles(e){if(!e)return;let t=e[0],r=new FileReader;r.onload=e=>{let r=e.target.result;this.loadFromArrayBuffer(r,t.name)},r.readAsArrayBuffer(t)}loadFromArrayBuffer(e,t){try{let r=ur.getImageTypeOrNull(t);null!==r?this.#mi(e,r):t.endsWith(".json")?Er.parseJsonResource(e).then((e=>this.#Ei(e))).catch((e=>this.#gi(e))):Er.parseZipResource(e).then((e=>this.#Ei(e))).catch((e=>this.#gi(e)))}catch(e){this.#gi(e)}}#mi(e,t){const r=(r,n,i,s)=>{const a=ur.asObjectUrl(e,t),o=P.TRANSPARENT_ELEMENT;ur.loadImageData(a,i,s).then((e=>{try{const t=ur.createSceneFromImageTemplate(e,r,o,n);this.#pi(t)}catch(e){this.#gi(e)}})).catch((e=>this.#gi(e)))};let n=pe.bootstrapDialogBuilder();n.setHeaderContent("Image template"),n.setBodyContent(this.#ui.createNode()),n.addSubmitButton("Place",(()=>{let e=this.#ui.getMaterialBrush(),t=this.#ui.getThresholdValue(),n=this.#ui.getMaxWidth(),i=this.#ui.getMaxHeight();r(e,t,n,i)})),n.addCloseButton("Close"),n.show(this.#di.getDialogAnchor())}#pi(e){this.#di.pasteScene(e),ge.triggerFeatureUsed(ge.FEATURE_IO_IMAGE_TEMPLATE)}#Ei(e){if(e instanceof Ze)this.#Ai(e);else if(e instanceof D){const t=e,r=this.#di.getToolManager();if(t instanceof k||t instanceof Y){const e=r.createRevertAction();r.setPrimaryTool(t),r.setSecondaryTool($.actionTool(e))}else r.setPrimaryTool(t)}else this.#gi("Unknown resource type")}#Ai(e){try{let t=pe.bootstrapDialogBuilder();t.setHeaderContent("Import scene"),t.setBodyContent([pe.par(null,"The imported scene can be opened or placed on the current scene.")]),t.addSubmitButton("Open",(()=>(ge.triggerFeatureUsed(ge.FEATURE_IO_IMPORT),this.#di.openScene(e)))),t.addSubmitButton("Place",(()=>(ge.triggerFeatureUsed(ge.FEATURE_IO_IMPORT),this.#di.pasteScene(e)))),t.addCloseButton("Close"),t.show(this.#di.getDialogAnchor())}catch(e){this.#gi(e)}}#gi(e){let t=pe.bootstrapDialogBuilder();t.setHeaderContent("Error"),t.setBodyContent([pe.par(null,"Error while loading resource:"),pe.element("code",null,""+e)]),t.addCloseButton("Close"),t.show(this.#di.getDialogAnchor())}}class fr extends Le{static renderPreview(e,t,r=255){const n=e.getWidth(),i=e.getHeight(),s=t.createImageData(n,i),a=s.data;for(let t=0;t<n;t++)for(let s=0;s<i;s++){const i=4*(n*s+t),o=e.getElementTail(t,s);o===P.TRANSPARENT_ELEMENT.elementTail&&e.getElementHead(t,s)===P.TRANSPARENT_ELEMENT.elementHead?a[i+3]=0:(a[i]=h.getColorRed(o),a[i+1]=h.getColorGreen(o),a[i+2]=h.getColorBlue(o),a[i+3]=r)}t.putImageData(s,0,0,0,0,n,i)}#fi;#Ti=null;#K;#W;#V;#ur;#mr;#Er;#Ci;#yi;#Ri;#Si;constructor(e,t,r){super(),this.#fi=r,this.#K=e,this.#W=e.getWidth(),this.#V=e.getHeight(),this.#ur=t,this.#mr=Math.ceil(this.#W/this.#ur),this.#Er=Math.ceil(this.#V/this.#ur),this.#Ci=new Array(this.#mr*this.#Er).fill(!0),this.#yi=this.#fi.createImageData(this.#W,this.#V);const n=this.#yi.data;for(let e=0;e<this.#V;e++)for(let t=0;t<this.#W;t++){n[4*(this.#W*e+t)+3]=255}this.#Ri=new Array(this.#W*this.#V).fill(!1),this.#Si=new Array(this.#W*this.#V).fill(!1)}trigger(e,t){const r=Math.trunc(e/this.#ur),n=Math.trunc(t/this.#ur)*this.#mr+r;this.#Ci[n]=!0}triggerChunk(e,t){const r=t*this.#mr+e;this.#Ci[r]=!0}triggerChunks(e){if(e.length!==this.#Ci.length)throw"Array must be of the same size";for(let t=0;t<e.length;t++){const r=e[t];r&&(this.#Ci[t]=r)}}setMode(e){this.#Ti=e,this.#Ci.fill(!0),this.#Ri.fill(!1),this.#Si.fill(!1)}render(e){for(let t=0;t<this.#Er;t++)for(let r=0;r<this.#mr;r++){const n=t*this.#mr+r,i=this.#Ci[n];i&&(this.#Ci[n]=!1);const s=e[n];if(s&&(this.#Ci[n]=!0),i||s){let n=!1;if(t+1<this.#mr){const i=(t+1)*this.#mr+r;this.#Ci[i]||e[i]||(n=!0)}this.#vi(r,t,n)}}this.#fi.putImageData(this.#yi,0,0,0,0,this.#W,this.#V)}#vi(e,t,r){const n=Math.min((e+1)*this.#ur,this.#W),i=Math.min((t+1)*this.#ur+(r?1:0),this.#V);for(let r=t*this.#ur;r<i;r++)for(let t=e*this.#ur;t<n;t++)this.#Ii(t,r,this.#yi.data)}#Ii(e,t,r){const n=this.#K.getElementTail(e,t),i=this.#W*t+e,s=4*i,a=h.getBlurType(n);if(a===h.BLUR_TYPE_BACKGROUND&&(this.#Si[i]&&fr.#wi(n)&&(this.#Ri[i]=!0,this.#Si[i]=!1),this.#Ri[i])){const n=r[s],a=r[s+1],o=r[s+2],l=.1*Math.random()-.05+.875,h=255*(1-l),c=Math.trunc(n*l+h),d=Math.trunc(a*l+h),u=Math.trunc(o*l+h);n===c&&a===d&&o===u?(this.#Ri[i]=!1,r[s]=255,r[s+1]=255,r[s+2]=255):(r[s]=c,r[s+1]=d,r[s+2]=u,this.trigger(e,t))}else if(null===this.#Ti)r[s]=h.getColorRed(n),r[s+1]=h.getColorGreen(n),r[s+2]=h.getColorBlue(n),this.#Si[i]=a===h.BLUR_TYPE_1,this.#Ri[i]=!1;else{let i=this.#K.getElementHead(e,t);this.#Ti.apply(r,s,i,n)}}static#wi(e){return 255===h.getColorRed(e)&&255===h.getColorGreen(e)&&255===h.getColorBlue(e)}}class Tr extends Ue{#Ti;constructor(e){super(),this.#Ti=e}getContextType(){return"2d"}initialize(e,t,r){let n=new fr(e,t,r);return null!==this.#Ti&&n.setMode(this.#Ti),n}}class Cr extends Le{#fi;#K;#W;#V;#Oi;#bi;constructor(e,t,r){super(),this.#fi=r,this.#K=e,this.#W=e.getWidth(),this.#V=e.getHeight(),this.#bi=(new Date).getTime();const n=this.#fi,i=this.#M("255,51,0\r\n255,69,0\r\n255,82,0\r\n255,93,0\r\n255,102,0\r\n255,111,0\r\n255,118,0\r\n255,124,0\r\n255,130,0\r\n255,135,0\r\n255,141,11\r\n255,146,29\r\n255,152,41\r\n255,157,51\r\n255,162,60\r\n255,166,69\r\n255,170,77\r\n255,174,84\r\n255,178,91\r\n255,182,98\r\n255,185,105\r\n255,189,111\r\n255,192,118\r\n255,195,124\r\n255,198,130\r\n255,201,135\r\n255,203,141\r\n255,206,146\r\n255,208,151\r\n255,211,156\r\n255,213,161\r\n255,215,166\r\n255,217,171\r\n255,219,175\r\n255,221,180\r\n255,223,184\r\n255,225,188\r\n255,226,192\r\n255,228,196\r\n255,229,200\r\n255,231,204\r\n255,232,208\r\n255,234,211\r\n255,235,215\r\n255,237,218\r\n255,238,222\r\n255,239,225\r\n255,240,228\r\n255,241,231\r\n255,243,234\r\n255,244,237\r\n255,245,240\r\n255,246,243\r\n255,247,245\r\n255,248,248\r\n255,249,251\r\n255,249,253\r\n254,250,255\r\n252,248,255\r\n250,247,255\r\n247,245,255\r\n245,244,255\r\n243,243,255\r\n241,241,255\r\n239,240,255\r\n238,239,255\r\n236,238,255\r\n234,237,255\r\n233,236,255\r\n231,234,255\r\n229,233,255\r\n228,233,255\r\n227,232,255\r\n225,231,255\r\n224,230,255\r\n223,229,255\r\n221,228,255\r\n220,227,255\r\n219,226,255\r\n218,226,255\r\n217,225,255\r\n216,224,255\r\n215,223,255\r\n214,223,255\r\n213,222,255\r\n212,221,255\r\n211,221,255\r\n210,220,255\r\n209,220,255\r\n208,219,255\r\n207,218,255"),s=i.byteLength/4,a=this.#_i(n,"#version 300 es\n#define GLSLIFY 1\nin vec4 a_position;out vec2 v_texcoord;void main(){gl_Position=a_position;v_texcoord=a_position.xy*vec2(0.5,0.5)+0.5;}","#version 300 es\nprecision mediump float;\n#define GLSLIFY 1\nin vec2 v_texcoord;out vec4 v_color;uniform float u_time;uniform sampler2D u_element_heads;uniform sampler2D u_element_tails;uniform sampler2D u_blur;uniform sampler2D u_temperature_palette;\n#define TEMP_PALETTE_SIZE 91.0\nfloat countTemperaturePaletteIndex(float c){float k=c+273.0;if(k<1000.0){return 0.0;}else{return floor(k/100.0-10.0);}}void applyTemperature(float temperature,int heatType,inout float r,inout float g,inout float b){float tFactor;float aFactor=0.001;if(heatType==0x01){tFactor=0.5;}else if(heatType==0x02){tFactor=1.0;}else{tFactor=1.45;}float sTemp=(temperature*255.0*10.0)*tFactor;float i=countTemperaturePaletteIndex(sTemp);vec4 color=texture(u_temperature_palette,vec2((i+0.5)/TEMP_PALETTE_SIZE,0.5));float cr=color[0];float cg=color[1];float cb=color[2];float alpha=1.0-sTemp*aFactor;r=(r*alpha)+(cr*(1.0-alpha));g=(g*alpha)+(cg*(1.0-alpha));b=(b*alpha)+(cb*(1.0-alpha));}float noise_func(float x,float y){return fract(sin(x+y*10000.)*10000.);}float noise_smooth(vec2 p){vec2 interp=smoothstep(0.,1.,fract(p));float s=mix(noise_func(floor(p.x),floor(p.y)),noise_func(ceil(p.x),floor(p.y)),interp.x);float n=mix(noise_func(floor(p.x),ceil(p.y)),noise_func(ceil(p.x),ceil(p.y)),interp.x);return mix(s,n,interp.y);}float noise_fractal(vec2 p){float x=0.;x+=noise_smooth(p);x+=noise_smooth(p*2.)/2.;x+=noise_smooth(p*4.)/4.;x+=noise_smooth(p*8.)/8.;x+=noise_smooth(p*16.)/16.;x/=1.+1./2.+1./4.+1./8.+1./16.;return x;}float noise_moving(vec2 p,float timeMod){float x=noise_fractal(p+(u_time*timeMod));float y=noise_fractal(p-(u_time*timeMod));return noise_fractal(p+vec2(x,y));}float noiseA(vec2 p,float timeMod){float x=noise_moving(p,timeMod);float y=noise_moving(p+100.,timeMod);return noise_moving(p+vec2(x,y),timeMod);}float rand(vec2 co){return fract(sin(dot(co.xy,vec2(12.9898,78.233)))*43758.5453);}void main(){vec4 elementTail=texture(u_element_tails,v_texcoord);int flags=int(floor(elementTail[3]*255.0+0.5));int blurType=(flags&0x3);if(blurType==0x0){v_color=vec4(1.0,1.0,1.0,1.0);}else if(blurType==0x1){vec4 oldPixel=texture(u_blur,v_texcoord);float r=oldPixel[0];float g=oldPixel[1];float b=oldPixel[2];float alpha;float m=max(r,max(g,b));if(m>0.9){alpha=0.875+(rand(v_texcoord.xy)*0.1-0.05);}else{alpha=0.775+(rand(v_texcoord.xy)*0.04-0.02);}float whiteBackground=1.0-alpha;float nr=(r*alpha)+whiteBackground;float ng=(g*alpha)+whiteBackground;float nb=(b*alpha)+whiteBackground;if(int(nr*255.0)==int(r*255.0)&&int(ng*255.0)==int(g*255.0)&&int(nb*255.0)==int(b*255.0)){v_color=vec4(1.0,1.0,1.0,1.0);}else{v_color=vec4(nr,ng,nb,1.0);}}else{float r=elementTail[2];float g=elementTail[1];float b=elementTail[0];vec4 elementHead=texture(u_element_heads,v_texcoord);int heatType=(flags>>4)&0x3;if(heatType>0){float temperature=elementHead[3];if(temperature>=0.001){applyTemperature(temperature,heatType,r,g,b);}}int type=int(floor(elementHead[0]*255.0+0.5));int typeClass=type&0x7;if(typeClass==0x4){float n=0.2*noiseA(v_texcoord.xy*20.,0.5);v_color=vec4(mix(vec3(r,g,b),vec3(1.,1.,1.),n),1.);}else if(typeClass==0x2){float n=noiseA(v_texcoord.xy*10.,0.6);v_color=vec4(mix(vec3(r,g,b),vec3(1.,1.,1.),n),1.);}else{v_color=vec4(r,g,b,1.0);}}}"),o=n.getUniformLocation(a,"u_time"),l=n.getUniformLocation(a,"u_element_heads"),h=n.getUniformLocation(a,"u_element_tails"),c=n.getUniformLocation(a,"u_blur"),d=n.getUniformLocation(a,"u_temperature_palette"),u=this.#_i(n,"#version 300 es\n#define GLSLIFY 1\nin vec4 a_position;out vec2 v_texcoord;void main(){gl_Position=a_position;v_texcoord=a_position.xy*vec2(0.5,-0.5)+0.5;}","#version 300 es\nprecision mediump float;\n#define GLSLIFY 1\nin vec2 v_texcoord;out vec4 v_color;uniform sampler2D u_element_heads;uniform sampler2D u_element_tails;uniform sampler2D u_blur;uniform sampler2D u_temperature_palette;\n#define TEMP_PALETTE_SIZE 91.0\nfloat countTemperaturePaletteIndex(float c){float k=c+273.0;if(k<1000.0){return 0.0;}else{return floor(k/100.0-10.0);}}void applyTemperature(float temperature,int heatType,inout float r,inout float g,inout float b){float tFactor;float aFactor=0.001;if(heatType==0x01){tFactor=0.5;}else if(heatType==0x02){tFactor=1.0;}else{tFactor=1.45;}float sTemp=(temperature*255.0*10.0)*tFactor;float i=countTemperaturePaletteIndex(sTemp);vec4 color=texture(u_temperature_palette,vec2((i+0.5)/TEMP_PALETTE_SIZE,0.5));float cr=color[0];float cg=color[1];float cb=color[2];float alpha=1.0-sTemp*aFactor;r=(r*alpha)+(cr*(1.0-alpha));g=(g*alpha)+(cg*(1.0-alpha));b=(b*alpha)+(cb*(1.0-alpha));}void main(){vec4 elementTail=texture(u_element_tails,v_texcoord);int flags=int(floor(elementTail[3]*255.0+0.5));int blurType=(flags&0x3);if(blurType==0x00){float r=elementTail[2];float g=elementTail[1];float b=elementTail[0];int heatType=(flags>>4)&0x3;if(heatType>0){vec4 elementHead=texture(u_element_heads,v_texcoord);float temperature=elementHead[3];if(temperature>=0.001){applyTemperature(temperature,heatType,r,g,b);}}v_color=vec4(r,g,b,1.0);}else{v_color=texture(u_blur,v_texcoord);}}"),m=n.getUniformLocation(u,"u_element_heads"),E=n.getUniformLocation(u,"u_element_tails"),g=n.getUniformLocation(u,"u_blur"),p=n.getUniformLocation(u,"u_temperature_palette"),A=[1,1,-1,1,-1,-1,1,1,-1,-1,1,-1],f=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,f),n.bufferData(n.ARRAY_BUFFER,new Float32Array(A),n.STATIC_DRAW),n.enableVertexAttribArray(0),n.vertexAttribPointer(0,2,n.FLOAT,!1,0,0);const T=e=>{const t=new Uint8Array(this.#K.getDataTails().byteLength).fill(255),r=n.createTexture();n.activeTexture(e),n.bindTexture(n.TEXTURE_2D,r),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,this.#W,this.#V,0,n.RGBA,n.UNSIGNED_BYTE,t);const i=n.createFramebuffer();return n.bindFramebuffer(n.FRAMEBUFFER,i),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,r,0),i},C=T(n.TEXTURE2),y=T(n.TEXTURE3),R=n.createTexture();n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,R),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST);const S=n.createTexture();n.activeTexture(n.TEXTURE1),n.bindTexture(n.TEXTURE_2D,S),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST);const v=n.createTexture();n.activeTexture(n.TEXTURE4),n.bindTexture(n.TEXTURE_2D,v),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST);let I=2;this.#Oi=()=>{const e=new Uint8Array(this.#K.getDataHeads());n.bindTexture(n.TEXTURE_2D,R),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,this.#W,this.#V,0,n.RGBA,n.UNSIGNED_BYTE,e);const t=new Uint8Array(this.#K.getDataTails());n.bindTexture(n.TEXTURE_2D,S),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,this.#W,this.#V,0,n.RGBA,n.UNSIGNED_BYTE,t),n.bindTexture(n.TEXTURE_2D,v),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,s,1,0,n.RGBA,n.UNSIGNED_BYTE,i),n.bindFramebuffer(n.FRAMEBUFFER,2===I?C:y),n.useProgram(a),n.uniform1f(o,.001*((new Date).getTime()-this.#bi)),n.uniform1i(l,0),n.uniform1i(h,1),n.uniform1i(c,2===I?3:2),n.uniform1i(d,4),n.drawArrays(n.TRIANGLES,0,A.length/2),n.bindFramebuffer(n.FRAMEBUFFER,null),n.useProgram(u),n.uniform1i(m,0),n.uniform1i(E,1),n.uniform1i(g,I),n.uniform1i(p,4),n.drawArrays(n.TRIANGLES,0,A.length/2),I=2===I?3:2}}trigger(e,t){}render(e){this.#Oi()}#_i(e,t,r){const n=e.createProgram();if(e.attachShader(n,this.#Mi(e,t,e.VERTEX_SHADER)),e.bindAttribLocation(n,0,"a_position"),e.attachShader(n,this.#Mi(e,r,e.FRAGMENT_SHADER)),e.linkProgram(n),!e.getProgramParameter(n,e.LINK_STATUS)&&!e.isContextLost()){throw`Error in program linking: ${e.getProgramInfoLog(n)}`}return n}#Mi(e,t,r){const n=e.createShader(r);if(null===n)throw"Error compiling shader: cannot create shader";if(e.shaderSource(n,t),e.compileShader(n),!e.getShaderParameter(n,e.COMPILE_STATUS)&&!e.isContextLost()){throw`Error compiling shader: ${e.getShaderInfoLog(n)}`}return n}#M(e){const t=e.split("\n").map((e=>e.split(",").map(Number))),r=new Uint8Array(4*t.length);for(let e=0;e<t.length;e++){const n=t[e];r[4*e]=n[0],r[4*e+1]=n[1],r[4*e+2]=n[2]}return r}}class yr{#xi;constructor(e){this.#xi=e}getError(){return this.#xi}}class Rr extends Ue{getContextType(){return"webgl2"}initialize(e,t,r){try{return new Cr(e,t,r)}catch(e){throw new yr(e)}}}class Sr{static canvas2d(e=null){return new Tr(e)}static canvasWebGL(){return new Rr}}class vr{getExtraBrushes(){throw"Not implemented"}byCodeName(e){throw"Not implemented"}}class Ir extends vr{#Hi;constructor(e){super(),this.#Hi=e}getExtraBrushes(){return{...this.#Hi}}byCodeName(e){const t=this.#Hi[e];return void 0!==t?t:ie.byCodeName(e)}}class wr extends ve{#Di;#Ni;#Li;#Ui;#Bi;#Pi;#Fi;#ki;#Yi;#Vi;#Wi;#Gi;#zi;#Ki;constructor(e={},t=(()=>[])){function r(t){const r=e[t];if(null==r){const e=ie.byCodeName(t);if(null===e)throw`Brush '${t}' not found`;return e}if(r instanceof s)return r;throw`Provided brush '${t}' is not instance of Brush`}super(),this.#Di=t,this.#Ni=new Ir(e),this.#Li=r("air").apply(0,0,void 0),this.#Ui=r("water"),this.#Bi=r("steam"),this.#Pi=r("grass"),this.#Fi=r("tree"),this.#ki=r("tree_wood"),this.#Yi=r("tree_wood_dark"),this.#Vi=r("tree_leaf"),this.#Wi=r("tree_leaf_dark"),this.#Gi=r("tree_root"),this.#zi=r("fire"),this.#Ki=r("ash")}getExtensionsFactory(){return this.#Di}getBrushCollection(){return this.#Ni}getDefaultElement(){return this.#Li}getBrushWater(){return this.#Ui}getBrushSteam(){return this.#Bi}getBrushGrass(){return this.#Pi}getBrushTree(){return this.#Fi}getBrushTreeLeaf(){return this.#Vi}getBrushTreeLeafDark(){return this.#Wi}getBrushTreeWood(){return this.#ki}getBrushTreeWoodDark(){return this.#Yi}getBrushTreeRoot(){return this.#Gi}getBrushFire(){return this.#zi}getBrushAsh(){return this.#Ki}getTreeTrunkTemplates(){return re.TREE_TRUNK_TEMPLATES}getTreeLeafClusterTemplates(){return re.TREE_CLUSTER_TEMPLATES}}class Or{#Xi={scale:.5,canvasWidthPx:700,canvasHeightPx:400,scene:"empty"};#ji;#Ji;#qi;#Zi=null;#Qi;#$i="pixelated";#es=[];#ts=!1;#rs=Sr.canvasWebGL();#ns=null;#is;#ss=new Ar(this);#as;#os=null;constructor(e,t,r,n){e&&(this.#Xi=e),this.#as=t,this.#is=r,this.#Qi=n,this.#ji=Math.trunc(this.#Xi.canvasWidthPx*this.#Xi.scale),this.#Ji=Math.trunc(this.#Xi.canvasHeightPx*this.#Xi.scale),this.#qi=this.#Xi.scale}getVersion(){return this.#Xi.version}registerCanvasProvider(e){this.#os=e}getInitialScene(){return this.#ns}setInitialScene(e){this.#ns=e}setup(e){this.setInitialScene(e),this.#ls(e)}#ls(e){if(null==this.#os)throw"Illegal state: canvas provider not registered!";if(null==this.#as)throw"Illegal state: dialog anchor not registered!";const[t,r]=e.countSize(this.#ji,this.#Ji);t===this.#ji&&r===this.#Ji||(this.#ji=t,this.#Ji=r,this.#qi=+(t/this.#Xi.canvasWidthPx).toFixed(3));const n=this.#hs();let i;this.#Zi=null;try{i=e.createSandGame(t,r,this.#Qi,n,this.#rs)}catch(e){return void this.#cs("Initialization failed",e)}i.then((e=>{this.#Zi=e,this.#Zi.graphics().replace(P.TRANSPARENT_ELEMENT,this.#Qi.getDefaultElement()),null!==this.#ns&&this.#ns.executeOnOpened(this.#Zi),this.#ds.forEach((e=>e(this.#Zi))),this.#Zi.addOnRenderingFailed((e=>{this.#cs("Rendering failure",e)})),this.#Zi.startRendering(),this.#ts&&(this.#Zi.startProcessing(),this.#us.forEach((e=>e())))})).catch((t=>{t instanceof yr?setTimeout((()=>{const r="WebGL renderer initialization failed ("+t.getError()+"). Using fallback renderer; game performance and visuals will be affected!";this.#ms(r,e)}),100):this.#cs("Initialization failed",t)}))}#hs(){const e=this.#os.initialize();let t=this.#rs.getContextType(),r=this.#Es(e,t);return"webgl2"===t&&null==r&&(this.#gs("Unable to get WebGL context. Using fallback renderer; game performance and visual will be affected"),this.#rs=Sr.canvas2d(),t=this.#rs.getContextType(),r=this.#Es(e,t),ge.triggerFeatureUsed(ge.FEATURE_RENDERER_FALLBACK)),r}#Es(e,t){if("webgl2"===t){let t=!1;e.addEventListener("webglcontextlost",(e=>{if(null!==this.#Zi&&this.#Zi.stopRendering(),t)return;t=!0;e.preventDefault(),setTimeout((()=>{this.#ps("WebGL context loss detected. Using fallback renderer; game performance and visuals will be affected")}),2e3)}),!1)}return e.getContext(t)}close(){null!==this.#Zi&&(this.#Zi.stopProcessing(),this.#Zi.stopRendering());for(let e of this.#As)e()}enableGlobalShortcuts(){document.onkeydown=e=>{if(!e.ctrlKey||e.altKey||e.shiftKey||"Enter"!==e.key||(e.preventDefault(),this.switchStartStop()),!e.ctrlKey||e.altKey||e.shiftKey||" "!==e.key||(e.preventDefault(),null!==this.#Zi&&this.#Zi.doProcessing()),e.ctrlKey&&!e.altKey&&e.shiftKey&&" "===e.key&&(e.preventDefault(),null!==this.#Zi)){const e=prompt("Enter the number of iterations to run","10000"),t=Math.abs(parseInt(e)),r=new Date;for(let e=0;e<t;e++)this.#Zi.doProcessing(),e%2500==0&&console.log(`Performed ${e} of ${t} iterations`);const n=(new Date).getTime()-r.getTime();console.log(`Performed ${t} iterations in ${n} ms`)}}}getSandGame(){return this.#Zi}getCanvas(){return null!==this.#os?this.#os.getCanvasNode():null}#ds=[];#As=[];#fs=[];#us=[];#Ts=[];#Cs=[];addOnInitialized(e){this.#ds.push(e)}addOnBeforeNewSceneLoaded(e){this.#fs.push(e)}addOnBeforeClosed(e){this.#As.push(e)}addOnStarted(e){this.#us.push(e)}addOnStopped(e){this.#Ts.push(e)}addOnFailure(e){this.#Cs.push(e)}#ms(e,t){this.#gs(e),this.#rs=Sr.canvas2d(),this.#ls(t),ge.triggerFeatureUsed(ge.FEATURE_RENDERER_FALLBACK)}#ps(e){this.#gs(e);const t=this.createSnapshot();this.#rs=Sr.canvas2d(),this.openScene(new et(t)),ge.triggerFeatureUsed(ge.FEATURE_RENDERER_FALLBACK)}#gs(e){console.warn(e);for(let t of this.#Cs)t("rendering-warning",e);let t=pe.bootstrapToastBuilder();t.setHeaderContent(pe.element("strong",{style:"color: orange;"},"Warning")),t.setBodyContent(pe.par(null,e)),t.setDelay(6e4),t.show(this.#as)}#cs(e,t){console.error(e,t),t instanceof yr&&(t=t.getError()),"object"==typeof t&&(t=void 0!==t.message?""+t.message:JSON.stringify(t));const r=e+": "+t;for(let e of this.#Cs)e("serious",r);let n=pe.bootstrapToastBuilder();n.setHeaderContent(pe.element("strong",{style:"color: red;"},"Error")),n.setBodyContent(pe.par(null,r)),n.show(this.#as)}start(){null!==this.#Zi&&(this.#ts||(this.#Zi.startProcessing(),this.#us.forEach((e=>e())))),this.#ts=!0}switchStartStop(){this.#ts=!this.#ts,null!==this.#Zi&&(this.#ts?(this.#ts=!0,this.#Zi.startProcessing(),this.#us.forEach((e=>e()))):(this.#Zi.stopProcessing(),this.#Ts.forEach((e=>e()))))}createSnapshot(){if(null!==this.#Zi){let e=this.#Zi.createSnapshot();return e.metadata.scale=this.getCurrentScale(),void 0!==this.#Xi.version&&(e.metadata.appVersion=this.#Xi.version),e}return null}openScene(e){for(let t of this.#fs)t(e);this.close(),this.#ls(e)}pasteScene(e){const t=this.getToolManager(),r=t.createRevertAction();t.setPrimaryTool($.insertScenesTool([e],r)),t.setSecondaryTool($.actionTool(r))}getCurrentWidthPoints(){return this.#ji}getCurrentHeightPoints(){return this.#Ji}getCurrentScale(){return this.#qi}changeCanvasSize(e,t,r){if("number"!=typeof e||!(e>0&&e<2048))throw"Incorrect width";if("number"!=typeof t||!(t>0&&t<2048))throw"Incorrect height";if("number"!=typeof r||!(r>0&&r<=1))throw"Incorrect scale";this.close(),this.#ji=e,this.#Ji=t,this.#qi=r,this.#ls(new Qe(this.#Zi.createSnapshot()))}setRendererInitializer(e){this.#rs=e,this.#Zi&&(this.close(),this.#ls(new et(this.#Zi.createSnapshot())))}getRendererInitializer(){return this.#rs}setCanvasImageRenderingStyle(e){this.#$i=e;for(let t of this.#es)t(e)}getCanvasImageRenderingStyle(){return this.#$i}addOnImageRenderingStyleChanged(e){this.#es.push(e)}getToolManager(){return this.#is}getIOManager(){return this.#ss}getDialogAnchor(){return this.#as}}class br extends Ze{name;description;#ys;#Rs;constructor({name:e,description:t,onCreated:r,onOpened:n}){super(),this.#ys=r,this.#Rs=n,this.name=e,this.description=t}countSize(e,t){return[e,t]}async createSandGame(e,t,r,n,i){let s=this.createElementArea(e,t,r.getDefaultElement()),a=new qe(s,[],null,r,n,i);return await this.#ys(a),a}createElementArea(e,t,r){return P.create(e,t,r)}executeOnOpened(e){void 0!==this.#Rs&&this.#Rs(e)}}class _r{static custom(e,t,r=void 0){return new br({name:e,onCreated:t,onOpened:r})}}class Mr{static SCENE_EMPTY=new br({name:"Empty",description:"Boxed mode",onCreated:function(e){e.setBoxedMode()}});static SCENE_LANDSCAPE_1=new br({name:"Landscape 1",description:"Boxed mode",onCreated:async function(e){e.setBoxedMode();const t=e.getBrushCollection().byCodeName("soil"),r=e.getBrushCollection().byCodeName("sand"),n=e.getBrushCollection().byCodeName("water");let i=e.layeredTemplate().layerSpline([[0,35],[60,35],[80,40],[100,50],[120,40],[240,20],[440,20],[1040,20]],!0,M.concat(t,ie.EFFECT_NOISE_LG)).layerSpline([[0,0],[130,0],[150,10],[190,10],[290,0]],!0,r,2).tool(30,17,await Er.parseToolDefinition(se.CABIN)).tool(160,5,await Er.parseToolDefinition(se.SAND_CASTLE)).tree(100,1,200).tree(70,5).grass(60,80).grass(90,110);e.getWidth()/e.getHeight()>1.5?e.blockTemplate().withMaxHeight(120).withBlueprint(["          ","        ww","          ","       1  ","     111111","          ","          ","          ","          "]).withBrushes({w:M.withIntensity(.5,n),1:r}).paint():i.layer(26,!1,n).layer(27,!1,M.withIntensity(.33,n)),i.tool(65,45,Ee.BIRD),i.tool(70,70,Ee.BIRD),i.tool(71,75,Ee.BIRD),i.tool(125,55,Ee.BIRD),i.tool(130,50,Ee.BIRD)}});static SCENE_LANDSCAPE_2=new br({name:"Landscape 2",description:"Boxed mode",onCreated:function(e){e.setBoxedMode();const t=e.getBrushCollection().byCodeName("water"),r=e.getBrushCollection().byCodeName("sand"),n=e.getBrushCollection().byCodeName("soil"),i=e.getBrushCollection().byCodeName("gravel");e.layeredTemplate().layerSpline([[0,20],[50,15],[100,10],[150,10],[200,10],[250,10],[1250,10]],!0,M.concat(i,ie.EFFECT_NOISE_LG)).layerSpline([[0,30],[25,31],[50,27],[100,15],[150,0],[200,5],[220,15],[300,35],[330,37],[370,50],[400,45],[500,40],[1250,40]],!0,M.concat(n,ie.EFFECT_NOISE_LG),30).layerSpline([[0,0],[50,0],[100,10],[150,10],[200,9],[275,0],[1250,0]],!0,r,5).layer(35,!1,t).layer(36,!1,M.withIntensity(.33,t)).tool(150,-8,Ee.FISH).tool(270,20,Ee.BUTTERFLY).tool(280,15,Ee.BUTTERFLY).grass().tree(16,6).tree(28,3,70).tree(45,5).tree(309,1).tree(336,4).tree(361,0)}});static SCENE_FALLTHROUGH=new br({name:"Fall-through",description:"Fall-through mode",onCreated:function(e){e.setFallThroughMode();const t=e.getBrushCollection().byCodeName("wall"),r=e.getBrushCollection().byCodeName("water"),n=e.getBrushCollection().byCodeName("sand"),i=e.graphics(),s=Math.trunc((e.getWidth()-150)/2-15),a=Math.trunc((e.getHeight()-150)/2);i.drawRectangle(40+s,20+a,60+s,40+a,r),i.drawLine(30+s,30+a,30+s,50+a,5,t,!0),i.drawLine(30+s,50+a,70+s,80+a,5,t,!0),i.drawLine(65+s,90+a,100+s,100+a,5,t,!0),i.drawLine(55+s,140+a,125+s,140+a,10,t,!1),i.drawLine(55+s,130+a,55+s,140+a,10,t,!1),i.drawLine(70+s,125+a,90+s,125+a,10,n,!1),i.draw(120+s,130+a,n),i.drawLine(150+s,10+a,80+s,35+a,5,t,!0),i.drawLine(80+s,35+a,80+s,15+a,5,t,!0)}});static SCENE_PLATFORM=new br({name:"Platform",description:"Erasing mode",onCreated:function(e){e.setErasingMode();const t=e.getBrushCollection().byCodeName("sand"),r=e.getBrushCollection().byCodeName("wall");e.blockTemplate().withBlueprint(["          ","          ","        w ","        w ","          ","          "," ssssssss ","          ","          "]).withBrushes({w:t,s:r}).paint()}});static SCENES={empty:Mr.SCENE_EMPTY,landscape_1:Mr.SCENE_LANDSCAPE_1,landscape_2:Mr.SCENE_LANDSCAPE_2,fallthrough:Mr.SCENE_FALLTHROUGH,platform:Mr.SCENE_PLATFORM}}class xr{static bird(e=void 0,t=void 0){return{entity:"bird",x:e,y:t}}static butterfly(e=void 0,t=void 0){return{entity:"butterfly",x:e,y:t}}static fish(e=void 0,t=void 0){return{entity:"fish",x:e,y:t}}}class Hr{performAction(e){throw"Not implemented"}static create(e){return new Dr(e)}static createToggle(e,t){let r=e;return new Dr((function(e){r=!r,t(e,r)}))}}class Dr extends Hr{#S;constructor(e){super(),this.#S=e}performAction(e){this.#S(e)}}class Nr extends gr{#ue;constructor(e){super(),this.#ue=e}createNode(e){let t=[];for(const r of this.#ue){const n=r.info.displayName;let i=null,s=pe.button(n,{class:"btn btn-light template-button","data-bs-dismiss":"modal"},(()=>{if(null!==i){const t=e.getToolManager(),r=t.createRevertAction();t.setPrimaryTool(i),t.setSecondaryTool($.actionTool(r))}}));void 0!==r.info.icon&&(s.style.backgroundImage=`url(${r.info.icon.imageData})`),t.push(s),Er.parseToolDefinition(r).then((e=>{i=e})).catch((e=>{console.warn("Template loading failed: "+e)}))}return pe.div({class:"sand-game-templates"},t)}}class Lr extends Hr{#ue;#Ss;constructor(e,t=null){super(),this.#ue=e,this.#Ss=t}performAction(e){let t=new Nr(this.#ue),r=pe.bootstrapDialogBuilder();r.setHeaderContent("Templates"),r.setBodyContent(pe.div({class:"sand-game-component"},[pe.par(null,"Select a template"),t.createNode(e),this.#Ss])),r.addCloseButton("Close"),r.show(e.getDialogAnchor())}}class Ur extends gr{#de;#vs;constructor(e,t=!1){super(),this.#de=e,this.#vs=t}createNode(e){let t=[];const r="btn-sand-game-tool",n=(t,r)=>{t.addEventListener("click",(()=>{this.#Is(r,e)})),e.getToolManager().addOnPrimaryToolChanged((e=>{e===r?t.classList.add("selected"):t.classList.remove("selected")})),r===e.getToolManager().getPrimaryTool()&&t.classList.add("selected"),e.getToolManager().addOnInputDisabledChanged((e=>{t.disabled=e}))};for(let e of this.#de){const i=e.getInfo();let s=i.getCodeName(),a=i.getBadgeStyle();if(e instanceof X){const o=[];for(const t of e.getTools()){const e=t.getInfo();e.getCodeName();let i=e.getDisplayName(),a=e.getBadgeStyle();const l=pe.span(i,{class:"btn btn-secondary "+r+" "+s,style:a}),h={class:"dropdown-item"},c=pe.button(l,h);n(c,t),o.push(pe.element("li",null,c))}const l=this.#ws(i),h=pe.div({class:"btn-group"},[pe.button(l,{class:"btn btn-secondary dropdown-toggle "+r+" "+s,style:a,"data-bs-toggle":"dropdown","aria-expanded":"false"}),pe.element("ul",{class:"dropdown-menu "+(o.length>10?"sand-game-column-count-2":"")},o)]);t.push(h)}else{const o={class:"btn btn-secondary "+r+" "+s,style:a},l=this.#ws(i),h=pe.button(l,o);n(h,e),t.push(h)}}return pe.div({class:"sand-game-tools"},t)}#Is(e,t){if(e instanceof j){let r=null;this.#vs&&(r=pe.div(null,[pe.par(null,""),pe.par(null,"You can also create your own template using an image. See the Import button.")]));const n=e.getTemplateDefinitions();if(Array.isArray(n)){new Lr(n,r).performAction(t)}else Er.parseToolDefinition(n).then((e=>{const r=t.getToolManager(),n=r.createRevertAction();r.setPrimaryTool(e),r.setSecondaryTool($.actionTool(n))})).catch((e=>{console.warn("Template loading failed: "+e)}))}else if(e instanceof J){const r=e.getHandler(),n=t.getSandGame();null!==n&&r(n)}else t.getToolManager().setPrimaryTool(e),t.getToolManager().setSecondaryTool(Ee.ERASE)}#ws(e){let t=e.getDisplayName();const r=e.getSvgIcon();return void 0!==r?[pe.create(r),t]:t}}class Br extends gr{#di;#Os;#bs;#_s;#Ms;constructor(e,t,r,n){super(),this.#bs=e,this.#_s=t,this.#Ms=r;const i=e/r,s=t/r;this.#Os=pe.div({style:{display:"none",position:"absolute",left:"0",top:"0",width:`${i}px`,height:`${s}px`},class:"sand-game-canvas-overlay",width:e+"px",height:t+"px"}),this.#di=n}register(e){const t=e.getMarkers();if(t.length>0){for(const e of t)this.#Os.append(this.#xs(e));this.#Os.style.display="initial"}e.addOnMarkerAdded((e=>{this.#Os.append(this.#xs(e)),this.#Os.style.display="initial"}))}#xs(e){const t=e.getConfig(),[r,n,i,s]=e.getPosition(),a=this.#Hs(r,n,i,s,t.label);if("object"==typeof t.style)for(const[e,r]of Object.entries(t.style))a.style[e]=r;return e.isVisible()||(a.style.display="none"),e.addOnVisibleChanged((e=>{a.style.display=e?"initial":"none"})),a}#Hs(e,t,r,n,i=null){const s={class:"sand-game-marker",style:{left:e/this.#Ms+"px",top:t/this.#Ms+"px",width:(r-e)/this.#Ms+"px",height:(n-t)/this.#Ms+"px",position:"absolute"}};return pe.div(s,i)}createNode(e){return this.#Os}}class Pr extends gr{#di;#Os;#Ds=null;constructor(e,t,r,n){super();const i=e/r,s=t/r;this.#Os=pe.div({style:{position:"absolute",left:"0",top:"0",width:`${i}px`,height:`${s}px`},class:"sand-game-canvas-overlay",width:e+"px",height:t+"px"}),this.#di=n}createNode(e){return this.#Os}hideCursors(){this.#Os.innerHTML="",this.#Ds=null}repaintRectangleSelection(e,t,r,n,i){this.#Os.innerHTML="";let s=Math.min(e,r)/i,a=Math.min(t,n)/i,o=Math.abs(r-e)/i,l=Math.abs(n-t)/i;const h=pe.div({style:{left:s+"px",top:a+"px",width:o+"px",height:l+"px",position:"absolute",outline:"black 1px solid",pointerEvents:"none"}});this.#Os.append(h)}repaintLineSelection(e,t,r,n,i){this.#Os.innerHTML="";const s=this.#di.getCurrentWidthPoints(),a=this.#di.getCurrentHeightPoints(),o=pe.create(`\n            <svg viewBox="0 0 ${s} ${a}" xmlns="http://www.w3.org/2000/svg">\n              <line x1="${e}" y1="${t}" x2="${r}" y2="${n}" stroke="black" />\n            </svg>\n        `);o.style.pointerEvents="none",this.#Os.append(o)}showCursor(e,t,r,n){if(n instanceof F){{const e=Math.trunc(n.getWidth()/r),t=Math.trunc(n.getHeight()/r),i=pe.element("canvas",{width:n.getWidth()+"px",height:n.getHeight()+"px",style:{width:`${e}px`,height:`${t}px`,outline:"black 1px solid"}});i.style.imageRendering="pixelated",fr.renderPreview(n.getElementArea(),i.getContext("2d"),187),this.#Ds={width:e,height:t,node:i}}this.#Ds.node.style.position="absolute",this.#Ds.node.style.pointerEvents="none",this.moveCursor(e,t,r)}}hasCursor(){return null!==this.#Ds}moveCursor(e,t,r){const n=this.#Ds,i=this.#di.getCurrentWidthPoints()/r,s=this.#di.getCurrentHeightPoints()/r,a=t/r-Math.trunc(n.height/2),o=e/r-Math.trunc(n.width/2),l=a<0?-a:-1,h=o+n.width>=i?o+n.width-i:-1,c=a+n.height>=s?a+n.height-s:-1,d=o<0?-o:-1;n.node.style.top=a+"px",n.node.style.left=o+"px",n.node.style.clipPath=`inset(${l}px ${h}px ${c}px ${d}px)`,this.#Os.innerHTML="",this.#Os.append(n.node)}}class Fr extends gr{#di;#Os;#bs;#_s;#Ms;constructor(e,t,r,n){super(),this.#bs=e,this.#_s=t,this.#Ms=r;const i=e/r,s=t/r;this.#Os=pe.div({style:{display:"none",position:"absolute",left:"0",top:"0",width:`${i}px`,height:`${s}px`,pointerEvents:"none"},class:"sand-game-canvas-overlay",width:e+"px",height:t+"px"}),this.#di=n}register(e){let t=!1;const r=e=>{this.#Os.append(e),t||(t=!0,this.#Os.style.display=null)};for(const t of e.getSplashes())r(this.#Ns(t));e.addOnSplashAdded((e=>{r(this.#Ns(e))}));let n=null,i=0;const s=e=>{const t=this.#Ls(e);null===n&&(e.isVisible()&&i++,n=this.#Us(),n.style.display=i>0?null:"none",r(n)),n.append(t),e.addOnVisibleChanged((e=>{i+=e?1:-1,n.style.display=i>0?null:"none"}))};for(const t of e.getObjectives())s(t);e.addOnObjectiveAdded((e=>{s(e)}))}#Ns(e){let t=e.getConfig(),r={class:"sand-game-splash",style:{display:e.isVisible()?null:"none"}};Object.assign(r.style,t.style);let n=pe.div(r,[pe.div({class:"sand-game-splash-content"},t.content),pe.div({class:"sand-game-splash-footer"},t.buttons.filter((e=>null!==e)).map((t=>{let r;if("string"==typeof t.action)r=pe.element("a",{href:t.action,class:t.class},t.title);else{if("function"!=typeof t.action)throw"Button action type not supported: "+typeof t.action;r=pe.button(t.title,{class:t.class},(()=>t.action(e)))}return t.focus&&setTimeout((()=>{r.focus({preventScroll:!0})}),0),r})))]);return e.addOnVisibleChanged((e=>{n.style.display=e?null:"none"})),n}#Us(){return pe.div({class:"sand-game-objectives-list"},null)}#Ls(e){const t=pe.span(null,{class:"sand-game-objective-icon"});e.isVisible()&&pe.setContent(t,this.#Bs(e));const r={style:{display:e.isVisible()?null:"none"}},n=pe.div(r,[t,e.getConfig().name]);return e.addOnVisibleChanged((r=>{n.style.display=r?null:"none",r&&pe.setContent(t,this.#Bs(e))})),e.addOnActiveChanged((r=>{e.isVisible()&&pe.setContent(t,this.#Bs(e))})),e.addOnCompleted((()=>{e.isVisible()&&pe.setContent(t,this.#Bs(e))})),n}#Bs(e){return e.isCompleted()?pe.create('<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-check-square-fill" viewBox="0 0 16 16">\r\n    <path d="M2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2zm10.03 4.97a.75.75 0 0 1 .011 1.05l-3.992 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425a.75.75 0 0 1 1.08-.022z"/>\r\n</svg>'):e.isActive()?pe.create('<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-square" viewBox="0 0 16 16">\r\n    <path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"/>\r\n</svg>'):pe.create('<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-square-dotted" viewBox="0 0 16 16">\r\n    <path d="m2.5 0q-.25 0-.487.048l.194.98a1.5 1.5 0 01.293-.028h.458v-1zm2.292 0h-.917v1h.917zm1.833 0h-.917v1h.917zm1.833 0h-.916v1h.916zm1.834 0h-.917v1h.917zm1.833 0h-.917v1h.917zm1.375 0h-.458v1h.458q.151 0 .293.029l.194-.981a2.5 2.5 0 00-.487-.048m2.079 1.11a2.5 2.5 0 00-.69-.689l-.556.831q.248.167.415.415l.83-.556zm-14.469-.689a2.5 2.5 0 00-.689.69l.831.556c.11-.164.251-.305.415-.415zm14.89 2.079q0-.25-.048-.487l-.98.194q.027.141.028.293v.458h1zm-15.952-.487a2.5 2.5 0 00-.048.487v.458h1v-.458q0-.151.029-.293zm-.048 1.862v.917h1v-.917zm16 .917v-.917h-1v.917zm-16 .916v.917h1v-.917zm16 .917v-.917h-1v.917zm-16 .917v.916h1v-.916zm15 .916h1v-.916h-1zm-15 .917v.917h1v-.917zm16 .917v-.917h-1v.917zm-16 .916v.917h1v-.917zm16 .917v-.917h-1v.917zm-16 .917v.458q0 .25.048.487l.98-.194a1.5 1.5 0 01-.028-.293v-.458zm16 .458v-.458h-1v.458q0 .151-.029.293l.981.194q.048-.237.048-.487m-15.579 1.39c.183.272.417.506.69.689l.556-.831a1.5 1.5 0 01-.415-.415zm14.469.689c.272-.183.506-.417.689-.69l-.831-.556c-.11.164-.251.305-.415.415l.556.83zm-12.877.373q.237.048.487.048h.458v-1h-.458q-.151 0-.293-.029zm11.487.048q.25 0 .487-.048l-.194-.98a1.5 1.5 0 01-.293.028h-.458v1zm-9.625 0h.917v-1h-.917zm1.833 0h.917v-1h-.917zm1.834 0h.916v-1h-.916zm1.833 0h.917v-1h-.917zm1.833 0h.917v-1h-.917z"/>\r\n</svg>')}createNode(e){return this.#Os}}class kr extends gr{#di;#Ps;#Fs;#ks;#Ys;#Vs;#Ws;#Gs;constructor(e){super(),this.#di=e;const t=this.#di.getCurrentWidthPoints(),r=this.#di.getCurrentHeightPoints(),n=this.#di.getCurrentScale();this.#Ps=this.#zs(t,r,n),this.#Fs=new Br(t,r,n,e),this.#ks=this.#Fs.createNode(),this.#Ys=new Pr(t,r,n,e),this.#Vs=this.#Ys.createNode(),this.#Ws=new Fr(t,r,n,e),this.#Gs=this.#Ws.createNode()}#zs(e,t,r){const n=e/r,i=t/r,s=pe.element("canvas",{style:`position: relative; width: ${n}px; height: ${i}px;`,class:"sand-game-canvas",width:e+"px",height:t+"px"});return s.style.imageRendering=this.#di.getCanvasImageRenderingStyle(),s}createNode(e){return pe.div({style:"position: relative;",class:"sand-game-canvas-component"},[this.#Ps,this.#ks,this.#Vs,this.#Gs])}register(e){this.#Fs.register(e.overlay()),this.#Ws.register(e.scenario()),this.#Ks(e)}#Ks(e){const t=this.#Vs,r=this.#di.getCurrentScale(),n=this.#di.getToolManager();let i,s,a=e=>{const n=t.getBoundingClientRect();return[Math.max(0,Math.trunc((e.clientX-n.left)*r)),Math.max(0,Math.trunc((e.clientY-n.top)*r))]},o=null,l=!1,h=!1,c=!1,d=null;const u=(t,r,n)=>{o.isRepeatingEnabled()&&(d=setInterval((()=>{o.applyPoint(t,r,e.graphics(),n)}),80))},m=()=>{null!==d&&(clearInterval(d),d=null)};this.#Vs.addEventListener("contextmenu",(e=>(e.preventDefault(),!1))),t.addEventListener("mousedown",(t=>{if(n.isInputDisabled())return;const[d,E]=a(t);if(i=d,s=E,o=null,l=!1,h=!1,c=!1,1===t.buttons)o=n.getPrimaryTool(),ge.triggerFeatureUsed(ge.FEATURE_DRAW_PRIMARY);else{if(2!==t.buttons){if(4===t.buttons){if(t.preventDefault(),t.altKey||t.ctrlKey||t.shiftKey)t.altKey&&t.ctrlKey&&t.shiftKey&&console.log(d+"x"+E+": "+e.debugElementAt(d,E));else{const t=n.getTertiaryTool();t.applyPoint(d,E,e.graphics(),!1),ge.triggerFeatureUsed(ge.FEATURE_DRAW_TERTIARY),ge.triggerToolUsed(t)}return}return}{let r=n.getPrimaryTool();if(r.isSecondaryActionEnabled())return r.applySecondaryAction(d,E,e.graphics(),t.altKey),this.#Ys.hideCursors(),void m();o=n.getSecondaryTool(),ge.triggerFeatureUsed(ge.FEATURE_DRAW_SECONDARY)}}if(t.ctrlKey||t.shiftKey)t.ctrlKey&&t.shiftKey?(o.applySpecial(d,E,e.graphics(),t.altKey),ge.triggerFeatureUsed(ge.FEATURE_DRAW_FLOOD),ge.triggerToolUsed(o),o=null):(t.ctrlKey&&o.isAreaModeEnabled()&&(h=t.ctrlKey),t.shiftKey&&o.isLineModeEnabled()&&(c=t.shiftKey));else{o.applyPoint(d,E,e.graphics(),t.altKey),ge.triggerToolUsed(o),u(d,E,t.altKey),this.#Ys.hideCursors();const i=n.getPrimaryTool().createCursor();null!==i&&this.#Ys.showCursor(d,E,r,i)}})),t.addEventListener("mousemove",(t=>{if(m(),n.isInputDisabled())return o=null,void this.#Ys.hideCursors();if(!h&&!c){if(this.#Ys.hasCursor()){const[e,n]=a(t);this.#Ys.moveCursor(e,n,r)}else{const e=n.getPrimaryTool().createCursor();if(null!==e){const[n,i]=a(t);this.#Ys.showCursor(n,i,r,e)}}if(null===o)return;const[h,c]=a(t);return l||(o.onDragStart(i,s,e.graphics(),t.altKey),l=!0),o.applyStroke(i,s,h,c,e.graphics(),t.altKey),ge.triggerToolUsed(o),u(h,c,t.altKey),i=h,void(s=c)}if(!(null===o||h&&c))if(h){const[e,n]=a(t);this.#Ys.repaintRectangleSelection(i,s,e,n,r)}else if(c){const[e,n]=a(t);this.#Ys.repaintLineSelection(i,s,e,n,r)}else;})),t.addEventListener("mouseup",(t=>{if(m(),!n.isInputDisabled()&&null!==o){if(l)o.onDragEnd(i,s,e.graphics(),t.altKey),l=!1,o.hasCursor()||this.#Ys.hideCursors();else if(h){const[r,n]=a(t);let l=Math.min(i,r),h=Math.min(s,n),c=Math.max(i,r),d=Math.max(s,n);o.applyArea(l,h,c,d,e.graphics(),t.altKey),this.#Ys.hideCursors(),ge.triggerFeatureUsed(ge.FEATURE_DRAW_RECT),ge.triggerToolUsed(o)}else if(c){const[r,n]=a(t);o.applyStroke(i,s,r,n,e.graphics(),t.altKey),this.#Ys.hideCursors(),ge.triggerFeatureUsed(ge.FEATURE_DRAW_LINE),ge.triggerToolUsed(o)}o=null,h=!1,c=!1}})),t.addEventListener("mouseout",(e=>{m(),this.#Ys.hideCursors()})),t.addEventListener("mouseenter",(e=>{null!==o&&0===e.buttons&&(o=null,this.#Ys.hideCursors(),e.preventDefault())}));let E=e=>{let t=e.touches[0];return a(t)};t.addEventListener("touchstart",(t=>{if(n.isInputDisabled())return;const[r,a]=E(t);i=r,s=a,o=n.getPrimaryTool(),o.applyPoint(r,a,e.graphics(),!1),ge.triggerFeatureUsed(ge.FEATURE_DRAW_PRIMARY),ge.triggerToolUsed(o),t.preventDefault()})),t.addEventListener("touchmove",(t=>{if(n.isInputDisabled())return void(o=null);if(null===o)return;const[r,a]=E(t);o.applyStroke(i,s,r,a,e.graphics(),!1),ge.triggerToolUsed(o),i=r,s=a,t.preventDefault()})),t.addEventListener("touchend",(e=>{o=null,e.preventDefault()}))}getCanvasNode(){return this.#Ps}setImageRenderingStyle(e){this.#Ps.style.imageRendering=e}onInputDisabledChanged(e){this.#Vs.style.cursor=e?"not-allowed":null}}class Yr extends gr{#Xs=pe.div({class:"sand-game-canvas-holder"});#js=null;createNode(e){return e.registerCanvasProvider({initialize:()=>(this.#Xs.innerHTML="",this.#js=new kr(e),this.#Xs.append(this.#js.createNode(e)),this.#js.getCanvasNode()),getCanvasNode:()=>null!==this.#js?this.#js.getCanvasNode():null}),e.addOnImageRenderingStyleChanged((e=>{null!==this.#js&&this.#js.setImageRenderingStyle(e)})),e.addOnInitialized((e=>{if(null===this.#js)throw"Illegal state: canvas is not initialized";this.#js.register(e)})),e.addOnBeforeClosed((()=>{this.#js=null,this.#Xs.innerHTML=""})),e.getToolManager().addOnInputDisabledChanged((e=>{null!==this.#js&&this.#js.onInputDisabledChanged(e)})),this.#Xs}}class Vr extends Hr{performAction(e){let t=pe.bootstrapSimpleFormBuilder();t.addInput("Width","width",""+e.getCurrentWidthPoints()),t.addInput("Height","height",""+e.getCurrentHeightPoints()),t.addInput("Scale","scale",""+e.getCurrentScale());let r=pe.bootstrapDialogBuilder();r.setHeaderContent("Change canvas size manually"),r.setBodyContent(t.createNode()),r.addSubmitButton("Submit",(()=>{let r=t.getData(),n=Number.parseInt(r.width),i=Number.parseInt(r.height),s=Number.parseFloat(r.scale);e.changeCanvasSize(n,i,s),ge.triggerFeatureUsed(ge.FEATURE_CANVAS_SIZE_CHANGE)})),r.addCloseButton("Close"),r.show(e.getDialogAnchor())}}class Wr extends gr{static CLASS_SELECTED="selected-size";static SIZES=[{scale:.75,image:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHgAAABQCAYAAADSm7GJAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACHUlEQVR4Xu3WQW6EMBBEUSJx3jkMF55s4ogQG2zTxeDi/10ijdxTb5HME1k3b39BXgFsHsDmAWwewOYBbB7A5gFsHsDmAWwewOYBbB7A5gFsHsDmAWwewOYBbB7A5gFsHsCrlmV5r39+vV5f659HDOCftrjpd6MjAzzlcVOjIz8eeA83NTLyo4FrcFOjIj8WuAU3NSLyI4F7cFOjIT8O+AxuaiTkRwFH4KZGQX4McCRuagTkjwGvB1ePpMBN3R35I8DbwZUjbd9SpLz/bJcDlwZXjFR6S5Hi/oguBT4aPHKko7cURd4f1WXAtYNHjFT7lqKI+yO7BLh18DMjtb6l6Mz90cmBewfvGan3LUU99yuSAp8dvGWks28parlflQw4avCakaLeUlRzvzIJcPTgeyNFv6Vo73514cCqwXMjqd5SlLu/1Pp71X6mVCiwevD1SOq3FNUgb79XzWf2CgPeHqbqqndU7YGVvtveZ44KAS4dRvlyYEcb5j5T02ngo8MoX8+fmx7kU8C1h1G+nv1akbuBe46jmFqQu4DB/Xy1yM3A4N6nGuQmYHDv1xFyNTC4920PuQoY3PtXQj4EBneccsi7wOCO1xa5CAzuuK2Rs8Dgjl9C/gcMrk/Lsrz/AIPr1y8wuJ7N0wSuczO43v37J4u8Atg8gM0D2DyAzQPYPIDNA9g8gM0D2DyAzQPYPIDNA9g8gM0D2DyAzQPYvG9K/XJS29iPWwAAAABJRU5ErkJggg==",description:"Very small elements"},{scale:.5,image:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHgAAABQCAYAAADSm7GJAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABSElEQVR4Xu3WQQ6EIBAFUUw8L4fxwjN78xedQBDLeksiYbAysc8mtPO+IBYDwxkYzsBwBoYzMJyB4QwMZ2A4A8MZGM7AcAaGMzCcgeEMDGdgOAPDGRjOwK2167p+97Wk937c13ZnYDgDwxkYzsBwnwtcHaiStHf3wetzgb/GwHAGhjMw3JLAaThJZg8s1XNHpDNm32PEksB6joHhDAxnYLjpgdPQUZX2VgeWtPcp6bdU7zHb9MDai4HhDAxnYLihwGmYmG3FGSuke6TBq/pc1VBg7c/AcAaGMzBcOXD6+GtM9Z2m56qDVzmw3snAcAaGMzBcDJw+6tpLapQGrxhYHAaGMzCcgeHO9LHWO6WW/oPhDAxnYDgDwxkYzsBwBoYzMJyB4QwMZ2A4A8MZGM7AcAaGMzCcgeEMDGdgOAPDGRjOwHAGhjMw3B/1T0cI5HMokgAAAABJRU5ErkJggg==",description:"Small elements"},{scale:.375,image:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHgAAABQCAYAAADSm7GJAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABGklEQVR4Xu3YMU7EMBQAUZBy3hwmF4Y+BforGcNO3itdOFZGLvyPD9KO+wItAscJHCdwnMBxAscJHCdwnMBxAscJHCdwnMBxAscJHCdwnMBxjw58XdfXfe3uPM/P+9o7eXTgJxA4TuA4geMEjhM4TuA4geO2Bt45WJh8a2Kyz6oz/4atgdlP4DiB4wSOEzhO4DiB4wSOWxZ4MhCYWLXPTpMz/9UwZFlg/ieB4wSOEzhO4DiB4wSOEzhuFHjykOdnq/7hqwOTUWDel8BxAscJHCdwnMBxAscJHHeseoCzx6u93OA4geMEjhM4TuA4geMEjhM4TuA4geMEjhM4TuA4geMEjhM4TuA4geMEjhM4TuA4geMEjhM4TuC4b6YQJX8pLssnAAAAAElFTkSuQmCC",description:"Medium elements"},{scale:.25,image:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHgAAABQCAYAAADSm7GJAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA+ElEQVR4Xu3ZsQ3DMAwAwRjwvBpGCye9KgMq7LzvSnbiQxXPD2nnOqBF4DiB4wSOEzhO4DiB4wSOEzhO4DiB4wSOEzhO4LjXBZ5zftfZVWOMY5093esCv43AcQLHCRwncJzAcQLHCRwncJzAcQLHCRwncJzAcVuBd05v/2jnvXedGrcC83wCxwkcJ3CcwHECxwkcJ3CcwHECxwkcJ3CcwHECx507JzCuu2vPfnCcwHECxwkcJ3CcwHECxwkcJ3CcwHECxwkcJ3CcwHECxwkcJ3CcwHECxwkcJ3CcwHECxwkcJ3CcwHECxwkcJ3CcwHECxwkcJ3CcwHE/D68RYAgtpF0AAAAASUVORK5CYII=",description:"Big elements"}];#Js=[];#qs=null;#Zs=null;createNode(e){for(let t of Wr.SIZES){let r=this.#Qs(t.scale,t.image,t.description);t.scale===e.getCurrentScale()&&this.#$s(r,t.scale),r.addEventListener("click",(n=>{this.#ea(r,t.scale,e)})),this.#Js.push(r)}return pe.div(null,[pe.par(null,"Increasing the size of the elements will result in the top and right parts of the canvas being clipped."),pe.par(null,"Reducing the size of the elements will result in an expansion of the canvas in the upper and right parts."),pe.par(null,"Only the scale of the current scene and the initial setting for new scenes will be changed. Scene can be regenerated by clicking on the scene card."),pe.div({class:"element-size-options"},this.#Js)])}#ea(e,t,r){if(this.#Zs===t)return;this.#qs&&this.#qs.classList.remove(Wr.CLASS_SELECTED),this.#$s(e,t);let n=Math.trunc(r.getCurrentWidthPoints()/r.getCurrentScale()*t),i=Math.trunc(r.getCurrentHeightPoints()/r.getCurrentScale()*t);r.changeCanvasSize(n,i,t),ge.triggerFeatureUsed(ge.FEATURE_SWITCH_SCALE)}#$s(e,t){e.classList.add(Wr.CLASS_SELECTED),this.#qs=e,this.#Zs=t}#Qs(e,t,r){return pe.div({class:"card"},[pe.element("img",{src:t,alt:r})])}}class Gr extends Hr{performAction(e){let t=new Wr,r=pe.bootstrapDialogBuilder();r.setHeaderContent("Adjust Scale"),r.setBodyContent(pe.div({class:"sand-game-component"},[t.createNode(e)])),r.addSubmitButton("Set size manually",(()=>{(new Vr).performAction(e)})),r.addCloseButton("Close"),r.show(e.getDialogAnchor())}}class zr extends gr{createNode(e){return pe.button(pe.create('\x3c!-- @author Patrik Harag --\x3e\r\n<svg width="64" height="64" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">\r\n <g>\r\n  <rect stroke="#505050" stroke-width="4" id="svg_1" height="24" width="24" y="35.5" x="4.5" fill="none"/>\r\n  <rect stroke="#505050" stroke-width="2" stroke-dasharray="3,5" id="svg_2" height="54" width="54" y="4.5" x="4.5" fill="none"/>\r\n  <line stroke="#505050" id="svg_3" y2="10.65089" x2="51.9999" y1="27.9524" x1="34.38094" stroke-width="4" fill="none"/>\r\n  <line stroke="#505050" id="svg_4" y2="11.28581" x2="50.73007" y1="13.98421" x1="37.87298" stroke-width="4" fill="none"/>\r\n  <line stroke="#505050" id="svg_5" y2="11.762" x2="51.36499" y1="23.82543" x1="48.82531" stroke-width="4" fill="none"/>\r\n </g>\r\n</svg>'),{class:"btn btn-outline-secondary adjust-scale","aria-label":"Adjust scale"},(()=>{(new Gr).performAction(e)}))}}class Kr extends gr{static CLASS_SELECTED="selected-scene";static CLASS_VISITED="visited-scene";#di;#ta=!1;#J;#ra;#qs=null;#na=null;#ia=new Map;constructor(e,t,r){super(),this.#di=e,this.#J=t,this.#ra=r,this.#di.addOnBeforeNewSceneLoaded((()=>{this.#ta||(this.#sa(),this.#aa())}))}createNode(e){let t=pe.div({class:"scenes"},[]);for(const[e,r]of Object.entries(this.#J)){let n=pe.element("span",{class:"scene-title"},r.name),i=pe.button(n,{class:"btn btn-outline-secondary scene"},(()=>{this.#oa(e,i,r)}));e===this.#ra&&(this.#qs=i,this.#na=e,i.classList.add(Kr.CLASS_SELECTED),i.classList.add(Kr.CLASS_VISITED)),t.append(i)}return t}#oa(e,t,r){this.#qs?this.#na===e?this.#la((()=>{this.#ea(t,e,r),ge.triggerFeatureUsed(ge.FEATURE_RESTART_SCENE)})):(this.#sa(),this.#ea(t,e,r),ge.triggerFeatureUsed(ge.FEATURE_SWITCH_SCENE)):(this.#ea(t,e,r),ge.triggerFeatureUsed(ge.FEATURE_SWITCH_SCENE))}#la(e){let t=pe.bootstrapDialogBuilder();t.setHeaderContent("Restart scene"),t.setBodyContent([pe.par(null,"Do you want to restart the scene?")]),t.addSubmitButton("Confirm",e),t.addCloseButton("Close"),t.show(this.#di.getDialogAnchor())}#ea(e,t,r){this.#aa(),this.#qs=e,this.#na=t,e.classList.add(Kr.CLASS_SELECTED),e.classList.add(Kr.CLASS_VISITED);let n=this.#ia.get(t);n?(this.#ia.delete(t),this.#ta=!0,this.#di.setInitialScene(r),this.#di.openScene(new et(n)),this.#ta=!1):(this.#ta=!0,this.#di.setInitialScene(r),this.#di.openScene(r),this.#ta=!1)}#aa(){this.#qs&&this.#qs.classList.remove(Kr.CLASS_SELECTED),this.#qs=null,this.#na=null}#sa(){this.#qs&&this.#ia.set(this.#na,this.#di.createSnapshot())}}class Xr extends gr{#ha;#ca;constructor(e,t){super(),this.#ha=e,this.#ca=t}createNode(e){const t=pe.div({class:this.#ha},[]);for(let r of this.#ca)null!==r&&t.append(r.createNode(e));return t}}class jr extends gr{#da;constructor(e){super(),this.#da=e}createNode(e){return this.#da}}class Jr extends gr{static CLASS_PRIMARY="btn-primary";static CLASS_SECONDARY="btn-secondary";static CLASS_INFO="btn-info";static CLASS_SUCCESS="btn-success";static CLASS_WARNING="btn-warning";static CLASS_LIGHT="btn-light";static CLASS_OUTLINE_PRIMARY="btn-outline-primary";static CLASS_OUTLINE_SECONDARY="btn-outline-secondary";static CLASS_OUTLINE_INFO="btn-outline-info";static CLASS_OUTLINE_SUCCESS="btn-outline-success";static CLASS_OUTLINE_WARNING="btn-outline-warning";static CLASS_OUTLINE_LIGHT="btn-outline-light";#ua;#ma;#ha;constructor(e,t,r){super(),this.#ua=e,this.#ma="function"==typeof r?Hr.create(r):r,this.#ha=null==t?Jr.CLASS_PRIMARY:t}createNode(e){return pe.button(this.#ua,{class:"btn "+this.#ha},(t=>{this.#ma.performAction(e)}))}}var qr='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-play-fill" viewBox="0 0 16 16">\r\n    <path d="m11.596 8.697-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393z"/>\r\n</svg>';class Zr extends Jr{constructor(e){super("",e,Hr.create((e=>{e.switchStartStop(),ge.triggerFeatureUsed(ge.FEATURE_PAUSE)})))}createNode(e){const t=super.createNode(e);return pe.setContent(t,[pe.create(qr),"Start"]),e.addOnStarted((()=>{pe.setContent(t,[pe.create('<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pause-fill" viewBox="0 0 16 16">\r\n    <path d="M5.5 3.5A1.5 1.5 0 0 1 7 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5zm5 0A1.5 1.5 0 0 1 12 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5z"/>\r\n</svg>'),"Pause"])})),e.addOnStopped((()=>{pe.setContent(t,[pe.create(qr),"Start"])})),t}}class Qr extends gr{#Ss;constructor(e=null){super(),this.#Ss=e}createNode(e){let t="";const r=pe.span(""),n=[pe.span("Performance: ",{class:"visible-on-big-screen-only"}),r],i=pe.div({class:"btn-group"},[pe.element("button",{type:"button",class:"btn btn-link dropdown-toggle","data-bs-toggle":"dropdown","aria-expanded":"false"},n),pe.element("form",{class:"dropdown-menu p-2"},this.#Ea(e))]);i.addEventListener("show.bs.dropdown",(function(){ge.triggerFeatureUsed(ge.FEATURE_STATUS_DISPLAYED)}));let s=(e,n)=>{n!==t&&(r.textContent=n.toUpperCase(),r.classList.remove("status-"+t),r.classList.add("status-"+n),t=n)};return e.addOnStopped((()=>s(0,"stopped"))),e.addOnStarted((()=>s(0,"started"))),e.addOnInitialized((t=>{t.addOnRendered((()=>{const t=e.getSandGame().getIterationsPerSecond();s(0,0!==t?t>105?"best":t>80?"good":t>50?"medium":t>40?"low":"poor":"stopped")}))})),i}#Ea(e){const t=pe.span(),r=pe.span();e.addOnInitialized((n=>{n.addOnRendered((()=>{const n=e.getSandGame().getFramesPerSecond(),i=e.getSandGame().getIterationsPerSecond();r.textContent=" = "+n,t.textContent=" = "+i}))}));const n=pe.span(),i=()=>{const t=e.getCurrentWidthPoints(),r=e.getCurrentHeightPoints();n.textContent=` = ${t.toLocaleString()}×${r.toLocaleString()} = ${(t*r).toLocaleString()}`};return e.addOnInitialized((()=>{i()})),i(),[pe.span("Sand Game JS "+e.getVersion(),{style:"font-weight: bold;"}),pe.element("br"),pe.span("Simulated elements"),n,pe.element("br"),pe.span("Simulation iterations /s"),t,pe.span(" (target: "+Ne.OPT_CYCLES_PER_SECOND+")",{style:"color: lightgray;"}),pe.element("br"),pe.span("Rendered frames /s"),r,pe.span(" (target: "+Ne.OPT_FRAMES_PER_SECOND+")",{style:"color: lightgray;"}),pe.element("br"),this.#Ss]}}class $r extends Hr{performAction(e){let t=pe.bootstrapDialogBuilder();t.setHeaderContent("Restart"),t.setBodyContent([pe.par(null,"Are you sure?")]),t.addSubmitButton("Restart",(()=>{const t=e.getInitialScene();e.openScene(t),ge.triggerFeatureUsed(ge.FEATURE_RESTART_SCENE)})),t.addCloseButton("Close"),t.show(e.getDialogAnchor())}}class en extends Jr{constructor(e){super("",e,new $r)}createNode(e){const t=super.createNode(e);return pe.setContent(t,[pe.create('<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-clockwise" viewBox="0 0 16 16">\r\n    <path fill-rule="evenodd" d="M8 3.5a4.5 4.5 0 104.546 2.914.5.5 0 011.454-.414A6 6 0 118 2z"/>\r\n    <path d="M8 6V0l5 3L8 6"/>\r\n</svg>'),"Restart"]),t}}class tn extends Hr{performAction(e){let t=document.createElement("input");t.type="file",t.onchange=t=>{e.getIOManager().loadFromFiles(t.target.files)},t.click()}}var rn={};!function(e,t){!function(){function t(e,t){return void 0===t?t={autoBom:!1}:"object"!=typeof t&&(console.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e}function r(e,t,r){var n=new XMLHttpRequest;n.open("GET",e),n.responseType="blob",n.onload=function(){o(n.response,t,r)},n.onerror=function(){console.error("could not download file")},n.send()}function n(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(e){}return 200<=t.status&&299>=t.status}function i(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(r){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var s="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof Xe&&Xe.global===Xe?Xe:void 0,a=s.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),o=s.saveAs||("object"!=typeof window||window!==s?function(){}:"download"in HTMLAnchorElement.prototype&&!a?function(e,t,a){var o=s.URL||s.webkitURL,l=document.createElement("a");t=t||e.name||"download",l.download=t,l.rel="noopener","string"==typeof e?(l.href=e,l.origin===location.origin?i(l):n(l.href)?r(e,t,a):i(l,l.target="_blank")):(l.href=o.createObjectURL(e),setTimeout((function(){o.revokeObjectURL(l.href)}),4e4),setTimeout((function(){i(l)}),0))}:"msSaveOrOpenBlob"in navigator?function(e,s,a){if(s=s||e.name||"download","string"!=typeof e)navigator.msSaveOrOpenBlob(t(e,a),s);else if(n(e))r(e,s,a);else{var o=document.createElement("a");o.href=e,o.target="_blank",setTimeout((function(){i(o)}))}}:function(e,t,n,i){if((i=i||open("","_blank"))&&(i.document.title=i.document.body.innerText="downloading..."),"string"==typeof e)return r(e,t,n);var o="application/octet-stream"===e.type,l=/constructor/i.test(s.HTMLElement)||s.safari,h=/CriOS\/[\d]+/.test(navigator.userAgent);if((h||o&&l||a)&&"undefined"!=typeof FileReader){var c=new FileReader;c.onloadend=function(){var e=c.result;e=h?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),i?i.location.href=e:location=e,i=null},c.readAsDataURL(e)}else{var d=s.URL||s.webkitURL,u=d.createObjectURL(e);i?i.location=u:location.href=u,i=null,setTimeout((function(){d.revokeObjectURL(u)}),4e4)}});s.saveAs=o.saveAs=o,e.exports=o}()}({get exports(){return rn},set exports(e){rn=e}});var nn=rn;class sn extends Hr{performAction(e){const t=e.createSnapshot(),r=Er.createResourceFromSnapshot(t);nn.saveAs(new Blob([r]),this.#ga()),ge.triggerFeatureUsed(ge.FEATURE_IO_EXPORT)}#ga(){return`sand-game-js_${(new Date).toISOString().slice(0,10)}.sgjs`}}class an extends Hr{#Q;constructor(e){super(),this.#Q=e}performAction(e){let t=pe.bootstrapSimpleFormBuilder();t.addTextArea("Message","message");let r=pe.bootstrapDialogBuilder();r.setHeaderContent("Report a problem"),r.setBodyContent(t.createNode()),r.addSubmitButton("Submit",(()=>{let r=t.getData().message;""!==r.trim()&&this.#Q("user",r,e)})),r.addCloseButton("Close"),r.show(e.getDialogAnchor())}}class on extends Jr{constructor(e,t){super(["Report",pe.span(" a problem",{class:"visible-on-big-screen-only"})],e,new an(t))}}class ln{run(){throw"Not implemented"}}class hn extends ln{#K;#ut;#mt;constructor(e){super(),this.#K=e.elementArea,this.#ut=e.random,this.#mt=e.processorContext}run(){if(this.#mt.getIteration()%3==0){const e=this.#ut.nextInt(this.#K.getWidth()),t=this.#ut.nextInt(this.#K.getHeight()-3)+2;if(xe.canGrowUpHere(this.#K,e,t)){const r=this.#mt.getDefaults().getBrushGrass();this.#K.setElement(e,t,r.apply(e,t,this.#ut)),this.#mt.trigger(e,t)}}}}class cn extends ln{#K;#ut;#mt;#ln;constructor(e){super(),this.#K=e.elementArea,this.#ut=e.random,this.#mt=e.processorContext,this.#ln=e.entityManager}run(){if((this.#mt.getIteration()+200)%1e3==0){if(this.#ln.countEntities("fish")>=8)return;const e=this.#ut.nextInt(this.#K.getWidth()-20)+10,t=this.#pa(this.#K,e);null!==t&&(this.#ln.addSerializedEntity(xr.fish(e,t)),this.#mt.trigger(e,t))}}#pa(e,t){let r=0;for(let i=0;i<e.getHeight();i++){const s=e.getElementHead(t,i),a=n.getTypeClass(s);if(a===n.TYPE_AIR)r=0;else if(a===n.TYPE_FLUID)n.getBehaviour(s)===n.BEHAVIOUR_LIQUID&&n.getSpecial(s)===n.SPECIAL_LIQUID_WATER&&r++;else if(a===n.TYPE_POWDER||a===n.TYPE_POWDER_WET){if(r>7&&this.#Aa(t,i-1))return i-1;break}}return null}#Aa(e,t){for(let r=0;r<6;r++)for(let i=-(r+1);i<r+1;i++){const s=e+i,a=t-r,o=this.#K.getElementHeadOrNull(s,a);if(null===o)return!1;if(n.getTypeClass(o)!==n.TYPE_FLUID)return!1;if(n.getTemperature(o)>0)return!1}return!0}}class dn extends ln{#K;#ut;#mt;constructor(e){super(),this.#K=e.elementArea,this.#ut=e.random,this.#mt=e.processorContext}run(){const e=this.#mt.getIteration();if(e>1e3&&e%4==0){const e=this.#ut.nextInt(this.#K.getWidth()-12)+6,t=this.#ut.nextInt(this.#K.getHeight()-16)+15;if(dn.couldGrowUpHere(this.#K,e,t)){const r=this.#mt.getDefaults().getBrushTree();this.#K.setElement(e,t,r.apply(e,t,this.#ut)),this.#mt.trigger(e,t)}}}static couldGrowUpHere(e,t,r){if(t<0||r<12)return!1;if(t>e.getWidth()-5||r>e.getHeight()-2)return!1;let i=e.getElementHead(t,r);if(n.getBehaviour(i)!==n.BEHAVIOUR_GRASS)return!1;if(n.getTemperature(i)>0)return!1;let s=e.getElementHead(t,r+1);if(n.getBehaviour(s)!==n.BEHAVIOUR_SOIL)return!1;if(n.getTemperature(s)>0)return!1;for(let n=1;n<18;n++)if(!dn.#fa(e,t,r-n))return!1;for(let n=-15;n<15;n++)if(dn.#Ta(e,t+n,r-4))return!1;for(let n=10;n<15;n++){if(!dn.#fa(e,t-8,r-n))return!1;if(!dn.#fa(e,t+8,r-n))return!1}return!0}static#fa(e,t,r){let i=e.getElementHead(t,r);return n.getTypeClass(i)===n.TYPE_AIR||n.getBehaviour(i)===n.BEHAVIOUR_GRASS}static#Ta(e,t,r){let i=e.getElementHead(t,r),s=n.getBehaviour(i);return s===n.BEHAVIOUR_TREE_TRUNK||s===n.BEHAVIOUR_TREE}}class un extends ln{#K;#ut;#mt;#ln;constructor(e){super(),this.#K=e.elementArea,this.#ut=e.random,this.#mt=e.processorContext,this.#ln=e.entityManager}run(){if((this.#mt.getIteration()+500)%1e3==0){if(this.#ln.countEntities("butterfly")>3)return;const e=this.#ut.nextInt(this.#K.getWidth()-20)+10,t=this.#pa(this.#K,e);null!==t&&(this.#ln.addSerializedEntity(xr.butterfly(e,t)),this.#mt.trigger(e,t))}}#pa(e,t){let r=0;for(let i=0;i<e.getHeight();i++){const s=e.getElementHead(t,i);if(n.getTypeClass(s)===n.TYPE_AIR)r++;else{if(n.getBehaviour(s)===n.BEHAVIOUR_GRASS){if(r>=15&&this.#Aa(t,i-4))return i-4;break}r=0}}return null}#Aa(e,t){for(let r=-5;r<=2;r++)for(let i=-5;i<=5;i++){const s=e+i,a=t+r,o=this.#K.getElementHeadOrNull(s,a);if(null===o)return!1;if(n.getTypeClass(o)!==n.TYPE_AIR)return!1;if(n.getTemperature(o)>0)return!1}return!0}}class mn extends ln{#K;#ut;#mt;#ln;constructor(e){super(),this.#K=e.elementArea,this.#ut=e.random,this.#mt=e.processorContext,this.#ln=e.entityManager}run(){if((this.#mt.getIteration()+700)%1e3==0){if(this.#ln.countEntities("bird")>4)return;const e=this.#ut.nextInt(this.#K.getWidth()-20)+10,t=this.#pa(this.#K,e);null!==t&&(this.#ln.addSerializedEntity(xr.bird(e,t)),this.#mt.trigger(e,t))}}#pa(e,t){let r=0;for(let i=0;i<e.getHeight();i++){const s=e.getElementHead(t,i);if(n.getTypeClass(s)===n.TYPE_AIR)r++;else{if(n.getBehaviour(s)===n.BEHAVIOUR_TREE_LEAF){if(r>=15&&this.#Aa(t,i-5))return i-5;break}r=0}}return null}#Aa(e,t){for(let r=-6;r<=2;r++)for(let i=-5;i<=5;i++){const s=e+i,a=t+r,o=this.#K.getElementHeadOrNull(s,a);if(null===o)return!1;if(n.getTypeClass(o)!==n.TYPE_AIR)return!1;if(n.getTemperature(o)>0)return!1}return!0}}class En extends ln{#it;constructor(e){super(),this.#it=e}run(){(this.#it.processorContext.getIteration()+700)%1e3==0&&this.#Ca("fish",20,5,2),(this.#it.processorContext.getIteration()+800)%1e3==0&&this.#Ca("butterfly",20,5,4),(this.#it.processorContext.getIteration()+900)%1e3==0&&this.#Ca("bird",100,50,8)}#Ca(e,t,r,n){const i=this.#it.entityManager.getEntities().filter((t=>t.getType()===e));if(i.length>0){const e=this.#it.random;let s;if(1===i.length)s=[[i[0].getX(),i[0].getY(),i]];else{let t=2===i.length?1:2;e.next()<.2&&t++,s=this.#ya(i,t)}for(const[i,a,o]of s){let s=i+e.nextInt(2*t)-t,l=a+e.nextInt(2*r)-r;const h=this.#it.elementArea.getWidth();s=Math.abs(s),s>=h&&(s=h-(s-h));const c=this.#it.elementArea.getHeight();l=Math.abs(l),l>=c&&(l=c-(l-c));for(let t of o)if("function"==typeof t.assignWaypoint){const r=l+e.nextInt(2*n)-n,i=s+e.nextInt(2*n)-n;t.assignWaypoint(i,r)}}}}#ya(e,t){let r=e.slice(0,t),n=new Array(e.length),i=new Array(t);for(;;){for(let i=0;i<e.length;i++){let s=1/0;for(let a=0;a<t;a++){let t=e[i].getX()-r[a].getX(),o=e[i].getY()-r[a].getY(),l=Math.sqrt(t*t+o*o);l<s&&(s=l,n[i]=a)}}let s=new Array(t);for(let r=0;r<t;r++){i[r]=[];let t=0,a=0,o=0;for(let s=0;s<e.length;s++)n[s]===r&&(t+=e[s].getX(),a+=e[s].getY(),o++,i[r].push(e[s]));const l=Math.round(t/o),h=Math.round(a/o);s[r]={getX:()=>l,getY:()=>h}}let a=!0;for(let e=0;e<t;e++)if(r[e].getX()!==s[e].getX()||r[e].getY()!==s[e].getY()){a=!1;break}if(a)break;r=s}let s=[];for(let e=0;e<t;e++)s.push([r[e].getX(),r[e].getY(),i[e]]);return s}}const gn=ie._LIST,pn=Ee._LIST;e.BrushDefs=ie,e.Brushes=M,e.Entities=xr,e.PredicateDefs=w,e.RendererInitializerDefs=Sr,e.Resources=Er,e.SceneDefs=Mr,e.Scenes=_r,e.ToolDefs=Ee,e.Tools=$,e.brushes=gn,e.init=function(e,r){let n;void 0===r&&(r={});const{width:i,height:s,scale:a}=t.determineOptimalSizes(e,r.canvas),o={scale:a,canvasWidthPx:i,canvasHeightPx:s,version:r.version},l=!0===r.debug,h=void 0===r.autoStart||!0===r.autoStart,c=!(!0===r.disableRestart),d=!(!0===r.disableStartStop),u=!(!0===r.disableImport),m=!(!0===r.disableExport),E=!(!0===r.disableSizeChange),g=!(!0===r.disableSceneSelection),p=!(!0===r.disableGlobalShortcuts),A=void 0!==r.errorReporter,f=r.errorReporter;let T,C;if("object"==typeof r.brushes)T=r.brushes;else{if(void 0!==r.brushes)throw"config.brushes - wrong type, expected object";T=void 0}if("object"==typeof r.extensions)C=r.extensions;else{if(void 0!==r.extensions)throw"config.extensions - wrong type, expected object";C={spawnFish:!0,spawnGrass:!0,spawnTrees:!0,spawnButterflies:!0,spawnBirds:!0,generateWaypoints:!0}}const y=new wr(T,(e=>{const t=[];return!0===C.spawnFish&&t.push(new cn(e)),!0===C.spawnGrass&&t.push(new hn(e)),!0===C.spawnTrees&&t.push(new dn(e)),!0===C.spawnButterflies&&t.push(new un(e)),!0===C.spawnBirds&&t.push(new mn(e)),!0===C.generateWaypoints&&t.push(new En(e)),t}));let R,S,v,I,w,O,b,_;if(Array.isArray(r.scenes)){R={};for(let e=0;e<r.scenes.length;e++)R["scene_"+e]=r.scenes[e];S=!0}else"object"==typeof r.scenes?(R=r.scenes,S=!0):(R=Mr.SCENES,S=!1);if("string"==typeof r.scene){if(I=r.scene,v=R[I],void 0===v)throw"Scene not found: "+I}else if("object"==typeof r.scene){I="n/a";const e="function"==typeof r.scene.init?e=>r.scene.init(e,n):()=>{};v=_r.custom("n/a",e)}else S?(I=Object.keys(R)[0],v=Object.values(R)[0]):(I=l||Math.random()>.1?"landscape_1":"landscape_2",v=R[I]);function M(e,t=null){if("string"==typeof e){let r=Ee.byCodeName(e);if(null!==r)return r;if(l)throw"Tool not found: "+e;return t}if("object"==typeof e&&e instanceof D)return e;if(l)throw"Unexpected tool type";return t}if(Array.isArray(r.tools)){w=[];for(let e of r.tools){let t=M(e,null);null!==t&&w.push(t)}}else w=$.grouping(Ee.DEFAULT_TOOLS,Ee.DEFAULT_CATEGORY_DEFINITIONS);void 0!==r.primaryTool&&null!==(O=M(r.primaryTool))||(O=Ee.SAND),void 0!==r.secondaryTool&&null!==(b=M(r.secondaryTool))||(b=Ee.ERASE),void 0!==r.tertiaryTool&&null!==(_=M(r.tertiaryTool))||(_=Ee.METEOR);const x=pe.div({class:"sand-game-dialog-anchor sand-game-component"});document.body.prepend(x);const H=new $e(O,b,_);n=new Or(o,x,H,y),void 0!==f&&n.addOnFailure(((e,t)=>f(e,t,n)));const N=new Xr("sand-game-component",[new Ur(w,u),new Yr,new Xr("sand-game-options",[new Xr("sand-game-options-left",[u?new Jr("Import",Jr.CLASS_LIGHT,new tn):null,m?new Jr("Export",Jr.CLASS_LIGHT,new sn):null,c&&!g?new en(Jr.CLASS_LIGHT):null,d?new Zr(Jr.CLASS_LIGHT):null,new Qr(E?pe.element("span",null,[pe.element("br"),"Tip: adjust scale if needed"]):null)]),new Xr("sand-game-options-right",[A?new on(Jr.CLASS_LIGHT,f):null])]),new Xr("sand-game-views",[E||g?new Xr(null,[E?new zr:null,g?new jr(pe.span("Scenes",{class:"scenes-label"})):null,g?new Kr(n,R,I):null]):null,l&&void 0!==window.SandGameJS_ModuleDev?SandGameJS_ModuleDev.createComponent():null])]).createNode(n);return e.innerHTML="",e.append(N),n.setup(v),u&&n.getIOManager().initFileDragAndDrop(N),p&&n.enableGlobalShortcuts(),h&&n.start(),ge.triggerFeatureUsed(ge.FEATURE_APP_INITIALIZED),n},e.tools=pn,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=sand-game-js.umd.min.js.map
