{"version":3,"file":"sand-game-js.umd.min.js","sources":["../src/gui/SizeUtils.js","../src/core/Element.js","../src/core/ElementHead.js","../src/core/DeterministicRandom.js","../src/core/brush/Brush.js","../src/core/brush/RandomBrush.js","../src/core/brush/RandomElementBrush.js","../src/core/brush/AbstractEffectBrush.js","../src/core/ElementTail.js","../src/core/brush/ColorBrush.js","../src/core/brush/ColorPaletteRandomBrush.js","../src/Assets.js","../src/core/brush/ColorTextureBrush.js","../node_modules/simplex-noise/dist/esm/simplex-noise.js","../src/core/processing/VisualEffects.js","../src/core/brush/ColorNoiseBrush.js","../src/core/brush/ColorMovingPaletteBrush.js","../src/core/brush/ColorRandomize.js","../src/core/brush/CustomBrush.js","../src/core/brush/CountingBrush.js","../src/def/PredicateDefs.js","../src/core/brush/MeltingBrush.js","../src/core/brush/SolidBodyBrush.js","../src/core/brush/ExtinguishedBrush.js","../src/core/brush/Brushes.js","../src/core/tool/ToolInfo.js","../src/core/tool/CursorDefinition.js","../src/core/tool/Tool.js","../src/core/tool/RoundBrushTool.js","../src/core/tool/RoundBrushToolForSolidBody.js","../src/core/tool/PointBrushTool.js","../src/core/tool/MeteorTool.js","../src/core/ElementArea.js","../src/core/tool/CursorDefinitionElementArea.js","../src/core/tool/InsertElementAreaTool.js","../src/core/tool/InsertRandomSceneTool.js","../src/core/tool/ActionTool.js","../src/core/PositionedElement.js","../src/core/FloodFillPainter.js","../src/core/tool/CopyUtils.js","../src/core/tool/MoveTool.js","../src/core/tool/SelectionFakeTool.js","../src/core/tool/TemplateSelectionFakeTool.js","../src/core/tool/GlobalActionTool.js","../src/core/processing/ProcessorContext.js","../src/core/GameState.js","../src/core/tool/InsertEntityTool.js","../src/core/tool/Tools.js","../src/def/StructureDefs.js","../src/def/BrushDefs.js","../src/def/assets/brushes/brick-wall.png","../src/def/assets/brushes/wood-wall.png","../src/def/TemplateDefs.js","../src/def/assets/templates/rock-sm-1.png","../src/def/assets/templates/rock-sm-2.png","../src/def/assets/templates/rock-sm-3.png","../src/def/assets/templates/rock-1.png","../src/def/assets/templates/rock-2.png","../src/def/assets/templates/rock-3.png","../src/def/assets/templates/rock-4.png","../src/def/assets/templates/rock-5.png","../src/def/assets/templates/rock-6.png","../src/def/assets/templates/rock-lg-1.png","../src/def/assets/templates/rock-lg-2.png","../src/def/assets/templates/wooden-house.png","../src/def/assets/templates/sand-castle.png","../src/core/entity/StateDefinition.js","../src/core/entity/EntityUtils.js","../src/core/entity/Entity.js","../src/core/entity/StateBasedAbstractEntity.js","../src/core/entity/StateBasedBirdLikeEntity.js","../src/core/entity/StateBasedFishLikeEntity.js","../src/core/entity/EntityFactories.js","../src/def/ToolDefs.js","../src/Analytics.js","../src/gui/DomBuilder.js","../src/core/Counter.js","../src/core/entity/EntityPositionLookup.js","../src/core/entity/EntityManager.js","../src/core/GameDefaults.js","../src/core/processing/ProcessorModuleSolidBody.js","../src/core/processing/ProcessorModuleEntity.js","../src/core/processing/ProcessorModuleFire.js","../src/core/CircleIterator.js","../src/core/processing/ProcessorModuleMeteor.js","../src/core/processing/ProcessorModuleGrass.js","../src/core/processing/ProcessorModuleTree.js","../src/core/processing/ProcessorModuleLiquid.js","../src/core/processing/Processor.js","../src/core/rendering/Renderer.js","../src/core/rendering/RendererInitializer.js","../src/core/Marker.js","../src/core/SandGameGraphics.js","../src/core/SandGameEntities.js","../src/core/SandGameOverlay.js","../src/core/Splash.js","../src/core/Objective.js","../src/core/SandGameScenario.js","../src/core/Snapshot.js","../src/core/SnapshotMetadata.js","../src/core/TemplateBlockPainter.js","../node_modules/cubic-spline/index.js","../src/core/TemplateLayeredPainter.js","../src/core/SandGame.js","../src/core/scene/Scene.js","../src/core/scene/SceneImplResize.js","../src/gui/ServiceToolManager.js","../src/core/scene/SceneImplSnapshot.js","../node_modules/fflate/esm/browser.js","../src/io/ResourceSnapshot.js","../src/core/scene/SceneImplModFlip.js","../src/core/scene/SceneImplTemplate.js","../src/io/ResourceUtils.js","../src/io/ResourceTool.js","../src/io/Resources.js","../src/gui/component/Component.js","../src/gui/component/ComponentFormTemplate.js","../src/gui/ServiceIO.js","../src/core/rendering/Renderer2D.js","../src/core/rendering/RendererInitializer2D.js","../src/core/rendering/RendererWebGL.js","../src/core/rendering/RenderingWebGLException.js","../src/core/rendering/RendererInitializerWebGL.js","../src/def/RendererInitializerDefs.js","../src/core/brush/BrushCollection.js","../src/def/BrushCollectionImpl.js","../src/def/GameDefaultsImpl.js","../src/gui/Controller.js","../src/core/scene/SceneImplHardcoded.js","../src/core/scene/Scenes.js","../src/def/SceneDefs.js","../src/core/entity/Entities.js","../src/gui/action/Action.js","../src/gui/component/ComponentViewTemplateSelection.js","../src/gui/action/ActionDialogTemplateSelection.js","../src/gui/component/ComponentViewTools.js","../src/gui/component/ComponentViewCanvasOverlayMarker.js","../src/gui/component/ComponentViewCanvasOverlayCursor.js","../src/gui/component/ComponentViewCanvasOverlayScenario.js","../src/gui/component/ComponentViewCanvasInner.js","../src/gui/component/ComponentViewCanvas.js","../src/gui/action/ActionDialogChangeCanvasSize.js","../src/gui/component/ComponentViewElementSizeSelection.js","../src/gui/component/assets/element-size-1.png","../src/gui/component/assets/element-size-2.png","../src/gui/component/assets/element-size-3.png","../src/gui/component/assets/element-size-4.png","../src/gui/action/ActionDialogChangeElementSize.js","../src/gui/component/ComponentButtonAdjustScale.js","../src/gui/component/ComponentViewSceneSelection.js","../src/gui/component/ComponentContainer.js","../src/gui/component/ComponentSimple.js","../src/gui/component/ComponentButton.js","../src/gui/component/ComponentButtonStartStop.js","../src/gui/component/ComponentStatusIndicator.js","../src/gui/action/ActionRestart.js","../src/gui/component/ComponentButtonRestart.js","../src/gui/action/ActionIOImport.js","../node_modules/file-saver/dist/FileSaver.min.js","../src/gui/action/ActionIOExport.js","../src/gui/action/ActionReportProblem.js","../src/gui/component/ComponentButtonReport.js","../src/core/extensions/Extension.js","../src/core/extensions/ExtensionSpawnGrass.js","../src/core/extensions/ExtensionSpawnFish.js","../src/core/extensions/ExtensionSpawnTrees.js","../src/core/extensions/ExtensionSpawnButterflies.js","../src/core/extensions/ExtensionSpawnBirds.js","../src/core/extensions/ExtensionGenWaypoints.js","../src/main.js"],"sourcesContent":["// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-03-24\r\n */\r\nexport default class SizeUtils {\r\n\r\n    static #determineSize(root, maxWidthPx = 1400, maxHeightPx = 800) {\r\n        let parentWidth;\r\n        if (window.innerWidth <= 575) {\r\n            parentWidth = window.innerWidth;  // no margins\r\n        } else {\r\n            parentWidth = root.clientWidth;  // including padding\r\n        }\r\n\r\n        let width = Math.min(maxWidthPx, parentWidth);\r\n        let height = Math.min(maxHeightPx, Math.trunc(window.innerHeight * 0.70));\r\n        if (width / height < 0.75) {\r\n            height = Math.trunc(width / 0.75);\r\n        }\r\n        return {width, height};\r\n    }\r\n\r\n    static #determineMaxNumberOfPoints() {\r\n        if (navigator.maxTouchPoints || 'ontouchstart' in document.documentElement) {\r\n            // probably a smartphone\r\n            return 75000;\r\n        } else {\r\n            // bigger screen => usually more powerful (or newer) computer\r\n            if (window.screen.width >= 2560 && window.screen.height >= 1440) {\r\n                return 200000;  // >= QHD\r\n            } else if (window.screen.width >= 2048 && window.screen.height >= 1080) {\r\n                return 175000;  // >= 2k\r\n            } else if (window.screen.width >= 1920 && window.screen.height >= 1080) {\r\n                return 150000;\r\n            } else {\r\n                return 125000;\r\n            }\r\n        }\r\n    }\r\n\r\n    static #determineOptimalScale(width, height, maxPoints) {\r\n        function countPointsWithScale(scale) {\r\n            return Math.trunc(width * scale) * Math.trunc(height * scale);\r\n        }\r\n\r\n        if (countPointsWithScale(0.750) < maxPoints) {\r\n            return 0.750;\r\n        } else if (countPointsWithScale(0.5) < maxPoints) {\r\n            return 0.5;\r\n        } else if (countPointsWithScale(0.375) < maxPoints) {\r\n            return 0.375;\r\n        } else {\r\n            return 0.25;\r\n        }\r\n    }\r\n\r\n    static determineOptimalSizes(parentNode, canvasConfig = undefined) {\r\n        const maxWidthPx = (canvasConfig !== undefined) ? canvasConfig.maxWidthPx : undefined;\r\n        const maxHeightPx = (canvasConfig !== undefined) ? canvasConfig.maxHeightPx : undefined;\r\n\r\n        const {width, height} = SizeUtils.#determineSize(parentNode, maxWidthPx, maxHeightPx);\r\n\r\n        const scaleOverride = (canvasConfig !== undefined) ? canvasConfig.scale : undefined;\r\n        const scale = (scaleOverride === undefined)\r\n            ? SizeUtils.#determineOptimalScale(width, height, SizeUtils.#determineMaxNumberOfPoints())\r\n            : scaleOverride;\r\n        return { width, height, scale };\r\n    }\r\n}\r\n","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2022-09-09\r\n */\r\nexport default class Element {\r\n    elementHead;\r\n    elementTail;\r\n\r\n    constructor(elementHead = 0, elementTail = 0) {\r\n        this.elementHead = elementHead;\r\n        this.elementTail = elementTail;\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\n/**\r\n * Tools for working with the element head.\r\n *\r\n * The element head structure: <code>0x[type][beh.][flags][temp.]</code> (32b)\r\n * <pre>\r\n *     | type class   3b  | type modifiers                 5b  |\r\n *     | behaviour             4b  | special               4b  |\r\n *     | heat modifiers index                              8b  |\r\n *     | temperature                                       8b  |\r\n * </pre>\r\n *\r\n * Type modifier for powder-like types: (5b)\r\n * <pre>\r\n *     | sliding  1b |  direction  1b  | momentum  3b  |\r\n * </pre>\r\n *\r\n * Type modifier for solid-like types: (5b)\r\n * <pre>\r\n *     | neighbourhood type  1b |  body id  4b  |\r\n * </pre>\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-05-26\r\n */\r\nexport default class ElementHead {\r\n\r\n    static FIELD_TYPE_CLASS_SIZE = 3;  // bits\r\n    static TYPE_AIR = 0x0;\r\n    static TYPE_EFFECT = 0x1;\r\n    static TYPE_GAS = 0x2;\r\n    static TYPE_POWDER_FLOATING = 0x3;   // floating, not wet, can turn into wet\r\n    static TYPE_FLUID = 0x4;\r\n    static TYPE_POWDER = 0x5;  // not wet, can turn into wet\r\n    static TYPE_POWDER_WET = 0x6;  // wet\r\n    static TYPE_STATIC = 0x7;\r\n\r\n    static FIELD_TYPE_MODIFIERS_SIZE = 5;  // bits\r\n\r\n    static FIELD_BEHAVIOUR_SIZE = 4;  // bits\r\n    static BEHAVIOUR_NONE = 0x0;\r\n    static BEHAVIOUR_SOIL = 0x1;\r\n    static BEHAVIOUR_GRASS = 0x2;\r\n    static BEHAVIOUR_3 = 0x3;  // unused\r\n    static BEHAVIOUR_4 = 0x4;  // unused\r\n    static BEHAVIOUR_TREE = 0x5;\r\n    static BEHAVIOUR_TREE_ROOT = 0x6;\r\n    static BEHAVIOUR_TREE_TRUNK = 0x7;\r\n    static BEHAVIOUR_TREE_LEAF = 0x8;\r\n    static BEHAVIOUR_FIRE = 0x9;\r\n    static BEHAVIOUR_FIRE_SOURCE = 0xA;\r\n    static BEHAVIOUR_METEOR = 0xB;  // TODO: to entity?\r\n    static BEHAVIOUR_LIQUID = 0xC;\r\n    static BEHAVIOUR_ENTITY = 0xD;\r\n    static BEHAVIOUR_E = 0xE;\r\n    static BEHAVIOUR_F = 0xF;\r\n\r\n    static FIELD_SPECIAL_SIZE = 4;  // bits\r\n    static SPECIAL_LIQUID_WATER = 0;\r\n    static SPECIAL_LIQUID_LIGHT_OIL = 5;\r\n    static SPECIAL_LIQUID_HEAVY_MOLTEN = 10;\r\n\r\n    static FIELD_HMI_SIZE = 8;  // bits\r\n\r\n    static FIELD_TEMPERATURE_SIZE = 8;  // bits\r\n\r\n\r\n    static of(type8, behaviour8 = 0, modifiers8 = 0, temperature = 0) {\r\n        let value = temperature << 8;\r\n        value = (value | modifiers8) << 8;\r\n        value = (value | behaviour8) << 8;\r\n        value = value | type8;\r\n        return value;\r\n    }\r\n\r\n    static type8(typeClass, typeModifiers = 0) {\r\n        return typeClass | (typeModifiers << 3);\r\n    }\r\n\r\n    static type8Powder(typeClass, momentum = 0, sliding = 0, direction = 0) {\r\n        let value = momentum << 1;\r\n        value = (value | direction) << 1;\r\n        value = (value | sliding) << 3;\r\n        value = value | typeClass;\r\n        return value;\r\n    }\r\n\r\n    // TODO TYPE_FLUID: density, step size, ? viscosity, ? pressure\r\n    static type8Fluid(typeClass) {\r\n        return typeClass;\r\n    }\r\n\r\n    static type8Solid(typeClass, bodyId = 0, extendedNeighbourhood = true) {\r\n        let value = bodyId << 1;\r\n        value = (value | (extendedNeighbourhood ? 0 : 1)) << 3;\r\n        value = value | typeClass;\r\n        return value;\r\n    }\r\n\r\n    static behaviour8(behaviour = 0, special = 0) {\r\n        return behaviour | (special << 4);\r\n    }\r\n\r\n    static modifiers8(heatModIndex = 0) {\r\n        return heatModIndex;\r\n    }\r\n\r\n    // get methods\r\n\r\n    static getType(elementHead) {\r\n        return elementHead & 0x000000FF;\r\n    }\r\n\r\n    static getTypeClass(elementHead) {\r\n        return elementHead & 0x00000007;\r\n    }\r\n\r\n    static getTypeModifierPowderSliding(elementHead) {\r\n        return (elementHead >> 3) & 0x00000001;\r\n    }\r\n\r\n    static getTypeModifierPowderDirection(elementHead) {\r\n        return (elementHead >> 4) & 0x00000001;\r\n    }\r\n\r\n    static getTypeModifierPowderMomentum(elementHead) {\r\n        return (elementHead >> 5) & 0x00000007;\r\n    }\r\n\r\n    static getTypeModifierSolidNeighbourhoodType(elementHead) {\r\n        return (elementHead >> 3) & 0x00000001;\r\n    }\r\n\r\n    static getTypeModifierSolidBodyId(elementHead) {\r\n        return (elementHead >> 4) & 0x0000000F;\r\n    }\r\n\r\n    static getBehaviour(elementHead) {\r\n        return (elementHead >> 8) & 0x0000000F;\r\n    }\r\n\r\n    static getSpecial(elementHead) {\r\n        return (elementHead >> 12) & 0x0000000F;\r\n    }\r\n\r\n    static getHeatModIndex(elementHead) {\r\n        return (elementHead >> 16) & 0x000000FF;\r\n    }\r\n\r\n    static getTemperature(elementHead) {\r\n        return (elementHead >> 24) & 0x000000FF;\r\n    }\r\n\r\n    // set methods\r\n\r\n    static setType(elementHead, type) {\r\n        return (elementHead & 0xFFFFFF00) | type;\r\n    }\r\n\r\n    static setTypeClass(elementHead, type) {\r\n        return (elementHead & 0xFFFFFFF8) | type;\r\n    }\r\n\r\n    static setTypeModifierPowderSliding(elementHead, val) {\r\n        return (elementHead & 0xFFFFFFF7) | (val << 3);\r\n    }\r\n\r\n    static setTypeModifierPowderDirection(elementHead, val) {\r\n        return (elementHead & 0xFFFFFFEF) | (val << 4);\r\n    }\r\n\r\n    static setTypeModifierPowderMomentum(elementHead, val) {\r\n        return (elementHead & 0xFFFFFF1F) | (val << 5);\r\n    }\r\n\r\n    static setTypeModifierSolidNeighbourhoodType(elementHead, val) {\r\n        return (elementHead & 0xFFFFFFF7) | (val << 3);\r\n    }\r\n\r\n    static setTypeModifierSolidBodyId(elementHead, val) {\r\n        return (elementHead & 0xFFFFFF0F) | (val << 4);\r\n    }\r\n\r\n    static setBehaviour(elementHead, behaviour) {\r\n        return (elementHead & 0xFFFFF0FF) | (behaviour << 8);\r\n    }\r\n\r\n    static setSpecial(elementHead, special) {\r\n        return (elementHead & 0xFFFF0FFF) | (special << 12);\r\n    }\r\n\r\n    static setHeatModIndex(elementHead, heatModIndex) {\r\n        return (elementHead & 0xFF00FFFF) | (heatModIndex << 16);\r\n    }\r\n\r\n    static setTemperature(elementHead, temperature) {\r\n        return (elementHead & 0x00FFFFFF) | (temperature << 24);\r\n    }\r\n\r\n\r\n    // --- HEAT MODIFIERS ---\r\n\r\n    static #HEAT_MODS_COUNT = 16;\r\n    static #HEAT_MODS = Array(ElementHead.#HEAT_MODS_COUNT);\r\n\r\n    static #defHeatMods({i, conductiveIndex = 0.2, heatLossChanceTo10000 = 2500,\r\n                            flammableChanceTo10000 = 0, selfIgnitionChanceTo10000 = 0,\r\n                            flameHeat = 0, burnDownChanceTo10000 = 0,\r\n                            meltingTemperature = 0xFF + 1, meltingHMI = 0,\r\n                            hardeningTemperature = 0, hardeningHMI = 0}) {\r\n\r\n        const array = Array(10);\r\n        array[0] = conductiveIndex;\r\n        array[1] = heatLossChanceTo10000;\r\n        array[2] = flammableChanceTo10000;\r\n        array[3] = selfIgnitionChanceTo10000;\r\n        array[4] = flameHeat;\r\n        array[5] = burnDownChanceTo10000;\r\n        array[6] = meltingTemperature;\r\n        array[7] = meltingHMI;\r\n        array[8] = hardeningTemperature;\r\n        array[9] = hardeningHMI;\r\n\r\n        ElementHead.#HEAT_MODS[i] = array;\r\n        return i;\r\n    }\r\n\r\n    static HMI_DEFAULT = ElementHead.#defHeatMods({\r\n        i: 0\r\n        // default values\r\n    });\r\n\r\n    static HMI_CONDUCTIVE_1 = ElementHead.#defHeatMods({\r\n        i: 1,\r\n        conductiveIndex: 0.25,\r\n        heatLossChanceTo10000: 500\r\n    });\r\n\r\n    static HMI_CONDUCTIVE_2 = ElementHead.#defHeatMods({\r\n        i: 2,\r\n        conductiveIndex: 0.3,\r\n        heatLossChanceTo10000: 20\r\n    });\r\n\r\n    static HMI_CONDUCTIVE_3 = ElementHead.#defHeatMods({\r\n        i: 3,\r\n        conductiveIndex: 0.45,\r\n        heatLossChanceTo10000: 10\r\n    });\r\n\r\n    static HMI_GRASS_LIKE = ElementHead.#defHeatMods({\r\n        i: 4,\r\n        flammableChanceTo10000: 4500,\r\n        selfIgnitionChanceTo10000: 3,\r\n        flameHeat: 165,\r\n        burnDownChanceTo10000: 1000\r\n    });\r\n\r\n    static HMI_WOOD_LIKE = ElementHead.#defHeatMods({\r\n        i: 5,\r\n        flammableChanceTo10000: 100,\r\n        selfIgnitionChanceTo10000: 2,\r\n        flameHeat: 165,\r\n        burnDownChanceTo10000: 2\r\n    });\r\n\r\n    static HMI_LEAF_LIKE = ElementHead.#defHeatMods({\r\n        i: 6,\r\n        flammableChanceTo10000: 4500,\r\n        selfIgnitionChanceTo10000: 3,\r\n        flameHeat: 165,\r\n        burnDownChanceTo10000: 100\r\n    });\r\n\r\n    static HMI_METAL = ElementHead.#defHeatMods({\r\n        i: 7,\r\n        conductiveIndex: 0.45,\r\n        heatLossChanceTo10000: 10,\r\n        meltingTemperature: 200,\r\n        meltingHMI: 8\r\n    });\r\n\r\n    static HMI_MOLTEN = ElementHead.#defHeatMods({\r\n        i: 8,\r\n        conductiveIndex: 0.45,\r\n        heatLossChanceTo10000: 10,\r\n        hardeningTemperature: 150,\r\n        hardeningHMI: 7\r\n    });\r\n\r\n    static HMI_COAL = ElementHead.#defHeatMods({\r\n        i: 9,\r\n        conductiveIndex: 0.3,\r\n        heatLossChanceTo10000: 20,\r\n        flammableChanceTo10000: 500,\r\n        selfIgnitionChanceTo10000: 3,\r\n        flameHeat: 190,\r\n        burnDownChanceTo10000: 50\r\n    });\r\n\r\n    static HMI_THERMITE = ElementHead.#defHeatMods({\r\n        i: 10,\r\n        conductiveIndex: 0.45,\r\n        heatLossChanceTo10000: 10,\r\n        flammableChanceTo10000: 8000,\r\n        selfIgnitionChanceTo10000: 500,\r\n        flameHeat: 250,\r\n        burnDownChanceTo10000: 1000\r\n    });\r\n\r\n    static HMI_OIL = ElementHead.#defHeatMods({\r\n        i: 11,\r\n        conductiveIndex: 0.45,\r\n        heatLossChanceTo10000: 10,\r\n        flammableChanceTo10000: 10000,\r\n        selfIgnitionChanceTo10000: 2500,\r\n        flameHeat: 220,\r\n        burnDownChanceTo10000: 1000\r\n    });\r\n\r\n    static {\r\n        // fill missing definitions - bounds checking is not needed then...\r\n        for (let i = 0; i < ElementHead.#HEAT_MODS_COUNT; i++) {\r\n            if (ElementHead.#HEAT_MODS[i] === undefined) {\r\n                ElementHead.#defHeatMods(i);\r\n            }\r\n        }\r\n    }\r\n\r\n    // ---\r\n\r\n    static hmiToConductiveIndex(heatModIndex) {\r\n        return ElementHead.#HEAT_MODS[heatModIndex & 0xF][0];\r\n    }\r\n\r\n    static hmiToHeatLossChanceTo10000(heatModIndex) {\r\n        return ElementHead.#HEAT_MODS[heatModIndex & 0xF][1];\r\n    }\r\n\r\n    // how hard it is to ignite this element\r\n    static hmiToFlammableChanceTo10000(heatModIndex) {\r\n        return ElementHead.#HEAT_MODS[heatModIndex & 0xF][2];\r\n    }\r\n\r\n    // how hard it is to ignite this element\r\n    static hmiToSelfIgnitionChanceTo10000(heatModIndex) {\r\n        return ElementHead.#HEAT_MODS[heatModIndex & 0xF][3];\r\n    }\r\n\r\n    // how much heat this element produces while burning\r\n    static hmiToFlameHeat(heatModIndex) {\r\n        return ElementHead.#HEAT_MODS[heatModIndex & 0xF][4];\r\n    }\r\n\r\n    // how hard it is to burn down this element\r\n    static hmiToBurnDownChanceTo10000(heatModIndex) {\r\n        return ElementHead.#HEAT_MODS[heatModIndex & 0xF][5];\r\n    }\r\n\r\n    static hmiToMeltingTemperature(heatModIndex) {\r\n        return ElementHead.#HEAT_MODS[heatModIndex & 0xF][6];\r\n    }\r\n\r\n    static hmiToMeltingHMI(heatModIndex) {\r\n        return ElementHead.#HEAT_MODS[heatModIndex & 0xF][7];\r\n    }\r\n\r\n    static hmiToHardeningTemperature(heatModIndex) {\r\n        return ElementHead.#HEAT_MODS[heatModIndex & 0xF][8];\r\n    }\r\n\r\n    static hmiToHardeningHMI(heatModIndex) {\r\n        return ElementHead.#HEAT_MODS[heatModIndex & 0xF][9];\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\n/**\r\n * Custom random implementation: \"Mulberry32\"\r\n * https://stackoverflow.com/questions/521295/seeding-the-random-number-generator-in-javascript/47593316#47593316\r\n *\r\n * @author Patrik Harag\r\n * @version 2023-12-20\r\n */\r\nexport default class DeterministicRandom {\r\n\r\n    static DEFAULT = new DeterministicRandom(106244033);\r\n\r\n    static next(seed) {\r\n        let t = seed + 0x6D2B79F5;\r\n        t = Math.imul(t ^ t >>> 15, t | 1);\r\n        t ^= t + Math.imul(t ^ t >>> 7, t | 61);\r\n        return ((t ^ t >>> 14) >>> 0) / 4294967296;\r\n    }\r\n\r\n    /** @type number */\r\n    #last;\r\n\r\n    constructor(seed) {\r\n        this.#last = seed;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @return {number} (0..1)\r\n     */\r\n    next() {\r\n        let t = this.#last += 0x6D2B79F5;\r\n        t = Math.imul(t ^ t >>> 15, t | 1);\r\n        t ^= t + Math.imul(t ^ t >>> 7, t | 61);\r\n        return ((t ^ t >>> 14) >>> 0) / 4294967296;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param max\r\n     * @return {number} <0..max)\r\n     */\r\n    nextInt(max) {\r\n        return Math.trunc(this.next() * max);\r\n    }\r\n\r\n    /**\r\n     * Generator state.\r\n     *\r\n     * @return {number} integer\r\n     */\r\n    getState() {\r\n        return this.#last;\r\n    }\r\n}\r\n","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport Element from \"../Element.js\";\r\nimport DeterministicRandom from \"../DeterministicRandom\";\r\n\r\n/**\r\n * @interface\r\n *\r\n * @author Patrik Harag\r\n * @version 2023-12-20\r\n */\r\nexport default class Brush {\r\n\r\n    /**\r\n     *\r\n     * @param x\r\n     * @param y\r\n     * @param random {DeterministicRandom}\r\n     * @param oldElement {Element}\r\n     * @return {Element}\r\n     */\r\n    apply(x, y, random = undefined, oldElement = undefined) {\r\n        throw 'Not implemented'\r\n    }\r\n}\r\n","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport DeterministicRandom from \"../DeterministicRandom\";\r\nimport Brush from \"./Brush\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-01-29\r\n */\r\nexport default class RandomBrush extends Brush {\r\n\r\n    /** @type Brush[] */\r\n    #list;\r\n\r\n    constructor(list) {\r\n        super();\r\n        this.#list = list;\r\n    }\r\n\r\n    apply(x, y, random, oldElement) {\r\n        if (this.#list.length > 1) {\r\n            const i = ((random) ? random : DeterministicRandom.DEFAULT).nextInt(this.#list.length);\r\n            const item = this.#list[i];\r\n            return item.apply(x, y, random, oldElement);\r\n        } else if (this.#list.length === 1) {\r\n            const item = this.#list[0];\r\n            return item.apply(x, y, random, oldElement);\r\n        } else {\r\n            return null;\r\n        }\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport DeterministicRandom from \"../DeterministicRandom\";\r\nimport Brush from \"./Brush\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-01-29\r\n */\r\nexport default class RandomElementBrush extends Brush {\r\n\r\n    /** @type Element[] */\r\n    #elements;\r\n\r\n    constructor(elements) {\r\n        super();\r\n        this.#elements = elements;\r\n    }\r\n\r\n    apply(x, y, random, oldElement) {\r\n        if (this.#elements.length > 1) {\r\n            const i = ((random) ? random : DeterministicRandom.DEFAULT).nextInt(this.#elements.length);\r\n            return this.#elements[i];\r\n        } else if (this.#elements.length === 1) {\r\n            return this.#elements[0];\r\n        } else {\r\n            return null;\r\n        }\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport Brush from \"./Brush\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-02-05\r\n */\r\nexport default class AbstractEffectBrush extends Brush {\r\n\r\n    /** @type Brush|undefined */\r\n    #innerBrush;\r\n    constructor(innerBrush) {\r\n        super();\r\n        this.#innerBrush = innerBrush;\r\n    }\r\n\r\n    _retrieveElement(x, y, random, oldElement) {\r\n        if (this.#innerBrush !== undefined) {\r\n            // use inner brush\r\n            return this.#innerBrush.apply(x, y, random);\r\n        } else {\r\n            // use old element\r\n            return oldElement;\r\n        }\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\n/**\r\n * Tools for working with the element tail.\r\n *\r\n * The element head structure: <code>0x[flags][red][green][blue]</code> (32b)\r\n * <pre>\r\n *     |            2b  | heat e.    2b  | burnt lvl  2b  | blur type  2b  |\r\n *     | color red                                                     8b  |\r\n *     | color green                                                   8b  |\r\n *     | color blue                                                    8b  |\r\n * </pre>\r\n *\r\n * @author Patrik Harag\r\n * @version 2023-12-04\r\n */\r\nexport default class ElementTail {\r\n\r\n    static BLUR_TYPE_NONE = 0x0;\r\n    /** This element acts as a background = blur can be applied over this element */\r\n    static BLUR_TYPE_BACKGROUND = 0x1;\r\n    static BLUR_TYPE_1 = 0x2;\r\n\r\n    static HEAT_EFFECT_NONE = 0x0;\r\n    static HEAT_EFFECT_1 = 0x1;\r\n    static HEAT_EFFECT_2 = 0x2;\r\n    static HEAT_EFFECT_3 = 0x3;\r\n\r\n    static of(r, g, b, blurType=ElementTail.BLUR_TYPE_NONE, heatEffect=0, burntLevel=0) {\r\n        let value = 0;\r\n        value = (value | (heatEffect & 0x03)) << 2;\r\n        value = (value | (burntLevel & 0x03)) << 2;\r\n        value = (value | (blurType & 0x03)) << 8;\r\n        value = (value | (r & 0xFF)) << 8;\r\n        value = (value | (g & 0xFF)) << 8;\r\n        value = value | (b & 0xFF);\r\n        return value;\r\n    }\r\n\r\n    static getColorRed(elementTail) {\r\n        return (elementTail >> 16) & 0x000000FF;\r\n    }\r\n\r\n    static getColorGreen(elementTail) {\r\n        return (elementTail >> 8) & 0x000000FF;\r\n    }\r\n\r\n    static getColorBlue(elementTail) {\r\n        return elementTail & 0x000000FF;\r\n    }\r\n\r\n    static getBlurType(elementTail) {\r\n        return (elementTail >> 24) & 0x00000003;\r\n    }\r\n\r\n    static getBurntLevel(elementTail) {\r\n        return (elementTail >> 26) & 0x00000003;\r\n    }\r\n\r\n    static getHeatEffect(elementTail) {\r\n        return (elementTail >> 28) & 0x00000003;\r\n    }\r\n\r\n    static setColor(elementTail, r, g, b) {\r\n        elementTail = (elementTail & ~(0x00FF0000)) | (r << 16);\r\n        elementTail = (elementTail & ~(0x0000FF00)) | (g << 8);\r\n        elementTail = (elementTail & ~(0x000000FF)) | (b);\r\n        return elementTail;\r\n    }\r\n\r\n    static setBlurType(elementTail, blurType) {\r\n        return (elementTail & 0xFCFFFFFF) | (blurType << 24);\r\n    }\r\n\r\n    static setBurntLevel(elementTail, burntLevel) {\r\n        return (elementTail & 0xF3FFFFFF) | (burntLevel << 26);\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport AbstractEffectBrush from \"./AbstractEffectBrush\";\r\nimport Element from \"../Element\";\r\nimport ElementTail from \"../ElementTail\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-02-05\r\n */\r\nexport default class ColorBrush extends AbstractEffectBrush {\r\n\r\n    #r; #g; #b;\r\n\r\n    constructor(r, g, b, innerBrush) {\r\n        super(innerBrush);\r\n        this.#r = r;\r\n        this.#g = g;\r\n        this.#b = b;\r\n    }\r\n\r\n    apply(x, y, random, oldElement) {\r\n        const element = this._retrieveElement(x, y, random, oldElement);\r\n\r\n        const newElementTail = ElementTail.setColor(element.elementTail, this.#r, this.#g, this.#b);\r\n        return new Element(element.elementHead, newElementTail);\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport AbstractEffectBrush from \"./AbstractEffectBrush\";\r\nimport DeterministicRandom from \"../DeterministicRandom\";\r\nimport ElementTail from \"../ElementTail\";\r\nimport Element from \"../Element\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-02-05\r\n */\r\nexport default class ColorPaletteRandomBrush extends AbstractEffectBrush {\r\n\r\n    /** @type number[][] */\r\n    #palette;\r\n\r\n    constructor(innerBrush, palette) {\r\n        super(innerBrush);\r\n        if (typeof palette === 'string') {\r\n            // parse\r\n            this.#palette = palette.split('\\n').map(line => line.split(',').map(Number));\r\n        } else {\r\n            this.#palette = palette;\r\n        }\r\n    }\r\n\r\n    apply(x, y, random, oldElement) {\r\n        const element = this._retrieveElement(x, y, random, oldElement);\r\n\r\n        const i = ((random) ? random : DeterministicRandom.DEFAULT).nextInt(this.#palette.length);\r\n        const [r, g, b] = this.#palette[i];\r\n\r\n        const newElementTail = ElementTail.setColor(element.elementTail, r, g, b);\r\n        return new Element(element.elementHead, newElementTail);\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2023-12-09\r\n */\r\nexport default class Assets {\r\n\r\n    /**\r\n     *\r\n     * @param base64\r\n     * @param maxWidth {number|undefined}\r\n     * @param maxHeight {number|undefined}\r\n     * @returns {Promise<ImageData>}\r\n     */\r\n    static asImageData(base64, maxWidth=undefined, maxHeight=undefined) {\r\n        function countSize(imageWidth, imageHeight) {\r\n            let w = imageWidth;\r\n            let h = imageHeight;\r\n\r\n            if (maxWidth !== undefined && w > maxWidth) {\r\n                const wScale = w / maxWidth;\r\n                w = maxWidth;\r\n                h = h / wScale;\r\n            }\r\n            if (maxHeight !== undefined && h > maxHeight) {\r\n                const hScale = h / maxHeight;\r\n                h = maxHeight;\r\n                w = w / hScale;\r\n            }\r\n\r\n            return [Math.trunc(w), Math.trunc(h)];\r\n        }\r\n\r\n        return new Promise((resolve, reject) => {\r\n            try {\r\n                // http://stackoverflow.com/questions/3528299/get-pixel-color-of-base64-png-using-javascript\r\n                let image = new Image();\r\n                image.onload = () => {\r\n                    let canvas = document.createElement('canvas');\r\n                    let [w, h] = countSize(image.width, image.height);\r\n                    canvas.width = w;\r\n                    canvas.height = h;\r\n\r\n                    let context = canvas.getContext('2d');\r\n                    context.drawImage(image, 0, 0, canvas.width, canvas.height);\r\n\r\n                    let imageData = context.getImageData(0, 0, canvas.width, canvas.height);\r\n                    resolve(imageData);\r\n                };\r\n                image.onerror = () => {\r\n                    reject('Cannot load image');\r\n                };\r\n                image.src = base64;\r\n            } catch (e) {\r\n                reject(e);\r\n            }\r\n        });\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport AbstractEffectBrush from \"./AbstractEffectBrush\";\r\nimport Assets from \"../../Assets\";\r\nimport ElementTail from \"../ElementTail\";\r\nimport Element from \"../Element\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-02-05\r\n */\r\nexport default class ColorTextureBrush extends AbstractEffectBrush {\r\n\r\n    /** @type ImageData|null */\r\n    #imageData = null;\r\n\r\n    constructor(innerBrush, base64) {\r\n        super(innerBrush);\r\n\r\n        Assets.asImageData(base64).then(imageData => this.#imageData = imageData);\r\n    }\r\n\r\n    apply(x, y, random, oldElement) {\r\n        const element = this._retrieveElement(x, y, random, oldElement);\r\n\r\n        if (this.#imageData != null) {\r\n            const cx = x % this.#imageData.width;\r\n            const cy = y % this.#imageData.height;\r\n            const index = (cy * this.#imageData.width + cx) * 4;\r\n\r\n            const red = this.#imageData.data[index];\r\n            const green = this.#imageData.data[index + 1];\r\n            const blue = this.#imageData.data[index + 2];\r\n            // const alpha = this.#imageData.data[index + 3];\r\n\r\n            const newElementTail = ElementTail.setColor(element.elementTail, red, green, blue);\r\n            return new Element(element.elementHead, newElementTail);\r\n\r\n        } else {\r\n            return element;\r\n        }\r\n    }\r\n}","/*\n * A fast javascript implementation of simplex noise by Jonas Wagner\n\nBased on a speed-improved simplex noise algorithm for 2D, 3D and 4D in Java.\nWhich is based on example code by Stefan Gustavson (stegu@itn.liu.se).\nWith Optimisations by Peter Eastman (peastman@drizzle.stanford.edu).\nBetter rank ordering method by Stefan Gustavson in 2012.\n\n Copyright (c) 2022 Jonas Wagner\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated documentation files (the \"Software\"), to deal\n in the Software without restriction, including without limitation the rights\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n copies of the Software, and to permit persons to whom the Software is\n furnished to do so, subject to the following conditions:\n\n The above copyright notice and this permission notice shall be included in all\n copies or substantial portions of the Software.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n SOFTWARE.\n */\n// these #__PURE__ comments help uglifyjs with dead code removal\n// \nconst F2 = /*#__PURE__*/ 0.5 * (Math.sqrt(3.0) - 1.0);\nconst G2 = /*#__PURE__*/ (3.0 - Math.sqrt(3.0)) / 6.0;\nconst F3 = 1.0 / 3.0;\nconst G3 = 1.0 / 6.0;\nconst F4 = /*#__PURE__*/ (Math.sqrt(5.0) - 1.0) / 4.0;\nconst G4 = /*#__PURE__*/ (5.0 - Math.sqrt(5.0)) / 20.0;\n// I'm really not sure why this | 0 (basically a coercion to int)\n// is making this faster but I get ~5 million ops/sec more on the\n// benchmarks across the board or a ~10% speedup.\nconst fastFloor = (x) => Math.floor(x) | 0;\nconst grad2 = /*#__PURE__*/ new Float64Array([1, 1,\n    -1, 1,\n    1, -1,\n    -1, -1,\n    1, 0,\n    -1, 0,\n    1, 0,\n    -1, 0,\n    0, 1,\n    0, -1,\n    0, 1,\n    0, -1]);\n// double seems to be faster than single or int's\n// probably because most operations are in double precision\nconst grad3 = /*#__PURE__*/ new Float64Array([1, 1, 0,\n    -1, 1, 0,\n    1, -1, 0,\n    -1, -1, 0,\n    1, 0, 1,\n    -1, 0, 1,\n    1, 0, -1,\n    -1, 0, -1,\n    0, 1, 1,\n    0, -1, 1,\n    0, 1, -1,\n    0, -1, -1]);\n// double is a bit quicker here as well\nconst grad4 = /*#__PURE__*/ new Float64Array([0, 1, 1, 1, 0, 1, 1, -1, 0, 1, -1, 1, 0, 1, -1, -1,\n    0, -1, 1, 1, 0, -1, 1, -1, 0, -1, -1, 1, 0, -1, -1, -1,\n    1, 0, 1, 1, 1, 0, 1, -1, 1, 0, -1, 1, 1, 0, -1, -1,\n    -1, 0, 1, 1, -1, 0, 1, -1, -1, 0, -1, 1, -1, 0, -1, -1,\n    1, 1, 0, 1, 1, 1, 0, -1, 1, -1, 0, 1, 1, -1, 0, -1,\n    -1, 1, 0, 1, -1, 1, 0, -1, -1, -1, 0, 1, -1, -1, 0, -1,\n    1, 1, 1, 0, 1, 1, -1, 0, 1, -1, 1, 0, 1, -1, -1, 0,\n    -1, 1, 1, 0, -1, 1, -1, 0, -1, -1, 1, 0, -1, -1, -1, 0]);\n/**\n * Creates a 2D noise function\n * @param random the random function that will be used to build the permutation table\n * @returns {NoiseFunction2D}\n */\nexport function createNoise2D(random = Math.random) {\n    const perm = buildPermutationTable(random);\n    // precalculating this yields a little ~3% performance improvement.\n    const permGrad2x = new Float64Array(perm).map(v => grad2[(v % 12) * 2]);\n    const permGrad2y = new Float64Array(perm).map(v => grad2[(v % 12) * 2 + 1]);\n    return function noise2D(x, y) {\n        // if(!isFinite(x) || !isFinite(y)) return 0;\n        let n0 = 0; // Noise contributions from the three corners\n        let n1 = 0;\n        let n2 = 0;\n        // Skew the input space to determine which simplex cell we're in\n        const s = (x + y) * F2; // Hairy factor for 2D\n        const i = fastFloor(x + s);\n        const j = fastFloor(y + s);\n        const t = (i + j) * G2;\n        const X0 = i - t; // Unskew the cell origin back to (x,y) space\n        const Y0 = j - t;\n        const x0 = x - X0; // The x,y distances from the cell origin\n        const y0 = y - Y0;\n        // For the 2D case, the simplex shape is an equilateral triangle.\n        // Determine which simplex we are in.\n        let i1, j1; // Offsets for second (middle) corner of simplex in (i,j) coords\n        if (x0 > y0) {\n            i1 = 1;\n            j1 = 0;\n        } // lower triangle, XY order: (0,0)->(1,0)->(1,1)\n        else {\n            i1 = 0;\n            j1 = 1;\n        } // upper triangle, YX order: (0,0)->(0,1)->(1,1)\n        // A step of (1,0) in (i,j) means a step of (1-c,-c) in (x,y), and\n        // a step of (0,1) in (i,j) means a step of (-c,1-c) in (x,y), where\n        // c = (3-sqrt(3))/6\n        const x1 = x0 - i1 + G2; // Offsets for middle corner in (x,y) unskewed coords\n        const y1 = y0 - j1 + G2;\n        const x2 = x0 - 1.0 + 2.0 * G2; // Offsets for last corner in (x,y) unskewed coords\n        const y2 = y0 - 1.0 + 2.0 * G2;\n        // Work out the hashed gradient indices of the three simplex corners\n        const ii = i & 255;\n        const jj = j & 255;\n        // Calculate the contribution from the three corners\n        let t0 = 0.5 - x0 * x0 - y0 * y0;\n        if (t0 >= 0) {\n            const gi0 = ii + perm[jj];\n            const g0x = permGrad2x[gi0];\n            const g0y = permGrad2y[gi0];\n            t0 *= t0;\n            // n0 = t0 * t0 * (grad2[gi0] * x0 + grad2[gi0 + 1] * y0); // (x,y) of grad3 used for 2D gradient\n            n0 = t0 * t0 * (g0x * x0 + g0y * y0);\n        }\n        let t1 = 0.5 - x1 * x1 - y1 * y1;\n        if (t1 >= 0) {\n            const gi1 = ii + i1 + perm[jj + j1];\n            const g1x = permGrad2x[gi1];\n            const g1y = permGrad2y[gi1];\n            t1 *= t1;\n            // n1 = t1 * t1 * (grad2[gi1] * x1 + grad2[gi1 + 1] * y1);\n            n1 = t1 * t1 * (g1x * x1 + g1y * y1);\n        }\n        let t2 = 0.5 - x2 * x2 - y2 * y2;\n        if (t2 >= 0) {\n            const gi2 = ii + 1 + perm[jj + 1];\n            const g2x = permGrad2x[gi2];\n            const g2y = permGrad2y[gi2];\n            t2 *= t2;\n            // n2 = t2 * t2 * (grad2[gi2] * x2 + grad2[gi2 + 1] * y2);\n            n2 = t2 * t2 * (g2x * x2 + g2y * y2);\n        }\n        // Add contributions from each corner to get the final noise value.\n        // The result is scaled to return values in the interval [-1,1].\n        return 70.0 * (n0 + n1 + n2);\n    };\n}\n/**\n * Creates a 3D noise function\n * @param random the random function that will be used to build the permutation table\n * @returns {NoiseFunction3D}\n */\nexport function createNoise3D(random = Math.random) {\n    const perm = buildPermutationTable(random);\n    // precalculating these seems to yield a speedup of over 15%\n    const permGrad3x = new Float64Array(perm).map(v => grad3[(v % 12) * 3]);\n    const permGrad3y = new Float64Array(perm).map(v => grad3[(v % 12) * 3 + 1]);\n    const permGrad3z = new Float64Array(perm).map(v => grad3[(v % 12) * 3 + 2]);\n    return function noise3D(x, y, z) {\n        let n0, n1, n2, n3; // Noise contributions from the four corners\n        // Skew the input space to determine which simplex cell we're in\n        const s = (x + y + z) * F3; // Very nice and simple skew factor for 3D\n        const i = fastFloor(x + s);\n        const j = fastFloor(y + s);\n        const k = fastFloor(z + s);\n        const t = (i + j + k) * G3;\n        const X0 = i - t; // Unskew the cell origin back to (x,y,z) space\n        const Y0 = j - t;\n        const Z0 = k - t;\n        const x0 = x - X0; // The x,y,z distances from the cell origin\n        const y0 = y - Y0;\n        const z0 = z - Z0;\n        // For the 3D case, the simplex shape is a slightly irregular tetrahedron.\n        // Determine which simplex we are in.\n        let i1, j1, k1; // Offsets for second corner of simplex in (i,j,k) coords\n        let i2, j2, k2; // Offsets for third corner of simplex in (i,j,k) coords\n        if (x0 >= y0) {\n            if (y0 >= z0) {\n                i1 = 1;\n                j1 = 0;\n                k1 = 0;\n                i2 = 1;\n                j2 = 1;\n                k2 = 0;\n            } // X Y Z order\n            else if (x0 >= z0) {\n                i1 = 1;\n                j1 = 0;\n                k1 = 0;\n                i2 = 1;\n                j2 = 0;\n                k2 = 1;\n            } // X Z Y order\n            else {\n                i1 = 0;\n                j1 = 0;\n                k1 = 1;\n                i2 = 1;\n                j2 = 0;\n                k2 = 1;\n            } // Z X Y order\n        }\n        else { // x0<y0\n            if (y0 < z0) {\n                i1 = 0;\n                j1 = 0;\n                k1 = 1;\n                i2 = 0;\n                j2 = 1;\n                k2 = 1;\n            } // Z Y X order\n            else if (x0 < z0) {\n                i1 = 0;\n                j1 = 1;\n                k1 = 0;\n                i2 = 0;\n                j2 = 1;\n                k2 = 1;\n            } // Y Z X order\n            else {\n                i1 = 0;\n                j1 = 1;\n                k1 = 0;\n                i2 = 1;\n                j2 = 1;\n                k2 = 0;\n            } // Y X Z order\n        }\n        // A step of (1,0,0) in (i,j,k) means a step of (1-c,-c,-c) in (x,y,z),\n        // a step of (0,1,0) in (i,j,k) means a step of (-c,1-c,-c) in (x,y,z), and\n        // a step of (0,0,1) in (i,j,k) means a step of (-c,-c,1-c) in (x,y,z), where\n        // c = 1/6.\n        const x1 = x0 - i1 + G3; // Offsets for second corner in (x,y,z) coords\n        const y1 = y0 - j1 + G3;\n        const z1 = z0 - k1 + G3;\n        const x2 = x0 - i2 + 2.0 * G3; // Offsets for third corner in (x,y,z) coords\n        const y2 = y0 - j2 + 2.0 * G3;\n        const z2 = z0 - k2 + 2.0 * G3;\n        const x3 = x0 - 1.0 + 3.0 * G3; // Offsets for last corner in (x,y,z) coords\n        const y3 = y0 - 1.0 + 3.0 * G3;\n        const z3 = z0 - 1.0 + 3.0 * G3;\n        // Work out the hashed gradient indices of the four simplex corners\n        const ii = i & 255;\n        const jj = j & 255;\n        const kk = k & 255;\n        // Calculate the contribution from the four corners\n        let t0 = 0.6 - x0 * x0 - y0 * y0 - z0 * z0;\n        if (t0 < 0)\n            n0 = 0.0;\n        else {\n            const gi0 = ii + perm[jj + perm[kk]];\n            t0 *= t0;\n            n0 = t0 * t0 * (permGrad3x[gi0] * x0 + permGrad3y[gi0] * y0 + permGrad3z[gi0] * z0);\n        }\n        let t1 = 0.6 - x1 * x1 - y1 * y1 - z1 * z1;\n        if (t1 < 0)\n            n1 = 0.0;\n        else {\n            const gi1 = ii + i1 + perm[jj + j1 + perm[kk + k1]];\n            t1 *= t1;\n            n1 = t1 * t1 * (permGrad3x[gi1] * x1 + permGrad3y[gi1] * y1 + permGrad3z[gi1] * z1);\n        }\n        let t2 = 0.6 - x2 * x2 - y2 * y2 - z2 * z2;\n        if (t2 < 0)\n            n2 = 0.0;\n        else {\n            const gi2 = ii + i2 + perm[jj + j2 + perm[kk + k2]];\n            t2 *= t2;\n            n2 = t2 * t2 * (permGrad3x[gi2] * x2 + permGrad3y[gi2] * y2 + permGrad3z[gi2] * z2);\n        }\n        let t3 = 0.6 - x3 * x3 - y3 * y3 - z3 * z3;\n        if (t3 < 0)\n            n3 = 0.0;\n        else {\n            const gi3 = ii + 1 + perm[jj + 1 + perm[kk + 1]];\n            t3 *= t3;\n            n3 = t3 * t3 * (permGrad3x[gi3] * x3 + permGrad3y[gi3] * y3 + permGrad3z[gi3] * z3);\n        }\n        // Add contributions from each corner to get the final noise value.\n        // The result is scaled to stay just inside [-1,1]\n        return 32.0 * (n0 + n1 + n2 + n3);\n    };\n}\n/**\n * Creates a 4D noise function\n * @param random the random function that will be used to build the permutation table\n * @returns {NoiseFunction4D}\n */\nexport function createNoise4D(random = Math.random) {\n    const perm = buildPermutationTable(random);\n    // precalculating these leads to a ~10% speedup\n    const permGrad4x = new Float64Array(perm).map(v => grad4[(v % 32) * 4]);\n    const permGrad4y = new Float64Array(perm).map(v => grad4[(v % 32) * 4 + 1]);\n    const permGrad4z = new Float64Array(perm).map(v => grad4[(v % 32) * 4 + 2]);\n    const permGrad4w = new Float64Array(perm).map(v => grad4[(v % 32) * 4 + 3]);\n    return function noise4D(x, y, z, w) {\n        let n0, n1, n2, n3, n4; // Noise contributions from the five corners\n        // Skew the (x,y,z,w) space to determine which cell of 24 simplices we're in\n        const s = (x + y + z + w) * F4; // Factor for 4D skewing\n        const i = fastFloor(x + s);\n        const j = fastFloor(y + s);\n        const k = fastFloor(z + s);\n        const l = fastFloor(w + s);\n        const t = (i + j + k + l) * G4; // Factor for 4D unskewing\n        const X0 = i - t; // Unskew the cell origin back to (x,y,z,w) space\n        const Y0 = j - t;\n        const Z0 = k - t;\n        const W0 = l - t;\n        const x0 = x - X0; // The x,y,z,w distances from the cell origin\n        const y0 = y - Y0;\n        const z0 = z - Z0;\n        const w0 = w - W0;\n        // For the 4D case, the simplex is a 4D shape I won't even try to describe.\n        // To find out which of the 24 possible simplices we're in, we need to\n        // determine the magnitude ordering of x0, y0, z0 and w0.\n        // Six pair-wise comparisons are performed between each possible pair\n        // of the four coordinates, and the results are used to rank the numbers.\n        let rankx = 0;\n        let ranky = 0;\n        let rankz = 0;\n        let rankw = 0;\n        if (x0 > y0)\n            rankx++;\n        else\n            ranky++;\n        if (x0 > z0)\n            rankx++;\n        else\n            rankz++;\n        if (x0 > w0)\n            rankx++;\n        else\n            rankw++;\n        if (y0 > z0)\n            ranky++;\n        else\n            rankz++;\n        if (y0 > w0)\n            ranky++;\n        else\n            rankw++;\n        if (z0 > w0)\n            rankz++;\n        else\n            rankw++;\n        // simplex[c] is a 4-vector with the numbers 0, 1, 2 and 3 in some order.\n        // Many values of c will never occur, since e.g. x>y>z>w makes x<z, y<w and x<w\n        // impossible. Only the 24 indices which have non-zero entries make any sense.\n        // We use a thresholding to set the coordinates in turn from the largest magnitude.\n        // Rank 3 denotes the largest coordinate.\n        // Rank 2 denotes the second largest coordinate.\n        // Rank 1 denotes the second smallest coordinate.\n        // The integer offsets for the second simplex corner\n        const i1 = rankx >= 3 ? 1 : 0;\n        const j1 = ranky >= 3 ? 1 : 0;\n        const k1 = rankz >= 3 ? 1 : 0;\n        const l1 = rankw >= 3 ? 1 : 0;\n        // The integer offsets for the third simplex corner\n        const i2 = rankx >= 2 ? 1 : 0;\n        const j2 = ranky >= 2 ? 1 : 0;\n        const k2 = rankz >= 2 ? 1 : 0;\n        const l2 = rankw >= 2 ? 1 : 0;\n        // The integer offsets for the fourth simplex corner\n        const i3 = rankx >= 1 ? 1 : 0;\n        const j3 = ranky >= 1 ? 1 : 0;\n        const k3 = rankz >= 1 ? 1 : 0;\n        const l3 = rankw >= 1 ? 1 : 0;\n        // The fifth corner has all coordinate offsets = 1, so no need to compute that.\n        const x1 = x0 - i1 + G4; // Offsets for second corner in (x,y,z,w) coords\n        const y1 = y0 - j1 + G4;\n        const z1 = z0 - k1 + G4;\n        const w1 = w0 - l1 + G4;\n        const x2 = x0 - i2 + 2.0 * G4; // Offsets for third corner in (x,y,z,w) coords\n        const y2 = y0 - j2 + 2.0 * G4;\n        const z2 = z0 - k2 + 2.0 * G4;\n        const w2 = w0 - l2 + 2.0 * G4;\n        const x3 = x0 - i3 + 3.0 * G4; // Offsets for fourth corner in (x,y,z,w) coords\n        const y3 = y0 - j3 + 3.0 * G4;\n        const z3 = z0 - k3 + 3.0 * G4;\n        const w3 = w0 - l3 + 3.0 * G4;\n        const x4 = x0 - 1.0 + 4.0 * G4; // Offsets for last corner in (x,y,z,w) coords\n        const y4 = y0 - 1.0 + 4.0 * G4;\n        const z4 = z0 - 1.0 + 4.0 * G4;\n        const w4 = w0 - 1.0 + 4.0 * G4;\n        // Work out the hashed gradient indices of the five simplex corners\n        const ii = i & 255;\n        const jj = j & 255;\n        const kk = k & 255;\n        const ll = l & 255;\n        // Calculate the contribution from the five corners\n        let t0 = 0.6 - x0 * x0 - y0 * y0 - z0 * z0 - w0 * w0;\n        if (t0 < 0)\n            n0 = 0.0;\n        else {\n            const gi0 = ii + perm[jj + perm[kk + perm[ll]]];\n            t0 *= t0;\n            n0 = t0 * t0 * (permGrad4x[gi0] * x0 + permGrad4y[gi0] * y0 + permGrad4z[gi0] * z0 + permGrad4w[gi0] * w0);\n        }\n        let t1 = 0.6 - x1 * x1 - y1 * y1 - z1 * z1 - w1 * w1;\n        if (t1 < 0)\n            n1 = 0.0;\n        else {\n            const gi1 = ii + i1 + perm[jj + j1 + perm[kk + k1 + perm[ll + l1]]];\n            t1 *= t1;\n            n1 = t1 * t1 * (permGrad4x[gi1] * x1 + permGrad4y[gi1] * y1 + permGrad4z[gi1] * z1 + permGrad4w[gi1] * w1);\n        }\n        let t2 = 0.6 - x2 * x2 - y2 * y2 - z2 * z2 - w2 * w2;\n        if (t2 < 0)\n            n2 = 0.0;\n        else {\n            const gi2 = ii + i2 + perm[jj + j2 + perm[kk + k2 + perm[ll + l2]]];\n            t2 *= t2;\n            n2 = t2 * t2 * (permGrad4x[gi2] * x2 + permGrad4y[gi2] * y2 + permGrad4z[gi2] * z2 + permGrad4w[gi2] * w2);\n        }\n        let t3 = 0.6 - x3 * x3 - y3 * y3 - z3 * z3 - w3 * w3;\n        if (t3 < 0)\n            n3 = 0.0;\n        else {\n            const gi3 = ii + i3 + perm[jj + j3 + perm[kk + k3 + perm[ll + l3]]];\n            t3 *= t3;\n            n3 = t3 * t3 * (permGrad4x[gi3] * x3 + permGrad4y[gi3] * y3 + permGrad4z[gi3] * z3 + permGrad4w[gi3] * w3);\n        }\n        let t4 = 0.6 - x4 * x4 - y4 * y4 - z4 * z4 - w4 * w4;\n        if (t4 < 0)\n            n4 = 0.0;\n        else {\n            const gi4 = ii + 1 + perm[jj + 1 + perm[kk + 1 + perm[ll + 1]]];\n            t4 *= t4;\n            n4 = t4 * t4 * (permGrad4x[gi4] * x4 + permGrad4y[gi4] * y4 + permGrad4z[gi4] * z4 + permGrad4w[gi4] * w4);\n        }\n        // Sum up and scale the result to cover the range [-1,1]\n        return 27.0 * (n0 + n1 + n2 + n3 + n4);\n    };\n}\n/**\n * Builds a random permutation table.\n * This is exported only for (internal) testing purposes.\n * Do not rely on this export.\n * @private\n */\nexport function buildPermutationTable(random) {\n    const tableSize = 512;\n    const p = new Uint8Array(tableSize);\n    for (let i = 0; i < tableSize / 2; i++) {\n        p[i] = i;\n    }\n    for (let i = 0; i < tableSize / 2 - 1; i++) {\n        const r = i + ~~(random() * (256 - i));\n        const aux = p[i];\n        p[i] = p[r];\n        p[r] = aux;\n    }\n    for (let i = 256; i < tableSize; i++) {\n        p[i] = p[i - 256];\n    }\n    return p;\n}\n//# sourceMappingURL=simplex-noise.js.map","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport ElementTail from \"../ElementTail.js\";\r\nimport ElementHead from \"../ElementHead.js\";\r\nimport {createNoise2D} from \"simplex-noise\";\r\nimport DeterministicRandom from \"../DeterministicRandom\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-02-06\r\n */\r\nexport default class VisualEffects {\r\n\r\n    static isVisualBurnApplicable(elementHead) {\r\n        const type = ElementHead.getTypeClass(elementHead);\r\n        return type > ElementHead.TYPE_FLUID || type === ElementHead.TYPE_POWDER_FLOATING;\r\n    }\r\n\r\n    static visualBurn(elementTail, force = 1, maxBurntLevel = 3) {\r\n        const burntLevel = ElementTail.getBurntLevel(elementTail);\r\n        if (burntLevel >= 3) {\r\n            return elementTail;\r\n        }\r\n\r\n        let newTail = elementTail;\r\n\r\n        let newBurntLevel = burntLevel + force;\r\n        newBurntLevel = Math.min(newBurntLevel, maxBurntLevel);\r\n        newBurntLevel = Math.max(newBurntLevel, 0);\r\n\r\n        const appliedForce = newBurntLevel - burntLevel;\r\n        if (appliedForce > 0) {\r\n            newTail = ElementTail.setBurntLevel(newTail, newBurntLevel);\r\n\r\n            let red = ElementTail.getColorRed(elementTail);\r\n            let green = ElementTail.getColorGreen(elementTail);\r\n            let blue = ElementTail.getColorBlue(elementTail);\r\n\r\n            let divisor = 1.8 - (Math.random() * 0.5);\r\n            if (appliedForce > 1) {\r\n                divisor = divisor * (1.8 - (Math.random() * 0.5));\r\n            }\r\n            if (appliedForce > 2) {\r\n                divisor = divisor * (1.8 - (Math.random() * 0.5));\r\n            }\r\n\r\n            red = Math.trunc(red / divisor);\r\n            green = Math.trunc(green / divisor);\r\n            blue = Math.trunc(blue / divisor);\r\n\r\n            newTail = ElementTail.setColor(newTail, red, green, blue);\r\n        }\r\n\r\n        return newTail;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param seed {number|number[]|null}\r\n     * @returns {PerlinNoiseVisualEffect}\r\n     */\r\n    static visualNoiseProvider(seed = 0) {\r\n        if (Array.isArray(seed)) {\r\n            const instances = seed.map(s => {\r\n                const random = new DeterministicRandom(s);\r\n                return createNoise2D(() => random.next());\r\n            });\r\n            return new PerlinNoiseVisualEffect(instances);\r\n        } else {\r\n            const random = new DeterministicRandom(seed);\r\n            const noise2D = createNoise2D(() => random.next());\r\n            return new PerlinNoiseVisualEffect([noise2D]);\r\n        }\r\n    }\r\n}\r\n\r\nclass PerlinNoiseVisualEffect {\r\n    #noise2DInstances;\r\n\r\n    constructor(noise2DInstances) {\r\n        this.#noise2DInstances = noise2DInstances;\r\n    }\r\n\r\n    visualNoise(elementTail, x, y, factor = 1, threshold = 0.5, force = 0.1,\r\n                nr = 0x00, ng = 0x00, nb = 0x00) {\r\n\r\n        const nose2D = this.#noise2DInstances[0];\r\n\r\n        let value = (nose2D(x / factor, y / factor) + 1) / 2;  // 0..1\r\n\r\n        // apply threshold\r\n\r\n        if (value < threshold) {\r\n            return elementTail;\r\n        }\r\n        value = (value - threshold) * (1 / (1 - threshold));  // normalized 0..1\r\n\r\n        // alpha blending\r\n\r\n        const alpha = 1 - (value * force);\r\n\r\n        let r = ElementTail.getColorRed(elementTail);\r\n        let g = ElementTail.getColorGreen(elementTail);\r\n        let b = ElementTail.getColorBlue(elementTail);\r\n\r\n        r = Math.trunc(r * alpha) + (nr * (1 - alpha));\r\n        g = Math.trunc(g * alpha) + (ng * (1 - alpha));\r\n        b = Math.trunc(b * alpha) + (nb * (1 - alpha));\r\n\r\n        return ElementTail.setColor(elementTail, r, g, b);\r\n    }\r\n\r\n    visualNoiseCombined(elementTail, x, y, coefficientList,\r\n                nr = 0x00, ng = 0x00, nb = 0x00) {\r\n\r\n        let result = 0;\r\n        for (let i = 0; i < coefficientList.length; i++) {\r\n            const { factor, threshold, force } = coefficientList[i];\r\n            const instance = this.#noise2DInstances[i % this.#noise2DInstances.length];\r\n\r\n            // apply factor and count value\r\n            let value = (instance(x / factor, y / factor) + 1) / 2;  // 0..1\r\n\r\n            // apply threshold\r\n            if (value < threshold) {\r\n                value = 0;\r\n            } else {\r\n                value = (value - threshold) * (1 / (1 - threshold));  // normalized 0..1\r\n\r\n                // apply force\r\n                value = value * force;\r\n\r\n                result += value;\r\n            }\r\n        }\r\n        result = Math.min(result, 1);\r\n\r\n        // alpha blending\r\n\r\n        const alpha = 1 - (result);\r\n\r\n        let r = ElementTail.getColorRed(elementTail);\r\n        let g = ElementTail.getColorGreen(elementTail);\r\n        let b = ElementTail.getColorBlue(elementTail);\r\n\r\n        r = Math.trunc(r * alpha) + (nr * (1 - alpha));\r\n        g = Math.trunc(g * alpha) + (ng * (1 - alpha));\r\n        b = Math.trunc(b * alpha) + (nb * (1 - alpha));\r\n\r\n        return ElementTail.setColor(elementTail, r, g, b);\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport AbstractEffectBrush from \"./AbstractEffectBrush\";\r\nimport Element from \"../Element\";\r\nimport VisualEffects from \"../processing/VisualEffects\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-02-06\r\n */\r\nexport default class ColorNoiseBrush extends AbstractEffectBrush {\r\n\r\n    #r; #g; #b;\r\n\r\n    /**\r\n     * @type {object|object[]}\r\n     */\r\n    #coefficients;\r\n\r\n    #noise;\r\n\r\n    constructor(innerBrush, coefficients, r, g, b) {\r\n        super(innerBrush);\r\n        this.#coefficients = coefficients;\r\n        this.#r = r;\r\n        this.#g = g;\r\n        this.#b = b;\r\n        if (Array.isArray(coefficients)) {\r\n            this.#noise = VisualEffects.visualNoiseProvider(coefficients.map(c => c.seed));\r\n        } else {\r\n            this.#noise = VisualEffects.visualNoiseProvider(coefficients.seed);\r\n        }\r\n    }\r\n\r\n    apply(x, y, random, oldElement) {\r\n        const element = this._retrieveElement(x, y, random, oldElement);\r\n\r\n        const coefficients = this.#coefficients;\r\n        const r = this.#r;  // it could be null...\r\n        const g = this.#g;\r\n        const b = this.#b;\r\n\r\n        let newElementTail;\r\n        if (Array.isArray(coefficients)) {\r\n            newElementTail = this.#noise.visualNoiseCombined(element.elementTail, x, y, coefficients, r, g, b);\r\n        } else {\r\n            const factor = coefficients.factor;  // it could be null...\r\n            const threshold = coefficients.threshold;\r\n            const force = coefficients.force;\r\n            newElementTail = this.#noise.visualNoise(element.elementTail, x, y, factor, threshold, force, r, g, b);\r\n        }\r\n        return new Element(element.elementHead, newElementTail);\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport AbstractEffectBrush from \"./AbstractEffectBrush\";\r\nimport ElementTail from \"../ElementTail\";\r\nimport Element from \"../Element\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-03-12\r\n */\r\nexport default class ColorMovingPaletteBrush extends AbstractEffectBrush {\r\n\r\n    /** @type number[][] */\r\n    #palette;\r\n\r\n    /** @type number */\r\n    #stepSize;\r\n\r\n    #i = 0;\r\n    #direction = 1;\r\n    #current = 0;\r\n\r\n    constructor(innerBrush, palette, stepSize) {\r\n        super(innerBrush);\r\n        this.#palette = palette;\r\n        this.#stepSize = stepSize;\r\n    }\r\n\r\n    apply(x, y, random, oldElement) {\r\n        const element = this._retrieveElement(x, y, random, oldElement);\r\n\r\n        if (this.#palette.length === 0) {\r\n            return element;\r\n        }\r\n\r\n        // retrieve current color\r\n        const [r, g, b] = this.#palette[this.#i];\r\n\r\n        if (this.#palette.length > 1) {\r\n            // count next index\r\n            this.#current += 1;\r\n            if (this.#current >= this.#stepSize) {\r\n                this.#current = 0;\r\n                this.#i += this.#direction;\r\n                if (this.#i < 0) {\r\n                    // switch direction\r\n                    this.#direction = 1;\r\n                    this.#i = 1;\r\n                } else if (this.#i >= this.#palette.length) {\r\n                    // switch direction\r\n                    this.#direction = -1;\r\n                    this.#i = this.#palette.length - 2;\r\n                }\r\n            }\r\n        }\r\n\r\n        const newElementTail = ElementTail.setColor(element.elementTail, r, g, b);\r\n        return new Element(element.elementHead, newElementTail);\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport AbstractEffectBrush from \"./AbstractEffectBrush\";\r\nimport Element from \"../Element\";\r\nimport ElementTail from \"../ElementTail\";\r\n\r\n/**\r\n * This brush provides a bit of randomness to element colors.\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-03-12\r\n */\r\nexport default class ColorRandomize extends AbstractEffectBrush {\r\n\r\n    #maxDiff;\r\n\r\n    constructor(innerBrush, maxDiff) {\r\n        super(innerBrush);\r\n        this.#maxDiff = maxDiff;\r\n    }\r\n\r\n    apply(x, y, random, oldElement) {\r\n        const element = this._retrieveElement(x, y, random, oldElement);\r\n\r\n        let r = ElementTail.getColorRed(element.elementTail);\r\n        let g = ElementTail.getColorGreen(element.elementTail);\r\n        let b = ElementTail.getColorBlue(element.elementTail);\r\n\r\n        r += random.nextInt(this.#maxDiff) * (random.nextInt(2) === 0 ? 1 : -1);\r\n        g += random.nextInt(this.#maxDiff) * (random.nextInt(2) === 0 ? 1 : -1);\r\n        b += random.nextInt(this.#maxDiff) * (random.nextInt(2) === 0 ? 1 : -1);\r\n\r\n        r = Math.max(0, Math.min(255, r));\r\n        g = Math.max(0, Math.min(255, g));\r\n        b = Math.max(0, Math.min(255, b));\r\n\r\n        const newElementTail = ElementTail.setColor(element.elementTail, r, g, b);\r\n        return new Element(element.elementHead, newElementTail);\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport Brush from \"./Brush\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2023-02-20\r\n */\r\nexport default class CustomBrush extends Brush {\r\n\r\n    /** @type function(x: number, y: number, random: DeterministicRandom, oldElement: Element) */\r\n    #func;\r\n\r\n    constructor(func) {\r\n        super();\r\n        this.#func = func;\r\n    }\r\n\r\n    apply(x, y, random, oldElement) {\r\n        return this.#func(x, y, random, oldElement);\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport Brush from \"./Brush\";\r\n\r\n/**\r\n * Special brush for counting elements.\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-01-10\r\n */\r\nexport default class CountingBrush extends Brush {\r\n\r\n    static #NULL_REDICATE = function (elementHead, elementTail) {\r\n        return false;\r\n    };\r\n\r\n    #predicate;\r\n\r\n    #counterPositives = 0;\r\n    #counterTotal = 0;\r\n\r\n    /**\r\n     *\r\n     * @param predicate {function(number:elementHead, number:elementTail):boolean}\r\n     */\r\n    constructor(predicate = CountingBrush.#NULL_REDICATE) {\r\n        super();\r\n        this.#predicate = predicate;\r\n    }\r\n\r\n    apply(x, y, random, oldElement) {\r\n        this.#counterTotal++;\r\n        if (oldElement !== null) {\r\n            if (this.#predicate(oldElement.elementHead, oldElement.elementTail)) {\r\n                this.#counterPositives++;\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n\r\n    getPositives() {\r\n        return this.#counterPositives;\r\n    }\r\n\r\n    getTotal() {\r\n        return this.#counterTotal;\r\n    }\r\n\r\n    reset() {\r\n        this.#counterTotal = 0;\r\n        this.#counterPositives = 0;\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport ElementHead from \"../core/ElementHead\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-04-27\r\n */\r\nexport default class PredicateDefs {\r\n\r\n    static and(predicateA, predicateB) {\r\n        return function (elementHead, elementTail) {\r\n            return predicateA(elementHead, elementTail) && predicateB(elementHead, elementTail);\r\n        };\r\n    }\r\n\r\n    static or(predicateA, predicateB) {\r\n        return function (elementHead, elementTail) {\r\n            return predicateA(elementHead, elementTail) || predicateB(elementHead, elementTail);\r\n        };\r\n    }\r\n\r\n    static not(predicate) {\r\n        return function (elementHead, elementTail) {\r\n            return !predicate(elementHead, elementTail);\r\n        };\r\n    }\r\n\r\n    /** @type {function(elementHead:number, elementTail:number):boolean} */\r\n    static TRUE = function (elementHead, elementTail) {\r\n        return true;\r\n    };\r\n\r\n    /** @type {function(elementHead:number, elementTail:number):boolean} */\r\n    static IS_AIR = function (elementHead, elementTail) {\r\n        return ElementHead.getTypeClass(elementHead) === ElementHead.TYPE_AIR;\r\n    };\r\n\r\n    /** @type {function(elementHead:number, elementTail:number):boolean} */\r\n    static IS_EFFECT = function (elementHead, elementTail) {\r\n        return ElementHead.getTypeClass(elementHead) === ElementHead.TYPE_EFFECT;\r\n    };\r\n\r\n    /** @type {function(elementHead:number, elementTail:number):boolean} */\r\n    static IS_GAS = function (elementHead, elementTail) {\r\n        return ElementHead.getTypeClass(elementHead) === ElementHead.TYPE_GAS;\r\n    };\r\n\r\n    /** @type {function(elementHead:number, elementTail:number):boolean} */\r\n    static IS_FLUID = function (elementHead, elementTail) {\r\n        return ElementHead.getTypeClass(elementHead) === ElementHead.TYPE_FLUID;\r\n    };\r\n\r\n    /** @type {function(elementHead:number, elementTail:number):boolean} */\r\n    static IS_WATER = function (elementHead, elementTail) {\r\n        // TODO\r\n        return ElementHead.getBehaviour(elementHead) === ElementHead.BEHAVIOUR_LIQUID\r\n            && ElementHead.getTypeClass(elementHead) === ElementHead.TYPE_FLUID;\r\n    };\r\n\r\n    /** @type {function(elementHead:number, elementTail:number):boolean} */\r\n    static IS_POWDER = function (elementHead, elementTail) {\r\n        const typeClass = ElementHead.getTypeClass(elementHead);\r\n        return typeClass === ElementHead.TYPE_POWDER\r\n            || typeClass === ElementHead.TYPE_POWDER_FLOATING\r\n            || typeClass === ElementHead.TYPE_POWDER_WET;\r\n    };\r\n\r\n    /** @type {function(elementHead:number, elementTail:number):boolean} */\r\n    static IS_SAND = function (elementHead, elementTail) {\r\n        if (PredicateDefs.IS_POWDER(elementHead, elementTail)) {\r\n            return ElementHead.getBehaviour(elementHead) === 0\r\n                && ElementHead.getTypeModifierPowderMomentum(elementHead) === 6;\r\n        }\r\n        return false;\r\n    };\r\n\r\n    /** @type {function(elementHead:number, elementTail:number):boolean} */\r\n    static IS_SOIL = function (elementHead, elementTail) {\r\n        if (PredicateDefs.IS_POWDER(elementHead, elementTail)) {\r\n            const behaviour = ElementHead.getBehaviour(elementHead);\r\n            return behaviour === ElementHead.BEHAVIOUR_SOIL;\r\n        }\r\n        return false;\r\n    };\r\n\r\n    /** @type {function(elementHead:number, elementTail:number):boolean} */\r\n    static IS_GRAVEL = function (elementHead, elementTail) {\r\n        if (PredicateDefs.IS_POWDER(elementHead, elementTail)) {\r\n            return ElementHead.getBehaviour(elementHead) === 0\r\n                && ElementHead.getTypeModifierPowderMomentum(elementHead) === 3;\r\n        }\r\n        return false;\r\n    };\r\n\r\n    /** @type {function(elementHead:number, elementTail:number):boolean} */\r\n    static IS_STATIC = function (elementHead, elementTail) {\r\n        return ElementHead.getTypeClass(elementHead) === ElementHead.TYPE_STATIC;\r\n    };\r\n\r\n    /** @type {function(elementHead:number, elementTail:number):boolean} */\r\n    static IS_SOLID_BODY = function (elementHead, elementTail) {\r\n        return ElementHead.getTypeClass(elementHead) === ElementHead.TYPE_STATIC\r\n            && ElementHead.getTypeModifierSolidBodyId(elementHead) > 0;\r\n    };\r\n\r\n    /** @type {function(elementHead:number, elementTail:number):boolean} */\r\n    static IS_ENTITY = function (elementHead, elementTail) {\r\n        return ElementHead.getBehaviour(elementHead) === ElementHead.BEHAVIOUR_ENTITY;\r\n    };\r\n\r\n    /** @type {function(elementHead:number, elementTail:number):boolean} */\r\n    static IS_BIOMASS = function (elementHead, elementTail) {\r\n        const behaviour = ElementHead.getBehaviour(elementHead);\r\n        return behaviour === ElementHead.BEHAVIOUR_GRASS\r\n            || behaviour === ElementHead.BEHAVIOUR_TREE\r\n            || behaviour === ElementHead.BEHAVIOUR_TREE_LEAF\r\n            || behaviour === ElementHead.BEHAVIOUR_TREE_TRUNK\r\n            || behaviour === ElementHead.BEHAVIOUR_TREE_ROOT\r\n            || behaviour === ElementHead.BEHAVIOUR_ENTITY;\r\n    };\r\n\r\n    /** @type {function(elementHead:number, elementTail:number):boolean} */\r\n    static IS_TREE_PART = function (elementHead, elementTail) {\r\n        const behaviour = ElementHead.getBehaviour(elementHead);\r\n        return behaviour === ElementHead.BEHAVIOUR_TREE\r\n            || behaviour === ElementHead.BEHAVIOUR_TREE_LEAF\r\n            || behaviour === ElementHead.BEHAVIOUR_TREE_TRUNK\r\n            || behaviour === ElementHead.BEHAVIOUR_TREE_ROOT;\r\n    };\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport ElementHead from \"../ElementHead\";\r\nimport ElementTail from \"../ElementTail\";\r\nimport Element from \"../Element\";\r\nimport AbstractEffectBrush from \"./AbstractEffectBrush\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-04-07\r\n */\r\nexport default class MeltingBrush extends AbstractEffectBrush {\r\n\r\n    constructor(innerBrush) {\r\n        super(innerBrush);\r\n    }\r\n\r\n    apply(x, y, random, oldElement) {\r\n        const element = this._retrieveElement(x, y, random, oldElement);\r\n        if (element === null) {\r\n            return null;\r\n        }\r\n\r\n        const heatModIndex = ElementHead.getHeatModIndex(element.elementHead);\r\n        if (ElementHead.hmiToMeltingTemperature(heatModIndex) < (1 << ElementHead.FIELD_TEMPERATURE_SIZE)) {\r\n            let newElementHead = element.elementHead;\r\n            newElementHead = ElementHead.setHeatModIndex(newElementHead, ElementHead.hmiToMeltingHMI(heatModIndex));\r\n            newElementHead = ElementHead.setType(newElementHead, ElementHead.TYPE_FLUID);\r\n\r\n            let newElementTail = ElementTail.setBlurType(element.elementTail, ElementTail.BLUR_TYPE_1);\r\n\r\n            return new Element(newElementHead, newElementTail);\r\n        }\r\n        return element;\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport AbstractEffectBrush from \"./AbstractEffectBrush\";\r\nimport Element from \"../Element\";\r\nimport ElementHead from \"../ElementHead\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-03-23\r\n */\r\nexport default class SolidBodyBrush extends AbstractEffectBrush {\r\n\r\n    #solidBodyId;\r\n    #extendedNeighbourhood;\r\n\r\n    constructor(solidBodyId, extendedNeighbourhood, innerBrush) {\r\n        super(innerBrush);\r\n        this.#solidBodyId = solidBodyId;\r\n        this.#extendedNeighbourhood = extendedNeighbourhood;\r\n    }\r\n\r\n    apply(x, y, random, oldElement) {\r\n        const element = this._retrieveElement(x, y, random, oldElement);\r\n\r\n        let elementHead = element.elementHead;\r\n        const newType = ElementHead.type8Solid(ElementHead.TYPE_STATIC, this.#solidBodyId, this.#extendedNeighbourhood);\r\n        elementHead = ElementHead.setType(elementHead, newType);\r\n        return new Element(elementHead, element.elementTail);\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport Element from \"../Element\";\r\nimport ElementHead from \"../ElementHead\";\r\nimport AbstractEffectBrush from \"./AbstractEffectBrush\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-04-07\r\n */\r\nexport default class ExtinguishedBrush extends AbstractEffectBrush {\r\n\r\n    constructor(innerBrush) {\r\n        super(innerBrush);\r\n    }\r\n\r\n    apply(x, y, random, oldElement) {\r\n        const element = this._retrieveElement(x, y, random, oldElement);\r\n        if (element === null) {\r\n            return null;\r\n        }\r\n\r\n        const behaviour = ElementHead.getBehaviour(element.elementHead);\r\n        if (behaviour === ElementHead.BEHAVIOUR_FIRE_SOURCE) {\r\n            const newElementHead = ElementHead.setBehaviour(element.elementHead, ElementHead.BEHAVIOUR_NONE);\r\n            return new Element(newElementHead, element.elementTail);\r\n        } else {\r\n            return null;\r\n        }\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport Element from \"../Element.js\";\r\nimport ElementHead from \"../ElementHead.js\";\r\nimport Brush from \"./Brush\";\r\nimport DeterministicRandom from \"../DeterministicRandom\";\r\nimport RandomBrush from \"./RandomBrush\";\r\nimport RandomElementBrush from \"./RandomElementBrush\";\r\nimport ColorBrush from \"./ColorBrush\";\r\nimport ColorPaletteRandomBrush from \"./ColorPaletteRandomBrush\";\r\nimport ColorTextureBrush from \"./ColorTextureBrush\";\r\nimport ColorNoiseBrush from \"./ColorNoiseBrush\";\r\nimport ColorPaletteCyclicBrush from \"./ColorMovingPaletteBrush\";\r\nimport ColorRandomize from \"./ColorRandomize\";\r\nimport CustomBrush from \"./CustomBrush\";\r\nimport CountingBrush from \"./CountingBrush\";\r\nimport PredicateDefs from \"../../def/PredicateDefs\";\r\nimport MeltingBrush from \"./MeltingBrush\";\r\nimport SolidBodyBrush from \"./SolidBodyBrush\";\r\nimport ExtinguishedBrush from \"./ExtinguishedBrush\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-04-07\r\n */\r\nexport default class Brushes {\r\n\r\n    static #parsePalette(string) {\r\n        return string.split('\\n')\r\n            .filter(line => line.trim() !== '')\r\n            .map(line => line.split(',').map(Number));\r\n    }\r\n\r\n\r\n    /**\r\n     *\r\n     * @param predicate {(function(elementHead:number, elementTail:number):boolean)|undefined}\r\n     * @returns {CountingBrush}\r\n     */\r\n    static counting(predicate) {\r\n        return new CountingBrush(predicate);\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param func {function(x: number, y: number, random: DeterministicRandom, oldElement: Element)}\r\n     * @returns {Brush}\r\n     */\r\n    static custom(func) {\r\n        return new CustomBrush(func);\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param list {Element[]|Brush[]}\r\n     * @returns {Brush}\r\n     */\r\n    static random(list) {\r\n        let hasBrushes = undefined;\r\n        for (let item of list) {\r\n            if (item instanceof Element) {\r\n                if (hasBrushes === true) {\r\n                    throw 'Mixing Element and Brush instances';\r\n                }\r\n                hasBrushes = false;\r\n            } else if (item instanceof Brush) {\r\n                if (hasBrushes === false) {\r\n                    throw 'Mixing Element and Brush instances';\r\n                }\r\n                hasBrushes = true;\r\n            } else {\r\n                throw 'Element or Brush instances expected';\r\n            }\r\n        }\r\n        return (hasBrushes) ? new RandomBrush(list) : new RandomElementBrush(list);\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param r {number} 0..255\r\n     * @param g {number} 0..255\r\n     * @param b {number} 0..255\r\n     * @param innerBrush {Brush|undefined}\r\n     * @return {Brush}\r\n     */\r\n    static color(r = 0, g = 0, b = 0, innerBrush = undefined) {\r\n        return new ColorBrush(r, g, b, innerBrush);\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param base64\r\n     * @param innerBrush {Brush|undefined}\r\n     * @return {ColorTextureBrush}\r\n     */\r\n    static colorTexture(base64, innerBrush = undefined) {\r\n        return new ColorTextureBrush(innerBrush, base64);\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param palette {number[][]|string}\r\n     * @param innerBrush {Brush|undefined}\r\n     * @returns {Brush}\r\n     */\r\n    static colorPaletteRandom(palette, innerBrush = undefined) {\r\n        if (typeof palette === 'string') {\r\n            palette = Brushes.#parsePalette(palette);\r\n        }\r\n        return new ColorPaletteRandomBrush(innerBrush, palette);\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param palette {number[][]|string}\r\n     * @param stepSize {number}\r\n     * @param innerBrush {Brush|undefined}\r\n     * @returns {Brush}\r\n     */\r\n    static colorPaletteCyclic(palette, stepSize = 1, innerBrush = undefined) {\r\n        if (typeof palette === 'string') {\r\n            palette = Brushes.#parsePalette(palette);\r\n        }\r\n        return new ColorPaletteCyclicBrush(innerBrush, palette, stepSize);\r\n    }\r\n\r\n    /**\r\n     * This brush provides a bit of randomness to element colors.\r\n     *\r\n     * @param maxDiff {number}\r\n     * @param innerBrush {Brush|undefined}\r\n     * @returns {Brush}\r\n     */\r\n    static colorRandomize(maxDiff, innerBrush = undefined) {\r\n        return new ColorRandomize(innerBrush, maxDiff);\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param coefficients {\r\n     * {\r\n     *     seed: number|undefined,\r\n     *     factor: number|undefined,\r\n     *     threshold: number|undefined,\r\n     *     force: number|undefined,\r\n     * }\r\n     * |\r\n     * {\r\n     *     seed: number|undefined,\r\n     *     factor: number|undefined,\r\n     *     threshold: number|undefined,\r\n     *     force: number|undefined,\r\n     * }[]\r\n     * }\r\n     * @param r {number} 0..255\r\n     * @param g {number} 0..255\r\n     * @param b {number} 0..255\r\n     * @param innerBrush {Brush|undefined}\r\n     * @return {Brush}\r\n     */\r\n    static colorNoise(coefficients, r = undefined, g = undefined, b = undefined,\r\n            innerBrush = undefined) {\r\n\r\n        return new ColorNoiseBrush(innerBrush, coefficients, r, g, b);\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param brush {Brush}\r\n     * @param intensity {number} 0..1\r\n     * @returns {Brush}\r\n     */\r\n    static withIntensity(intensity, brush) {\r\n        return Brushes.custom((x, y, random, oldElement) => {\r\n            let rnd = ((random) ? random : DeterministicRandom.DEFAULT).next();\r\n            if (rnd < intensity) {\r\n                return brush.apply(x, y, random, oldElement);\r\n            }\r\n            return null;\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Brush will not paint over other elements.\r\n     *\r\n     * @param brush {Brush}\r\n     */\r\n    static gentle(brush) {\r\n        return Brushes.conditional(PredicateDefs.IS_AIR, brush);\r\n    }\r\n\r\n    /**\r\n     * Brush will paint only over specific elements.\r\n     *\r\n     * @param predicate {function(elementHead:number, elementTail:number):boolean}\r\n     * @param brush {Brush}\r\n     */\r\n    static conditional(predicate, brush) {\r\n        return Brushes.custom((x, y, random, oldElement) => {\r\n            if (oldElement === null) {\r\n                return null;\r\n            }\r\n            if (predicate(oldElement.elementHead, oldElement.elementTail)) {\r\n                return brush.apply(x, y, random, oldElement);\r\n            }\r\n            return null;\r\n        });\r\n    }\r\n\r\n    static temperature(value) {\r\n        return Brushes.custom((x, y, random, oldElement) => {\r\n            if (oldElement === null) {\r\n                return null;\r\n            }\r\n            const newElementHead = ElementHead.setTemperature(oldElement.elementHead, value & 0xFF);\r\n            return new Element(newElementHead, oldElement.elementTail);\r\n        });\r\n    }\r\n\r\n    static temperatureOrBrush(value, brush) {\r\n        return Brushes.custom((x, y, random, oldElement) => {\r\n            if (oldElement === null) {\r\n                return brush.apply(x, y, random, null);\r\n            }\r\n\r\n            const typeClass = ElementHead.getTypeClass(oldElement.elementHead);\r\n            switch (typeClass) {\r\n                case ElementHead.TYPE_AIR:\r\n                case ElementHead.TYPE_EFFECT:\r\n                    return brush.apply(x, y, random, oldElement);\r\n\r\n                case ElementHead.TYPE_POWDER:\r\n                case ElementHead.TYPE_POWDER_WET:\r\n                case ElementHead.TYPE_POWDER_FLOATING:\r\n                case ElementHead.TYPE_FLUID:\r\n                case ElementHead.TYPE_GAS:\r\n                case ElementHead.TYPE_STATIC:\r\n                    const newElementHead = ElementHead.setTemperature(oldElement.elementHead, value & 0xFF);\r\n                    return new Element(newElementHead, oldElement.elementTail);\r\n\r\n                default:\r\n                    return brush.apply(x, y, random, null);\r\n            }\r\n        });\r\n    }\r\n\r\n    static concat(first, second) {\r\n        return Brushes.custom((x, y, random, oldElement) => {\r\n            const firstResult = first.apply(x, y, random, oldElement);\r\n            const secondResult = second.apply(x, y, random, firstResult !== null ? firstResult : oldElement);\r\n            return (secondResult !== null) ? secondResult : firstResult;\r\n        });\r\n    }\r\n\r\n    static join(brushes) {\r\n        return Brushes.custom((x, y, random, oldElement) => {\r\n            let last = oldElement;\r\n            for (let brush of brushes) {\r\n                const next = brush.apply(x, y, random, last);\r\n                if (next !== null) {\r\n                    last = next;\r\n                }\r\n            }\r\n            return last;\r\n        });\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param innerBrush {Brush|undefined}\r\n     * @returns {Brush}\r\n     */\r\n    static molten(innerBrush) {\r\n        return new MeltingBrush(innerBrush);\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param innerBrush {Brush|undefined}\r\n     * @returns {Brush}\r\n     */\r\n    static extinguished(innerBrush) {\r\n        return new ExtinguishedBrush(innerBrush)\r\n    }\r\n\r\n    /**\r\n     * @param solidBodyId {number}\r\n     * @param extendedNeighbourhood {boolean|undefined}\r\n     * @param innerBrush {Brush|undefined}\r\n     * @return {SolidBodyBrush}\r\n     */\r\n    static toSolidBody(solidBodyId, extendedNeighbourhood = undefined, innerBrush = undefined) {\r\n        return new SolidBodyBrush(solidBodyId, extendedNeighbourhood, innerBrush);\r\n    }\r\n}\r\n","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-05-19\r\n */\r\nexport default class ToolInfo {\r\n\r\n    static NOT_DEFINED = new ToolInfo();\r\n\r\n    #info\r\n\r\n    /**\r\n     *\r\n     * @param info {{\r\n     *     codeName: string|undefined,\r\n     *     displayName: string|undefined,\r\n     *     category: string|undefined,\r\n     *     badgeStyle: CSSStyleDeclaration|undefined,\r\n     *     icon: {svg: string|undefined}|undefined,\r\n     * }}\r\n     */\r\n    constructor(info = {}) {\r\n        this.#info = info;\r\n    }\r\n\r\n    derive(info) {\r\n        const derivedInfo = {};\r\n        Object.assign(derivedInfo, this.#info);\r\n        Object.assign(derivedInfo, info);\r\n        return new ToolInfo(derivedInfo);\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @return {string|undefined}\r\n     */\r\n    getCategory() {\r\n        return this.#info.category;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @return {string|undefined}\r\n     */\r\n    getDisplayName() {\r\n        return this.#info.displayName;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @return {string|undefined}\r\n     */\r\n    getCodeName() {\r\n        return this.#info.codeName;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @return {CSSStyleDeclaration|undefined}\r\n     */\r\n    getBadgeStyle() {\r\n        return this.#info.badgeStyle;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @returns {string|undefined}\r\n     */\r\n    getSvgIcon() {\r\n        return this.#info.icon?.svg;\r\n    }\r\n}\r\n","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\n/**\r\n * @interface\r\n *\r\n * @author Patrik Harag\r\n * @version 2023-05-04\r\n */\r\nexport default class CursorDefinition {\r\n\r\n    /**\r\n     *\r\n     * @return {number}\r\n     */\r\n    getWidth() {\r\n        throw 'Not implemented';\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @return {number}\r\n     */\r\n    getHeight() {\r\n        throw 'Not implemented';\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport CursorDefinition from \"./CursorDefinition.js\";\r\nimport ToolInfo from \"./ToolInfo\";\r\n\r\n/**\r\n * @interface\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-02-08\r\n */\r\nexport default class Tool {\r\n\r\n    /** @type ToolInfo|null */\r\n    #info;\r\n\r\n    constructor(info = ToolInfo.NOT_DEFINED) {\r\n        this.#info = info;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @returns {ToolInfo}\r\n     */\r\n    getInfo() {\r\n        return this.#info;\r\n    }\r\n\r\n    hasCursor() {\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * @return {CursorDefinition|null}\r\n     */\r\n    createCursor() {\r\n        // default cursor\r\n        return null;\r\n    }\r\n\r\n    isRepeatingEnabled() {\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param x {number}\r\n     * @param y {number}\r\n     * @param graphics {SandGameGraphics}\r\n     * @param altModifier {boolean}\r\n     * @return {void}\r\n     */\r\n    applyPoint(x, y, graphics, altModifier) {\r\n        // no action by default\r\n    }\r\n\r\n    isLineModeEnabled() {\r\n        return false;\r\n    }\r\n\r\n    onDragStart(x, y, graphics, altModifier) {\r\n        // no action by default\r\n    }\r\n\r\n    onDragEnd(x, y, graphics, altModifier) {\r\n        // no action by default\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param x1 {number}\r\n     * @param y1 {number}\r\n     * @param x2 {number}\r\n     * @param y2 {number}\r\n     * @param graphics {SandGameGraphics}\r\n     * @param altModifier {boolean}\r\n     * @return {void}\r\n     */\r\n    applyStroke(x1, y1, x2, y2, graphics, altModifier) {\r\n        // no action by default\r\n    }\r\n\r\n    isAreaModeEnabled() {\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param x1 {number}\r\n     * @param y1 {number}\r\n     * @param x2 {number}\r\n     * @param y2 {number}\r\n     * @param graphics {SandGameGraphics}\r\n     * @param altModifier {boolean}\r\n     * @return {void}\r\n     */\r\n    applyArea(x1, y1, x2, y2, graphics, altModifier) {\r\n        // no action by default\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param x {number}\r\n     * @param y {number}\r\n     * @param graphics {SandGameGraphics}\r\n     * @param altModifier {boolean}\r\n     * @return {void}\r\n     */\r\n    applySpecial(x, y, graphics, altModifier) {\r\n        // no action by default\r\n    }\r\n\r\n    isSecondaryActionEnabled() {\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param x {number}\r\n     * @param y {number}\r\n     * @param graphics {SandGameGraphics}\r\n     * @param altModifier {boolean}\r\n     * @return {void}\r\n     */\r\n    applySecondaryAction(x, y, graphics, altModifier) {\r\n        // no action by default\r\n    }\r\n}\r\n","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport Brush from \"../brush/Brush\";\r\nimport Tool from \"./Tool\";\r\nimport Brushes from \"../brush/Brushes\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-02-26\r\n */\r\nexport default class RoundBrushTool extends Tool {\r\n\r\n    /** @type Brush */\r\n    #brush;\r\n\r\n    /** @type number */\r\n    #size;\r\n\r\n    constructor(info, brush, size) {\r\n        super(info);\r\n        this.#brush = brush;\r\n        this.#size = size;\r\n    }\r\n\r\n    getBrush() {\r\n        return this.#brush;\r\n    }\r\n\r\n    isLineModeEnabled() {\r\n        return true;\r\n    }\r\n\r\n    isAreaModeEnabled() {\r\n        return true;\r\n    }\r\n\r\n    isRepeatingEnabled() {\r\n        return true;\r\n    }\r\n\r\n    applyPoint(x, y, graphics, altModifier) {\r\n        this.applyStroke(x, y, x, y, graphics, altModifier);\r\n    }\r\n\r\n    applyStroke(x1, y1, x2, y2, graphics, altModifier) {\r\n        const brush = this.#currentBrush(altModifier);\r\n        graphics.drawLine(x1, y1, x2, y2, this.#size, brush, true);\r\n    }\r\n\r\n    applyArea(x1, y1, x2, y2, graphics, altModifier) {\r\n        const brush = this.#currentBrush(altModifier);\r\n        graphics.drawRectangle(x1, y1, x2, y2, brush);\r\n    }\r\n\r\n    applySpecial(x, y, graphics, altModifier) {\r\n        const brush = this.#currentBrush(altModifier);\r\n        graphics.floodFill(x, y, brush, 1);\r\n    }\r\n\r\n    #currentBrush(altModifier) {\r\n        let brush = this.#brush;\r\n        if (altModifier) {\r\n            brush = Brushes.gentle(brush);\r\n        }\r\n        return brush;\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport Tool from \"./Tool\";\r\nimport Brush from \"../brush/Brush\";\r\nimport Brushes from \"../brush/Brushes\";\r\nimport ElementHead from \"../ElementHead\";\r\nimport Element from \"../Element\";\r\nimport PredicateDefs from \"../../def/PredicateDefs\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-02-26\r\n */\r\nexport default class RoundBrushToolForSolidBody extends Tool {\r\n\r\n    /** @type Brush */\r\n    #brush;\r\n\r\n    /** @type Brush */\r\n    #toSolidBodyBrush = Brushes.conditional(PredicateDefs.IS_STATIC, Brushes.toSolidBody(2, false));  // TODO: hardcoded\r\n\r\n    /** @type number */\r\n    #size;\r\n\r\n    #drag = false;\r\n    #dragBuffer = [];\r\n\r\n    constructor(info, brush, size) {\r\n        super(info);\r\n        this.#brush = brush;\r\n        this.#size = size;\r\n    }\r\n\r\n    getBrush() {\r\n        return this.#brush;\r\n    }\r\n\r\n    isLineModeEnabled() {\r\n        return true;\r\n    }\r\n\r\n    isAreaModeEnabled() {\r\n        return true;\r\n    }\r\n\r\n    isRepeatingEnabled() {\r\n        return false;\r\n    }\r\n\r\n    applyPoint(x, y, graphics, altModifier) {\r\n        // ignored\r\n    }\r\n\r\n    applyStroke(x1, y1, x2, y2, graphics, altModifier) {\r\n        const brush = this.#currentBrush(altModifier);\r\n        graphics.drawLine(x1, y1, x2, y2, this.#size, brush, true);\r\n    }\r\n\r\n    applyArea(x1, y1, x2, y2, graphics, altModifier) {\r\n        const brush = this.#currentBrush(altModifier);\r\n        graphics.drawRectangle(x1, y1, x2, y2, brush);\r\n    }\r\n\r\n    applySpecial(x, y, graphics, altModifier) {\r\n        const brush = this.#currentBrush(altModifier);\r\n        graphics.floodFill(x, y, brush, 1);\r\n    }\r\n\r\n    onDragStart(x, y, graphics, altModifier) {\r\n        this.#drag = true;\r\n    }\r\n\r\n    onDragEnd(x, y, graphics, altModifier) {\r\n        this.#drag = false;\r\n        for (const [ex, ey] of this.#dragBuffer) {\r\n            graphics.draw(ex, ey, this.#toSolidBodyBrush);\r\n        }\r\n        this.#dragBuffer = [];\r\n    }\r\n\r\n    #currentBrush(altModifier) {\r\n        let brush = this.#brush;\r\n        if (altModifier) {\r\n            brush = Brushes.gentle(brush);\r\n        }\r\n\r\n        if (this.#drag) {\r\n            return Brushes.custom((x, y, random, oldElement) => {\r\n                const element = brush.apply(x, y, random, oldElement);\r\n                if (element !== null) {\r\n                    const elementHead = ElementHead.setType(element.elementHead, ElementHead.TYPE_STATIC);\r\n                    this.#dragBuffer.push([x, y]);\r\n                    return new Element(elementHead, element.elementTail);\r\n                }\r\n                return null;\r\n            });\r\n        } else {\r\n            return brush;\r\n        }\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport Tool from \"./Tool\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2023-12-25\r\n */\r\nexport default class PointBrushTool extends Tool {\r\n\r\n    /** @type {{dx: number, dy: number, brush: Brush}[]} */\r\n    #points;\r\n\r\n    constructor(info, points) {\r\n        super(info);\r\n        this.#points = points;\r\n    }\r\n\r\n    applyPoint(x, y, graphics, aldModifier) {\r\n        for (const {dx, dy, brush} of this.#points) {\r\n            graphics.draw(x + dx, y + dy, brush);\r\n        }\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport DeterministicRandom from \"../DeterministicRandom\";\r\nimport Tool from \"./Tool\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-04-12\r\n */\r\nexport default class MeteorTool extends Tool {\r\n\r\n    #meteor;\r\n    #meteorFromLeft;\r\n    #meteorFromRight;\r\n\r\n    constructor(info, meteor, meteorFromLeft, meteorFromRight) {\r\n        super(info);\r\n        this.#meteor = meteor;\r\n        this.#meteorFromLeft = meteorFromLeft;\r\n        this.#meteorFromRight = meteorFromRight;\r\n    }\r\n\r\n    applyPoint(x, y, graphics, aldModifier) {\r\n        const diffSlope4 = Math.trunc(y / 4);\r\n        if (x < diffSlope4 + 10) {\r\n            // right only\r\n            graphics.draw(x + diffSlope4, 1, this.#meteorFromRight);\r\n            return;\r\n        }\r\n        if (x > graphics.getWidth() - diffSlope4 - 10) {\r\n            // left only\r\n            graphics.draw(x - diffSlope4, 1, this.#meteorFromLeft);\r\n            return;\r\n        }\r\n\r\n        if (x < graphics.getWidth() / 2) {\r\n            if (DeterministicRandom.DEFAULT.next() < 0.8) {\r\n                graphics.draw(x + diffSlope4, 1, this.#meteorFromRight);\r\n            } else {\r\n                graphics.draw(x, 1, this.#meteor);\r\n            }\r\n        } else {\r\n            if (DeterministicRandom.DEFAULT.next() < 0.8) {\r\n                graphics.draw(x - diffSlope4, 1, this.#meteorFromLeft);\r\n            } else {\r\n                graphics.draw(x, 1, this.#meteor);\r\n            }\r\n        }\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport Element from \"./Element.js\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2023-10-11\r\n */\r\nexport default class ElementArea {\r\n\r\n    /**\r\n     * This element is used for templates etc.\r\n     * @type {Element}\r\n     */\r\n    static TRANSPARENT_ELEMENT = new Element(0xFFFFFFFF, 0xFFFFFFFF);\r\n\r\n    static LITTLE_ENDIAN = true;\r\n\r\n    static create(width, height, defaultElement) {\r\n        let bufferHeads = new DataView(new ArrayBuffer(width * height * 4));\r\n        let bufferTails = new DataView(new ArrayBuffer(width * height * 4));\r\n        let instance = new ElementArea(width, height, bufferHeads, bufferTails);\r\n\r\n        // set default elements\r\n        for (let y = 0; y < instance.#height; y++) {\r\n            for (let x = 0; x < instance.#width; x++) {\r\n                instance.setElement(x, y, defaultElement);\r\n            }\r\n        }\r\n        return instance;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param width\r\n     * @param height\r\n     * @param dataHeads {ArrayBuffer}\r\n     * @param dataTails {ArrayBuffer}\r\n     * @returns {ElementArea}\r\n     */\r\n    static from(width, height, dataHeads, dataTails) {\r\n        return new ElementArea(width, height, new DataView(dataHeads), new DataView(dataTails));\r\n    }\r\n\r\n\r\n    /** @type number */\r\n    #width;\r\n\r\n    /** @type number */\r\n    #height;\r\n\r\n    /** @type DataView */\r\n    #bufferHeads;\r\n\r\n    /** @type DataView */\r\n    #bufferTails;\r\n\r\n    constructor(width, height, bufferHeads, bufferTails) {\r\n        this.#width = width;\r\n        this.#height = height;\r\n        this.#bufferHeads = bufferHeads;\r\n        this.#bufferTails = bufferTails;\r\n    }\r\n\r\n    isValidPosition(x, y) {\r\n        if (x < 0 || y < 0) {\r\n            return false;\r\n        }\r\n        if (x >= this.#width || y >= this.#height) {\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    setElement(x, y, element) {\r\n        if (element !== null) {\r\n            this.setElementHeadAndTail(x, y, element.elementHead, element.elementTail);\r\n        }\r\n        // brushes can produce nulls\r\n    }\r\n\r\n    setElementHeadAndTail(x, y, elementHead, elementTail) {\r\n        const byteOffset = (this.#width * y + x) * 4;\r\n        this.#bufferHeads.setUint32(byteOffset, elementHead, ElementArea.LITTLE_ENDIAN);\r\n        this.#bufferTails.setUint32(byteOffset, elementTail, ElementArea.LITTLE_ENDIAN);\r\n    }\r\n\r\n    setElementHead(x, y, elementHead) {\r\n        const byteOffset = (this.#width * y + x) * 4;\r\n        this.#bufferHeads.setUint32(byteOffset, elementHead, ElementArea.LITTLE_ENDIAN);\r\n    }\r\n\r\n    setElementTail(x, y, elementTail) {\r\n        const byteOffset = (this.#width * y + x) * 4;\r\n        this.#bufferTails.setUint32(byteOffset, elementTail, ElementArea.LITTLE_ENDIAN);\r\n    }\r\n\r\n    getElement(x, y) {\r\n        const byteOffset = (this.#width * y + x) * 4;\r\n        const elementHead = this.#bufferHeads.getUint32(byteOffset, ElementArea.LITTLE_ENDIAN);\r\n        const elementTail = this.#bufferTails.getUint32(byteOffset, ElementArea.LITTLE_ENDIAN);\r\n        return new Element(elementHead, elementTail);\r\n    }\r\n\r\n    getElementHead(x, y) {\r\n        const byteOffset = (this.#width * y + x) * 4;\r\n        return this.#bufferHeads.getUint32(byteOffset, ElementArea.LITTLE_ENDIAN);\r\n    }\r\n\r\n    getElementHeadOrNull(x, y) {\r\n        if (this.isValidPosition(x, y)) {\r\n            return this.getElementHead(x, y);\r\n        }\r\n        return null;\r\n    }\r\n\r\n    getElementTail(x, y) {\r\n        const byteOffset = (this.#width * y + x) * 4;\r\n        return this.#bufferTails.getUint32(byteOffset, ElementArea.LITTLE_ENDIAN);\r\n    }\r\n\r\n    getElementTailOrNull(x, y) {\r\n        if (this.isValidPosition(x, y)) {\r\n            return this.getElementTail(x, y);\r\n        }\r\n        return null;\r\n    }\r\n\r\n    swap(x, y, x2, y2) {\r\n        const elementHead = this.getElementHead(x, y);\r\n        const elementHead2 = this.getElementHead(x2, y2);\r\n        this.setElementHead(x2, y2, elementHead);\r\n        this.setElementHead(x, y, elementHead2);\r\n\r\n        const elementTail = this.getElementTail(x, y);\r\n        const elementTail2 = this.getElementTail(x2, y2);\r\n        this.setElementTail(x2, y2, elementTail);\r\n        this.setElementTail(x, y, elementTail2);\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @return {ArrayBuffer}\r\n     */\r\n    getDataHeads() {\r\n        return this.#bufferHeads.buffer;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @return {ArrayBuffer}\r\n     */\r\n    getDataTails() {\r\n        return this.#bufferTails.buffer;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @return {number}\r\n     */\r\n    getWidth() {\r\n        return this.#width;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @return {number}\r\n     */\r\n    getHeight() {\r\n        return this.#height;\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport CursorDefinition from \"./CursorDefinition\";\r\n\r\n/**\r\n * @author Patrik Harag\r\n * @version 2023-05-04\r\n */\r\nexport default class CursorDefinitionElementArea extends CursorDefinition {\r\n\r\n    /** @type ElementArea */\r\n    #elementArea;\r\n\r\n    constructor(elementArea) {\r\n        super();\r\n        this.#elementArea = elementArea;\r\n    }\r\n\r\n    getWidth() {\r\n        return this.#elementArea.getWidth();\r\n    }\r\n\r\n    getHeight() {\r\n        return this.#elementArea.getHeight();\r\n    }\r\n\r\n    getElementArea() {\r\n        return this.#elementArea;\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport ElementArea from \"../ElementArea\";\r\nimport Brushes from \"../brush/Brushes\";\r\nimport CursorDefinitionElementArea from \"./CursorDefinitionElementArea\";\r\nimport Tool from \"./Tool\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-04-20\r\n */\r\nexport default class InsertElementAreaTool extends Tool {\r\n\r\n    static asElementArea(scene) {\r\n        return scene.createElementArea(InsertElementAreaTool.DEFAULT_W, InsertElementAreaTool.DEFAULT_H,\r\n                ElementArea.TRANSPARENT_ELEMENT);\r\n    }\r\n\r\n\r\n    static DEFAULT_W = 30;\r\n    static DEFAULT_H = 30;\r\n\r\n    /** @type ElementArea */\r\n    #elementArea;\r\n    /** @type object[] */\r\n    #serializedEntities;\r\n    /** @type function */\r\n    #onInsertHandler;\r\n\r\n    constructor(info, elementArea, serializedEntities, onInsertHandler) {\r\n        super(info);\r\n        this.#elementArea = elementArea;\r\n        this.#serializedEntities = serializedEntities;\r\n        this.#onInsertHandler = onInsertHandler;\r\n    }\r\n\r\n    applyPoint(x, y, graphics, aldModifier) {\r\n        const elementArea = this.#elementArea;\r\n        const offsetX = x - Math.trunc(elementArea.getWidth() / 2);\r\n        const offsetY = y - Math.trunc(elementArea.getHeight() / 2);\r\n\r\n        // apply elements\r\n        let brush = Brushes.custom((tx, ty) => {\r\n            const element = elementArea.getElement(tx - offsetX, ty - offsetY);\r\n            if (element.elementHead !== ElementArea.TRANSPARENT_ELEMENT.elementHead\r\n                && element.elementTail !== ElementArea.TRANSPARENT_ELEMENT.elementTail) {\r\n\r\n                return element;\r\n            }\r\n            return null;\r\n        });\r\n        if (aldModifier) {\r\n            brush = Brushes.gentle(brush);\r\n        }\r\n\r\n        for (let i = 0; i < elementArea.getWidth() && offsetX + i < graphics.getWidth(); i++) {\r\n            const tx = offsetX + i;\r\n            if (tx < 0) {\r\n                continue;\r\n            }\r\n\r\n            for (let j = 0; j < elementArea.getHeight() && offsetY + j < graphics.getHeight(); j++) {\r\n                const ty = offsetY + j;\r\n                if (ty < 0) {\r\n                    continue;\r\n                }\r\n\r\n                graphics.draw(tx, ty, brush);\r\n            }\r\n        }\r\n\r\n        // apply entities\r\n        for (const serializedEntity of this.#serializedEntities) {\r\n            const serializedClone = Object.assign({}, serializedEntity);\r\n            // map entity position\r\n            if (typeof serializedClone.x === 'number') {\r\n                serializedClone.x += offsetX;\r\n            }\r\n            if (typeof serializedClone.y === 'number') {\r\n                serializedClone.y += offsetY;\r\n            }\r\n            graphics.entities().insertEntity(serializedClone);\r\n        }\r\n\r\n        if (this.#onInsertHandler !== undefined) {\r\n            this.#onInsertHandler();\r\n        }\r\n    }\r\n\r\n    hasCursor() {\r\n        return true;\r\n    }\r\n\r\n    createCursor() {\r\n        return new CursorDefinitionElementArea(this.#elementArea);\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport DeterministicRandom from \"../DeterministicRandom\";\r\nimport InsertElementAreaTool from \"./InsertElementAreaTool\";\r\nimport Tool from \"./Tool\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-04-20\r\n */\r\nexport default class InsertRandomSceneTool extends Tool {\r\n\r\n    /** @type Scene[] */\r\n    #scenes;\r\n\r\n    #currentTool;\r\n\r\n    /** @type function */\r\n    #onInsertHandler;\r\n\r\n    constructor(info, scenes, onInsertHandler) {\r\n        super(info);\r\n        this.#scenes = scenes;\r\n        this.#onInsertHandler = onInsertHandler;\r\n        this.#initRandomTool();\r\n    }\r\n\r\n    #initRandomTool() {\r\n        if (this.#scenes.length === undefined || this.#scenes.length === 0) {\r\n            throw 'Scenes not set';\r\n        }\r\n\r\n        const i = DeterministicRandom.DEFAULT.nextInt(this.#scenes.length);\r\n        const scene = this.#scenes[i];\r\n        const elementArea = InsertElementAreaTool.asElementArea(scene);\r\n        const serializedEntitiesOrNull = scene.createEntities();\r\n        const serializedEntities = serializedEntitiesOrNull !== null ? serializedEntitiesOrNull : [];\r\n        this.#currentTool = new InsertElementAreaTool(this.getInfo(), elementArea, serializedEntities, this.#onInsertHandler);\r\n    }\r\n\r\n    applyPoint(x, y, graphics, aldModifier) {\r\n        this.#currentTool.applyPoint(x, y, graphics, aldModifier);\r\n        this.#initRandomTool();\r\n    }\r\n\r\n    hasCursor() {\r\n        return true;\r\n    }\r\n\r\n    createCursor() {\r\n        return this.#currentTool.createCursor();\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport Tool from \"./Tool\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-05-04\r\n */\r\nexport default class ActionTool extends Tool {\r\n\r\n    /** @type function */\r\n    #handler;\r\n\r\n    constructor(info, handler) {\r\n        super(info);\r\n        this.#handler = handler;\r\n    }\r\n\r\n    applyPoint(x, y, graphics, aldModifier) {\r\n        this.#handler(x, y, graphics, aldModifier);\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport Element from \"./Element\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-04-20\r\n */\r\nexport default class PositionedElement extends Element {\r\n\r\n    x;\r\n    y;\r\n\r\n    constructor(x, y, elementHead, elementTail) {\r\n        super(elementHead, elementTail);\r\n        this.x = x;\r\n        this.y = y;\r\n    }\r\n}\r\n","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport ElementHead from \"./ElementHead\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-04-20\r\n */\r\nexport default class FloodFillPainter {\r\n\r\n    static NEIGHBOURHOOD_VON_NEUMANN = 0;\r\n    static NEIGHBOURHOOD_MOORE = 1;\r\n    static NEIGHBOURHOOD_SOLID_BODY = 2;\r\n\r\n\r\n    /** @type ElementArea */\r\n    #elementArea;\r\n\r\n    /** @type SandGameGraphics */\r\n    #graphics;\r\n\r\n    #neighbourhood;\r\n\r\n    /**\r\n     *\r\n     * @param elementArea {ElementArea}\r\n     * @param neighbourhood\r\n     * @param graphics {SandGameGraphics}\r\n     */\r\n    constructor(elementArea, neighbourhood = FloodFillPainter.NEIGHBOURHOOD_VON_NEUMANN, graphics) {\r\n        this.#elementArea = elementArea;\r\n        this.#neighbourhood = neighbourhood;\r\n        this.#graphics = graphics;\r\n    }\r\n\r\n    #createPattern() {\r\n        if (this.#neighbourhood === FloodFillPainter.NEIGHBOURHOOD_SOLID_BODY) {\r\n            return 0b1111_1111;  // type class + solid body id (without neighbourhood type)\r\n        } else {\r\n            return 0b1111_11100111;  // TODO: different for fluid, powder-like...\r\n        }\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param x {number}\r\n     * @param y {number}\r\n     * @param brush {Brush}\r\n     */\r\n    paint(x, y, brush) {\r\n        const pattern = this.#createPattern();\r\n        const matcher = this.#normalize(this.#elementArea.getElementHead(x, y)) & pattern;\r\n\r\n        const w = this.#elementArea.getWidth();\r\n\r\n        const pointSet = new Set();\r\n        const queue = [];\r\n\r\n        let point = x + y * w;\r\n        do {\r\n            let x = point % w;\r\n            let y = Math.trunc(point / w);\r\n\r\n            if (pointSet.has(point)) {\r\n                continue;  // already completed\r\n            }\r\n\r\n            this.#graphics.draw(x, y, brush);\r\n            pointSet.add(point);\r\n\r\n            // add neighbours\r\n            this.#tryAdd(x, y - 1, pattern, matcher, pointSet, queue);\r\n            this.#tryAdd(x + 1, y, pattern, matcher, pointSet, queue);\r\n            this.#tryAdd(x, y + 1, pattern, matcher, pointSet, queue);\r\n            this.#tryAdd(x - 1, y, pattern, matcher, pointSet, queue);\r\n\r\n            let extendedNeighbourhood = false;\r\n            if (this.#neighbourhood === FloodFillPainter.NEIGHBOURHOOD_MOORE) {\r\n                extendedNeighbourhood = true;\r\n            } else if (this.#neighbourhood === FloodFillPainter.NEIGHBOURHOOD_SOLID_BODY) {\r\n                const elementHead = this.#elementArea.getElementHead(x, y);\r\n                if (ElementHead.getTypeModifierSolidNeighbourhoodType(elementHead) === 0) {\r\n                    extendedNeighbourhood = true;\r\n                }\r\n            }\r\n\r\n            if (extendedNeighbourhood) {\r\n                this.#tryAdd(x + 1, y + 1, pattern, matcher, pointSet, queue);\r\n                this.#tryAdd(x + 1, y - 1, pattern, matcher, pointSet, queue);\r\n                this.#tryAdd(x - 1, y + 1, pattern, matcher, pointSet, queue);\r\n                this.#tryAdd(x - 1, y - 1, pattern, matcher, pointSet, queue);\r\n            }\r\n\r\n        } while ((point = queue.pop()) != null);\r\n    }\r\n\r\n    #tryAdd(x, y, pattern, matcher, pointSet, queue) {\r\n        const w = this.#elementArea.getWidth();\r\n        const h = this.#elementArea.getHeight();\r\n\r\n        if (x < 0 || y < 0) {\r\n            return;\r\n        }\r\n        if (x >= w || y >= h) {\r\n            return;\r\n        }\r\n\r\n        if (!this.#equals(x, y, pattern, matcher)) {\r\n            return;\r\n        }\r\n\r\n        const point = x + y * w;\r\n        if (pointSet.has(point)) {\r\n            return;\r\n        }\r\n\r\n        queue.push(point);\r\n    }\r\n\r\n    #equals(x, y, pattern, matcher) {\r\n        let elementHead = this.#elementArea.getElementHead(x, y);\r\n        elementHead = this.#normalize(elementHead);\r\n        return (elementHead & pattern) === matcher;\r\n    }\r\n\r\n    #normalize(elementHead) {\r\n        // wetness is ignored\r\n        if (ElementHead.getTypeClass(elementHead) === ElementHead.TYPE_POWDER_WET) {\r\n            elementHead = ElementHead.setTypeClass(elementHead, ElementHead.TYPE_POWDER);\r\n        }\r\n        return elementHead;\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport Brushes from \"../brush/Brushes\";\r\nimport PositionedElement from \"../PositionedElement\";\r\nimport ElementHead from \"../ElementHead\";\r\nimport ElementArea from \"../ElementArea\";\r\nimport FloodFillPainter from \"../FloodFillPainter\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-04-27\r\n */\r\nexport default class CopyUtils {\r\n\r\n    static copyNonSolidElements(graphicsCommands, replacementElement = null) {\r\n        const elements = [];\r\n\r\n        function canBeCopiedAsNonSolidElement(elementHead) {\r\n            const elementTypeClass = ElementHead.getTypeClass(elementHead);\r\n            if (elementTypeClass > ElementHead.TYPE_AIR && elementTypeClass < ElementHead.TYPE_STATIC) {\r\n                return true;\r\n            }\r\n            return false;\r\n        }\r\n\r\n        const brush = Brushes.custom((tx, ty, r, element) => {\r\n            if (canBeCopiedAsNonSolidElement(element.elementHead)) {\r\n                elements.push(new PositionedElement(tx, ty, element.elementHead, element.elementTail));\r\n                return replacementElement;  // remove\r\n            }\r\n            return null;  // ignore\r\n        });\r\n\r\n        graphicsCommands(brush);\r\n\r\n        return elements;\r\n    }\r\n\r\n    static copySolidBodies(graphicsCommands, graphics, maxArea, replacementElement) {\r\n        const elements = [];\r\n\r\n        const brush = Brushes.custom((tx, ty, r, element) => {\r\n            if (ElementHead.getTypeClass(element.elementHead) === ElementHead.TYPE_STATIC\r\n                    && ElementHead.getTypeModifierSolidBodyId(element.elementHead) !== 0) {\r\n\r\n                const newElements = CopyUtils.copySolidBody(tx, ty, graphics, maxArea, replacementElement);\r\n                for (const newElement of newElements) {\r\n                    elements.push(newElement);\r\n                }\r\n            }\r\n            return null;  // ignore here\r\n        });\r\n\r\n        graphicsCommands(brush);\r\n\r\n        return elements;\r\n    }\r\n\r\n    static copySolidBody(x, y, graphics, maxArea, replacementElement = null) {\r\n        const solidBodyElements = [];\r\n        const collectingBrush = Brushes.custom((tx, ty, random, element) => {\r\n            solidBodyElements.push(new PositionedElement(tx, ty, element.elementHead, element.elementTail));\r\n            return null;  // ignore here\r\n        });\r\n        graphics.floodFill(x, y, collectingBrush, FloodFillPainter.NEIGHBOURHOOD_SOLID_BODY);\r\n\r\n        if (solidBodyElements.length > maxArea) {\r\n            return [];  // too big\r\n        }\r\n        for (let solidBodyElement of solidBodyElements) {\r\n            graphics.draw(solidBodyElement.x, solidBodyElement.y, replacementElement);\r\n        }\r\n        return solidBodyElements;\r\n    }\r\n\r\n    static copyEntities(graphicsCommands, graphics, defaultElement) {\r\n        const elements = [];\r\n        const entities = [];\r\n\r\n        const brush = Brushes.custom((tx, ty, r, element) => {\r\n            for (const entity of graphics.entities().getAt(tx, ty)) {\r\n                if (entity.isActive()) {\r\n                    const [extractedSerializedEntity, extractedElements] = entity.extract(defaultElement, 0, 0);\r\n                    entities.push(extractedSerializedEntity);\r\n                    elements.push(...extractedElements);\r\n                }\r\n            }\r\n            return null;  // ignore\r\n        });\r\n\r\n        graphicsCommands(brush);\r\n\r\n        return [entities, elements];\r\n    }\r\n\r\n    static trimmed(elements, entities) {\r\n        if (elements.length === 0) {\r\n            return [null, null];\r\n        }\r\n\r\n        let minX = Number.MAX_VALUE;\r\n        let maxX = Number.MIN_VALUE;\r\n        let minY = Number.MAX_VALUE;\r\n        let maxY = Number.MIN_VALUE;\r\n        for (const element of elements) {\r\n            minX = Math.min(minX, element.x);\r\n            maxX = Math.max(maxX, element.x);\r\n            minY = Math.min(minY, element.y);\r\n            maxY = Math.max(maxY, element.y);\r\n        }\r\n        const w = maxX - minX + 1;\r\n        const h = maxY - minY + 1;\r\n\r\n        // create element area\r\n        const elementArea = ElementArea.create(w, h, ElementArea.TRANSPARENT_ELEMENT);\r\n        for (const element of elements) {\r\n            const tx = element.x - minX;\r\n            const ty = element.y - minY;\r\n            elementArea.setElement(tx, ty, element);\r\n        }\r\n\r\n        // map entities\r\n        for (let serializedEntity of entities) {\r\n            if (typeof serializedEntity.x === 'number') {\r\n                serializedEntity.x -= minX;\r\n            }\r\n            if (typeof serializedEntity.y === 'number') {\r\n                serializedEntity.y -= minY;\r\n            }\r\n        }\r\n\r\n        return [elementArea, entities];\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport Tool from \"./Tool\";\r\nimport ToolInfo from \"./ToolInfo\";\r\nimport ElementArea from \"../ElementArea\";\r\nimport ElementHead from \"../ElementHead\";\r\nimport InsertElementAreaTool from \"./InsertElementAreaTool\";\r\nimport Brushes from \"../brush/Brushes\";\r\nimport CopyUtils from \"./CopyUtils\";\r\n\r\n/**\r\n * It can be used to move elements from one place to another.\r\n * This tool works in three modes: click-click, drag-drop and selection-click.\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-04-24\r\n */\r\nexport default class MoveTool extends Tool {\r\n\r\n    /** @type number */\r\n    #size;\r\n    /** @type number */\r\n    #solidBodyMaxArea;\r\n\r\n    /** @type InsertElementAreaTool */\r\n    #insertScene = null;\r\n\r\n    constructor(info, size, solidBodyMaxArea) {\r\n        super(info);\r\n        this.#size = size;\r\n        this.#solidBodyMaxArea = solidBodyMaxArea;\r\n    }\r\n\r\n    // POINT & DRAG AND DROP ACTION\r\n\r\n    applyPoint(x, y, graphics, altModifier) {\r\n        if (this.#insertScene === null) {\r\n            this.#insertScene = this.#createInsertToolAt(x, y, graphics);\r\n        } else {\r\n            this.#insertScene.applyPoint(x, y, graphics, altModifier);\r\n            this.#insertScene = null;\r\n        }\r\n    }\r\n\r\n    onDragStart(x, y, graphics, altModifier) {\r\n        // ignore\r\n    }\r\n\r\n    onDragEnd(x, y, graphics, altModifier) {\r\n        if (this.#insertScene !== null) {\r\n            this.#insertScene.applyPoint(x, y, graphics, altModifier);\r\n            this.#insertScene = null;\r\n        }\r\n    }\r\n\r\n    #createInsertToolAt(x, y, graphics) {\r\n        const [elementArea, entities] = this.#copySingleElementsAt(x, y, graphics);\r\n        return (elementArea !== null)\r\n                ? new InsertElementAreaTool(new ToolInfo(), elementArea, entities)\r\n                : null;\r\n    }\r\n\r\n    #copySingleElementsAt(x, y, graphics) {\r\n        const defaultElement = graphics.getDefaults().getDefaultElement();\r\n        const graphicsCommands = (brush) => graphics.drawLine(x, y, x, y, this.#size, brush, true);\r\n\r\n        const elements = [];\r\n\r\n        elements.push(...CopyUtils.copyNonSolidElements(graphicsCommands, defaultElement));\r\n\r\n        elements.push(...CopyUtils.copySolidBodies(graphicsCommands, graphics, this.#solidBodyMaxArea, defaultElement));\r\n\r\n        const [entities, entitiesElements] = CopyUtils.copyEntities(graphicsCommands, graphics, defaultElement);\r\n        elements.push(...entitiesElements);\r\n\r\n        return CopyUtils.trimmed(elements, entities);\r\n    }\r\n\r\n    // AREA ACTION\r\n\r\n    isAreaModeEnabled() {\r\n        return true;\r\n    }\r\n\r\n    applyArea(x1, y1, x2, y2, graphics, altModifier) {\r\n        this.#insertScene = this.#createInsertTool(x1, y1, x2, y2, graphics);\r\n    }\r\n\r\n    #createInsertTool(x1, y1, x2, y2, graphics) {\r\n        const [elementArea, entities] = this.#copyElements(x1, y1, x2, y2, graphics);\r\n        return (elementArea !== null)\r\n            ? new InsertElementAreaTool(new ToolInfo(), elementArea, entities)\r\n            : null;\r\n    }\r\n\r\n    #copyElements(x1, y1, x2, y2, graphics) {\r\n        const w = Math.abs(x1 - x2) + 1;\r\n        const h = Math.abs(y1 - y2) + 1;\r\n        const elementArea = ElementArea.create(w, h, ElementArea.TRANSPARENT_ELEMENT);\r\n        const entities = [];\r\n\r\n        const defaultElement = graphics.getDefaults().getDefaultElement();\r\n        let empty = true;\r\n        const brush = Brushes.custom((tx, ty, r, element) => {\r\n\r\n            // process entities\r\n            for (const entity of graphics.entities().getAt(tx, ty)) {\r\n                if (entity.isActive()) {\r\n                    const [serializedEntity] = entity.extract(defaultElement, x1, y1);\r\n                    entities.push(serializedEntity);\r\n                }\r\n            }\r\n\r\n            // process elements\r\n            if (ElementHead.getTypeClass(element.elementHead) > ElementHead.TYPE_AIR) {\r\n                let x = tx - Math.min(x1, x2);\r\n                let y = ty - Math.min(y1, y2);\r\n                elementArea.setElement(x, y, element);\r\n                empty = false;\r\n                return defaultElement;  // remove\r\n            }\r\n            return null;  // ignore\r\n        });\r\n\r\n        graphics.drawRectangle(x1, y1, x2, y2, brush, false);\r\n\r\n        return (empty) ? null : [elementArea, entities];\r\n    }\r\n\r\n    // SECONDARY ACTION\r\n\r\n    isSecondaryActionEnabled() {\r\n        return (this.#insertScene !== null);\r\n    }\r\n\r\n    applySecondaryAction(x, y, graphics, altModifier) {\r\n        this.#insertScene = null;\r\n    }\r\n\r\n    // CURSOR\r\n\r\n    hasCursor() {\r\n        return this.#insertScene !== null;\r\n    }\r\n\r\n    createCursor() {\r\n        if (this.#insertScene !== null) {\r\n            return this.#insertScene.createCursor();\r\n        } else {\r\n            return null;\r\n        }\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport Tool from \"./Tool\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-05-07\r\n */\r\nexport default class SelectionFakeTool extends Tool {\r\n\r\n    #tools;\r\n\r\n    constructor(info, tools) {\r\n        super(info);\r\n        this.#tools = tools;\r\n    }\r\n\r\n    getTools() {\r\n        return this.#tools;\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport Tool from \"./Tool\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-02-08\r\n */\r\nexport default class TemplateSelectionFakeTool extends Tool {\r\n\r\n    #templateDefinitions;\r\n\r\n    constructor(info, templateDefinitions) {\r\n        super(info);\r\n        this.#templateDefinitions = templateDefinitions;\r\n    }\r\n\r\n    getTemplateDefinitions() {\r\n        return this.#templateDefinitions;\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport Tool from \"./Tool\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-05-04\r\n */\r\nexport default class GlobalActionTool extends Tool {\r\n\r\n    /** @type function(SandGame) */\r\n    #handler;\r\n\r\n    constructor(info, handler) {\r\n        super(info);\r\n        this.#handler = handler;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @return {function((SandGame))}\r\n     */\r\n    getHandler() {\r\n        return this.#handler;\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-03-23\r\n */\r\nexport default class ProcessorContext {\r\n\r\n    static OPT_CYCLES_PER_SECOND = 120;\r\n    static OPT_FRAMES_PER_SECOND = 60;\r\n\r\n\r\n    /**\r\n     * @returns number\r\n     */\r\n    getIteration() {\r\n        throw 'Not implemented';\r\n    }\r\n\r\n    /**\r\n     * @returns GameDefaults\r\n     */\r\n    getDefaults() {\r\n        throw 'Not implemented';\r\n    }\r\n\r\n    /**\r\n     * @returns {boolean}\r\n     */\r\n    isFallThroughEnabled() {\r\n        throw 'Not implemented';\r\n    }\r\n\r\n    /**\r\n     * @returns {boolean}\r\n     */\r\n    isErasingEnabled() {\r\n        throw 'Not implemented';\r\n    }\r\n\r\n    trigger(x, y) {\r\n        throw 'Not implemented';\r\n    }\r\n\r\n    triggerSolidCreated(elementHead, x, y) {\r\n        throw 'Not implemented';\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-04-27\r\n */\r\nexport default class GameState {\r\n\r\n    /** @type ElementArea */\r\n    elementArea;\r\n    /** @type DeterministicRandom */\r\n    random;\r\n    /** @type ProcessorContext */\r\n    processorContext;\r\n    /** @type EntityManager */\r\n    entityManager;\r\n\r\n    constructor(elementArea, random, processorContext, entityManager) {\r\n        this.elementArea = elementArea;\r\n        this.random = random;\r\n        this.processorContext = processorContext;\r\n        this.entityManager = entityManager;\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport Tool from \"./Tool\";\r\nimport CursorDefinitionElementArea from \"./CursorDefinitionElementArea\";\r\nimport ElementArea from \"../ElementArea\";\r\nimport DeterministicRandom from \"../DeterministicRandom\";\r\nimport ProcessorContext from \"../processing/ProcessorContext\";\r\nimport GameState from \"../GameState\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-04-26\r\n */\r\nexport default class InsertEntityTool extends Tool {\r\n\r\n    /** @type {function(object, GameState):Entity} */\r\n    #entityFactory;\r\n\r\n    /** @type {Entity} */\r\n    #nextEntity;\r\n\r\n    constructor(info, entityFactory) {\r\n        super(info);\r\n        this.#entityFactory = entityFactory;\r\n\r\n        this.#createEntity();\r\n    }\r\n\r\n    #createEntity() {\r\n        const tmpElementArea = ElementArea.create(1, 1, ElementArea.TRANSPARENT_ELEMENT);\r\n        const tmpRandom = DeterministicRandom.DEFAULT;\r\n        const tmpProcessorContext = new ProcessorContext();\r\n        const gameState = new GameState(tmpElementArea, tmpRandom, tmpProcessorContext);\r\n        this.#nextEntity = this.#entityFactory({}, gameState);\r\n    }\r\n\r\n    applyPoint(x, y, graphics, aldModifier) {\r\n        const serialized = this.#nextEntity.serialize();\r\n        serialized.x = x;\r\n        serialized.y = y;\r\n\r\n        graphics.entities().insertEntity(serialized);\r\n\r\n        this.#createEntity();\r\n    }\r\n\r\n    hasCursor() {\r\n        return true;\r\n    }\r\n\r\n    createCursor() {\r\n        const boundaries = 2;\r\n        const [w, h] = this.#nextEntity.countMaxBoundaries();\r\n        const defaultElement = ElementArea.TRANSPARENT_ELEMENT;\r\n        const tmpElementArea = ElementArea.create(w + 2 * boundaries, h + 2 * boundaries, defaultElement);\r\n        const centerX = Math.trunc(tmpElementArea.getWidth() / 2);\r\n        const centerY = Math.trunc(tmpElementArea.getHeight() / 2);\r\n        this.#nextEntity.paint(centerX, centerY, tmpElementArea, DeterministicRandom.DEFAULT);\r\n        return new CursorDefinitionElementArea(tmpElementArea);\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport ToolInfo from \"./ToolInfo\";\r\nimport RoundBrushTool from \"./RoundBrushTool\";\r\nimport RoundBrushToolForSolidBody from \"./RoundBrushToolForSolidBody\";\r\nimport PointBrushTool from \"./PointBrushTool\";\r\nimport MeteorTool from \"./MeteorTool\";\r\nimport InsertElementAreaTool from \"./InsertElementAreaTool\";\r\nimport InsertRandomSceneTool from \"./InsertRandomSceneTool\";\r\nimport ActionTool from \"./ActionTool\";\r\nimport MoveTool from \"./MoveTool\";\r\nimport SelectionFakeTool from \"./SelectionFakeTool\";\r\nimport TemplateSelectionFakeTool from \"./TemplateSelectionFakeTool\";\r\nimport GlobalActionTool from \"./GlobalActionTool\";\r\nimport InsertEntityTool from \"./InsertEntityTool\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-05-07\r\n */\r\nexport default class Tools {\r\n\r\n    static #info(info) {\r\n        if (info instanceof ToolInfo) {\r\n            return info;\r\n        }\r\n        if (info === undefined) {\r\n            return ToolInfo.NOT_DEFINED;\r\n        }\r\n        if (typeof info === 'object') {\r\n            return new ToolInfo(info);\r\n        }\r\n        throw 'Incorrect tool info type: ' + (typeof info);\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param brush\r\n     * @param size\r\n     * @param info {ToolInfo|object|undefined}\r\n     * @return {Tool}\r\n     */\r\n    static roundBrushTool(brush, size, info) {\r\n        return new RoundBrushTool(Tools.#info(info), brush, size);\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param brush\r\n     * @param size\r\n     * @param info {ToolInfo|object|undefined}\r\n     * @return {Tool}\r\n     */\r\n    static roundBrushToolForSolidBody(brush, size, info) {\r\n        return new RoundBrushToolForSolidBody(Tools.#info(info), brush, size);\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param brush\r\n     * @param info {ToolInfo|object|undefined}\r\n     * @return {Tool}\r\n     */\r\n    static pointBrushTool(brush, info) {\r\n        return new PointBrushTool(Tools.#info(info), [{ dx: 0, dy: 0, brush: brush }]);\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param points {{dx: number, dy: number, brush: Brush}[]}\r\n     * @param info {ToolInfo|object|undefined}\r\n     * @return {Tool}\r\n     */\r\n    static multiPointBrushTool(points, info) {\r\n        return new PointBrushTool(Tools.#info(info), points);\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param meteor {Brush}\r\n     * @param meteorFromLeft {Brush}\r\n     * @param meteorFromRight {Brush}\r\n     * @param info {ToolInfo|object|undefined}\r\n     * @return {Tool}\r\n     */\r\n    static meteorTool(meteor, meteorFromLeft, meteorFromRight, info) {\r\n        return new MeteorTool(Tools.#info(info), meteor, meteorFromLeft, meteorFromRight);\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param scenes\r\n     * @param handler\r\n     * @param info {ToolInfo|object|undefined}\r\n     * @return {Tool}\r\n     */\r\n    static insertScenesTool(scenes, handler, info) {\r\n        if (scenes.length === 1) {\r\n            const scene = scenes[0];\r\n            const elementArea = InsertElementAreaTool.asElementArea(scene);\r\n            const serializedEntitiesOrNull = scene.createEntities();\r\n            const serializedEntities = serializedEntitiesOrNull !== null ? serializedEntitiesOrNull : [];\r\n            return new InsertElementAreaTool(Tools.#info(info), elementArea, serializedEntities, handler);\r\n        } else {\r\n            return new InsertRandomSceneTool(Tools.#info(info), scenes, handler);\r\n        }\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param handler {function(x: number, y: number, graphics: SandGameGraphics, aldModifier: boolean)}\r\n     * @param info {ToolInfo|object|undefined}\r\n     * @return {Tool}\r\n     */\r\n    static actionTool(handler, info) {\r\n        return new ActionTool(Tools.#info(info), handler);\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param handler {function(SandGame)}\r\n     * @param info {ToolInfo|object|undefined}\r\n     * @return {Tool}\r\n     */\r\n    static globalActionTool(handler, info) {\r\n        return new GlobalActionTool(Tools.#info(info), handler);\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param size {number}\r\n     * @param solidBodyMaxArea {number}\r\n     * @param info {ToolInfo|object|undefined}\r\n     * @return {Tool}\r\n     */\r\n    static moveTool(size, solidBodyMaxArea, info) {\r\n        return new MoveTool(Tools.#info(info), size, solidBodyMaxArea);\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param templateDefinitions\r\n     * @param info {ToolInfo|object|undefined}\r\n     * @return {Tool}\r\n     */\r\n    static templateSelectionTool(templateDefinitions, info) {\r\n        return new TemplateSelectionFakeTool(Tools.#info(info), templateDefinitions);\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param tools {Tool[]}\r\n     * @param info {ToolInfo|object|undefined}\r\n     * @return {Tool}\r\n     */\r\n    static selectionTool(tools, info) {\r\n        return new SelectionFakeTool(Tools.#info(info), tools);\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param entityFactory {function(serialized:object, gameState:GameState):Entity}\r\n     * @param info {ToolInfo|object|undefined}\r\n     * @return {Tool}\r\n     */\r\n    static insertEntityTool(entityFactory, info) {\r\n        return new InsertEntityTool(Tools.#info(info), entityFactory);\r\n    }\r\n\r\n    // ---\r\n\r\n    /**\r\n     *\r\n     * @param tools {Tool[]}\r\n     * @param categoryDefinitions {Object<string, {displayName: string, badgeStyle: object}>}\r\n     * @returns {Tool[]}\r\n     */\r\n    static grouping(tools, categoryDefinitions) {\r\n        const groups = [];\r\n        const selections = {};\r\n        for (const tool of tools) {\r\n            const category = tool.getInfo().getCategory();\r\n            if (category !== undefined && categoryDefinitions[category] !== undefined) {\r\n                let selection = selections[category];\r\n                if (selection === undefined) {\r\n                    selection = [];\r\n                    selections[category] = selection;\r\n                    groups.push(selection);\r\n                }\r\n                selection.push(tool);\r\n            } else {\r\n                groups.push(tool);\r\n            }\r\n        }\r\n\r\n        const groupedTools = [];\r\n        for (const group of groups) {\r\n            if (Array.isArray(group)) {\r\n                const category = group[0].getInfo().getCategory();\r\n                const categoryDefinition = categoryDefinitions[category];\r\n                groupedTools.push(Tools.selectionTool(group, Tools.#info({\r\n                    ...categoryDefinition,\r\n                    codeName: 'category_' + category,\r\n                })));\r\n            } else {\r\n                groupedTools.push(group);\r\n            }\r\n        }\r\n        return groupedTools;\r\n    }\r\n\r\n}\r\n","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport _ASSET_TREE_TRUNK_TEMPLATES from './assets/structures/tree-trunk-templates.json'\r\nimport _ASSET_TREE_CELL_TEMPLATES from './assets/structures/tree-leaf-cluster-templates.json'\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2023-12-18\r\n */\r\nexport default class StructureDefs {\r\n\r\n    /** @type {[]} */\r\n    static TREE_TRUNK_TEMPLATES = _ASSET_TREE_TRUNK_TEMPLATES;\r\n\r\n    /** @type {[]} */\r\n    static TREE_CLUSTER_TEMPLATES = _ASSET_TREE_CELL_TEMPLATES;\r\n}\r\n","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport Brush from \"../core/brush/Brush.js\";\r\nimport Brushes from \"../core/brush/Brushes\";\r\nimport ElementHead from \"../core/ElementHead.js\";\r\nimport ElementTail from \"../core/ElementTail.js\";\r\nimport Element from \"../core/Element.js\";\r\nimport VisualEffects from \"../core/processing/VisualEffects.js\";\r\nimport StructureDefs from \"./StructureDefs\";\r\n\r\nimport _ASSET_PALETTE_SAND from './assets/brushes/sand.palette.csv';\r\nimport _ASSET_PALETTE_SOIL from './assets/brushes/soil.palette.csv';\r\nimport _ASSET_PALETTE_GRAVEL from './assets/brushes/gravel.palette.csv';\r\nimport _ASSET_PALETTE_THERMITE from './assets/brushes/thermite-2.palette.csv';\r\nimport _ASSET_PALETTE_COAL from './assets/brushes/coal.palette.csv';\r\nimport _ASSET_PALETTE_ASH from './assets/brushes/ash.palette.csv';\r\nimport _ASSET_PALETTE_WATER from './assets/brushes/water.palette.csv';\r\nimport _ASSET_PALETTE_STEAM from './assets/brushes/steam.palette.csv';\r\nimport _ASSET_PALETTE_OIL from './assets/brushes/oil.palette.csv';\r\nimport _ASSET_PALETTE_WALL from './assets/brushes/wall.palette.csv';\r\nimport _ASSET_PALETTE_TREE_WOOD_LIGHT from './assets/brushes/tree-wood-light.palette.csv';\r\nimport _ASSET_PALETTE_TREE_WOOD_DARK from './assets/brushes/tree-wood-dark.palette.csv';\r\nimport _ASSET_PALETTE_TREE_ROOT from './assets/brushes/tree-root.palette.csv';\r\nimport _ASSET_PALETTE_TREE_LEAF_LIGHT from './assets/brushes/tree-leaf-light.palette.csv';\r\nimport _ASSET_PALETTE_TREE_LEAF_DARK from './assets/brushes/tree-leaf-dark.palette.csv';\r\n\r\nimport _ASSET_TEXTURE_BRICK from './assets/brushes/brick-wall.png';\r\nimport _ASSET_TEXTURE_WOOD from './assets/brushes/wood-wall.png';\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-05-25\r\n */\r\nexport default class BrushDefs {\r\n\r\n    static NONE = Brushes.custom(() => null);\r\n\r\n    // TEST brushes\r\n    // bright color for testing purposes\r\n\r\n    static _TEST_SOLID = Brushes.random([\r\n        new Element(\r\n            ElementHead.of(ElementHead.type8(ElementHead.TYPE_STATIC)),\r\n            ElementTail.of(255, 0, 125))\r\n    ]);\r\n\r\n    static _TEST_AIR = Brushes.random([\r\n        new Element(\r\n            ElementHead.of(ElementHead.type8(ElementHead.TYPE_AIR)),\r\n            ElementTail.of(255, 0, 125))\r\n    ]);\r\n\r\n    // ---\r\n\r\n    static AIR = Brushes.random([\r\n        new Element(\r\n            ElementHead.of(ElementHead.type8(ElementHead.TYPE_AIR)),\r\n            ElementTail.of(255, 255, 255, ElementTail.BLUR_TYPE_BACKGROUND))\r\n    ]);\r\n\r\n    static WALL = Brushes.colorPaletteRandom(_ASSET_PALETTE_WALL, Brushes.random([\r\n        new Element(\r\n            ElementHead.of(\r\n                ElementHead.type8(ElementHead.TYPE_STATIC),\r\n                ElementHead.behaviour8(0),\r\n                ElementHead.modifiers8(ElementHead.HMI_CONDUCTIVE_1)),\r\n            ElementTail.of(0, 0, 0, ElementTail.BLUR_TYPE_NONE, ElementTail.HEAT_EFFECT_2))\r\n    ]));\r\n\r\n    static ROCK = Brushes.join([\r\n        Brushes.random([\r\n            new Element(\r\n                ElementHead.of(\r\n                    ElementHead.type8(ElementHead.type8Solid(ElementHead.TYPE_STATIC, 1, false)),\r\n                    ElementHead.behaviour8(),\r\n                    ElementHead.modifiers8(ElementHead.HMI_CONDUCTIVE_1)),\r\n                ElementTail.of(155, 155, 155, ElementTail.BLUR_TYPE_NONE, ElementTail.HEAT_EFFECT_2))\r\n        ]),\r\n        Brushes.colorNoise([\r\n            { seed: 40, factor: 60, threshold: 0.4, force: 0.9 },\r\n            { seed: 41, factor: 30, threshold: 0.4, force: 0.9 },\r\n            { seed: 42, factor: 15, threshold: 0.4, force: 0.5 },\r\n            { seed: 43, factor: 3, threshold: 0.1, force: 0.1 },\r\n        ], 79, 69, 63),\r\n        Brushes.colorNoise([\r\n            { seed: 51, factor: 30, threshold: 0.4, force: 0.9 },\r\n            { seed: 52, factor: 15, threshold: 0.4, force: 0.5 },\r\n            { seed: 53, factor: 3, threshold: 0.1, force: 0.1 },\r\n        ], 55, 48, 46),\r\n        Brushes.colorNoise([\r\n            { seed: 61, factor: 30, threshold: 0.4, force: 0.9 },\r\n            { seed: 62, factor: 15, threshold: 0.4, force: 0.5 },\r\n            { seed: 63, factor: 3, threshold: 0.1, force: 0.1 },\r\n        ], 33, 29, 28)\r\n    ]);\r\n\r\n    static BRICK = Brushes.join([\r\n        Brushes.random([\r\n            new Element(\r\n                ElementHead.of(\r\n                    ElementHead.type8(ElementHead.type8Solid(ElementHead.TYPE_STATIC, 4, false)),\r\n                    ElementHead.behaviour8(),\r\n                    ElementHead.modifiers8(ElementHead.HMI_CONDUCTIVE_1)),\r\n                ElementTail.of(0, 0, 0, ElementTail.BLUR_TYPE_NONE, ElementTail.HEAT_EFFECT_2))\r\n        ]),\r\n        Brushes.colorTexture(_ASSET_TEXTURE_BRICK),\r\n        Brushes.colorNoise({ seed: 4011, factor: 10, threshold: 0.5, force: 0.2 })\r\n    ]);\r\n\r\n    static WOOD = Brushes.join([\r\n        Brushes.random([\r\n            new Element(\r\n                ElementHead.of(\r\n                    ElementHead.type8(ElementHead.type8Solid(ElementHead.TYPE_STATIC, 3)),\r\n                    ElementHead.behaviour8(),\r\n                    ElementHead.modifiers8(ElementHead.HMI_WOOD_LIKE)),\r\n                ElementTail.of(0, 0, 0, ElementTail.BLUR_TYPE_NONE, ElementTail.HEAT_EFFECT_1))\r\n        ]),\r\n        Brushes.colorTexture(_ASSET_TEXTURE_WOOD),\r\n        Brushes.colorNoise({ seed: 1515, factor: 10, threshold: 0.5, force: 0.1 }, 255, 255, 255)\r\n    ]);\r\n\r\n    static METAL = Brushes.join([\r\n        Brushes.random([\r\n            new Element(\r\n                ElementHead.of(\r\n                    ElementHead.type8(ElementHead.type8Solid(ElementHead.TYPE_STATIC, 2, false)),\r\n                    ElementHead.behaviour8(ElementHead.BEHAVIOUR_LIQUID, ElementHead.SPECIAL_LIQUID_HEAVY_MOLTEN),\r\n                    ElementHead.modifiers8(ElementHead.HMI_METAL)),\r\n                ElementTail.of(155, 155, 155, ElementTail.BLUR_TYPE_NONE, ElementTail.HEAT_EFFECT_3))\r\n        ]),\r\n        Brushes.colorNoise([\r\n            { seed: 40, factor: 40, threshold: 0.4, force: 0.75 },\r\n            { seed: 40, factor: 20, threshold: 0.5, force: 0.4 },\r\n            { seed: 40, factor: 10, threshold: 0.4, force: 0.2 },\r\n            { seed: 40, factor: 5, threshold: 0.4, force: 0.1 },\r\n        ], 135, 135, 135),\r\n        Brushes.colorNoise([\r\n            { seed: 41, factor: 10, threshold: 0.4, force: 0.4 },\r\n            { seed: 41, factor: 6, threshold: 0.3, force: 0.3 },\r\n            { seed: 41, factor: 4, threshold: 0.5, force: 0.3 },\r\n        ], 130, 130, 130)\r\n    ]);\r\n\r\n    static METAL_MOLTEN = Brushes.join([BrushDefs.METAL, Brushes.temperature(180), Brushes.molten()]);\r\n\r\n    static SAND = Brushes.colorPaletteRandom(_ASSET_PALETTE_SAND, Brushes.custom((x, y, random) => {\r\n        const type = random.nextInt(100) < 60 ? ElementHead.TYPE_POWDER : ElementHead.TYPE_POWDER_WET;\r\n        const elementHead = ElementHead.of(\r\n            ElementHead.type8Powder(type, 6),\r\n            ElementHead.behaviour8(),\r\n            ElementHead.modifiers8(ElementHead.HMI_CONDUCTIVE_2));\r\n        const elementTail = ElementTail.of(0, 0, 0, ElementTail.BLUR_TYPE_1, ElementTail.HEAT_EFFECT_2);\r\n        return new Element(elementHead, elementTail);\r\n    }));\r\n\r\n    static SOIL = Brushes.colorPaletteRandom(_ASSET_PALETTE_SOIL, Brushes.custom((x, y, random) => {\r\n        const type = random.nextInt(100) < 40 ? ElementHead.TYPE_POWDER : ElementHead.TYPE_POWDER_WET;\r\n        const elementHead = ElementHead.of(\r\n            ElementHead.type8Powder(type, 5),\r\n            ElementHead.behaviour8(ElementHead.BEHAVIOUR_SOIL),\r\n            ElementHead.modifiers8(ElementHead.HMI_CONDUCTIVE_1));\r\n        const elementTail = ElementTail.of(0, 0, 0, ElementTail.BLUR_TYPE_1, ElementTail.HEAT_EFFECT_1);\r\n        return new Element(elementHead, elementTail);\r\n    }));\r\n\r\n    static GRAVEL = Brushes.colorPaletteRandom(_ASSET_PALETTE_GRAVEL, Brushes.custom((x, y, random) => {\r\n        const type = random.nextInt(100) < 20 ? ElementHead.TYPE_POWDER : ElementHead.TYPE_POWDER_WET;\r\n        const elementHead = ElementHead.of(\r\n            ElementHead.type8Powder(type, 3),\r\n            ElementHead.behaviour8(),\r\n            ElementHead.modifiers8(ElementHead.HMI_CONDUCTIVE_2));\r\n        const elementTail = ElementTail.of(0, 0, 0, ElementTail.BLUR_TYPE_1, ElementTail.HEAT_EFFECT_2);\r\n        return new Element(elementHead, elementTail);\r\n    }));\r\n\r\n    static COAL = Brushes.colorPaletteRandom(_ASSET_PALETTE_COAL, Brushes.custom((x, y, random) => {\r\n        const type = random.nextInt(100) < 40 ? ElementHead.TYPE_POWDER : ElementHead.TYPE_POWDER_WET;\r\n        const elementHead = ElementHead.of(\r\n            ElementHead.type8Powder(type, 4),\r\n            ElementHead.behaviour8(),\r\n            ElementHead.modifiers8(ElementHead.HMI_COAL));\r\n        const elementTail = ElementTail.of(0, 0, 0, ElementTail.BLUR_TYPE_1, ElementTail.HEAT_EFFECT_2, 3);\r\n        return new Element(elementHead, elementTail);\r\n    }));\r\n\r\n    static THERMITE = Brushes.colorPaletteRandom(_ASSET_PALETTE_THERMITE, Brushes.custom((x, y, random) => {\r\n        const type = random.nextInt(100) < 60 ? ElementHead.TYPE_POWDER : ElementHead.TYPE_POWDER_WET;\r\n        const elementHead = ElementHead.of(\r\n            ElementHead.type8Powder(type, 5),\r\n            ElementHead.behaviour8(),\r\n            ElementHead.modifiers8(ElementHead.HMI_THERMITE));\r\n        const elementTail = ElementTail.of(0, 0, 0, ElementTail.BLUR_TYPE_1, ElementTail.HEAT_EFFECT_2, 3);\r\n        return new Element(elementHead, elementTail);\r\n    }));\r\n\r\n    static WATER = Brushes.colorPaletteRandom(_ASSET_PALETTE_WATER, Brushes.random([\r\n        new Element(\r\n            ElementHead.of(\r\n                ElementHead.type8Fluid(ElementHead.TYPE_FLUID),\r\n                ElementHead.behaviour8(ElementHead.BEHAVIOUR_LIQUID, ElementHead.SPECIAL_LIQUID_WATER),\r\n                ElementHead.modifiers8(ElementHead.HMI_CONDUCTIVE_3)),\r\n            ElementTail.of(0, 0, 0, ElementTail.BLUR_TYPE_1, ElementTail.HEAT_EFFECT_NONE))\r\n    ]));\r\n\r\n    static STEAM = Brushes.colorPaletteRandom(_ASSET_PALETTE_STEAM, Brushes.random([\r\n        new Element(\r\n            ElementHead.of(\r\n                ElementHead.type8Fluid(ElementHead.TYPE_GAS),\r\n                ElementHead.behaviour8(ElementHead.BEHAVIOUR_LIQUID, ElementHead.SPECIAL_LIQUID_WATER),\r\n                ElementHead.modifiers8(ElementHead.HMI_CONDUCTIVE_3)),\r\n            ElementTail.of(0, 0, 0, ElementTail.BLUR_TYPE_1, ElementTail.HEAT_EFFECT_NONE))\r\n    ]));\r\n\r\n    static OIL = Brushes.colorPaletteRandom(_ASSET_PALETTE_OIL, Brushes.random([\r\n        new Element(\r\n            ElementHead.of(\r\n                ElementHead.type8Fluid(ElementHead.TYPE_FLUID),\r\n                ElementHead.behaviour8(ElementHead.BEHAVIOUR_LIQUID, ElementHead.SPECIAL_LIQUID_LIGHT_OIL),\r\n                ElementHead.modifiers8(ElementHead.HMI_OIL)),\r\n            ElementTail.of(0, 0, 0, ElementTail.BLUR_TYPE_1, ElementTail.HEAT_EFFECT_NONE, 3))\r\n    ]));\r\n\r\n    static GRASS = Brushes.random([\r\n        new Element(\r\n            ElementHead.of(\r\n                ElementHead.type8Powder(ElementHead.TYPE_POWDER, 0),\r\n                ElementHead.behaviour8(ElementHead.BEHAVIOUR_GRASS, 5),\r\n                ElementHead.modifiers8(ElementHead.HMI_GRASS_LIKE)),\r\n            ElementTail.of(56, 126, 38, ElementTail.BLUR_TYPE_1, ElementTail.HEAT_EFFECT_1)),\r\n        new Element(\r\n            ElementHead.of(\r\n                ElementHead.type8Powder(ElementHead.TYPE_POWDER, 0),\r\n                ElementHead.behaviour8(ElementHead.BEHAVIOUR_GRASS, 3),\r\n                ElementHead.modifiers8(ElementHead.HMI_GRASS_LIKE)),\r\n            ElementTail.of(46, 102, 31, ElementTail.BLUR_TYPE_1, ElementTail.HEAT_EFFECT_1)),\r\n        new Element(\r\n            ElementHead.of(\r\n                ElementHead.type8Powder(ElementHead.TYPE_POWDER, 0),\r\n                ElementHead.behaviour8(ElementHead.BEHAVIOUR_GRASS, 4),\r\n                ElementHead.modifiers8(ElementHead.HMI_GRASS_LIKE)),\r\n            ElementTail.of(72, 130, 70, ElementTail.BLUR_TYPE_1, ElementTail.HEAT_EFFECT_1))\r\n    ]);\r\n\r\n    static TREE = Brushes.colorPaletteRandom(_ASSET_PALETTE_TREE_WOOD_DARK, Brushes.custom((x, y, random) => {\r\n        let treeType = random.nextInt(StructureDefs.TREE_TRUNK_TEMPLATES.length);\r\n        return new Element(\r\n            ElementHead.of(\r\n                ElementHead.type8(ElementHead.type8Solid(ElementHead.TYPE_STATIC, 3)),\r\n                ElementHead.behaviour8(ElementHead.BEHAVIOUR_TREE, treeType),\r\n                ElementHead.modifiers8(ElementHead.HMI_WOOD_LIKE)),\r\n            ElementTail.of(0, 0, 0, ElementTail.BLUR_TYPE_NONE, ElementTail.HEAT_EFFECT_1));\r\n    }));\r\n\r\n    static TREE_ROOT = Brushes.colorPaletteRandom(_ASSET_PALETTE_TREE_ROOT, Brushes.random([\r\n        new Element(\r\n            ElementHead.of(\r\n                ElementHead.type8(ElementHead.type8Solid(ElementHead.TYPE_STATIC, 3)),\r\n                ElementHead.behaviour8(ElementHead.BEHAVIOUR_TREE_ROOT, 8),\r\n                ElementHead.modifiers8(ElementHead.HMI_WOOD_LIKE)),\r\n            ElementTail.of(0, 0, 0, ElementTail.BLUR_TYPE_NONE, ElementTail.HEAT_EFFECT_1)),\r\n        new Element(\r\n            ElementHead.of(\r\n                ElementHead.type8(ElementHead.type8Solid(ElementHead.TYPE_STATIC, 3)),\r\n                ElementHead.behaviour8(ElementHead.BEHAVIOUR_TREE_ROOT, 5),\r\n                ElementHead.modifiers8(ElementHead.HMI_WOOD_LIKE)),\r\n            ElementTail.of(0, 0, 0, ElementTail.BLUR_TYPE_NONE, ElementTail.HEAT_EFFECT_1))\r\n    ]));\r\n\r\n    static TREE_WOOD = Brushes.colorPaletteRandom(_ASSET_PALETTE_TREE_WOOD_LIGHT, Brushes.random([\r\n        new Element(\r\n            ElementHead.of(\r\n                ElementHead.type8(ElementHead.type8Solid(ElementHead.TYPE_STATIC, 3)),\r\n                ElementHead.behaviour8(ElementHead.BEHAVIOUR_TREE_TRUNK, 0),\r\n                ElementHead.modifiers8(ElementHead.HMI_WOOD_LIKE)),\r\n            ElementTail.of(0, 0, 0, ElementTail.BLUR_TYPE_NONE, ElementTail.HEAT_EFFECT_1))\r\n    ]));\r\n\r\n    static TREE_WOOD_DARK = Brushes.colorPaletteRandom(_ASSET_PALETTE_TREE_WOOD_DARK, Brushes.random([\r\n        new Element(\r\n            ElementHead.of(\r\n                ElementHead.type8(ElementHead.type8Solid(ElementHead.TYPE_STATIC, 3)),\r\n                ElementHead.behaviour8(ElementHead.BEHAVIOUR_TREE_TRUNK, 0),\r\n                ElementHead.modifiers8(ElementHead.HMI_WOOD_LIKE)),\r\n            ElementTail.of(0, 0, 0, ElementTail.BLUR_TYPE_NONE, ElementTail.HEAT_EFFECT_1))\r\n    ]));\r\n\r\n    static TREE_LEAF_LIGHTER = Brushes.colorPaletteRandom(_ASSET_PALETTE_TREE_LEAF_LIGHT, Brushes.random([\r\n        new Element(\r\n            ElementHead.of(\r\n                ElementHead.type8(ElementHead.type8Solid(ElementHead.TYPE_STATIC, 3)),\r\n                ElementHead.behaviour8(ElementHead.BEHAVIOUR_TREE_LEAF, 0),\r\n                ElementHead.modifiers8(ElementHead.HMI_LEAF_LIKE)),\r\n            ElementTail.of(0, 0, 0, ElementTail.BLUR_TYPE_NONE, ElementTail.HEAT_EFFECT_1))\r\n    ]));\r\n\r\n    static TREE_LEAF_DARKER = Brushes.colorPaletteRandom(_ASSET_PALETTE_TREE_LEAF_DARK, Brushes.random([\r\n        new Element(\r\n            ElementHead.of(\r\n                ElementHead.type8(ElementHead.type8Solid(ElementHead.TYPE_STATIC, 3)),\r\n                ElementHead.behaviour8(ElementHead.BEHAVIOUR_TREE_LEAF, 0),\r\n                ElementHead.modifiers8(ElementHead.HMI_LEAF_LIKE)),\r\n            ElementTail.of(0, 0, 0, ElementTail.BLUR_TYPE_NONE, ElementTail.HEAT_EFFECT_1))\r\n    ]));\r\n\r\n    static #FIRE_ELEMENT_HEAD = ElementHead.of(\r\n            ElementHead.type8(ElementHead.TYPE_EFFECT),\r\n            ElementHead.behaviour8(ElementHead.BEHAVIOUR_FIRE, 0));\r\n    static FIRE = Brushes.random([\r\n        new Element(ElementHead.setTemperature(BrushDefs.#FIRE_ELEMENT_HEAD, 255), ElementTail.of(249, 219, 30)),\r\n        new Element(ElementHead.setTemperature(BrushDefs.#FIRE_ELEMENT_HEAD, 255), ElementTail.of(249, 219, 30)),\r\n        new Element(ElementHead.setTemperature(BrushDefs.#FIRE_ELEMENT_HEAD, 120), ElementTail.of(249, 219, 30))\r\n    ]);\r\n\r\n    static ASH = Brushes.colorPaletteRandom(_ASSET_PALETTE_ASH, Brushes.custom((x, y, random) => {\r\n        const type = random.nextInt(100) < 80 ? ElementHead.TYPE_POWDER : ElementHead.TYPE_POWDER_WET;\r\n        const elementHead = ElementHead.of(\r\n            ElementHead.type8Powder(type, 6),\r\n            ElementHead.behaviour8(),\r\n            ElementHead.modifiers8(ElementHead.HMI_CONDUCTIVE_2));\r\n        const elementTail = ElementTail.of(0, 0, 0, ElementTail.BLUR_TYPE_1, ElementTail.HEAT_EFFECT_2, 3);\r\n        return new Element(elementHead, elementTail);\r\n    }));\r\n\r\n    static METEOR = Brushes.random([\r\n        new Element(\r\n            ElementHead.of(\r\n                ElementHead.type8(ElementHead.TYPE_STATIC),\r\n                ElementHead.behaviour8(ElementHead.BEHAVIOUR_METEOR, 0)),\r\n            ElementTail.of(249, 219, 30))\r\n    ]);\r\n\r\n    static METEOR_FROM_LEFT = Brushes.random([\r\n        new Element(\r\n            ElementHead.of(\r\n                ElementHead.type8(ElementHead.TYPE_STATIC),\r\n                ElementHead.behaviour8(ElementHead.BEHAVIOUR_METEOR, 1 << 1)),\r\n            ElementTail.of(249, 219, 30))\r\n    ]);\r\n\r\n    static METEOR_FROM_RIGHT = Brushes.random([\r\n        new Element(\r\n            ElementHead.of(\r\n                ElementHead.type8(ElementHead.TYPE_STATIC),\r\n                ElementHead.behaviour8(ElementHead.BEHAVIOUR_METEOR, 2 << 1)),\r\n            ElementTail.of(249, 219, 30))\r\n    ]);\r\n\r\n    static EFFECT_BURNT = Brushes.custom((x, y, random, oldElement) => {\r\n        if (VisualEffects.isVisualBurnApplicable(oldElement.elementHead)) {\r\n            const burntLevel = ElementTail.getBurntLevel(oldElement.elementTail);\r\n            if (burntLevel < 3) {\r\n                return new Element(oldElement.elementHead, VisualEffects.visualBurn(oldElement.elementTail, 1));\r\n            }\r\n        }\r\n        return null;\r\n    });\r\n\r\n    static EFFECT_NOISE_LG = Brushes.colorNoise({ seed: 0, factor: 40, threshold: 0.5, force: 0.25 });\r\n    static EFFECT_NOISE_MD = Brushes.colorNoise({ seed: 0, factor: 10, threshold: 0.5, force: 0.25 });\r\n    static EFFECT_NOISE_SM = Brushes.colorNoise({ seed: 0, factor: 4, threshold: 0.5, force: 0.25 });\r\n\r\n    static EFFECT_TEMP_0 = Brushes.temperature(0);\r\n    static EFFECT_TEMP_127 = Brushes.temperature(127);\r\n    static EFFECT_TEMP_200 = Brushes.temperature(200);\r\n    static EFFECT_TEMP_255 = Brushes.temperature(255);\r\n\r\n    static EFFECT_WET = Brushes.custom((x, y, random, oldElement) => {\r\n        if (oldElement !== null) {\r\n            const typeClass = ElementHead.getTypeClass(oldElement.elementHead);\r\n            if (typeClass === ElementHead.TYPE_POWDER) {\r\n                const modifiedElementHead = ElementHead.setTypeClass(oldElement.elementHead, ElementHead.TYPE_POWDER_WET);\r\n                return new Element(modifiedElementHead, oldElement.elementTail);\r\n            } else {\r\n                return oldElement;\r\n            }\r\n        }\r\n        return null;\r\n    });\r\n\r\n    static EFFECT_MOLTEN = Brushes.molten();\r\n    static EFFECT_EXTINGUISH = Brushes.extinguished();\r\n\r\n    // --- SEARCH\r\n\r\n    static _LIST = {\r\n        none: BrushDefs.NONE,\r\n        air: BrushDefs.AIR,\r\n        ash: BrushDefs.ASH,\r\n        sand: BrushDefs.SAND,\r\n        soil: BrushDefs.SOIL,\r\n        gravel: BrushDefs.GRAVEL,\r\n        wall: BrushDefs.WALL,\r\n        rock: BrushDefs.ROCK,\r\n        wood: BrushDefs.WOOD,\r\n        brick: BrushDefs.BRICK,\r\n        metal: BrushDefs.METAL,\r\n        metal_molten: BrushDefs.METAL_MOLTEN,\r\n        water: BrushDefs.WATER,\r\n        steam: BrushDefs.STEAM,\r\n        oil: BrushDefs.OIL,\r\n        grass: BrushDefs.GRASS,\r\n        tree: BrushDefs.TREE,\r\n        tree_wood: BrushDefs.TREE_WOOD,\r\n        tree_wood_dark: BrushDefs.TREE_WOOD_DARK,\r\n        tree_leaf: BrushDefs.TREE_LEAF_LIGHTER,\r\n        tree_leaf_dark: BrushDefs.TREE_LEAF_DARKER,\r\n        tree_root: BrushDefs.TREE_ROOT,\r\n        fire: BrushDefs.FIRE,\r\n        meteor: BrushDefs.METEOR,\r\n        meteor_l: BrushDefs.METEOR_FROM_LEFT,\r\n        meteor_r: BrushDefs.METEOR_FROM_RIGHT,\r\n        effect_temp_0: BrushDefs.EFFECT_TEMP_0,\r\n        effect_temp_127: BrushDefs.EFFECT_TEMP_127,\r\n        effect_temp_200: BrushDefs.EFFECT_TEMP_200,\r\n        effect_temp_255: BrushDefs.EFFECT_TEMP_255,\r\n        effect_burnt: BrushDefs.EFFECT_BURNT,\r\n        effect_wet: BrushDefs.EFFECT_WET,\r\n        effect_molten: BrushDefs.EFFECT_MOLTEN,\r\n        effect_extinguished: BrushDefs.EFFECT_EXTINGUISH,\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param codeName {string}\r\n     * @returns {Brush|null}\r\n     */\r\n    static byCodeName(codeName) {\r\n        const brush = BrushDefs._LIST[codeName];\r\n        if (brush !== undefined) {\r\n            return brush;\r\n        }\r\n        return null;\r\n    }\r\n}","var img = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAAXNSR0IArs4c6QAAALtJREFUKFNjvHz++P+vn98zfPzwjgEE+AWEwDQ3ryDDs8d3GRi35qb8Bwk8evWawTA7neH81JkMcmKiDL9+/WJgY2NjYJwe7v+fk4sbrEsy0Ivh4pI1DGLcXAz8bCxgMcausID/vIxgQxjkwrwZHq3ayvD5PyNY0fdvXxkYCboBpODRvLlgE0D2gsCLDx8ZQNaCTThxaNv/G/OXgO28/f4T2OhXX7+BFYKsBltxpKMDrAMkARIEuQFEg8QA9mBbK1rMQigAAAAOZVhJZk1NACoAAAAIAAAAAAAAANJTkwAAAABJRU5ErkJggg==\";\n  export default img;","var img = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAICAYAAAAvOAWIAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAAySURBVChTYyyKsP8vIMTPQAxggtJEAbDJUDZBQJLJYMVcnCxEYdJN/vb9D1GYBJMZGABQ9iJQOWTXQgAAAABJRU5ErkJggg==\";\n  export default img;","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport _ASSET_ROCK_ICON from './assets/templates/rock-icon.png'\r\nimport _ASSET_ROCK_1 from './assets/templates/rock-1.png'\r\nimport _ASSET_ROCK_2 from './assets/templates/rock-2.png'\r\nimport _ASSET_ROCK_3 from './assets/templates/rock-3.png'\r\nimport _ASSET_ROCK_4 from './assets/templates/rock-4.png'\r\nimport _ASSET_ROCK_5 from './assets/templates/rock-5.png'\r\nimport _ASSET_ROCK_6 from './assets/templates/rock-6.png'\r\n\r\nimport _ASSET_ROCK_SM_ICON from './assets/templates/rock-sm-icon.png'\r\nimport _ASSET_ROCK_SM_1 from './assets/templates/rock-sm-1.png'\r\nimport _ASSET_ROCK_SM_2 from './assets/templates/rock-sm-2.png'\r\nimport _ASSET_ROCK_SM_3 from './assets/templates/rock-sm-3.png'\r\n\r\nimport _ASSET_ROCK_LG_ICON from './assets/templates/rock-lg-icon.png'\r\nimport _ASSET_ROCK_LG_1 from './assets/templates/rock-lg-1.png'\r\nimport _ASSET_ROCK_LG_2 from './assets/templates/rock-lg-2.png'\r\n\r\nimport _ASSET_WOODEN_HOUSE_ICON from './assets/templates/wooden-house-icon.png'\r\nimport _ASSET_WOODEN_HOUSE from './assets/templates/wooden-house.png'\r\n\r\nimport _ASSET_SAND_CASTLE from './assets/templates/sand-castle.png'\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-05-25\r\n */\r\nexport default class TemplateDefs {\r\n\r\n    static ROCK_SM = {\r\n        info: {\r\n            displayName: \"Small Rock\",\r\n            category: \"template\",\r\n            // icon: {\r\n            //     imageData: _ASSET_ROCK_SM_ICON\r\n            // }\r\n        },\r\n        action: {\r\n            type: \"random-template\",\r\n            actions: [\r\n                {\r\n                    type: \"image-template\",\r\n                    imageData: _ASSET_ROCK_SM_1,\r\n                    brush: \"rock\",\r\n                    threshold: 50,\r\n                    randomFlipHorizontally: true\r\n                },\r\n                {\r\n                    type: \"image-template\",\r\n                    imageData: _ASSET_ROCK_SM_2,\r\n                    brush: \"rock\",\r\n                    threshold: 50,\r\n                    randomFlipHorizontally: true,\r\n                    randomFlipVertically: true\r\n                },\r\n                {\r\n                    type: \"image-template\",\r\n                    imageData: _ASSET_ROCK_SM_3,\r\n                    brush: \"rock\",\r\n                    threshold: 50,\r\n                    randomFlipHorizontally: true\r\n                }\r\n            ]\r\n        }\r\n    };\r\n\r\n    static ROCK_MD =  {\r\n        info: {\r\n            displayName: \"Medium Rock\",\r\n            category: \"template\",\r\n            // icon: {\r\n            //     imageData: _ASSET_ROCK_ICON\r\n            // }\r\n        },\r\n        action: {\r\n            type: \"random-template\",\r\n            actions: [\r\n                {\r\n                    type: \"image-template\",\r\n                    imageData: _ASSET_ROCK_1,\r\n                    brush: \"rock\",\r\n                    threshold: 50,\r\n                    randomFlipHorizontally: true\r\n                },\r\n                {\r\n                    type: \"image-template\",\r\n                    imageData: _ASSET_ROCK_2,\r\n                    brush: \"rock\",\r\n                    threshold: 50,\r\n                    randomFlipHorizontally: true,\r\n                    randomFlipVertically: true\r\n                },\r\n                {\r\n                    type: \"image-template\",\r\n                    imageData: _ASSET_ROCK_3,\r\n                    brush: \"rock\",\r\n                    threshold: 50,\r\n                    randomFlipHorizontally: true,\r\n                    randomFlipVertically: true\r\n                },\r\n                {\r\n                    type: \"image-template\",\r\n                    imageData: _ASSET_ROCK_4,\r\n                    brush: \"rock\",\r\n                    threshold: 50,\r\n                    randomFlipHorizontally: true,\r\n                    randomFlipVertically: true\r\n                },\r\n                {\r\n                    type: \"image-template\",\r\n                    imageData: _ASSET_ROCK_5,\r\n                    brush: \"rock\",\r\n                    threshold: 50,\r\n                    randomFlipHorizontally: true\r\n                },\r\n                {\r\n                    type: \"image-template\",\r\n                    imageData: _ASSET_ROCK_6,\r\n                    brush: \"rock\",\r\n                    threshold: 50,\r\n                    randomFlipHorizontally: true,\r\n                    randomFlipVertically: true\r\n                }\r\n            ]\r\n        }\r\n    };\r\n\r\n    static ROCK_LG = {\r\n        info: {\r\n            displayName: \"Large Rock\",\r\n            category: \"template\",\r\n            // icon: {\r\n            //     imageData: _ASSET_ROCK_LG_ICON\r\n            // }\r\n        },\r\n        action: {\r\n            type: \"random-template\",\r\n            actions: [\r\n                {\r\n                    type: \"image-template\",\r\n                    imageData: _ASSET_ROCK_LG_1,\r\n                    brush: \"rock\",\r\n                    threshold: 50\r\n                },\r\n                {\r\n                    type: \"image-template\",\r\n                    imageData: _ASSET_ROCK_LG_2,\r\n                    brush: \"rock\",\r\n                    threshold: 50,\r\n                    randomFlipHorizontally: true\r\n                }\r\n            ]\r\n        }\r\n    };\r\n\r\n    static CABIN = {\r\n        info: {\r\n            displayName: \"Cabin\",\r\n            category: \"template\",\r\n            // icon: {\r\n            //     imageData: _ASSET_WOODEN_HOUSE_ICON\r\n            // }\r\n        },\r\n        action: {\r\n            type: \"image-template\",\r\n            imageData: _ASSET_WOODEN_HOUSE,\r\n            brush: \"wood\",\r\n            threshold: 50,\r\n            randomFlipHorizontally: true\r\n        }\r\n    };\r\n\r\n    static SAND_CASTLE = {\r\n        info: {\r\n            displayName: \"Sand Castle\",\r\n            category: \"template\"\r\n        },\r\n        action: {\r\n            type: \"image-template\",\r\n            imageData: _ASSET_SAND_CASTLE,\r\n            brush: \"sand\",\r\n            threshold: 1\r\n        }\r\n    };\r\n}\r\n","var img = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAATCAYAAACdkl3yAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC7UlEQVQ4T62UPW9cRRiFn5k793Pt682yzoq4wOAoFBEyihA0Bgk6CoqkMBU/gAYpQhR0KdOlhAJRpcF/gC5IKCiYEBnHGCKEsVMYO9rY3t27vp8zdyjAa6+ddJzyaM6j94zeGcX/JHXaAFi89oGtdAaiphFNEDVaLC/fZ3VtXZw+e6QzoHfeftPmRYI2FcbkDAYDXpqdotO5wDzY58HU0tKSt7i4WB4Z0tYMDxOkBCktQsD+XpdGI+Dl2TlW19ZP5kdSJyE3bnz2+k/3fqSscoypKMqS2kjS4RPiyRZ1bZh/7fIzpxqr9nSnu/LGlSs8evQb3W4XB4cyKzFVRTz9Ivu9HtPN1snISGOgYZIQxxM0okn2ZQ9TgRISARRZjjUGAby3sGDv3L07NtUYSGtNmh4y1Zxie3uH0lQox8NKzTDpUwsQAkpdnak4BgrCgCRJ6HQu4AhBXRtcRyGFIMtz/DDAWouUknNx82T0GPTRh9esEJL0MOXg6R5BEJANU4zWSEcS+j7GWoqypNU+z2CYjE01AimlaLdfoMwyHEfSbrfZ3d5BOhIHBwAhBFCjTYVyXebmjtdhBHKwNIKIIPCpipzA85iYCNHGYkpzdAyAPM8JopCNjY2RpwA+//QT+9eff2Ctpq4NeZqhteZ8p0O/N2BQJqOAsFCkKY0oojXZ5Itbt2Y/vn59SwGsPviZdrvFw5U1ZmZmcKVHnue4ro9SPmnexfV90jRHa40fhvT2DximGV9+/dUmIBTA3kGfKApI05zNrU2KosBoTRw36ff7xHGM53lkWYFUCmtrhFDUdc3Dtd+PL3t5dV0AFuDixVcIKsPW48c4rk9a5GAlaVGSpilBFOL6Icrx8IKIb2/enH3/6tV/qx3B3l1YsH8/OQAgmogxViCVS1EUKKEIopDp6Q67u10e/HpPANz54Xvg1EJ+99/avzV/2UaT59A1KC/AcX2KouDVS5e4/c3SmQcLz/iPYFT1jO6v/HLaGukfK6ZXUFEV3tAAAAAASUVORK5CYII=\";\n  export default img;","var img = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAALCAYAAACQy8Z9AAAACXBIWXMAAAsTAAALEwEAmpwYAAAB6klEQVQoU7WSzU4TURiGnzNz5qfTMkEMaFkg0XgXbePCcAWscKXeSG+GRAVvgLgw6J4ASwKr0kCBTmf6M2dmzum4aKhQY1z57M57zvfkTb4j+Q/IxWCRVqNZKjVmefkJtVqVMAzR2lAUOZ/3vorF9/AXaavRLAE8zyHPc4SwiOOYm5sbpLSZ3Xm0Gs1yOIw5Oj55JJ9LW41m+XRlhSxP0dpgjKYoCqS08TwPYzSTyexs25KyLBkOY+r15xwdnzx0zqT3zZIkQTqzJq7rYts2taDKZDxmkqYk05hBP8KREum52LYkSRLetJrl98Mf87YSYL1eZ5KmZFnG0lIVAK0LsixDKYXruqyurvJsbY1Op0OeF0yyFKUUWhcEQZWtrbflwcE3MZcCVHwfKW3G4xFhGOJ5NaR02NzYoNPpcHnZpdfrkRc5QgiwBI4jUUohhCBKBrx++ao8uzgXEuDT3hfx8f2HsuL75IUiDEOMmTIYRJyenNLrXSOEhTaaqTEIYSGwwALf99HaUA2qjOIRj5qqPGNj8wXRXZ9u94rrq2uGoyFRPyKoBjjSwbZsUpUDhnc7O3a73Z7ezz9kLt3d3RXb29ulyQtu726pVAKifkR9fZ3Dn7+XcE+73V6M5jz6p/v7+38Mn12cL0b/5Bf4ONku8uljuAAAAABJRU5ErkJggg==\";\n  export default img;","var img = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAASCAYAAABfJS4tAAAACXBIWXMAAAsTAAALEwEAmpwYAAADFklEQVQ4T7XUz2ucRRzH8fc8z+zMs88++yvG1GRrhUKLWOKhxTZYqeBBinrwUr34X4l4lyLoqQcFxZLakJb+sF7ExkAuSmh2m/3R7JN95vk9HpYkVkJsDn6Ow3xfDDMfRvI/Rf574ahceuuiPTH/Ckop4shQrwdsbm4CMBgMefzHmtjb+0LwtWvXrNaa4XafJEkYDQakacZoOMSVEsdxmJubY2Fh3t5cXhZwCHz50kWrtQZgYhLuP3wgJuMQ/ZICYH7uBOrkqxRZxsbGBtJxMcagqh5PnmztO/vwB1fftzWvSmQMVc9DCMG8Upx7/awd7jxjNwyx1rKzs4MrJVpKTp16jbW1NVrtFiaOcR2HxTfO2d8e/y4kTO9u1B8Sex5SCl6eaSOEi+/7rK+vI5XCWovWinD8jLIsGQwGaK1pNAPKMqe0lloQYK09OHEYhniug680eZLxtNslTQsAlFK4rkteFNRrAXFkyPJ8OuxKhBCEYYiu+vh+jTiOD+A3Fxfpd7fob/XwfR+bQxD4AGitkLoCgC1yZmfaJFlKq9HEdV1MmlD1PIKgxqDfx1XTvRKg2+sx6j2l3WphjKEoCiITAyVe1SOODMJ1sNbSarWZnZ1lYmKstRSjEYXOUUpRlCVSTBsnAX5euS3eu3zFRvEuwquw8ugXcfXKuzbcDTFJhhCCdr3O9vY2Qgji2JDlGdJ1SbOYWuCTJAnNZpOFkx1W7947aMXynZX9cgP8sHJbLF04b+M4RimF79c4fbrOeDwmtwWeVyUIakRJTKfT4c7qXc6cOctX178+vMf/zL1Hv4qlC+dtsyIZ704QQiCES7PeJM9z/vpzk6DZoLvVo9Fu41Tc/dkjYTjApZQsdDoUZUGcJoQ7YxzHwUSGSTSZVq/R2J/7Txim+GeffmK7vS6TKMJxHMqyxHEcsjTFcVzaszN8/sWXx/srAK5/8634+KMPbUVWSNOUNEuxpUVrjTERt26sPvdGLwwD3Pjue/HO20tWCEHQaLAzHHJr9XlwL8eCAbKsRCmXH3+6eSi4l2PD9x8+OBLcy99QElUk8fCpxwAAAABJRU5ErkJggg==\";\n  export default img;","var img = \"data:image/png;base64,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\";\n  export default img;","var img = \"data:image/png;base64,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\";\n  export default img;","var img = \"data:image/png;base64,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\";\n  export default img;","var img = \"data:image/png;base64,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\";\n  export default img;","var img = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAeCAYAAABNChwpAAAACXBIWXMAAAsTAAALEwEAmpwYAAAHJUlEQVRIS8WWy29cVx3HP+fec+c+Zjz22OO4SZo6jd02Jm1C20RJoFSoEiB2laoUVECqBP9A1my6gQ1Su2EJCDVUokI8FkgoBaKoFFIoIBq1pKR5+BF7/Bh73nNf58Fi3Ch2nDQRC77Le8/5/T7nd76/c47k/yy5/cO96qnDMxbgnxcvie3/7kf3DfDU4RnbaLRotZoMD49w+NAjthgVOX7sGA9Nz0SnT59OhBB2+7w76b4Anjo8YzudDp7n4knBUDHkwT17ieOY5sY6u5qr/Ref/yrPnniat9/9xz1V5r4AGvUGQVggKobUbixw/NhRIj9grDLM2NgYy0s38KQDwJGZaYvrUBkZ4/w7F+4Ic88Ax5983DY3Guzbu4fdE+OMlor40iXp95iamsLxXBCGyQf3MVQa5tz5twmDgOWVJZ774jP23Pl3doS4J4Af/uD7J3/2+utUhkKOHDxIbbXGngcmGB4qk3spy0tLBFFI2o9RuaLZbOK5As+X6NRy5coVXnvte7tPn/5ubXvsewL4yZkzfxkLIx57ZIqCdEFrpqam6fV7VEYrWGuZn5snLEW0mi021uoMlYv04pTyUAlXurz5xptLwG1V+FSAV199NTz7q18gsfS6PVZWakxMTOAAE9Vx1tc32PXAbhxniTTJ2Wg0yfKcYhTR7cdYYwmCYHvYm7orwCuvvOK89dtf963VTD06TX1thcXFxcGeOw5JkuC6Dp1Oh5HKCK12m7gfE0URmcqRrqTZbFKujBInyfbwwKcAzF2+rH3pYYVAaU2z2eRzzzyD9Av00wS/EKKtYGFhAWUNq6srAIyMjHDl2lWEBd/3cYTAdVy+8/I37I9++saWbbgrwMLcLJP79tLrtBgbHWVxXhJGIa7jkGU5ANZalDVEYcjc7ByT+yfxPI9Go0GlUgVAChfj7Xw23RHgm6dO2cZ6nSRJePjhA8zOzbFn715GKxW6vR42TQFIkhghBIuLi4RhiCc94jjGcRx8v0CeKwB86dHvdm9NAdwFYOnGPEJYJg/PUJAuaZqyb89ufN+n1+8Dg9XX6+u0uh26nQ5BGOBHIcvLy1SrVRzHJcv64LgUCgXCMOTb3/q6/fGZn9/chh0BXn7pBTs/O0ttscbC/AT9bpuHJicZGR1jea1O5AcYK9BYenEflWuKxTJuQZJnmm63T7VapRfHaK2xVlMql0myFCn9Lbl2BLhxYx5rc54++iStZovK8BDSdVFaYbRBG4Pv+8xev06SJKRpjlJ9cqPQSgMD8y2vruJ6kiRJCMKAIIjodntbcu0I0Ov3qAyVqFQq1Ot1KqMP4UqJVhprB2Yy2lBbrtFut7FGoLUmVTlGG8bHx9lYXyeKQvqb7efc4sGvvfC8ffOXvxGwA8CXnj1mAZ54/AlqtRU8z6NULGGtRZvB6nOtWa2vkeeKNE3JUo3rOkjPw/VdrLX4vs9KvU5UKmKMIUkSkjghCAKEcG/muw3Ai4ZxTYpX8FicX+DEiRP4vk+aphij0UrhScnlq1fwA59MKYR0MYBRObnKicISjUYb1/XACPbvP0CWabxCgTzLyPNBB8EOANZajDbkWc7k/knGqlV63S5CCIw2OK7DRx9fJk1Tmo0GruviiK1hupvtFhUjRioVrBVI6aK1RjgC4QistUIIYbfM/MqXn7PGWqYPTCGF5NChGVZXl4nCIq4cmEkIh6WlJfI8p5fEhGGIlIMwdrO5lLJI18X3fcJihNED02ZZhu/7CGF56cVTBtiK/olRdlXHcaxhqDRMq9VBG4MnJVoplDXkWUYcx/i+j1KWIJAIIbDWYq0lDD0AjIA8zxFC4rgOWZrihCFCCDxvMOa2LZienkblisb6OkJIPD9E5QrheuBKVmo1Hj34Gd6/eJEgCIjjPsWoRKoUWiuwljj9xGyCLMsRriXXltLQMIVCgYnde5mdvQ5sAxiujg7aKknod/v88fwfADh58vMorXCkpFQq0u322LVrF+12m9HRMXJt8DaLqbVCKTXoGq1J05zxiTGyLMNojYkihBCkm0f5TYDHZw7aDz+8RCkKSVodHMvmwJgLF/4MwMzMIT6+fJVca4IwIElz/DDC8zyUMRgBKIH0CzjSxQjQVnPt2jX2HzhAuVym2+2wtrZ2842wpQK+79NpdXGtoFDwSNOUNFe0OxnloQIX3v0buC7hZnmr4+N4niRTCkcr5Kany+UynvRxHGdgUMdDa0Wv1yWOE9rtNr87+/utB9EHlz7ack9/9rFHLUAUFZEFn2Y3RRkwVqP6Mb0kAQwAY9UqAL04QTgO1hgskiDwEK6kWPRQSmNtSprFnH3r3N0vI4B//efybe+3W/WFY0csQC9VbKw3KVdG0FrTa7cJgiJaxeS5YnTzzTg7e52LH/z7tph3BPg0/em9928Ltl3Hjx21GxsNgB2Tw/8AcC/663t/3zHprfovP2tqaiT8rXwAAAAASUVORK5CYII=\";\n  export default img;","var img = \"data:image/png;base64,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\";\n  export default img;","var img = \"data:image/png;base64,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\";\n  export default img;","var img = \"data:image/png;base64,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\";\n  export default img;","var img = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC4AAAAkCAYAAAD2IghRAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAFcUlEQVRYR82Y3W4TRxTHf7vetb2Osd2AY18kogqpKkETSC7sUEEAqep9L7jhEfoYfYA+BqqUN6hUKNyUQgnioxcVigOqIR84ITHGG3u9M73YzHr9tXZIgP5udj1n9sx/Zs7MmbHBR2Jp6YpsNBrEYjHu3r2jdduPitFdcFQKhaKMRCIIITCjJq5wKRYXpXBdHvz14Ng6cGzCFxcvSiklZtRESsne3h5CCPSITjqdRkqDQqEodV3n3r0/Ojrww/ffyWjcwjRNIhqsr67x66NHoZ08kvCrV69JIQQArnABqO5VAZg91fDrPduuIqUkeSKJrutcvrwkTdPk1q3fNAApdVxNx2jYtAwTDc9nGB8k/NKly9JxHFzXE4sWFNwCXBJWEoBkMsY3bAMRnlZqaJpGOp2m6TQpFhclQHlnh7NGlpZpEDUMNEIHGzik8Pn5BRkxImi6hhk1/XDQNK1HcCrlPROWQa3mvc+eqgHw5I1A13VS6RS6piOiJk/WN4jHY3w1cRLDjDOMocILhaJ0HAdN00ilUriuy9udtwghuJCTgDfqSrAiYRnU7RZRa4x8zivb2PSec9kaEOHx1luklEQMgy8yGVzh8uzf9fZMhjBQ+MWL30p73yYej2NZFltbW+zv7wP4goNi1Qgr6nYLgN2dPb9M1UkmY9RqDc5PeDMAksdb28RiMVKpFFJKLlyYl/F4vGchK3qEFwpF2Wg2MAyDdCpNpVJBCMF8Xo1ChIRlkc9lfHGHRddN8jnLnwHgoBOCv3dcHMchm80ipGB2dk5alsX9+392dMAXfuXKVbm/v080GsWMmlSrVYQQnJ9wgHYo5HMZ9QmZ8bT/Dt7oqrLgSHfXU+RzELXGAGja79nY3OXcuFoH2+i6TjrjfVssLsp4PM6dO79rAEahUJQArutimIa/4OayLuAykT1JrdboEKxo2u+7i0YuUwQ7mM9l2Nj0QmmOXcDlaWUPNDiRSuEKl0KhKKUQGG6rhSsFTsvBaTrMZZu+I4CtN9sAlF6oePz41O12W7OnvBB9WqliRk2EK7xBfrjy0I+dG9fOyukvJ/2PwFtkCatnKXwG1rl5+4mvtUfRxubuwZTtAt60qWrK9qlRWoL0CK/btY6wqNs1tt607Z8yZDqJdPzqEa52j7ptk7CsLuunJaihbtsdth7h7TDpzV7BvTszng7dLRT9pnl03I6wDdIjPMigbAid21gY3T5GJWEZlF7UBia5UOFBNjY3uosAyOfy3UUjcVR/ocLVQSkznubnX/pfv3768WvZXaYyaPAJXnip95u3/wn1NywMQ4Urwpw07ff+dKqOQjuU1DNhGSOFl/I3LHeEWw8YFGfQaRu1Xhij1gsVHrXGiFrhCzFhGf5BKXjI6mbQAawfg3wECRUeDINB1O0WdbstJExUmC3I7s7e0UJlmOiPybC2Q4VXq7WRLwxqYQ4aqaBtmL+EZfRNOkH6t3JAKpUc2ohC1QurH2YLUrdb5HOZ0HNRqPDg9vZ/I1S42lUAblzrTTQw2g7Qj2H+wnIHDBEeTAbdFwxFdwIKI1hvFH9hhLd0wCiO4HjrDRuEcCsfHgqHYadSASA5ZnXc+sMYKnyYg+MgOda+sHS3l7AMqt7fkh30CC+9KPd9/1y0NQy4ui0tLcnGeBYpJeVymcnJSXRdR9O802epVOLMmTM4jkO5XGZqaopIxHOmaRpS9t0kBqL8qj9Ng5RKJaanpwFotVq8evWKqakprl8/J5eXlzU4ED4/Py+r1Srv3r1DSommabx8+RLw/ihSjp8/fw6AlJK1tTUOy8zMTMdAqM7qus7k5CSvX7/m9OnTzMzM4Louq6ur/rerq6vous7CwoJcWVnR/gMS6rip19cCIwAAAABJRU5ErkJggg==\";\n  export default img;","var img = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAAOCAIAAACtuNvgAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAB5UlEQVQoz1XPy04UURAG4Ko6t+6eGRkl0dGFLly5cOv7+AY+itEVCStDfBg1JhICbCQIiAmCc6FP97mXi9EJXZtK/sqXqkJmhv91/PktM7x49QaGdXm4x0pnZ5++fL1OaDM7P9xTciyFPjv4cNecfNsNXNq+db7bjP6x7193gm+ZgtYm39l/9OW9QIyu7RZXRCJEu87luuWcfAqCBI4m2S83rGqmSjYo+8RBCIopDpjSejJ9kktw3UKresNyDq1tkaCutr1bNM10wLgU2/8uIIiZVLVh3t4KIgAjuDeqRlSD33rf3c7n7B0i9N31yf7OOp9OtsfjSVOJ5eImINjuarDtwfaz7Nu2W6ZUtBzZdnV6sAfF5ZRzSYXTw9lzSiUgDdhq+ROZiFDryvteG/3j9Hz2eAqcYvKVHvlu7r1HMoMjjW6kFjFGH3pTVecXNyH4s4s5AxOqEJ2WtRSKsx8w26+8d1LKVLK1rTENQ/ZuRUjj5p5UCjAT4mRrNmBaGYGaGaaTR3XdWLtS0milS4JbO/fe9a6PzDEsTvd3AQCZ+ejTu7oaMRdEijGQaUK3ICRCAYBAzBliDve3Zi4scyopR/nr+CMAh9gJKQVr57sGBQNoo4Gxd50RlaxlA+M/y0sSJiUrSf0F+OQcr89DEA8AAAAASUVORK5CYII=\";\n  export default img;","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-05-05\r\n */\r\nexport default class StateDefinition {\r\n\r\n    static #createStateTransition(stateFrom, stateTo) {\r\n        const transitions = [];\r\n        for (let i = 0; i < stateFrom.length; i++) {\r\n            const [ax, ay] = stateFrom[i];\r\n            const [bx, by] = stateTo[i];\r\n            if (ax === bx && ay === by) {\r\n                continue;  // no change\r\n            }\r\n            transitions.push([[ax, ay], [bx, by]]);\r\n        }\r\n        return transitions;\r\n    }\r\n\r\n    static #createStateTransitionTable(states) {\r\n        const stateTransitions = [];\r\n        for (let i = 0; i < states.length; i++) {\r\n            stateTransitions.push(StateDefinition.#createStateTransition(states[i], states[i + 1 < states.length ? i + 1 : 0]));\r\n        }\r\n        return stateTransitions;\r\n    }\r\n\r\n    static createCyclic(states) {\r\n        const transitions = StateDefinition.#createStateTransitionTable(states);\r\n\r\n        let minX = Number.MAX_VALUE;\r\n        let minY = Number.MAX_VALUE;\r\n        let maxX = Number.MIN_VALUE;\r\n        let maxY = Number.MIN_VALUE;\r\n        for (let state of states) {\r\n            for (let [dx, dy] of state) {\r\n                minX = Math.min(minX, dx);\r\n                minY = Math.min(minY, dy);\r\n                maxX = Math.max(maxX, dx);\r\n                maxY = Math.max(maxY, dy);\r\n            }\r\n        }\r\n\r\n        const masks = [];\r\n        for (let state of states) {\r\n            masks.push(new StateMask(state, minX, maxX, minY, maxY));\r\n        }\r\n\r\n        return new StateDefinition(states, masks, transitions, minX, maxX, minY, maxY);\r\n    }\r\n\r\n\r\n    #states;\r\n    #masks;\r\n    #transitions;\r\n    #minX;\r\n    #maxX;\r\n    #minY;\r\n    #maxY;\r\n\r\n    constructor(states, masks, transitions, minX, maxX, minY, maxY) {\r\n        this.#states = states;\r\n        this.#masks = masks;\r\n        this.#transitions = transitions;\r\n        this.#minX = minX;\r\n        this.#maxX = maxX;\r\n        this.#minY = minY;\r\n        this.#maxY = maxY;\r\n    }\r\n\r\n    getStates() {\r\n        return this.#states;\r\n    }\r\n\r\n    getStatesCount() {\r\n        return this.#states.length;\r\n    }\r\n\r\n    getMasks() {\r\n        return this.#masks;\r\n    }\r\n\r\n    getTransitions() {\r\n        return this.#transitions;\r\n    }\r\n\r\n    getMinX() {\r\n        return this.#minX;\r\n    }\r\n\r\n    getMaxX() {\r\n        return this.#maxX;\r\n    }\r\n\r\n    getMinY() {\r\n        return this.#minY;\r\n    }\r\n\r\n    getMaxY() {\r\n        return this.#maxY;\r\n    }\r\n}\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-05-05\r\n */\r\nclass StateMask {\r\n\r\n    #minX;\r\n    #maxX;\r\n    #minY;\r\n    #maxY;\r\n    #array\r\n\r\n    constructor(state, minX, maxX, minY, maxY) {\r\n        this.#minX = minX;\r\n        this.#maxX = maxX;\r\n        this.#minY = minY;\r\n        this.#maxY = maxY;\r\n\r\n        const w = Math.abs(minX) + 1 + maxX;\r\n        const h = Math.abs(minY) + 1 + maxY;\r\n        const array = new Uint8Array(w * h);\r\n        for (const [dx, dy] of state) {\r\n            const x = dx - this.#minX;\r\n            const y = dy - this.#minY;\r\n            const i = x + (w * y);\r\n            array[i] = 1;\r\n        }\r\n        this.#array = array;\r\n    }\r\n\r\n    matches(dx, dy) {\r\n        if (dx < this.#minX || dy < this.#minY || dx > this.#maxX || dy > this.#maxY) {\r\n            // out of bounds\r\n            return false;\r\n        }\r\n        const w = Math.abs(this.#minX) + 1 + this.#maxX;\r\n        const x = dx - this.#minX;\r\n        const y = dy - this.#minY;\r\n        const i = x + (w * y);\r\n        return this.#array[i] === 1;\r\n    }\r\n}\r\n","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport ElementHead from \"../ElementHead\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-05-26\r\n */\r\nexport default class EntityUtils {\r\n\r\n    static isElementFallingHeavy(elementHead) {\r\n        if (elementHead === null) {\r\n            return false;\r\n        }\r\n        const typeClass = ElementHead.getTypeClass(elementHead);\r\n        if (typeClass === ElementHead.TYPE_POWDER || typeClass === ElementHead.TYPE_POWDER_WET) {\r\n            return true;\r\n        }\r\n        if (typeClass === ElementHead.TYPE_STATIC) {\r\n            if (ElementHead.getBehaviour(elementHead) === ElementHead.BEHAVIOUR_ENTITY) {\r\n                return false;\r\n            }\r\n            if (ElementHead.getTypeModifierSolidBodyId(elementHead) > 0) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    static isElementLight(elementHead) {\r\n        if (elementHead === null) {\r\n            return false;\r\n        }\r\n        const typeClass = ElementHead.getTypeClass(elementHead);\r\n        return typeClass <= ElementHead.TYPE_GAS;\r\n\r\n    }\r\n\r\n    static isElementWater(elementHead) {\r\n        if (elementHead === null) {\r\n            return false;\r\n        }\r\n        const typeClass = ElementHead.getTypeClass(elementHead);\r\n        return typeClass === ElementHead.TYPE_FLUID\r\n            && ElementHead.getBehaviour(elementHead) === ElementHead.BEHAVIOUR_LIQUID\r\n            && ElementHead.getSpecial(elementHead) === ElementHead.SPECIAL_LIQUID_WATER;\r\n    }\r\n\r\n    static isElementEntity(elementHead) {\r\n        if (elementHead === null) {\r\n            return false;\r\n        }\r\n        const behaviour = ElementHead.getBehaviour(elementHead);\r\n        return behaviour === ElementHead.BEHAVIOUR_ENTITY\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\n/**\r\n * @interface\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-04-27\r\n */\r\nexport default class Entity {\r\n\r\n    /**\r\n     * @return {string}\r\n     */\r\n    getType() {\r\n        throw 'Not implemented';\r\n    }\r\n\r\n    /**\r\n     * @return {number}\r\n     */\r\n    getX() {\r\n        throw 'Not implemented';\r\n    }\r\n\r\n    /**\r\n     * @return {number}\r\n     */\r\n    getY() {\r\n        throw 'Not implemented';\r\n    }\r\n\r\n    /**\r\n     * @returns {boolean}\r\n     */\r\n    isActive() {\r\n        throw 'Not implemented';\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @returns {object}\r\n     */\r\n    serialize() {\r\n        throw 'Not implemented';\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @returns {void}\r\n     */\r\n    initialize() {\r\n        throw 'Not implemented';\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @returns {boolean} alive\r\n     */\r\n    performBeforeProcessing() {\r\n        throw 'Not implemented';\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @returns {boolean} alive\r\n     */\r\n    performAfterProcessing() {\r\n        throw 'Not implemented';\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param defaultElement {Element}\r\n     * @param rx {number} relative x\r\n     * @param ry {number} relative y\r\n     * @returns {[object, PositionedElement[]]}\r\n     */\r\n    extract(defaultElement, rx, ry) {\r\n        throw 'Not implemented';\r\n    }\r\n\r\n    paint(x, y, elementArea, random) {\r\n        throw 'Not implemented';\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @returns {[number, number]}\r\n     */\r\n    countMaxBoundaries() {\r\n        throw 'Not implemented';\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport ElementHead from \"../ElementHead\";\r\nimport Entity from \"./Entity\";\r\nimport PositionedElement from \"../PositionedElement\";\r\n\r\n// TODO: support collisions/interleaving with other entities\r\n// TODO: support flammability\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-05-05\r\n */\r\nexport default class StateBasedAbstractEntity extends Entity {\r\n\r\n    /** @type ElementArea */\r\n    _elementArea;\r\n    /** @type DeterministicRandom */\r\n    _random;\r\n    /** @type ProcessorContext */\r\n    _processorContext;\r\n\r\n    /** @type StateDefinition */\r\n    _stateDefinition;\r\n    /** @type Brush */\r\n    _brush;\r\n    _areaBoundary;\r\n\r\n    /** @type string */\r\n    _type;\r\n    _iteration = 0;\r\n    _x = 0;\r\n    _y = 0;\r\n    _waypoint = null;\r\n    _state = 0;\r\n    _stuck = 0;\r\n\r\n    constructor(type, serialized, stateDefinition, brush, gameState) {\r\n        super();\r\n        this._type = type;\r\n        this._stateDefinition = stateDefinition;\r\n        this._brush = brush;\r\n        this._areaBoundary = 2 * (Math.abs(this._stateDefinition.getMinX() - this._stateDefinition.getMaxX()) + 1);\r\n\r\n        this._elementArea = gameState.elementArea;\r\n        this._random = gameState.random;\r\n        this._processorContext = gameState.processorContext;\r\n\r\n        if (serialized.iteration !== undefined) {\r\n            this._iteration = serialized.iteration;\r\n        } else {\r\n            // set randomly; so state change will not be on the same time\r\n            this._iteration = this._random.nextInt(this._stateDefinition.getStatesCount());\r\n        }\r\n        if (serialized.x !== undefined) {\r\n            this._x = serialized.x;\r\n        }\r\n        if (serialized.y !== undefined) {\r\n            this._y = serialized.y;\r\n        }\r\n        if (serialized.state !== undefined) {\r\n            this._state = serialized.state;\r\n        } else {\r\n            // random state by default\r\n            this._state = this._random.nextInt(this._stateDefinition.getStatesCount());\r\n        }\r\n        if (serialized.stuck !== undefined) {\r\n            this._stuck = serialized.stuck;\r\n        }\r\n    }\r\n\r\n    // abstract methods\r\n\r\n    _checkIsSpace(elementHead) {\r\n        throw 'Not implemented';\r\n    }\r\n\r\n    performBeforeProcessing() {\r\n        return this._state !== -1;\r\n    }\r\n\r\n    performAfterProcessing() {\r\n        return this._state !== -1;\r\n    }\r\n\r\n    // methods\r\n\r\n    serialize() {\r\n        return {\r\n            entity: this._type,\r\n            iteration: this._iteration,\r\n            x: this._x,\r\n            y: this._y,\r\n            state: this._state,\r\n            stuck: this._stuck,\r\n        };\r\n    }\r\n\r\n    getType() {\r\n        return this._type;\r\n    }\r\n\r\n    getX() {\r\n        return this._x;\r\n    }\r\n\r\n    getY() {\r\n        return this._y;\r\n    }\r\n\r\n    assignWaypoint(x, y) {\r\n        this._waypoint = {\r\n            x: x,\r\n            y: y,\r\n            stuck: 0\r\n        }\r\n    }\r\n\r\n    unassignWaypoint() {\r\n        this._waypoint = null;\r\n    }\r\n\r\n    isActive() {\r\n        return this._state !== -1;\r\n    }\r\n\r\n    initialize() {\r\n        this.paint(this._x, this._y, this._elementArea, this._random);\r\n    }\r\n\r\n    _incrementState() {\r\n        const x = this._x;\r\n        const y = this._y;\r\n\r\n        const transitions = this._stateDefinition.getTransitions()[this._state];\r\n\r\n        let allowed = true;\r\n        for (const [[dx1, dy1], [dx2, dy2]] of transitions) {\r\n            if (!this._elementArea.isValidPosition(x + dx1, y + dy1) || !this._checkIsSpaceAt(x + dx2, y + dy2)) {\r\n                allowed = false;\r\n                break;\r\n            }\r\n        }\r\n\r\n        if (allowed) {\r\n            for (const [[dx1, dy1], [dx2, dy2]] of transitions) {\r\n                this._elementArea.swap(x + dx1, y + dy1, x + dx2, y + dy2);\r\n            }\r\n\r\n            this._stuck = 0;\r\n            this._state++;\r\n            if (this._state === this._stateDefinition.getStates().length) {\r\n                this._state = 0;\r\n            }\r\n        } else {\r\n            // stuck\r\n            this._stuck++;\r\n        }\r\n    }\r\n\r\n    _moveRandom(visionExtra) {\r\n        const xChange = this._random.nextInt(3) - 1;\r\n        const yChange = this._random.nextInt(3) - 1;\r\n\r\n        return this._move(xChange, yChange, visionExtra);\r\n    }\r\n\r\n    _moveInWaypointDirection(visionExtra) {\r\n        let dx = this._waypoint.x - this._x;\r\n        let xChange = 0;\r\n        if (dx > 0) {\r\n            // move right\r\n            xChange += 1;\r\n        } else if (dx < 0) {\r\n            // move left\r\n            xChange -= 1;\r\n        }\r\n\r\n        let dy = this._waypoint.y - this._y;\r\n        let yChange = 0;\r\n        if (dy > 0) {\r\n            // move up\r\n            yChange += 1;\r\n        } else if (dy < 0) {\r\n            // move down\r\n            yChange -= 1;\r\n        }\r\n\r\n        const moved = this._move(xChange, yChange, visionExtra);\r\n        if (moved) {\r\n            this._waypoint.stuck = 0;\r\n        } else {\r\n            this._waypoint.stuck++;\r\n        }\r\n    }\r\n\r\n    _move(xChange, yChange, visionExtra) {\r\n        const x = this._x;\r\n        const y = this._y;\r\n\r\n        const newPos = this.#countNewPosition(x, y, xChange, yChange, visionExtra);\r\n\r\n        if (newPos !== null) {\r\n            const [nx, ny] = newPos;\r\n\r\n            this.#relocate(this._stateDefinition.getStates()[this._state], x, y, nx, ny);\r\n\r\n            this._x = nx;\r\n            this._y = ny;\r\n\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    #countNewPosition(x, y, xChange, yChange, visionExtra) {\r\n        // check boundaries\r\n\r\n        if (x + xChange < this._areaBoundary && xChange < 0) {\r\n            xChange = 0;\r\n        }\r\n        if (x + xChange > this._elementArea.getWidth() - this._areaBoundary && xChange > 0) {\r\n            xChange = 0;\r\n        }\r\n\r\n        if (y + yChange < this._areaBoundary && yChange < 0) {\r\n            yChange = 0;\r\n        }\r\n        if (y + yChange > this._elementArea.getHeight() - this._areaBoundary && yChange > 0) {\r\n            yChange = 0;\r\n        }\r\n\r\n        // check further obstacles\r\n\r\n        if (xChange === 0 && yChange === 0) {\r\n            return null;\r\n        }\r\n\r\n        // test right | right\r\n        if (xChange > 0 || xChange < 0) {\r\n            for (let yy = this._stateDefinition.getMinY() - visionExtra; yy <= this._stateDefinition.getMaxY() + visionExtra; yy++) {\r\n                if (!this._checkIsSpaceAt(x + (xChange * 5), y + yChange + yy)) {\r\n                    xChange = 0;\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        // test above | below\r\n        if (yChange > 0 || yChange < 0) {\r\n            for (let xx = this._stateDefinition.getMinX() - visionExtra; xx <= this._stateDefinition.getMaxX() + visionExtra; xx++) {\r\n                if (!this._checkIsSpaceAt(x + xChange + xx, y + (yChange * 5))) {\r\n                    yChange = 0;\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        // check close obstacles\r\n\r\n        if (xChange === 0 && yChange === 0) {\r\n            return null;\r\n        }\r\n\r\n        const mask = this._stateDefinition.getMasks()[this._state];\r\n        for (const [dx, dy] of this._stateDefinition.getStates()[this._state]) {\r\n            if (mask.matches(xChange + dx, yChange + dy)) {\r\n                // its own part\r\n            } else if (!this._checkIsSpaceAt(x + xChange + dx, y + yChange + dy)) {\r\n                return null;\r\n            }\r\n        }\r\n\r\n        return [x + xChange, y + yChange];\r\n    }\r\n\r\n    _moveForced(xChange, yChange) {\r\n        const x = this._x;\r\n        const y = this._y;\r\n\r\n        const newPos = this.#countNewForcedPosition(x, y, xChange, yChange);\r\n\r\n        if (newPos !== null) {\r\n            const [nx, ny] = newPos;\r\n\r\n            this.#relocate(this._stateDefinition.getStates()[this._state], x, y, nx, ny);\r\n\r\n            this._x = nx;\r\n            this._y = ny;\r\n\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    #countNewForcedPosition(x, y, xChange, yChange) {\r\n        if (x + xChange < 0 && xChange < 0) {\r\n            xChange = 0;\r\n        }\r\n        if (x + xChange > this._elementArea.getWidth() && xChange > 0) {\r\n            xChange = 0;\r\n        }\r\n\r\n        if (y + yChange < 0 && yChange < 0) {\r\n            yChange = 0;\r\n        }\r\n        if (y + yChange > this._elementArea.getHeight() && yChange > 0) {\r\n            yChange = 0;\r\n        }\r\n\r\n        if (xChange === 0 && yChange === 0) {\r\n            return null;  // cannot move\r\n        }\r\n\r\n        // check is space\r\n        for (const [dx, dy] of this._stateDefinition.getStates()[this._state]) {\r\n            const ex = x + dx + xChange;\r\n            const ey = y + dy + yChange;\r\n\r\n            const elementHead = this._elementArea.getElementHeadOrNull(ex, ey);\r\n            if (elementHead === null) {\r\n                return null;  // cannot move\r\n            }\r\n            if (ElementHead.getBehaviour(elementHead) !== ElementHead.BEHAVIOUR_ENTITY) {\r\n                if (ElementHead.getTypeClass(elementHead) > ElementHead.TYPE_FLUID) {\r\n                    return null;  // cannot move\r\n                }\r\n            }\r\n        }\r\n\r\n        return [x + xChange, y + yChange];\r\n    }\r\n\r\n    _checkIsSpaceAt(tx, ty) {\r\n        const targetElementHead = this._elementArea.getElementHeadOrNull(tx, ty);\r\n        if (targetElementHead === null) {\r\n            return false;\r\n        }\r\n        return this._checkIsSpace(targetElementHead);\r\n    }\r\n\r\n    #relocate(state, x, y, nx, ny) {\r\n        const sortedPoints = [...state];\r\n\r\n        if (nx > x) {\r\n            sortedPoints.sort((a, b) => b[0] - a[0]);\r\n        } else if (nx < x) {\r\n            sortedPoints.sort((a, b) => a[0] - b[0]);\r\n        }\r\n        if (ny > y) {\r\n            sortedPoints.sort((a, b) => b[1] - a[1]);\r\n        } else if (ny < y) {\r\n            sortedPoints.sort((a, b) => a[1] - b[1]);\r\n        }\r\n\r\n        for (const [dx, dy] of sortedPoints) {\r\n            this._elementArea.swap(x + dx, y + dy, nx + dx, ny + dy);\r\n        }\r\n    }\r\n\r\n    _kill() {\r\n        const x = this._x;\r\n        const y = this._y;\r\n\r\n        for (const [dx, dy] of this._stateDefinition.getStates()[this._state]) {\r\n            const ex = x + dx;\r\n            const ey = y + dy;\r\n\r\n            const elementHead = this._elementArea.getElementHeadOrNull(ex, ey);\r\n            if (elementHead === null) {\r\n                continue;\r\n            }\r\n\r\n            if (ElementHead.getBehaviour(elementHead) !== ElementHead.BEHAVIOUR_ENTITY) {\r\n                continue;\r\n            }\r\n\r\n            let newElementHead = elementHead;\r\n            newElementHead = ElementHead.setType(newElementHead, ElementHead.type8Solid(ElementHead.TYPE_STATIC, 4, true));\r\n            newElementHead = ElementHead.setBehaviour(newElementHead, ElementHead.BEHAVIOUR_NONE);\r\n            newElementHead = ElementHead.setSpecial(newElementHead, 0);\r\n            this._elementArea.setElementHead(ex, ey, newElementHead);\r\n        }\r\n\r\n        this._state = -1;\r\n        return false;  // not active\r\n    }\r\n\r\n    paint(x, y, elementArea, random) {\r\n        for (const [dx, dy] of this._stateDefinition.getStates()[this._state]) {\r\n            const ex = x + dx;\r\n            const ey = y + dy;\r\n\r\n            if (!elementArea.isValidPosition(ex, ey)) {\r\n                continue;  // out of bounds\r\n            }\r\n\r\n            const element = this._brush.apply(dx, dy, random);\r\n            elementArea.setElement(ex, ey, element);\r\n        }\r\n    }\r\n\r\n    extract(defaultElement, rx, ry) {\r\n        const x = this._x;\r\n        const y = this._y;\r\n\r\n        const positionedElements = [];\r\n        for (const [dx, dy] of this._stateDefinition.getStates()[this._state]) {\r\n            const ex = x + dx;\r\n            const ey = y + dy;\r\n\r\n            const elementHead = this._elementArea.getElementHeadOrNull(ex, ey);\r\n            if (elementHead === null) {\r\n                continue;  // out of bounds\r\n            }\r\n            if (ElementHead.getBehaviour(elementHead) !== ElementHead.BEHAVIOUR_ENTITY) {\r\n                continue;\r\n            }\r\n\r\n            const elementTail = this._elementArea.getElementTail(ex, ey);\r\n            positionedElements.push(new PositionedElement(ex, ey, elementHead, elementTail));\r\n\r\n            this._elementArea.setElement(ex, ey, defaultElement);\r\n        }\r\n\r\n        const serializedEntity = this.serialize();\r\n        // relativize entity position\r\n        serializedEntity.x -= rx;\r\n        serializedEntity.y -= ry;\r\n\r\n        this._state = -1;\r\n        return [serializedEntity, positionedElements];\r\n    }\r\n\r\n    countMaxBoundaries() {\r\n        const w = Math.abs(this._stateDefinition.getMinX() - this._stateDefinition.getMaxX()) + 1;\r\n        const h = Math.abs(this._stateDefinition.getMinY() - this._stateDefinition.getMaxY()) + 1;\r\n        return [w, h];\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport ElementHead from \"../ElementHead\";\r\nimport EntityUtils from \"./EntityUtils\";\r\nimport StateBasedAbstractEntity from \"./StateBasedAbstractEntity\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-05-25\r\n */\r\nexport default class StateBasedBirdLikeEntity extends StateBasedAbstractEntity {\r\n\r\n    static #MAX_AVG_TEMPERATURE = 10;\r\n\r\n    static #MAX_STUCK_COUNT = 15;\r\n\r\n    constructor(type, serialized, stateDefinition, brush, gameState) {\r\n        super(type, serialized, stateDefinition, brush, gameState);\r\n    }\r\n\r\n    _checkIsSpace(elementHead) {\r\n        if (ElementHead.getTypeClass(elementHead) > ElementHead.TYPE_GAS) {\r\n            return false;\r\n        }\r\n        if (ElementHead.getBehaviour(elementHead) === ElementHead.BEHAVIOUR_FIRE) {\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    performAfterProcessing() {\r\n        this._iteration++;\r\n\r\n        let isActive = (this._state !== -1);\r\n        let isFalling = false;\r\n\r\n        if (isActive) {\r\n            const [retIsActive, retIsFalling] = this.#doCheckState();\r\n            isActive = retIsActive;\r\n            isFalling = retIsFalling;\r\n        }\r\n\r\n        if (isActive) {\r\n            if (isFalling || this._stuck > 0) {\r\n                const xChange = this._random.nextInt(3) - 1;\r\n                const yChange = 1;\r\n                this._moveForced(xChange, yChange);\r\n            } else if (this._iteration % 11 === 0) {\r\n                if (this._waypoint !== null) {\r\n                    if (this._waypoint.stuck === 10) {\r\n                        this._waypoint.stuck = -20;  // try random walk now...\r\n                    }\r\n                    if (this._waypoint.stuck >= 0) {\r\n                        this._moveInWaypointDirection(2);\r\n                    } else {\r\n                        this._waypoint.stuck++;\r\n                        this._moveRandom(2);\r\n                    }\r\n                } else {\r\n                    this._moveRandom(2);\r\n                }\r\n            }\r\n        }\r\n\r\n        if (isActive && this._stateDefinition.getStatesCount() > 1 && this._iteration % 10 === 0) {\r\n            this._incrementState();\r\n        }\r\n\r\n        return isActive;\r\n    }\r\n\r\n    #doCheckState() {\r\n        const x = this._x;\r\n        const y = this._y;\r\n        const points = this._stateDefinition.getStates()[this._state];\r\n\r\n        let heavyElementsAbove = false;\r\n        let totalTemperature = 0;\r\n        for (const [dx, dy] of points) {\r\n            const ex = x + dx;\r\n            const ey = y + dy;\r\n\r\n            const elementHead = this._elementArea.getElementHeadOrNull(ex, ey);\r\n            if (elementHead === null) {\r\n                // lost body part / out of bounds\r\n                return [this._kill(), false];\r\n            }\r\n\r\n            if (ElementHead.getBehaviour(elementHead) !== ElementHead.BEHAVIOUR_ENTITY) {\r\n                // lost body part\r\n                return [this._kill(), false];\r\n            }\r\n\r\n            totalTemperature += ElementHead.getTemperature(elementHead);\r\n\r\n            // update\r\n            this._elementArea.setElementHead(ex, ey, ElementHead.setSpecial(elementHead, 0));\r\n\r\n            // check element above\r\n            if (!heavyElementsAbove) {\r\n                heavyElementsAbove = EntityUtils.isElementFallingHeavy(this._elementArea.getElementHeadOrNull(ex, ey - 1));\r\n            }\r\n        }\r\n\r\n        if (totalTemperature / points.length > StateBasedBirdLikeEntity.#MAX_AVG_TEMPERATURE) {\r\n            // killed by temperature\r\n            return [this._kill(), false];\r\n        }\r\n\r\n        if (this._stuck > StateBasedBirdLikeEntity.#MAX_STUCK_COUNT) {\r\n            // stuck to death\r\n            return [this._kill(), false];\r\n        }\r\n\r\n        return [true, heavyElementsAbove];\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport ElementHead from \"../ElementHead\";\r\nimport EntityUtils from \"./EntityUtils\";\r\nimport StateBasedAbstractEntity from \"./StateBasedAbstractEntity\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-05-05\r\n */\r\nexport default class StateBasedFishLikeEntity extends StateBasedAbstractEntity {\r\n\r\n    static #MAX_AVG_TEMPERATURE = 10;\r\n\r\n    static #MAX_STUCK_COUNT = 1000;\r\n\r\n    constructor(type, serialized, stateDefinition, brush, gameState) {\r\n        super(type, serialized, stateDefinition, brush, gameState);\r\n    }\r\n\r\n    _checkIsSpace(elementHead) {\r\n        if (ElementHead.getTypeClass(elementHead) !== ElementHead.TYPE_FLUID) {\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    performAfterProcessing() {\r\n        this._iteration++;\r\n\r\n        let isActive = (this._state !== -1);\r\n        let isFalling = false;\r\n\r\n        if (isActive) {\r\n            const [retIsActive, retIsFalling] = this.#doCheckState();\r\n            isActive = retIsActive;\r\n            isFalling = retIsFalling;\r\n        }\r\n\r\n        if (isActive) {\r\n            if (isFalling) {\r\n                this._moveForced(0, 1);\r\n            } else if (this._iteration % 14 === 0) {\r\n                if (this._waypoint !== null) {\r\n                    if (this._waypoint.stuck === 3) {\r\n                        this._waypoint.stuck = -10;  // try random walk now...\r\n                    }\r\n                    if (this._waypoint.stuck >= 0) {\r\n                        this._moveInWaypointDirection(1);\r\n                    } else {\r\n                        this._waypoint.stuck++;\r\n                        this._moveRandom(1);\r\n                    }\r\n                } else {\r\n                    this._moveRandom(1);\r\n                }\r\n            }\r\n        }\r\n\r\n        if (isActive && this._stateDefinition.getStatesCount() > 1 && this._iteration % 10 === 0) {\r\n            this._incrementState();\r\n        }\r\n\r\n        return isActive;\r\n    }\r\n\r\n    #doCheckState() {\r\n        const x = this._x;\r\n        const y = this._y;\r\n        const points = this._stateDefinition.getStates()[this._state];\r\n\r\n        let heavyElementAbove = false;  // at least one\r\n        let lightElementsAbove = true;  // all\r\n        let waterElementsAbove = true;  // all\r\n\r\n        let lightElementsBelow = true;  // all\r\n        let waterElementsBelow = true;  // all\r\n\r\n        let totalTemperature = 0;\r\n\r\n        for (const [dx, dy] of points) {\r\n            const ex = x + dx;\r\n            const ey = y + dy;\r\n\r\n            const elementHead = this._elementArea.getElementHeadOrNull(ex, ey);\r\n            if (elementHead === null) {\r\n                // lost body part / out of bounds\r\n                return [this._kill(), false];\r\n            }\r\n\r\n            if (ElementHead.getBehaviour(elementHead) !== ElementHead.BEHAVIOUR_ENTITY) {\r\n                // lost body part\r\n                return [this._kill(), false];\r\n            }\r\n\r\n            totalTemperature += ElementHead.getTemperature(elementHead);\r\n\r\n            // update\r\n            this._elementArea.setElementHead(ex, ey, ElementHead.setSpecial(elementHead, 0));\r\n\r\n            // check element above\r\n            if (!heavyElementAbove || lightElementsAbove || waterElementsAbove) {\r\n                const elementHeadOrNull = this._elementArea.getElementHeadOrNull(ex, ey - 1);\r\n                if (!heavyElementAbove) {\r\n                    heavyElementAbove = EntityUtils.isElementFallingHeavy(elementHeadOrNull);\r\n                }\r\n                if (lightElementsAbove) {\r\n                    lightElementsAbove = EntityUtils.isElementLight(elementHeadOrNull);\r\n                }\r\n                if (waterElementsAbove) {\r\n                    waterElementsAbove = EntityUtils.isElementWater(elementHeadOrNull)\r\n                            || EntityUtils.isElementEntity(elementHeadOrNull);\r\n                }\r\n            }\r\n\r\n            // check element below\r\n            if (lightElementsBelow || waterElementsBelow) {\r\n                const elementHeadOrNull = this._elementArea.getElementHeadOrNull(ex, ey + 1);\r\n                if (lightElementsBelow) {\r\n                    lightElementsBelow = EntityUtils.isElementLight(elementHeadOrNull);\r\n                }\r\n                if (waterElementsBelow) {\r\n                    waterElementsBelow = EntityUtils.isElementWater(elementHeadOrNull)\r\n                            || EntityUtils.isElementEntity(elementHeadOrNull);\r\n                }\r\n            }\r\n        }\r\n\r\n        if (totalTemperature / points.length > StateBasedFishLikeEntity.#MAX_AVG_TEMPERATURE) {\r\n            // killed by temperature\r\n            return [this._kill(), false];\r\n        }\r\n\r\n        if (!waterElementsAbove || !waterElementsBelow) {\r\n            // not enough water\r\n            this._stuck++;\r\n        }\r\n\r\n        if (this._stuck > StateBasedFishLikeEntity.#MAX_STUCK_COUNT) {\r\n            // stuck to death\r\n            return [this._kill(), false];\r\n        }\r\n\r\n        const falling = heavyElementAbove  // dragged\r\n            || lightElementsBelow  // falling\r\n            || (lightElementsAbove && waterElementsBelow);  // force submerge\r\n\r\n        return [true, falling];\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport ElementHead from \"../ElementHead\";\r\nimport ElementTail from \"../ElementTail\";\r\nimport Element from \"../Element\";\r\nimport Brushes from \"../brush/Brushes\";\r\nimport StateDefinition from \"./StateDefinition\";\r\nimport StateBasedBirdLikeEntity from \"./StateBasedBirdLikeEntity\";\r\nimport StateBasedFishLikeEntity from \"./StateBasedFishLikeEntity\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-04-27\r\n */\r\nexport default class EntityFactories {\r\n\r\n    // bird\r\n\r\n    static #BIRD_STATES = StateDefinition.createCyclic([\r\n        [[0, 0], [1, -1], [-1, -1], [2, -1], [-2, -1], [3, -1], [-3, -1]],\r\n        [[0, 0], [1, -1], [-1, -1], [2, -1], [-2, -1], [3, -2], [-3, -2]],\r\n        [[0, 0], [1, -1], [-1, -1], [2, -2], [-2, -2], [3, -2], [-3, -2]],\r\n        [[0, 0], [1, -1], [-1, -1], [2, -2], [-2, -2], [3, -1], [-3, -1]],\r\n        [[0, 0], [1, -1], [-1, -1], [2, -1], [-2, -1], [3, -1], [-3, -1]],\r\n        [[0, 0], [1, -1], [-1, -1], [2,  0], [-2,  0], [3,  0], [-3,  0]],\r\n        [[0, 0], [1, -1], [-1, -1], [2,  0], [-2,  0], [3,  1], [-3,  1]],\r\n        [[0, 0], [1, -1], [-1, -1], [2,  0], [-2,  0], [3,  0], [-3,  0]],\r\n    ]);\r\n\r\n    static #BIRD_BRUSH = Brushes.custom((x, y) => {\r\n        // motion blur - ends of wings only\r\n        const blurType = Math.abs(x) < 2 ? ElementTail.BLUR_TYPE_NONE : ElementTail.BLUR_TYPE_1;\r\n        return new Element(\r\n            ElementHead.of(\r\n                ElementHead.type8(ElementHead.TYPE_STATIC),\r\n                ElementHead.behaviour8(ElementHead.BEHAVIOUR_ENTITY, 0),\r\n                ElementHead.modifiers8(ElementHead.HMI_CONDUCTIVE_1)),\r\n            ElementTail.of(0, 0, 0, blurType))\r\n    });\r\n\r\n    static birdFactory(serialized, gameState) {\r\n        return new StateBasedBirdLikeEntity('bird', serialized, EntityFactories.#BIRD_STATES, EntityFactories.#BIRD_BRUSH, gameState);\r\n    }\r\n\r\n    // butterfly\r\n\r\n    static #BUTTERFLY_STATES = StateDefinition.createCyclic([\r\n        [[0, 0], [1, -1], [-1, -1]],\r\n        [[0, 0], [1, -1], [-1, -1]],\r\n        [[0, 0], [1,  0], [-1,  0]],\r\n        [[0, 0], [1,  1], [-1,  1]],\r\n        [[0, 0], [1,  1], [-1,  1]],\r\n    ]);\r\n\r\n    static #BUTTERFLY_BRUSH = Brushes.custom((x, y) => {\r\n        // motion blur - ends of wings only\r\n        const blurType = Math.abs(x) === 0 ? ElementTail.BLUR_TYPE_NONE : ElementTail.BLUR_TYPE_1;\r\n        const r = Math.abs(x) === 0 ? 0 : 200;\r\n        return new Element(\r\n            ElementHead.of(\r\n                ElementHead.type8(ElementHead.TYPE_STATIC),\r\n                ElementHead.behaviour8(ElementHead.BEHAVIOUR_ENTITY, 0),\r\n                ElementHead.modifiers8(ElementHead.HMI_CONDUCTIVE_1)),\r\n            ElementTail.of(r, 0, 0, blurType));\r\n    });\r\n\r\n    static butterflyFactory(serialized, gameState) {\r\n        return new StateBasedBirdLikeEntity('butterfly', serialized, EntityFactories.#BUTTERFLY_STATES, EntityFactories.#BUTTERFLY_BRUSH, gameState);\r\n    }\r\n\r\n    // fish\r\n\r\n    static #FISH_STATES = StateDefinition.createCyclic([\r\n        [[0, 0], [1, 0]],\r\n    ]);\r\n\r\n    static #FISH_BRUSH = Brushes.custom((x, y) => {\r\n        return new Element(\r\n            ElementHead.of(\r\n                ElementHead.type8(ElementHead.TYPE_STATIC),\r\n                ElementHead.behaviour8(ElementHead.BEHAVIOUR_ENTITY, 0),\r\n                ElementHead.modifiers8(ElementHead.HMI_CONDUCTIVE_1)),\r\n            ElementTail.of(0, 0, 0, ElementTail.BLUR_TYPE_NONE))\r\n    });\r\n\r\n    static fishFactory(serialized, gameState) {\r\n        return new StateBasedFishLikeEntity('fish', serialized, EntityFactories.#FISH_STATES, EntityFactories.#FISH_BRUSH, gameState);\r\n    }\r\n\r\n    // ---\r\n\r\n    static findFactoryByEntityType(type) {\r\n        switch (type) {\r\n            case 'bird':\r\n                return EntityFactories.birdFactory;\r\n            case 'butterfly':\r\n                return EntityFactories.butterflyFactory;\r\n            case 'fish':\r\n                return EntityFactories.fishFactory;\r\n        }\r\n        return null;\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport Brushes from \"../core/brush/Brushes\";\r\nimport Tools from \"../core/tool/Tools\";\r\nimport BrushDefs from \"./BrushDefs\";\r\nimport TemplateDefs from \"./TemplateDefs\";\r\nimport EntityFactories from \"../core/entity/EntityFactories\";\r\n\r\nimport _ASSET_ICON_POWDERS from './assets/tools/powder.svg'\r\nimport _ASSET_ICON_SOLID from './assets/tools/solid.svg'\r\nimport _ASSET_ICON_EFFECTS from './assets/tools/fire.svg'\r\nimport _ASSET_ICON_FLUIDS from './assets/tools/droplet-fill.svg'\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-05-25\r\n */\r\nexport default class ToolDefs {\r\n\r\n    static DEFAULT_SIZE = 6;\r\n\r\n    static CATEGORY_NONE = undefined;\r\n    static CATEGORY_POWDER = 'powders';\r\n    static CATEGORY_FLUIDS = 'fluids';\r\n    static CATEGORY_SOLIDS = 'solids';\r\n    static CATEGORY_EFFECTS = 'effects';\r\n    static CATEGORY_BIOLOGICAL = 'biological';\r\n\r\n    static DEFAULT_CATEGORY_DEFINITIONS = {};\r\n    static {\r\n        ToolDefs.DEFAULT_CATEGORY_DEFINITIONS[ToolDefs.CATEGORY_POWDER] = {\r\n            displayName: 'Powders',\r\n            icon: {\r\n                svg: _ASSET_ICON_POWDERS\r\n            },\r\n            badgeStyle: {\r\n                color: 'black',\r\n                backgroundColor: '#d9bc7a',\r\n            }\r\n        };\r\n        ToolDefs.DEFAULT_CATEGORY_DEFINITIONS[ToolDefs.CATEGORY_FLUIDS] = {\r\n            displayName: 'Fluids',\r\n            icon: {\r\n                svg: _ASSET_ICON_FLUIDS\r\n            },\r\n            badgeStyle: {\r\n                color: 'black',\r\n                backgroundColor: '#6aa6bd',\r\n            }\r\n        };\r\n        ToolDefs.DEFAULT_CATEGORY_DEFINITIONS[ToolDefs.CATEGORY_SOLIDS] = {\r\n            displayName: 'Solids',\r\n            icon: {\r\n                svg: _ASSET_ICON_SOLID\r\n            },\r\n            badgeStyle: {\r\n                color: 'black',\r\n                backgroundColor: '#adadad',\r\n            }\r\n        };\r\n        ToolDefs.DEFAULT_CATEGORY_DEFINITIONS[ToolDefs.CATEGORY_EFFECTS] = {\r\n            displayName: 'Effects',\r\n            icon: {\r\n                svg: _ASSET_ICON_EFFECTS\r\n            },\r\n            badgeStyle: {\r\n                color: 'black',\r\n                backgroundColor: '#ff945b',\r\n            }\r\n        };\r\n    }\r\n\r\n\r\n    static NONE = Tools.actionTool(() => {}, {\r\n        codeName: 'none',\r\n        displayName: 'None',\r\n        category: ToolDefs.CATEGORY_NONE,\r\n    });\r\n\r\n    static ERASE = Tools.roundBrushTool(BrushDefs.AIR, ToolDefs.DEFAULT_SIZE, {\r\n        codeName: 'erase',\r\n        displayName: 'Erase',\r\n        category: ToolDefs.CATEGORY_NONE,\r\n        badgeStyle: {\r\n            backgroundColor: '#e6e6e6',\r\n            color: 'black'\r\n        }\r\n    });\r\n\r\n    static MOVE = Tools.moveTool(13, 2048, {\r\n        codeName: 'move',\r\n        displayName: 'Move',\r\n        category: ToolDefs.CATEGORY_NONE,\r\n        badgeStyle: {\r\n            backgroundColor: '#e6e6e6',\r\n            color: 'black'\r\n        }\r\n    });\r\n\r\n    static FLIP_VERTICALLY = Tools.globalActionTool(sg => sg.graphics().flipVertically(), {\r\n        codeName: 'flip_vertically',\r\n        displayName: 'Flip \\u2195',\r\n        category: ToolDefs.CATEGORY_NONE,\r\n        badgeStyle: {\r\n            backgroundColor: '#e6e6e6',\r\n            color: 'black'\r\n        }\r\n    });\r\n\r\n    static FLIP_HORIZONTALLY = Tools.globalActionTool(sg => sg.graphics().flipHorizontally(), {\r\n        codeName: 'flip_horizontally',\r\n        displayName: 'Flip \\u2194',\r\n        category: ToolDefs.CATEGORY_NONE,\r\n        badgeStyle: {\r\n            backgroundColor: '#e6e6e6',\r\n            color: 'black'\r\n        }\r\n    });\r\n\r\n    static SAND = Tools.roundBrushTool(BrushDefs.SAND, ToolDefs.DEFAULT_SIZE, {\r\n        codeName: 'sand',\r\n        displayName: 'Sand',\r\n        category: ToolDefs.CATEGORY_POWDER,\r\n        badgeStyle: {\r\n            backgroundColor: '#b7a643',\r\n        }\r\n    });\r\n\r\n    static SOIL = Tools.roundBrushTool(BrushDefs.SOIL, ToolDefs.DEFAULT_SIZE, {\r\n        codeName: 'soil',\r\n        displayName: 'Soil',\r\n        category: ToolDefs.CATEGORY_POWDER,\r\n        badgeStyle: {\r\n            backgroundColor: '#8e6848',\r\n        }\r\n    });\r\n\r\n    static GRAVEL = Tools.roundBrushTool(BrushDefs.GRAVEL, ToolDefs.DEFAULT_SIZE, {\r\n        codeName: 'gravel',\r\n        displayName: 'Gravel',\r\n        category: ToolDefs.CATEGORY_POWDER,\r\n        badgeStyle: {\r\n            backgroundColor: '#656565',\r\n        }\r\n    });\r\n\r\n    static COAL = Tools.roundBrushTool(BrushDefs.COAL, ToolDefs.DEFAULT_SIZE, {\r\n        codeName: 'coal',\r\n        displayName: 'Coal',\r\n        category: ToolDefs.CATEGORY_POWDER,\r\n        badgeStyle: {\r\n            backgroundColor: '#343434',\r\n        }\r\n    });\r\n\r\n    static THERMITE = Tools.roundBrushTool(BrushDefs.THERMITE, ToolDefs.DEFAULT_SIZE, {\r\n        codeName: 'thermite',\r\n        displayName: 'Thermite',\r\n        category: ToolDefs.CATEGORY_POWDER,\r\n        badgeStyle: {\r\n            backgroundColor: '#914e47',\r\n        }\r\n    });\r\n\r\n    static WALL = Tools.roundBrushTool(BrushDefs.WALL, ToolDefs.DEFAULT_SIZE, {\r\n        codeName: 'wall',\r\n        displayName: 'Static Wall',\r\n        category: ToolDefs.CATEGORY_SOLIDS,\r\n        badgeStyle: {\r\n            backgroundColor: '#383838',\r\n        }\r\n    });\r\n\r\n    static BRICK = Tools.roundBrushToolForSolidBody(BrushDefs.BRICK, ToolDefs.DEFAULT_SIZE, {\r\n        codeName: 'brick',\r\n        displayName: 'Brick',\r\n        category: ToolDefs.CATEGORY_SOLIDS,\r\n        badgeStyle: {\r\n            backgroundColor: '#B56D64',\r\n        }\r\n    });\r\n\r\n    static WOOD = Tools.roundBrushToolForSolidBody(BrushDefs.WOOD, ToolDefs.DEFAULT_SIZE, {\r\n        codeName: 'wood',\r\n        displayName: 'Wood',\r\n        category: ToolDefs.CATEGORY_SOLIDS,\r\n        badgeStyle: {\r\n            backgroundColor: '#7b6043',\r\n        }\r\n    });\r\n\r\n    static ROCK = Tools.roundBrushToolForSolidBody(BrushDefs.ROCK, ToolDefs.DEFAULT_SIZE, {\r\n        codeName: 'rock',\r\n        displayName: 'Rock',\r\n        category: ToolDefs.CATEGORY_SOLIDS,\r\n        badgeStyle: {\r\n            backgroundColor: '#383838',\r\n        }\r\n    });\r\n\r\n    static ROCK_TEMPLATES_SM = Tools.templateSelectionTool(TemplateDefs.ROCK_SM, {\r\n        codeName: 'rock_templates_sm',\r\n        displayName: 'Rock \\u2022',\r\n        category: ToolDefs.CATEGORY_SOLIDS,\r\n        badgeStyle: {\r\n            backgroundColor: '#574F48',\r\n        }\r\n    });\r\n\r\n    static ROCK_TEMPLATES_MD = Tools.templateSelectionTool(TemplateDefs.ROCK_MD, {\r\n        codeName: 'rock_templates_md',\r\n        displayName: 'Rock \\u25cf',\r\n        category: ToolDefs.CATEGORY_SOLIDS,\r\n        badgeStyle: {\r\n            backgroundColor: '#574F48',\r\n        }\r\n    });\r\n\r\n    static ROCK_TEMPLATES_LG = Tools.templateSelectionTool(TemplateDefs.ROCK_LG, {\r\n        codeName: 'rock_templates_lg',\r\n        displayName: 'Rock \\u2b24',\r\n        category: ToolDefs.CATEGORY_SOLIDS,\r\n        badgeStyle: {\r\n            backgroundColor: '#574F48',\r\n        }\r\n    });\r\n\r\n    static METAL = Tools.roundBrushToolForSolidBody(BrushDefs.METAL, ToolDefs.DEFAULT_SIZE, {\r\n        codeName: 'metal',\r\n        displayName: 'Metal',\r\n        category: ToolDefs.CATEGORY_SOLIDS,\r\n        badgeStyle: {\r\n            backgroundColor: '#7c7c7c',\r\n        }\r\n    });\r\n\r\n    static METAL_MOLTEN = Tools.roundBrushTool(BrushDefs.METAL_MOLTEN, ToolDefs.DEFAULT_SIZE, {\r\n        codeName: 'metal_molten',\r\n        displayName: 'M. Metal',\r\n        category: ToolDefs.CATEGORY_FLUIDS,\r\n        badgeStyle: {\r\n            backgroundColor: '#e67d00',\r\n        }\r\n    });\r\n\r\n    static WATER = Tools.roundBrushTool(BrushDefs.WATER, ToolDefs.DEFAULT_SIZE, {\r\n        codeName: 'water',\r\n        displayName: 'Water',\r\n        category: ToolDefs.CATEGORY_FLUIDS,\r\n        badgeStyle: {\r\n            backgroundColor: '#0487ba',\r\n        }\r\n    });\r\n\r\n    static OIL = Tools.roundBrushTool(BrushDefs.OIL, ToolDefs.DEFAULT_SIZE, {\r\n        codeName: 'oil',\r\n        displayName: 'Oil',\r\n        category: ToolDefs.CATEGORY_FLUIDS,\r\n        badgeStyle: {\r\n            backgroundColor: 'rgb(36,26,1)',\r\n        }\r\n    });\r\n\r\n    static FIRE = Tools.roundBrushTool(Brushes.temperatureOrBrush(50, BrushDefs.FIRE), ToolDefs.DEFAULT_SIZE, {\r\n        codeName: 'fire',\r\n        displayName: 'Fire',\r\n        category: ToolDefs.CATEGORY_EFFECTS,\r\n        badgeStyle: {\r\n            backgroundColor: '#ff5900',\r\n        }\r\n    });\r\n\r\n    static METEOR = Tools.meteorTool(BrushDefs.METEOR, BrushDefs.METEOR_FROM_LEFT, BrushDefs.METEOR_FROM_RIGHT, {\r\n        codeName: 'meteor',\r\n        displayName: 'Meteor',\r\n        category: ToolDefs.CATEGORY_EFFECTS,\r\n        badgeStyle: {\r\n            backgroundColor: '#ff5900',\r\n        }\r\n    });\r\n\r\n    static EFFECT_TEMP_MINUS = Tools.roundBrushTool(Brushes.concat(BrushDefs.EFFECT_TEMP_0, BrushDefs.EFFECT_EXTINGUISH),\r\n            ToolDefs.DEFAULT_SIZE, {\r\n\r\n        codeName: 'effect_temp_minus',\r\n        displayName: '°C −',\r\n        category: ToolDefs.CATEGORY_EFFECTS,\r\n        badgeStyle: {\r\n            backgroundColor: '#63cffa',\r\n        }\r\n    });\r\n\r\n    static EFFECT_TEMP_PLUS = Tools.roundBrushTool(BrushDefs.EFFECT_TEMP_200, ToolDefs.DEFAULT_SIZE, {\r\n        codeName: 'effect_temp_plus',\r\n        displayName: '°C +',\r\n        category: ToolDefs.CATEGORY_EFFECTS,\r\n        badgeStyle: {\r\n            backgroundColor: '#fa9b4e',\r\n        }\r\n    });\r\n\r\n    static EFFECT_TEMP_PLUS2 = Tools.roundBrushTool(BrushDefs.EFFECT_TEMP_255, ToolDefs.DEFAULT_SIZE, {\r\n        codeName: 'effect_temp_plus2',\r\n        displayName: '°C ⧺',\r\n        category: ToolDefs.CATEGORY_EFFECTS,\r\n        badgeStyle: {\r\n            backgroundColor: '#fa9b4e',\r\n        }\r\n    });\r\n\r\n    /** @type Tool[] */\r\n    static DEFAULT_TOOLS = [\r\n        this.ERASE,\r\n        this.MOVE,\r\n        this.SAND,\r\n        this.SOIL,\r\n        this.GRAVEL,\r\n        this.COAL,\r\n        this.THERMITE,\r\n        this.WALL,\r\n        this.BRICK,\r\n        this.WOOD,\r\n        this.METAL,\r\n        this.ROCK_TEMPLATES_SM,\r\n        this.ROCK_TEMPLATES_MD,\r\n        this.ROCK_TEMPLATES_LG,\r\n        this.WATER,\r\n        this.OIL,\r\n        this.METAL_MOLTEN,\r\n        this.FIRE,\r\n        this.METEOR,\r\n        this.EFFECT_TEMP_MINUS,\r\n        this.EFFECT_TEMP_PLUS,\r\n        this.EFFECT_TEMP_PLUS2\r\n    ];\r\n\r\n    static BIRD = Tools.insertEntityTool(EntityFactories.birdFactory, {\r\n        codeName: 'bird',\r\n        displayName: 'Bird',\r\n        category: ToolDefs.CATEGORY_BIOLOGICAL,\r\n    });\r\n\r\n    static BUTTERFLY = Tools.insertEntityTool(EntityFactories.butterflyFactory, {\r\n        codeName: 'butterfly',\r\n        displayName: 'Butterfly',\r\n        category: ToolDefs.CATEGORY_BIOLOGICAL,\r\n    });\r\n\r\n    static FISH = Tools.insertEntityTool(EntityFactories.fishFactory, {\r\n        codeName: 'fish',\r\n        displayName: 'Fish',\r\n        category: ToolDefs.CATEGORY_BIOLOGICAL,\r\n    });\r\n\r\n\r\n    static _LIST = {};\r\n    static {\r\n        const tools = [\r\n            ToolDefs.NONE,\r\n            ToolDefs.FLIP_HORIZONTALLY,\r\n            ToolDefs.FLIP_VERTICALLY,\r\n            ...ToolDefs.DEFAULT_TOOLS,\r\n            ToolDefs.ROCK,\r\n            ToolDefs.BIRD,\r\n            ToolDefs.BUTTERFLY,\r\n            ToolDefs.FISH\r\n        ];\r\n        for (const tool of tools) {\r\n            ToolDefs._LIST[tool.getInfo().getCodeName()] = tool;\r\n        }\r\n    }\r\n\r\n    static byCodeName(codeName) {\r\n        const tool = ToolDefs._LIST[codeName];\r\n        if (tool !== undefined) {\r\n            return tool;\r\n        }\r\n        return null;\r\n    }\r\n}\r\n","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport ToolDefs from \"./def/ToolDefs.js\";\r\nimport InsertElementAreaTool from \"./core/tool/InsertElementAreaTool\";\r\nimport InsertRandomSceneTool from \"./core/tool/InsertRandomSceneTool\";\r\nimport InsertEntityTool from \"./core/tool/InsertEntityTool\";\r\n\r\n/**\r\n *\r\n * @version 2024-05-07\r\n * @author Patrik Harag\r\n */\r\nexport default class Analytics {\r\n\r\n    static EVENT_NAME = 'app_sand_game_js';\r\n    static FEATURE_APP_INITIALIZED = 'initialized';\r\n    static FEATURE_SCENARIO_COMPLETED = 's_completed';\r\n    static FEATURE_RENDERER_FALLBACK = 'renderer_fallback';\r\n\r\n    // options bar\r\n    static FEATURE_PAUSE = 'pause';\r\n    static FEATURE_DRAW_PRIMARY = 'draw_primary';\r\n    static FEATURE_DRAW_SECONDARY = 'draw_secondary';\r\n    static FEATURE_DRAW_TERTIARY = 'draw_tertiary';\r\n    static FEATURE_DRAW_LINE = 'draw_line';\r\n    static FEATURE_DRAW_RECT = 'draw_rect';\r\n    static FEATURE_DRAW_FLOOD = 'draw_flood';\r\n    static FEATURE_STATUS_DISPLAYED = 'status_displayed';\r\n    static FEATURE_OPTIONS_DISPLAYED = 'options_displayed';\r\n    static FEATURE_RENDERER_PIXELATED = 'renderer_pixelated';\r\n    static FEATURE_RENDERER_SHOW_CHUNKS = 'renderer_show_chunks';\r\n    static FEATURE_RENDERER_SHOW_HEATMAP = 'renderer_show_heatmap';\r\n    static FEATURE_CANVAS_SIZE_CHANGE = 'canvas_size_change';\r\n    static FEATURE_SWITCH_SCENE = 'switch_scene';\r\n    static FEATURE_RESTART_SCENE = 'restart_scene';\r\n    static FEATURE_SWITCH_SCALE = 'switch_scale';\r\n    static FEATURE_IO_EXPORT = 'io_export';\r\n    static FEATURE_IO_IMPORT = 'io_import';\r\n    static FEATURE_IO_IMAGE_TEMPLATE = 'io_image_template';\r\n\r\n    static #USED_FEATURES = new Set();\r\n\r\n\r\n    static triggerToolUsed(tool) {\r\n        // Note: better feature name would be tool_xxx, but we will keep backward compatibility\r\n\r\n        let name = tool.getInfo().getCodeName();\r\n        if (name === undefined) {\r\n            if (tool instanceof InsertElementAreaTool || tool instanceof InsertRandomSceneTool) {\r\n                name = 'template';\r\n            } else if (tool instanceof InsertEntityTool) {\r\n                name = 'entity';\r\n            }\r\n        }\r\n        if (name !== undefined) {\r\n            const feature = 'brush_' + name;\r\n            Analytics.triggerFeatureUsed(feature);\r\n        }\r\n    }\r\n\r\n    static triggerFeatureUsed(feature) {\r\n        if (!Analytics.#USED_FEATURES.has(feature)) {\r\n            // report only the first usage\r\n            Analytics.#USED_FEATURES.add(feature);\r\n            Analytics.#report({\r\n                'app_sand_game_js_feature': feature\r\n            });\r\n        }\r\n    }\r\n\r\n    static #report(properties) {\r\n        if (typeof gtag === 'function') {\r\n            try {\r\n                gtag('event', Analytics.EVENT_NAME, properties);\r\n            } catch (e) {\r\n                console.warn(e);\r\n            }\r\n        }\r\n        // console.log('event: ' + Analytics.EVENT_NAME + ' = ' + JSON.stringify(properties));\r\n    }\r\n}\r\n","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\n/**\r\n *\r\n * @version 2023-12-21\r\n * @author Patrik Harag\r\n */\r\nexport default class DomBuilder {\r\n\r\n    /**\r\n     *\r\n     * @param element {HTMLElement}\r\n     * @param content {null|string|Node|(null|string|Node)[]}\r\n     */\r\n    static addContent(element, content) {\r\n        if (content === null) {\r\n            // ignore\r\n        } else if (typeof content === 'string') {\r\n            element.textContent = content;\r\n        } else if (content instanceof Node) {\r\n            element.appendChild(content);\r\n        } else if (Array.isArray(content)) {\r\n            for (const item of content) {\r\n                if (item instanceof Node) {\r\n                    element.appendChild(item);\r\n                } else if (typeof item === 'string') {\r\n                    element.insertAdjacentText('beforeend', item);\r\n                } else if (item === null) {\r\n                    // ignore\r\n                } else {\r\n                    throw 'Content type not supported: ' + (typeof item);\r\n                }\r\n            }\r\n        } else {\r\n            throw 'Content type not supported: ' + (typeof content);\r\n        }\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param element {HTMLElement}\r\n     * @param content {null|string|Node|(Node|null)[]}\r\n     */\r\n    static setContent(element, content) {\r\n        element.innerHTML = '';\r\n        DomBuilder.addContent(element, content);\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param element {HTMLElement}\r\n     * @param attributes {object|null}\r\n     */\r\n    static putAttributes(element, attributes) {\r\n        for (const key in attributes) {\r\n            const value = attributes[key];\r\n            const type = typeof value;\r\n\r\n            if (type === 'string' || type === 'boolean' || type === 'number') {\r\n                element.setAttribute(key, value);\r\n            } else if (key === 'style' && type === 'object') {\r\n                Object.assign(element.style, value);\r\n            } else if (value === null) {\r\n                // ignore\r\n            } else {\r\n                throw 'Unsupported attribute type: ' + (typeof value);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param html {string}\r\n     * @return {HTMLElement}\r\n     */\r\n    static create(html) {\r\n        const template = document.createElement('template');\r\n        template.innerHTML = html.trim();\r\n        return template.content.firstElementChild;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param name {string}\r\n     * @param attributes {object|null}\r\n     * @param content {null|string|HTMLElement|HTMLElement[]}\r\n     * @return {HTMLElement}\r\n     */\r\n    static element(name, attributes = null, content = null) {\r\n        const element = document.createElement(name);\r\n\r\n        // attributes\r\n        DomBuilder.putAttributes(element, attributes);\r\n\r\n        // content\r\n        DomBuilder.addContent(element, content);\r\n\r\n        return element;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param attributes {object|null}\r\n     * @param content {null|string|HTMLElement|HTMLElement[]}\r\n     * @return {HTMLElement}\r\n     */\r\n    static div(attributes = null, content = null) {\r\n        return DomBuilder.element('div', attributes, content);\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param attributes {object|null}\r\n     * @param content {null|string|HTMLElement|HTMLElement[]}\r\n     * @return {HTMLElement}\r\n     */\r\n    static par(attributes = null, content = null) {\r\n        return DomBuilder.element('p', attributes, content);\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param text {string|null}\r\n     * @param attributes {object|null}\r\n     * @return {HTMLElement}\r\n     */\r\n    static span(text = null, attributes = null) {\r\n        return DomBuilder.element('span', attributes, text);\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param text {string}\r\n     * @param attributes {object|null}\r\n     * @param handler {function()}\r\n     * @return {HTMLElement}\r\n     */\r\n    static link(text, attributes = null, handler = null) {\r\n        const link = DomBuilder.element('a', attributes, text);\r\n        if (handler !== null) {\r\n            link.href = 'javascript:void(0)';\r\n            link.addEventListener('click', handler);\r\n        }\r\n        return link;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param label {string|HTMLElement|HTMLElement[]}\r\n     * @param attributes {object|null}\r\n     * @param handler {function()}\r\n     * @return {HTMLElement}\r\n     */\r\n    static button(label, attributes = null, handler = null) {\r\n        if (attributes === null) {\r\n            attributes = {};\r\n        }\r\n        attributes['type'] = 'button';\r\n\r\n        const button = DomBuilder.element('button', attributes, label);\r\n        if (handler !== null) {\r\n            button.addEventListener('click', handler);\r\n        }\r\n        return button;\r\n    }\r\n\r\n    // bootstrap methods\r\n\r\n    /**\r\n     *\r\n     * @param bodyContent {string|HTMLElement}\r\n     * @return {HTMLElement}\r\n     */\r\n    static bootstrapAlertInfo(bodyContent) {\r\n        const alertDiv = DomBuilder.div({ class: 'alert alert-info alert-dismissible fade show', role: 'alert' });\r\n        DomBuilder.addContent(alertDiv, bodyContent);\r\n        alertDiv.append(DomBuilder.button(null, { type: 'button', class: 'btn-close', 'data-bs-dismiss': 'alert', 'aria-label': 'Close' }));\r\n        return alertDiv;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param headerContent {string|HTMLElement|HTMLElement[]}\r\n     * @param bodyContent {string|HTMLElement|HTMLElement[]}\r\n     * @param attributes {object|null}\r\n     * @return {HTMLElement}\r\n     */\r\n    static bootstrapCard(headerContent, bodyContent, attributes = null) {\r\n        if (attributes === null) {\r\n            attributes = {};\r\n        }\r\n        if (attributes.class === undefined) {\r\n            attributes.class = 'card';\r\n        }\r\n\r\n        const card = DomBuilder.div(attributes);\r\n\r\n        if (headerContent) {\r\n            card.append(DomBuilder.div({ class: 'card-header' }, headerContent));\r\n        }\r\n\r\n        card.append(DomBuilder.div({ class: 'card-body' }, bodyContent));\r\n        return card;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param title {string}\r\n     * @param collapsed {boolean}\r\n     * @param bodyContent {string|HTMLElement|HTMLElement[]}\r\n     * @return {HTMLElement}\r\n     */\r\n    static bootstrapCardCollapsable(title, collapsed, bodyContent) {\r\n        const id = 'collapsable_' + Math.floor(Math.random() * 999_999_999);\r\n\r\n        return DomBuilder.div({ class: 'card' }, [\r\n            DomBuilder.div({ class: 'card-header' }, [\r\n                DomBuilder.element('a', { class: 'card-link', 'data-bs-toggle': 'collapse', href: '#' + id}, title)\r\n            ]),\r\n            DomBuilder.div({ id: id, class: (collapsed ? 'collapse' : 'collapse show') }, [\r\n                DomBuilder.div({ class: 'card-body' }, bodyContent)\r\n            ])\r\n        ]);\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param content {string|HTMLElement}\r\n     * @param node {HTMLElement}\r\n     * @return {HTMLElement}\r\n     */\r\n    static bootstrapInitTooltip(content, node) {\r\n        if (window.bootstrap === undefined) {\r\n            console.error('Bootstrap library not available');\r\n            return node;\r\n        }\r\n\r\n        const old = new window.bootstrap.Tooltip(node);\r\n        if (old) {\r\n            old.dispose();\r\n        }\r\n\r\n        node.setAttribute('data-bs-toggle', 'tooltip');\r\n        node.setAttribute('data-bs-placement', 'top');\r\n        if (typeof content === 'object') {\r\n            node.setAttribute('data-bs-html', 'true');\r\n            node.setAttribute('title', content.innerHTML);\r\n        } else {\r\n            node.setAttribute('title', content);\r\n        }\r\n\r\n        new window.bootstrap.Tooltip(node);\r\n        return node;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param text {string}\r\n     * @param checked {boolean}\r\n     * @param handler {function(boolean)}\r\n     * @return {HTMLElement}\r\n     */\r\n    static bootstrapSwitchButton(text, checked, handler = null) {\r\n        const id = 'switch-button_' + Math.floor(Math.random() * 999_999_999);\r\n\r\n        const switchInput = DomBuilder.element('input', {\r\n            type: 'checkbox',\r\n            id: id,\r\n            class: 'form-check-input',\r\n            role: 'switch',\r\n            checked: checked\r\n        });\r\n\r\n        const control = DomBuilder.div({ class: 'form-check form-switch' }, [\r\n            switchInput,\r\n            DomBuilder.element('label', { class: 'form-check-label', for: id }, text)\r\n        ]);\r\n\r\n        if (handler !== null) {\r\n            switchInput.addEventListener('click', () => {\r\n                handler(switchInput.checked);\r\n            });\r\n        }\r\n        return control;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param labelContent {string|HTMLElement}\r\n     * @param buttonClass {string} e.g. btn-primary\r\n     * @param checked {boolean}\r\n     * @param handler {function(boolean)}\r\n     * @return {HTMLElement[]}\r\n     */\r\n    static bootstrapToggleButton(labelContent, buttonClass, checked, handler = null) {\r\n        const id = 'toggle-button_' + Math.floor(Math.random() * 999_999_999);\r\n\r\n        const nodeInput = DomBuilder.element('input', {\r\n            type: 'checkbox',\r\n            class: 'btn-check',\r\n            checked: checked,\r\n            id: id\r\n        });\r\n        const nodeLabel = DomBuilder.element('label', {\r\n            class: 'btn ' + buttonClass,\r\n            for: id\r\n        }, labelContent);\r\n\r\n        nodeInput.addEventListener('change', (e) => {\r\n            if (handler !== null) {\r\n                handler(nodeInput.checked);\r\n            }\r\n        });\r\n\r\n        return [nodeInput, nodeLabel];\r\n    }\r\n\r\n    static bootstrapTableBuilder() {\r\n        return new BootstrapTable();\r\n    }\r\n\r\n    static bootstrapDialogBuilder() {\r\n        return new BootstrapDialog();\r\n    }\r\n\r\n    static bootstrapToastBuilder() {\r\n        return new BootstrapToast();\r\n    }\r\n\r\n    static bootstrapSimpleFormBuilder() {\r\n        return new BootstrapSimpleForm();\r\n    }\r\n}\r\n\r\n/**\r\n *\r\n * @version 2023-12-21\r\n * @author Patrik Harag\r\n */\r\nclass BootstrapTable {\r\n\r\n    #tableBody = DomBuilder.element('tbody');\r\n\r\n    addRow(row) {\r\n        this.#tableBody.appendChild(row);\r\n    }\r\n\r\n    addRowBefore(row) {\r\n        this.#tableBody.insertBefore(row, this.#tableBody.firstChild);\r\n    }\r\n\r\n    createNode() {\r\n        const table = DomBuilder.element('table', { class: 'table table-striped' });\r\n        table.appendChild(this.#tableBody);\r\n\r\n        const tableResponsive = DomBuilder.div({ class: 'table-responsive' });\r\n        tableResponsive.appendChild(table);\r\n\r\n        return tableResponsive;\r\n    }\r\n}\r\n\r\n/**\r\n *\r\n * @version 2023-12-24\r\n * @author Patrik Harag\r\n */\r\nclass BootstrapDialog {\r\n\r\n    // will be removed after close\r\n    #persistent = false;\r\n\r\n    #additionalStyle = '';\r\n\r\n    #headerNode = null;\r\n    #bodyNode = null;\r\n    #footerNodeChildren = [];\r\n\r\n    #dialog = null;\r\n    #dialogBootstrap = null;\r\n\r\n\r\n    setPersistent(persistent) {\r\n        this.#persistent = persistent;\r\n    }\r\n\r\n    setSizeLarge() {\r\n        this.#additionalStyle = 'modal-lg';\r\n    }\r\n\r\n    setSizeExtraLarge() {\r\n        this.#additionalStyle = 'modal-xl';\r\n    }\r\n\r\n    setHeaderContent(headerNode) {\r\n        if (typeof headerNode === 'string') {\r\n            this.#headerNode = DomBuilder.element('strong', null, headerNode);\r\n        } else {\r\n            this.#headerNode = headerNode;\r\n        }\r\n    }\r\n\r\n    setBodyContent(bodyNode) {\r\n        this.#bodyNode = bodyNode;\r\n    }\r\n\r\n    addCloseButton(buttonText) {\r\n        const button = DomBuilder.element('button', { type: 'button', class: 'btn btn-secondary', 'data-bs-dismiss': 'modal' }, buttonText);\r\n        this.#footerNodeChildren.push(button);\r\n    }\r\n\r\n    addSubmitButton(buttonText, handler) {\r\n        const button = DomBuilder.element('button', { type: 'button', class: 'btn btn-primary', 'data-bs-dismiss': 'modal' }, buttonText);\r\n        button.addEventListener('click', handler);\r\n        this.#footerNodeChildren.push(button);\r\n    }\r\n\r\n    addButton(button) {\r\n        this.#footerNodeChildren.push(button);\r\n    }\r\n\r\n    show(dialogAnchor) {\r\n        if (window.bootstrap === undefined) {\r\n            console.error('Bootstrap library not available');\r\n            return;\r\n        }\r\n\r\n        if (this.#dialog === null) {\r\n            this.#dialog = DomBuilder.div({ class: 'modal fade', tabindex: '-1', role: 'dialog', 'aria-hidden': 'true' }, [\r\n                DomBuilder.div({ class: `modal-dialog modal-dialog-centered ${this.#additionalStyle}` }, [\r\n                    DomBuilder.div({ class: 'modal-content' }, [\r\n                        DomBuilder.div({ class: 'modal-header' }, this.#headerNode),\r\n                        DomBuilder.div({ class: 'modal-body' }, this.#bodyNode),\r\n                        DomBuilder.div({ class: 'modal-footer' }, this.#footerNodeChildren)\r\n                    ])\r\n                ])\r\n            ]);\r\n\r\n            // add into DOM\r\n            dialogAnchor.appendChild(this.#dialog);\r\n        }\r\n\r\n        this.#dialogBootstrap = new window.bootstrap.Modal(this.#dialog);\r\n\r\n        if (!this.#persistent) {\r\n            // remove from DOM after hide\r\n            this.#dialog.addEventListener('hidden.bs.modal', () => {\r\n                dialogAnchor.removeChild(this.#dialog);\r\n            });\r\n        }\r\n\r\n        this.#dialogBootstrap.show();\r\n    }\r\n\r\n    hide() {\r\n        if (this.#dialog !== null) {\r\n            this.#dialogBootstrap.hide();\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n *\r\n * @version 2023-12-22\r\n * @author Patrik Harag\r\n */\r\nclass BootstrapToast {\r\n\r\n    #headerNode = null;\r\n    #bodyNode = null;\r\n\r\n    #toast = null;\r\n    #toastBootstrap = null;\r\n\r\n    #dataDelay = 1000 * 60 * 60;  // ms\r\n\r\n    setHeaderContent(headerNode) {\r\n        if (typeof headerNode === 'string') {\r\n            headerNode = DomBuilder.element('strong', headerNode);\r\n        }\r\n        this.#headerNode = DomBuilder.span(headerNode, { class: 'me-auto' });\r\n    }\r\n\r\n    setBodyContent(bodyNode) {\r\n        this.#bodyNode = bodyNode;\r\n    }\r\n\r\n    setDelay(milliseconds) {\r\n        this.#dataDelay = milliseconds;\r\n    }\r\n\r\n    show(dialogAnchor) {\r\n        if (window.bootstrap === undefined) {\r\n            console.error('Bootstrap library not available');\r\n            return;\r\n        }\r\n\r\n        const wrapperAttributes = {\r\n            class: 'position-fixed bottom-0 right-0 p-3',\r\n            style: 'z-index: 5; right: 0; bottom: 0;'\r\n        };\r\n        const toastAttributes = {\r\n            class: 'toast hide',\r\n            role: 'alert',\r\n            'aria-live': 'assertive',\r\n            'aria-atomic': 'true',\r\n            'data-bs-delay': this.#dataDelay\r\n        };\r\n        const wrapper = DomBuilder.div(wrapperAttributes, [\r\n            this.#toast = DomBuilder.div(toastAttributes, [\r\n                DomBuilder.div({ class: 'toast-header' }, [\r\n                    this.#headerNode,\r\n                    DomBuilder.button('', {\r\n                        type: 'button',\r\n                        class: 'btn-close',\r\n                        'data-bs-dismiss': 'toast',\r\n                        'aria-label': 'Close'\r\n                    })\r\n                ]),\r\n                DomBuilder.div({ class: 'toast-body' }, [\r\n                    this.#bodyNode,\r\n\r\n                ])\r\n            ])\r\n        ]);\r\n\r\n        // add into DOM\r\n        dialogAnchor.append(wrapper);\r\n\r\n        this.#toastBootstrap = new window.bootstrap.Toast(this.#toast);\r\n\r\n        // remove from DOM after hide\r\n        this.#toast.addEventListener('hidden.bs.toast', () => {\r\n            dialogAnchor.removeChild(wrapper);\r\n        });\r\n\r\n        this.#toastBootstrap.show();\r\n    }\r\n\r\n    hide() {\r\n        if (this.#toast !== null) {\r\n            this.#toastBootstrap.hide();\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n *\r\n * @version 2023-12-22\r\n * @author Patrik Harag\r\n */\r\nclass BootstrapSimpleForm {\r\n\r\n    /** @type {{key:string,label:string,input:HTMLElement}[]} */\r\n    #formFields = [];\r\n    #submitButton = null;\r\n\r\n    addTextArea(label, key, initialValue = '', rows = 8) {\r\n        let input = DomBuilder.element('textarea', { class: 'form-control', rows: rows }, initialValue);\r\n        this.#formFields.push({\r\n            key: key,\r\n            label: label,\r\n            input: input\r\n        });\r\n        return input;\r\n    }\r\n\r\n    addInput(label, key, initialValue = '') {\r\n        let input = DomBuilder.element('input', { class: 'form-control' });\r\n        if (initialValue) {\r\n            input.value = initialValue;\r\n        }\r\n        this.#formFields.push({\r\n            key: key,\r\n            label: label,\r\n            input: input\r\n        });\r\n        return input;\r\n    }\r\n\r\n    addSubmitButton(text, handler) {\r\n        this.#submitButton = DomBuilder.button(text, { class: 'btn btn-primary' }, e => {\r\n            handler(this.getData());\r\n        });\r\n    }\r\n\r\n    createNode() {\r\n        let form = DomBuilder.element('form', { action: 'javascript:void(0);' });\r\n\r\n        for (let formField of this.#formFields) {\r\n            form.append(DomBuilder.div({ class: 'mb-3' }, [\r\n                DomBuilder.element('label', null, formField.label),\r\n                formField.input\r\n            ]));\r\n        }\r\n\r\n        if (this.#submitButton) {\r\n            form.append(this.#submitButton);\r\n        }\r\n\r\n        return form;\r\n    }\r\n\r\n    getData() {\r\n        let data = {};\r\n        for (let formField of this.#formFields) {\r\n            data[formField.key] = formField.input.value;\r\n        }\r\n        return data;\r\n    }\r\n}\r\n","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2022-09-25\r\n */\r\nexport default class Counter {\r\n\r\n    #currentValue = 0;\r\n    #lastValue = 0;\r\n    #start = 0;\r\n\r\n    tick(currentTimeMillis) {\r\n        this.#currentValue++;\r\n        if (currentTimeMillis - this.#start >= 1000) {\r\n            this.#lastValue = this.#currentValue;\r\n            this.#currentValue = 0;\r\n            this.#start = currentTimeMillis;\r\n        }\r\n    }\r\n\r\n    getValue() {\r\n        return this.#lastValue;\r\n    }\r\n\r\n    clear() {\r\n        this.#lastValue = 0;\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport Entity from \"./Entity\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-04-24\r\n */\r\nexport default class EntityPositionLookup {\r\n\r\n    #table;\r\n    #width;\r\n    #height;\r\n\r\n    /**\r\n     *\r\n     * @param entities {Entity[]}\r\n     * @param width {number} element area width\r\n     * @param height {number} element area height\r\n     */\r\n    constructor(entities, width, height) {\r\n        this.#width = width;\r\n        this.#height = height;\r\n        const table = new Map();\r\n        for (const entity of entities) {\r\n            const index = (entity.getY() * width) + entity.getX();\r\n            let array = table.get(index);\r\n            if (array === undefined) {\r\n                array = [];\r\n                table.set(index, array);\r\n            }\r\n            array.push(entity);\r\n        }\r\n        this.#table = table;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param x {number}\r\n     * @param y {number}\r\n     * @return {Entity[]}\r\n     */\r\n    getAt(x, y) {\r\n        if (x < 0 || y < 0) {\r\n            return [];\r\n        }\r\n        if (x >= this.#width || y >= this.#height) {\r\n            return [];\r\n        }\r\n        const array = this.#table.get((y * this.#width) + x);\r\n        return array !== undefined ? array : [];\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport Entity from \"./Entity\";\r\nimport EntityPositionLookup from \"./EntityPositionLookup\";\r\nimport EntityFactories from \"./EntityFactories\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-05-04\r\n */\r\nexport default class EntityManager {\r\n\r\n    /** @type GameState */\r\n    #gameState;\r\n\r\n    /** @type Entity[] */\r\n    #entities = [];\r\n\r\n    /** @type {EntityPositionLookup} */\r\n    #positionLookupCache = null;\r\n\r\n    /**\r\n     *\r\n     * @param serializedEntities {object[]}\r\n     * @param gameState {GameState}\r\n     */\r\n    constructor(serializedEntities, gameState) {\r\n        this.#gameState = gameState;\r\n\r\n        for (let serializedEntity of serializedEntities) {\r\n            this.addSerializedEntity(serializedEntity, false);\r\n        }\r\n    }\r\n\r\n    addSerializedEntity(serializedEntity, autoInitialize = true) {\r\n        try {\r\n            const entity = this.#deserialize(serializedEntity);\r\n            this.#entities.push(entity);\r\n            if (autoInitialize) {\r\n                entity.initialize();\r\n            }\r\n            return entity;\r\n        } catch (e) {\r\n            console.warn('Cannot deserialize entity', e);\r\n            return null;\r\n        }\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param serialized {object}\r\n     * @return {Entity}\r\n     */\r\n    #deserialize(serialized) {\r\n        if (typeof serialized !== 'object') {\r\n            throw 'Serialized entity must be an object';\r\n        }\r\n        const factory = EntityFactories.findFactoryByEntityType(serialized.entity);\r\n        if (factory !== null) {\r\n            return factory(serialized, this.#gameState);\r\n        }\r\n        throw 'Entity not recognized';\r\n    }\r\n\r\n    performBeforeProcessing() {\r\n        for (let i = 0; i < this.#entities.length; i++) {\r\n            const entity = this.#entities[i];\r\n            entity.performBeforeProcessing();\r\n        }\r\n\r\n        this.#positionLookupCache = null;\r\n    }\r\n\r\n    performAfterProcessing() {\r\n        let toDelete = null;\r\n\r\n        for (let i = 0; i < this.#entities.length; i++) {\r\n            const entity = this.#entities[i];\r\n\r\n            let active;\r\n            try {\r\n                active = entity.performAfterProcessing();\r\n            } catch (e) {\r\n                // some entities are very complex...\r\n                // log error and remove broken entity\r\n                console.error('Entity error', e);\r\n                // TODO: rethrow + error reporting (when stable)\r\n                active = false;\r\n            }\r\n\r\n            if (active === false) {\r\n                if (toDelete === null) {\r\n                    toDelete = [];\r\n                }\r\n                toDelete.push();\r\n            }\r\n        }\r\n\r\n        if (toDelete !== null) {\r\n            for (let i = toDelete.length - 1; i >= 0; i--) {\r\n                const j = toDelete[i];\r\n                this.#entities.splice(j, 1);\r\n            }\r\n        }\r\n\r\n        this.#positionLookupCache = null;\r\n    }\r\n\r\n    serializeEntities() {\r\n        const list = [];\r\n        for (let entity of this.#entities) {\r\n            list.push(entity.serialize());\r\n        }\r\n        return list;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param x\r\n     * @param y\r\n     * @returns {Entity[]}\r\n     */\r\n    getAt(x, y) {\r\n        if (this.#positionLookupCache === null) {\r\n            const width = this.#gameState.elementArea.getWidth();\r\n            const height = this.#gameState.elementArea.getHeight();\r\n            this.#positionLookupCache = new EntityPositionLookup(this.#entities, width, height);\r\n        }\r\n\r\n        return this.#positionLookupCache.getAt(x, y);\r\n    }\r\n\r\n    countEntities(type) {\r\n        let count = 0;\r\n        for (let i = 0; i < this.#entities.length; i++) {\r\n            const entity = this.#entities[i];\r\n            if (type === entity.getType()) {\r\n                count++;\r\n            }\r\n        }\r\n        return count;\r\n    }\r\n\r\n    getEntities() {\r\n        return this.#entities;\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport Element from \"./Element.js\";\r\nimport Brush from \"./brush/Brush.js\";\r\n\r\n/**\r\n * @interface\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-04-27\r\n */\r\nexport default class GameDefaults {\r\n\r\n    /**\r\n     * @returns function(GameState):Extension[]\r\n     */\r\n    getExtensionsFactory() {\r\n        throw 'Not implemented';\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @return BrushCollection\r\n     */\r\n    getBrushCollection() {\r\n        throw 'Not implemented';\r\n    }\r\n\r\n    /**\r\n     * @return Element\r\n     */\r\n    getDefaultElement() {\r\n        throw 'Not implemented';\r\n    }\r\n\r\n    // brushes\r\n\r\n    /**\r\n     * @return Brush\r\n     */\r\n    getBrushWater() {\r\n        throw 'Not implemented';\r\n    }\r\n\r\n    /**\r\n     * @return Brush\r\n     */\r\n    getBrushSteam() {\r\n        throw 'Not implemented';\r\n    }\r\n\r\n    /**\r\n     * @return Brush\r\n     */\r\n    getBrushGrass() {\r\n        throw 'Not implemented';\r\n    }\r\n\r\n    /**\r\n     * @return Brush\r\n     */\r\n    getBrushTree() {\r\n        throw 'Not implemented';\r\n    }\r\n\r\n    /**\r\n     * @return Brush\r\n     */\r\n    getBrushTreeWood() {\r\n        throw 'Not implemented';\r\n    }\r\n\r\n    /**\r\n     * @return Brush\r\n     */\r\n    getBrushTreeWoodDark() {\r\n        throw 'Not implemented';\r\n    }\r\n\r\n    /**\r\n     * @return Brush\r\n     */\r\n    getBrushTreeRoot() {\r\n        throw 'Not implemented';\r\n    }\r\n\r\n    /**\r\n     * @return Brush\r\n     */\r\n    getBrushTreeLeaf() {\r\n        throw 'Not implemented';\r\n    }\r\n\r\n    /**\r\n     * @return Brush\r\n     */\r\n    getBrushTreeLeafDark() {\r\n        throw 'Not implemented';\r\n    }\r\n\r\n    /**\r\n     * @return Brush\r\n     */\r\n    getBrushFire() {\r\n        throw 'Not implemented';\r\n    }\r\n\r\n    /**\r\n     * @return Brush\r\n     */\r\n    getBrushAsh() {\r\n        throw 'Not implemented';\r\n    }\r\n\r\n    // structures\r\n\r\n    /**\r\n     * @return []\r\n     */\r\n    getTreeTrunkTemplates() {\r\n        throw 'Not implemented';\r\n    }\r\n\r\n    /**\r\n     * @return []\r\n     */\r\n    getTreeLeafClusterTemplates() {\r\n        throw 'Not implemented';\r\n    }\r\n}\r\n","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport ElementHead from \"../ElementHead\";\r\nimport ElementTail from \"../ElementTail\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-04-26\r\n */\r\nexport default class ProcessorModuleSolidBody {\r\n\r\n    static #QUEUED_PAINT_ID = 255;\r\n    static #NEWLY_CREATED_PAINT_ID = 254;\r\n    static #BODY_SIZE_LIMIT_MAX = 8192;\r\n    static #BODY_SIZE_LIMIT_MIN = 32;\r\n\r\n\r\n    /** @type ElementArea */\r\n    #elementArea;\r\n\r\n    /** @type DeterministicRandom */\r\n    #random;\r\n\r\n    /** @type ProcessorContext */\r\n    #processorContext;\r\n\r\n    /** @type Uint8Array */\r\n    #elementAreaOverlay;\r\n\r\n    /** @type Set */\r\n    #moved;\r\n\r\n    constructor(elementArea, random, processorContext) {\r\n        this.#elementArea = elementArea;\r\n        this.#random = random;\r\n        this.#processorContext = processorContext;\r\n        this.#elementAreaOverlay = new Uint8Array(elementArea.getWidth() * elementArea.getHeight());\r\n        this.#moved = new Set();\r\n        this.#reusableLowerBorderMinY = new Uint16Array(elementArea.getWidth());\r\n    }\r\n\r\n    onSolidCreated(elementHead, x, y) {\r\n        this.#elementAreaOverlay[x + (y * this.#elementArea.getWidth())] = ProcessorModuleSolidBody.#NEWLY_CREATED_PAINT_ID;\r\n    }\r\n\r\n    onNextIteration() {\r\n        // TODO: optimize - do not clean if not used or needed\r\n        this.#elementAreaOverlay.fill(0);\r\n        this.#moved.clear();\r\n    }\r\n\r\n    behaviourSolid(elementHead, x, y) {\r\n        const bodyId = ElementHead.getTypeModifierSolidBodyId(elementHead);\r\n        // TODO: optimize - map paint id\r\n        const paintId = bodyId;\r\n\r\n        const point = x + (y * this.#elementArea.getWidth());\r\n        const currentPaintId = this.#elementAreaOverlay[point];\r\n        if (currentPaintId === ProcessorModuleSolidBody.#NEWLY_CREATED_PAINT_ID) {\r\n            // this handles newly created tree branches etc.\r\n            return true;\r\n        }\r\n        if (currentPaintId === paintId) {\r\n            // already processed\r\n            return this.#moved.has(paintId);\r\n        }\r\n\r\n        const [\r\n            originalCount, upperBorderStack, lowerBorderStack, lowerBorderMin, properties\r\n        ] = this.#discoverBoundaries(x, y, elementHead, paintId);\r\n\r\n        if (this.#processorContext.isFallThroughEnabled()) {\r\n            if (this.#bodyFallthrough(lowerBorderStack.shadowClone(), paintId)) {\r\n                return true;\r\n            }\r\n        }\r\n\r\n        const extendedCount = this.#extendUpperBoundaries(upperBorderStack, lowerBorderMin, paintId);\r\n        const count = originalCount + extendedCount;\r\n\r\n        const [\r\n            borderCount, borderCountCanMove\r\n        ] = this.#determineCanMove(lowerBorderStack.shadowClone(), paintId);\r\n\r\n        // if (count >= ProcessorModuleSolidBody.#BODY_SIZE_LIMIT_MAX) {\r\n        //     // too big\r\n        //     return false;\r\n        // }\r\n\r\n        // if (count < ProcessorModuleSolidBody.#BODY_SIZE_LIMIT_MIN) {\r\n        //     this.#bodyDestroy(paintId, borderStack);\r\n        //     return true;\r\n        // }\r\n\r\n        if (properties.tree) {\r\n            // living trees are more stable\r\n            if (borderCount === borderCountCanMove) {\r\n                // falling\r\n                this.#bodyMove(paintId, lowerBorderStack);\r\n                this.#moved.add(paintId);\r\n                return true;\r\n            }\r\n        } else {\r\n            if (borderCountCanMove / borderCount > 0.95) {\r\n                // falling or very unstable\r\n                this.#bodyMove(paintId, lowerBorderStack);\r\n                this.#moved.add(paintId);\r\n                return true;\r\n            }\r\n\r\n            if (borderCountCanMove / borderCount > 0.75) {\r\n                // unstable\r\n                this.#bodyPush(paintId, lowerBorderStack);\r\n                return false;\r\n            }\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    #bodyDestroy(paintId, lowerBorderStack) {\r\n        const w = this.#elementArea.getWidth();\r\n\r\n        let point;\r\n        while ((point = lowerBorderStack.pop()) !== null) {\r\n            // process \"column\"\r\n\r\n            if (point === 0xffffffff) {\r\n                // null point\r\n                continue;\r\n            }\r\n\r\n            const bx = point % w;\r\n            const by = Math.trunc(point / w);\r\n\r\n            let i = 0;\r\n            do {\r\n                let elementHead = this.#elementArea.getElementHead(bx, by + i);\r\n\r\n                const type = this.#random.nextInt(100) < 20 ? ElementHead.TYPE_POWDER : ElementHead.TYPE_POWDER_WET;\r\n                elementHead = ElementHead.setType(elementHead, ElementHead.type8Powder(type, 4));\r\n\r\n                let elementTail = this.#elementArea.getElementTail(bx, by + i);\r\n                this.#elementArea.setElementHead(bx, by + i, elementHead);\r\n                this.#elementArea.setElementTail(bx, by + i, elementTail);\r\n\r\n                if (by + i >= 0) {\r\n                    const nextPaintId = this.#elementAreaOverlay[bx + ((by + i - 1) * w)];\r\n                    if (nextPaintId === paintId) {\r\n                        i--;\r\n                    } else {\r\n                        break;\r\n                    }\r\n                } else {\r\n                    break;\r\n                }\r\n            } while (true);\r\n        }\r\n    }\r\n\r\n    #bodyMove(paintId, lowerBorderStack) {\r\n        const w = this.#elementArea.getWidth();\r\n        const h = this.#elementArea.getHeight();\r\n\r\n        let point;\r\n        while ((point = lowerBorderStack.pop()) !== null) {\r\n            // process \"column\"\r\n\r\n            if (point === 0xffffffff) {\r\n                // null point\r\n                continue;\r\n            }\r\n\r\n            const bx = point % w;\r\n            const by = Math.trunc(point / w);\r\n\r\n            let elementHeadOld = null;\r\n            let elementTailOld = null;\r\n            if (by + 1 < h) {\r\n                elementHeadOld = this.#elementArea.getElementHead(bx, by + 1);\r\n                elementTailOld = this.#elementArea.getElementTail(bx, by + 1);\r\n            }\r\n\r\n            let i = 0;\r\n            do {\r\n                const ty = by + 1 + i;\r\n                if (ty < h) {\r\n                    this.#elementArea.setElementHead(bx, ty, this.#elementArea.getElementHead(bx, by + i));\r\n                    this.#elementArea.setElementTail(bx, ty, this.#elementArea.getElementTail(bx, by + i));\r\n                    this.#elementAreaOverlay[bx + (ty * w)] = paintId;\r\n                }\r\n\r\n                if (by + i >= 0) {\r\n                    const nextPaintId = this.#elementAreaOverlay[bx + ((by + i - 1) * w)];\r\n                    if (nextPaintId === paintId) {\r\n                        i--;\r\n                    } else {\r\n                        break;\r\n                    }\r\n                } else {\r\n                    break;\r\n                }\r\n            } while (true);\r\n\r\n            // deal with the old element\r\n\r\n            let reuseElement = false;\r\n            if (elementHeadOld != null) {\r\n                const typeClass = ElementHead.getTypeClass(elementHeadOld);\r\n                if (typeClass === ElementHead.TYPE_AIR) {\r\n                    reuseElement = true;\r\n                } else if (typeClass <= ElementHead.TYPE_FLUID) {\r\n                    reuseElement = this.#reuseFluid(Math.abs(i));\r\n                }\r\n            }\r\n\r\n            if (reuseElement) {\r\n                // move element above the solid body\r\n                this.#elementArea.setElementHead(bx, by + i, elementHeadOld);\r\n                this.#elementArea.setElementTail(bx, by + i, elementTailOld);\r\n            } else {\r\n                // set default element\r\n                this.#elementArea.setElement(bx, by + i, this.#processorContext.getDefaults().getDefaultElement());\r\n            }\r\n\r\n            // create some movement below\r\n\r\n            this.triggerPowderElement(bx, by + 2);\r\n        }\r\n    }\r\n\r\n    #reuseFluid(distance) {\r\n        let f = 1 - (1 / (1 + Math.exp(-(0.1) * (distance - 50))));  // https://en.wikipedia.org/wiki/Sigmoid_function\r\n        return this.#random.next() < f;\r\n    }\r\n\r\n    #bodyPush(paintId, lowerBorderStack) {\r\n        const w = this.#elementArea.getWidth();\r\n\r\n        let point;\r\n        while ((point = lowerBorderStack.pop()) !== null) {\r\n            // process \"column\"\r\n\r\n            if (point === 0xffffffff) {\r\n                // null point\r\n                continue;\r\n            }\r\n\r\n            const bx = point % w;\r\n            const by = Math.trunc(point / w);\r\n\r\n            // create some movement below\r\n\r\n            this.triggerPowderElement(bx, by + 1);\r\n        }\r\n    }\r\n\r\n    triggerPowderElement(x, y) {\r\n        if (this.#elementArea.isValidPosition(x, y)) {\r\n            const elementHeadUnder = this.#elementArea.getElementHead(x, y);\r\n            const typeUnder = ElementHead.getTypeClass(elementHeadUnder);\r\n\r\n            if (typeUnder === ElementHead.TYPE_POWDER || typeUnder === ElementHead.TYPE_POWDER_WET) {\r\n                let modified = elementHeadUnder;\r\n                modified = ElementHead.setTypeModifierPowderSliding(modified, 1);\r\n                if (this.#random.nextInt(15) === 0) {\r\n                    // change direction only once a while to make it less chaotic\r\n                    modified = ElementHead.setTypeModifierPowderDirection(modified, this.#random.nextInt(2));\r\n                }\r\n                this.#elementArea.setElementHead(x, y, modified);\r\n            }\r\n        }\r\n    }\r\n\r\n    #determineCanMove(lowerBorderStack, paintId) {\r\n        const w = this.#elementArea.getWidth();\r\n        const h = this.#elementArea.getHeight();\r\n\r\n        let borderCount = 0;\r\n        let borderCountCanMove = 0;\r\n\r\n        let point;\r\n        while ((point = lowerBorderStack.pop()) !== null) {\r\n\r\n            const bx = point % w;\r\n            const by = Math.trunc(point / w);\r\n\r\n            if (by + 1 < h) {\r\n                const elementHead = this.#elementArea.getElementHead(bx, by + 1);\r\n\r\n                // check whether is not connected with other \"column\" by extendUpperBoundaries\r\n                if (this.#elementAreaOverlay[bx + ((by + 1) * w)] === paintId) {\r\n                    lowerBorderStack.removePrevious();  // remove\r\n                    continue;\r\n                }\r\n\r\n                borderCount++;\r\n\r\n                // can move here?\r\n                const typeClass = ElementHead.getTypeClass(elementHead);\r\n                switch (typeClass) {\r\n                    case ElementHead.TYPE_AIR:\r\n                    case ElementHead.TYPE_EFFECT:\r\n                    case ElementHead.TYPE_GAS:\r\n                    case ElementHead.TYPE_FLUID:\r\n                        borderCountCanMove++;\r\n                }\r\n            } else {\r\n                borderCount++;\r\n            }\r\n        }\r\n\r\n        return [borderCount, borderCountCanMove];\r\n    }\r\n\r\n    #bodyFallthrough(lowerBorderStack, paintId) {\r\n        const w = this.#elementArea.getWidth();\r\n        const h = this.#elementArea.getHeight();\r\n\r\n        let applied = false;\r\n\r\n        let point;\r\n        while ((point = lowerBorderStack.pop()) !== null) {\r\n\r\n            const bx = point % w;\r\n            const by = Math.trunc(point / w);\r\n\r\n            if (by === h - 1) {\r\n                // destroy\r\n\r\n                let elementHead = this.#elementArea.getElementHead(bx, by);\r\n                elementHead = ElementHead.setType(elementHead, ElementHead.type8Powder(ElementHead.TYPE_POWDER, 5));\r\n\r\n                let elementTail = this.#elementArea.getElementTail(bx, by);\r\n                elementTail = ElementTail.setBlurType(elementTail, ElementTail.BLUR_TYPE_1);\r\n\r\n                this.#elementArea.setElementHeadAndTail(bx, by, elementHead, elementTail);\r\n\r\n                applied = true;\r\n            }\r\n        }\r\n\r\n        return applied;\r\n    }\r\n\r\n    #extendUpperBoundaries(upperBorderStack, lowerBorderMinY, paintId) {\r\n        // handles e.g. sand /stuck/ inside a solid body\r\n\r\n        const w = this.#elementArea.getWidth();\r\n        const h = this.#elementArea.getHeight();\r\n\r\n        let extendedCount = 0;\r\n\r\n        let point;\r\n        while ((point = upperBorderStack.pop()) !== null) {\r\n            const bx = point % w;\r\n            const by = Math.trunc(point / w);\r\n\r\n            const columnLowerBorderMinY = lowerBorderMinY[bx];\r\n            if (columnLowerBorderMinY >= by) {\r\n                continue;\r\n            }\r\n            // there is at leas one lower border above this upper border\r\n\r\n            let i = 0;\r\n            let ty;\r\n            while ((ty = by - (i + 1)) >= 0 && ty > columnLowerBorderMinY) {\r\n                const nextPaintId = this.#elementAreaOverlay[bx + (ty * w)];\r\n\r\n                if (nextPaintId === paintId) {\r\n                    // lower boundary reached\r\n                    break;\r\n                }\r\n\r\n                if (nextPaintId !== 0) {\r\n                    // already in another body\r\n                    break;\r\n                }\r\n\r\n                const elementHead = this.#elementArea.getElementHead(bx, ty);\r\n                const typeClass = ElementHead.getTypeClass(elementHead);\r\n\r\n                // TODO: Im not sure here\r\n                /*if (typeClass <= ElementHead.TYPE_FLUID) {\r\n                    // light element\r\n                    break;\r\n                } else*/ if (typeClass < ElementHead.TYPE_STATIC) {\r\n                    // extend\r\n                    this.#elementAreaOverlay[bx + (ty * w)] = paintId;\r\n                    extendedCount++;\r\n                    i++;\r\n                } else {\r\n                    // too heavy element\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        return extendedCount;\r\n    }\r\n\r\n    #reusableWorkStack = new Uint32Stack();\r\n    #reusableUpperBorderStack = new Uint32Stack();\r\n    #reusableLowerBorderStack = new Uint32Stack();\r\n    #reusableLowerBorderMinY;  // new Uint16Array(width);\r\n\r\n    /**\r\n     *\r\n     * @param x {number}\r\n     * @param y {number}\r\n     * @param elementHead {number}\r\n     * @param paintId {number}\r\n     * @return {[number, Uint32Stack, Uint32Stack, Uint16Array, object]} result\r\n     */\r\n    #discoverBoundaries(x, y, elementHead, paintId) {\r\n        const pattern = 0b11110111;  // falling id and type class\r\n        const matcher = this.#elementArea.getElementHead(x, y) & pattern;\r\n\r\n        const w = this.#elementArea.getWidth();\r\n\r\n        const stack = this.#reusableWorkStack;\r\n        stack.reset();\r\n\r\n        const upperBorderStack = this.#reusableUpperBorderStack;\r\n        upperBorderStack.reset();\r\n\r\n        const lowerBorderStack = this.#reusableLowerBorderStack;\r\n        lowerBorderStack.reset();\r\n\r\n        const lowerBorderMinY = this.#reusableLowerBorderMinY;\r\n        lowerBorderMinY.fill(0xffff);  // not set\r\n\r\n        const properties = {\r\n            tree: ElementHead.getBehaviour(elementHead) === ElementHead.BEHAVIOUR_TREE  // default value\r\n        };\r\n\r\n        let count = 0;\r\n        let point = x + y * w;\r\n        do {\r\n            const x = point % w;\r\n            const y = Math.trunc(point / w);\r\n\r\n            this.#elementAreaOverlay[point] = paintId;\r\n            count++;\r\n\r\n            const upperBorder = this.#discoverNeighbour(x, y - 1, pattern, matcher, stack, paintId, properties);\r\n            if (upperBorder) {\r\n                upperBorderStack.push(point);\r\n            }\r\n\r\n            this.#discoverNeighbour(x + 1, y, pattern, matcher, stack, paintId, properties);\r\n            this.#discoverNeighbour(x - 1, y, pattern, matcher, stack, paintId, properties);\r\n\r\n            if (ElementHead.getTypeModifierSolidNeighbourhoodType(this.#elementArea.getElementHead(x, y)) === 0) {\r\n                // extended neighbourhood\r\n                this.#discoverNeighbour(x + 1, y - 1, pattern, matcher, stack, paintId, properties);\r\n                this.#discoverNeighbour(x - 1, y - 1, pattern, matcher, stack, paintId, properties);\r\n                this.#discoverNeighbour(x + 1, y + 1, pattern, matcher, stack, paintId, properties);\r\n                this.#discoverNeighbour(x - 1, y + 1, pattern, matcher, stack, paintId, properties);\r\n            }\r\n\r\n            const lowerBorder = this.#discoverNeighbour(x, y + 1, pattern, matcher, stack, paintId, properties);\r\n            if (lowerBorder) {\r\n                lowerBorderStack.push(point);\r\n                const oldMin = lowerBorderMinY[x];\r\n                lowerBorderMinY[x] = (oldMin === 0xffff) ? y : Math.min(oldMin, y);\r\n            }\r\n\r\n        } while ((point = stack.pop()) != null);\r\n\r\n        return [count, upperBorderStack, lowerBorderStack, lowerBorderMinY, properties];\r\n    }\r\n\r\n    #discoverNeighbour(x, y, pattern, matcher, stack, targetPaintId, properties) {\r\n        if (x < 0 || y < 0) {\r\n            return true;  // border\r\n        }\r\n\r\n        const w = this.#elementArea.getWidth();\r\n        const h = this.#elementArea.getHeight();\r\n        if (x >= w || y >= h) {\r\n            return true;  // border\r\n        }\r\n\r\n        const point = x + (y * w);\r\n        const currentPaintId = this.#elementAreaOverlay[point];\r\n        if (currentPaintId === ProcessorModuleSolidBody.#QUEUED_PAINT_ID) {\r\n            // already queued\r\n            return false;  // no border\r\n        }\r\n        if (currentPaintId === targetPaintId) {\r\n            // already done\r\n            return false;  // no border\r\n        }\r\n\r\n        const elementHead = this.#elementArea.getElementHead(x, y);\r\n\r\n        if (!properties.tree) {\r\n            if (ElementHead.getBehaviour(elementHead) === ElementHead.BEHAVIOUR_TREE) {\r\n                properties.tree = true;\r\n            }\r\n        }\r\n\r\n        if ((elementHead & pattern) !== matcher) {\r\n            // no match\r\n            return true;  // border\r\n        }\r\n\r\n        this.#elementAreaOverlay[point] = ProcessorModuleSolidBody.#QUEUED_PAINT_ID;\r\n        stack.push(point);\r\n        return false;  // no border\r\n    }\r\n}\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-03-23\r\n */\r\nclass Uint32Stack {\r\n    static create(size) {\r\n        return new Uint32Stack(new Uint32Array(Math.max(1, size)));\r\n    }\r\n\r\n    /** @type Uint32Array */\r\n    #array;\r\n    #i = -1;\r\n\r\n    constructor(array = new Uint32Array(1)) {\r\n        this.#array = array;\r\n    }\r\n\r\n    push(value) {\r\n        if (this.#array.length === this.#i + 1) {\r\n            // increase size\r\n            const newArray = new Uint32Array(this.#array.length * 2);\r\n            newArray.set(this.#array);\r\n            this.#array = newArray;\r\n        }\r\n        this.#array[++this.#i] = value;\r\n    }\r\n\r\n    pop() {\r\n        if (this.#i === -1) {\r\n            return null;\r\n        }\r\n        return this.#array[this.#i--];\r\n    }\r\n\r\n    shadowClone() {\r\n        const clone = new Uint32Stack(this.#array);\r\n        clone.#i = this.#i;\r\n        return clone;\r\n    }\r\n\r\n    removePrevious() {\r\n        this.#array[this.#i + 1] = 0xffffffff;\r\n    }\r\n\r\n    reset() {\r\n        this.#i = -1;\r\n    }\r\n}\r\n","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport ElementHead from \"../ElementHead\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-04-25\r\n */\r\nexport default class ProcessorModuleEntity {\r\n\r\n    /** @type ElementArea */\r\n    #elementArea;\r\n\r\n    /** @type DeterministicRandom */\r\n    #random;\r\n\r\n    /** @type ProcessorContext */\r\n    #processorContext;\r\n\r\n    constructor(elementArea, random, processorContext) {\r\n        this.#elementArea = elementArea;\r\n        this.#random = random;\r\n        this.#processorContext = processorContext;\r\n    }\r\n\r\n    behaviourEntity(elementHead, x, y) {\r\n        const special = ElementHead.getSpecial(elementHead);\r\n\r\n        if (special < 5) {\r\n            // increment\r\n            const newElementHead = ElementHead.setSpecial(elementHead, special + 1);\r\n            this.#elementArea.setElementHead(x, y, newElementHead);\r\n        } else {\r\n            // destroy\r\n            const type = this.#random.nextInt(100) < 20 ? ElementHead.TYPE_POWDER : ElementHead.TYPE_POWDER_WET;\r\n\r\n            let newElementHead = elementHead;\r\n            newElementHead = ElementHead.setType(newElementHead, ElementHead.type8Powder(type, 4));\r\n            newElementHead = ElementHead.setBehaviour(newElementHead, ElementHead.BEHAVIOUR_NONE);\r\n            newElementHead = ElementHead.setSpecial(newElementHead, 0);\r\n            this.#elementArea.setElementHead(x, y, newElementHead);\r\n        }\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport ElementHead from \"../ElementHead.js\";\r\nimport ElementTail from \"../ElementTail.js\";\r\nimport VisualEffects from \"./VisualEffects.js\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-02-01\r\n */\r\nexport default class ProcessorModuleFire {\r\n\r\n    static #FIRE_MIN_TEMPERATURE = 34;\r\n\r\n    static createFireElementHead(temperature) {\r\n        let elementHead = ElementHead.of(ElementHead.TYPE_EFFECT, ElementHead.BEHAVIOUR_FIRE);\r\n        elementHead = ElementHead.setTemperature(elementHead, temperature);\r\n        return elementHead;\r\n    }\r\n\r\n    static createFireElementTail(temperature) {\r\n        let elementTail = ElementTail.of(0, 0, 0);\r\n\r\n        if (temperature > 213)\r\n            elementTail = ElementTail.setColor(elementTail, 249, 219, 30);\r\n        else if (temperature > 170)\r\n            elementTail = ElementTail.setColor(elementTail, 248, 201,  7);\r\n        else if (temperature > 128)\r\n            elementTail = ElementTail.setColor(elementTail, 250, 150,  3);\r\n        else if (temperature > 85)\r\n            elementTail = ElementTail.setColor(elementTail, 255, 111,  0);\r\n        else if (temperature > 80)\r\n            elementTail = ElementTail.setColor(elementTail, 255,  37,  0);\r\n        else if (temperature > 75)\r\n            elementTail = ElementTail.setColor(elementTail, 250,   4,  5);\r\n        else\r\n            elementTail = ElementTail.setColor(elementTail, 125,   0,  0);\r\n\r\n        return elementTail;\r\n    }\r\n\r\n\r\n    /** @type ElementArea */\r\n    #elementArea;\r\n\r\n    /** @type DeterministicRandom */\r\n    #random;\r\n\r\n    /** @type ProcessorContext */\r\n    #processorContext;\r\n\r\n    constructor(elementArea, random, processorContext) {\r\n        this.#elementArea = elementArea;\r\n        this.#random = random;\r\n        this.#processorContext = processorContext;\r\n    }\r\n\r\n    // FIRE\r\n\r\n    behaviourFire(elementHead, x, y) {\r\n        if (this.#random.nextInt(4) !== 0) {\r\n            return;  // it would disappear too quickly...\r\n        }\r\n\r\n        // count new temperature\r\n        const temperature = ElementHead.getTemperature(elementHead);\r\n        const newTemperature = this.#countNewTemperature(x, y, temperature);\r\n        if (newTemperature < ProcessorModuleFire.#FIRE_MIN_TEMPERATURE) {\r\n            // the fire will disappear\r\n            this.#elementArea.setElement(x, y, this.#processorContext.getDefaults().getDefaultElement());\r\n            return;\r\n        }\r\n\r\n        const elementHeadAbove = this.#elementArea.getElementHeadOrNull(x, y - 1);\r\n        // check is fluid above\r\n        if (ElementHead.getTypeClass(elementHeadAbove) === ElementHead.TYPE_FLUID) {\r\n            this.#elementArea.setElement(x, y, this.#processorContext.getDefaults().getDefaultElement());\r\n            return;\r\n        }\r\n\r\n        // spread or update\r\n        if (elementHeadAbove !== null && this.#couldBeReplacedByFire(elementHeadAbove)) {\r\n            this.#elementArea.setElementHead(x, y - 1, ProcessorModuleFire.createFireElementHead(newTemperature));\r\n            this.#elementArea.setElementTail(x, y - 1, ProcessorModuleFire.createFireElementTail(newTemperature));\r\n        } else {\r\n            this.#elementArea.setElementHead(x, y, ElementHead.setTemperature(elementHead, newTemperature));\r\n            this.#elementArea.setElementTail(x, y, ProcessorModuleFire.createFireElementTail(newTemperature));\r\n        }\r\n\r\n        // affect near elements:\r\n        //   # #\r\n        //   #O#\r\n        //    #\r\n        this.#fireEffect(x + 1, y - 1, newTemperature);\r\n        this.#fireEffect(x - 1, y - 1, newTemperature);\r\n        this.#fireEffect(x + 1, y, newTemperature);\r\n        this.#fireEffect(x - 1, y, newTemperature);\r\n        this.#fireEffect(x, y + 1, newTemperature);\r\n    }\r\n\r\n    #countNewTemperature(x, y, currentTemperature) {\r\n        let newTemperature = currentTemperature\r\n                + this.#getTemperatureAt(x, y + 1)          // under\r\n                + this.#getTemperatureAt(x + 1, y + 1)   // under right\r\n                + this.#getTemperatureAt(x - 1, y + 1);  // under left\r\n\r\n        newTemperature = newTemperature / 4;\r\n\r\n        if (newTemperature < 76) {\r\n            if (this.#random.nextInt(2) === 0) {\r\n                newTemperature -= this.#random.nextInt(10);\r\n            }\r\n        } else {\r\n            if (this.#random.nextInt(2) === 0) {\r\n                newTemperature -= this.#random.nextInt(50);\r\n            }\r\n        }\r\n        if (newTemperature < 0) {\r\n            newTemperature = 0;\r\n        }\r\n        return newTemperature;\r\n    }\r\n\r\n    #getTemperatureAt(x, y) {\r\n        const elementHead = this.#elementArea.getElementHeadOrNull(x, y);\r\n        if (elementHead !== null) {\r\n            return ElementHead.getTemperature(elementHead);\r\n        }\r\n        return null;\r\n    }\r\n\r\n    #couldBeReplacedByFire(elementHead) {\r\n        return ElementHead.getTypeClass(elementHead) === ElementHead.TYPE_AIR;\r\n    }\r\n\r\n    #fireEffect(x, y, temperature) {\r\n        const elementHead = this.#elementArea.getElementHeadOrNull(x, y);\r\n        if (elementHead == null) {\r\n            return;\r\n        }\r\n\r\n        if (ElementHead.getBehaviour(elementHead) === ElementHead.BEHAVIOUR_FIRE) {\r\n            // affect fire\r\n            const otherTemperature = ElementHead.getTemperature(elementHead);\r\n            if (otherTemperature < temperature) {\r\n                const newTemperature = Math.trunc((temperature - otherTemperature) / 2);\r\n                if (newTemperature > ProcessorModuleFire.#FIRE_MIN_TEMPERATURE) {\r\n                    this.#elementArea.setElementHead(x, y, ProcessorModuleFire.createFireElementHead(newTemperature));\r\n                    this.#elementArea.setElementTail(x, y, ProcessorModuleFire.createFireElementTail(newTemperature));\r\n                }\r\n            }\r\n            return;\r\n        }\r\n\r\n        // for air elements...\r\n        if (ElementHead.getTypeClass(elementHead) === ElementHead.TYPE_AIR) {\r\n            // spreading\r\n            const newTemperature = Math.trunc(temperature * 0.7);\r\n            if (newTemperature > ProcessorModuleFire.#FIRE_MIN_TEMPERATURE) {\r\n                this.#elementArea.setElementHead(x, y, ProcessorModuleFire.createFireElementHead(newTemperature));\r\n                this.#elementArea.setElementTail(x, y, ProcessorModuleFire.createFireElementTail(newTemperature));\r\n            }\r\n            return;\r\n        }\r\n\r\n        // for flammable elements...\r\n        const heatModIndex = ElementHead.getHeatModIndex(elementHead);\r\n        const flammableChance = ElementHead.hmiToFlammableChanceTo10000(heatModIndex);\r\n        if (flammableChance !== 0) {\r\n            if (ElementHead.getBehaviour(elementHead) === ElementHead.BEHAVIOUR_FIRE_SOURCE) {\r\n                // already in fire\r\n                return;\r\n            }\r\n            if (this.#random.nextInt(10000) < flammableChance) {\r\n                // ignite\r\n                this.ignite(elementHead, x, y);\r\n                return;\r\n            }\r\n        }\r\n\r\n        // increase temperature\r\n        if (this.#random.nextInt(5) === 0) {\r\n            const currentTemperature = ElementHead.getTemperature(elementHead);\r\n            if (currentTemperature < temperature) {\r\n                const modifiedElementHead = ElementHead.setTemperature(elementHead, temperature);\r\n                this.#elementArea.setElementHead(x, y, modifiedElementHead);\r\n            }\r\n        }\r\n\r\n        // visual change\r\n        if (VisualEffects.isVisualBurnApplicable(elementHead)) {\r\n            if (this.#random.nextInt(10) === 0) {\r\n                const elementTail = this.#elementArea.getElementTail(x, y);\r\n                this.#elementArea.setElementTail(x, y, VisualEffects.visualBurn(elementTail, 1, 2));\r\n            }\r\n        }\r\n    }\r\n\r\n    // FIRE SOURCE\r\n\r\n    behaviourFireSource(elementHead, x, y) {\r\n        const heatModIndex = ElementHead.getHeatModIndex(elementHead);\r\n        const flameHeat = ElementHead.hmiToFlameHeat(heatModIndex);\r\n        const burnDownChange = ElementHead.hmiToBurnDownChanceTo10000(heatModIndex);\r\n\r\n        if (this.#random.nextInt(10000) < burnDownChange) {\r\n            // burned down\r\n            if (ElementHead.getTypeClass(elementHead) >= ElementHead.TYPE_POWDER && this.#random.nextInt(100) < 8) {\r\n                // turn into ash\r\n                const oldTemperature = ElementHead.getTemperature(elementHead);\r\n                const ashElement = this.#processorContext.getDefaults().getBrushAsh().apply(x, y, this.#random);\r\n                const modifiedAshElementHead = ElementHead.setTemperature(ashElement.elementHead, oldTemperature);\r\n                const modifiedAshElementTail = ashElement.elementTail;\r\n                this.#elementArea.setElementHeadAndTail(x, y, modifiedAshElementHead, modifiedAshElementTail);\r\n            } else {\r\n                // turn into fire element\r\n                this.#elementArea.setElementHead(x, y, ProcessorModuleFire.createFireElementHead(flameHeat));\r\n                this.#elementArea.setElementTail(x, y, ProcessorModuleFire.createFireElementTail(flameHeat));\r\n            }\r\n            return;\r\n        }\r\n\r\n        // affect others\r\n        const flags = this.#fireSourceEffect(x, y - 1, flameHeat)\r\n                | this.#fireSourceEffect(x, y + 1, flameHeat)\r\n                | this.#fireSourceEffect(x - 1, y, flameHeat)\r\n                | this.#fireSourceEffect(x + 1, y, flameHeat);\r\n\r\n        if (flags === 0b00 || (flags & 0b10) !== 0) {  // no air || some water\r\n            // extinguish\r\n            this.#elementArea.setElementHead(x, y, ElementHead.setBehaviour(elementHead, ElementHead.BEHAVIOUR_NONE));\r\n            return;\r\n        }\r\n\r\n        if (ElementHead.getTypeClass(elementHead) === ElementHead.TYPE_STATIC) {\r\n            // occasionally a falling piece...\r\n            if (this.#random.nextInt(10000) < 2) {\r\n                const type = ElementHead.type8Powder(ElementHead.TYPE_POWDER, 5, 1, this.#random.nextInt(2));\r\n                this.#elementArea.setElementHead(x, y, ElementHead.setType(elementHead, type));\r\n                return;\r\n            }\r\n        }\r\n\r\n        // update temperature\r\n        this.#elementArea.setElementHead(x, y, ElementHead.setTemperature(elementHead, flameHeat));\r\n    }\r\n\r\n    #fireSourceEffect(x, y, temperature) {\r\n        const elementHead = this.#elementArea.getElementHeadOrNull(x, y);\r\n        if (elementHead === null) {\r\n            return 0b00;\r\n        }\r\n\r\n        // water => extinguish\r\n        if (ElementHead.getBehaviour(elementHead) === ElementHead.BEHAVIOUR_LIQUID\r\n                && ElementHead.getSpecial(elementHead) === ElementHead.SPECIAL_LIQUID_WATER) {\r\n            return 0b10;\r\n        }\r\n\r\n        // air => spawn fire\r\n        if (ElementHead.getTypeClass(elementHead) <= ElementHead.TYPE_EFFECT) {\r\n            // air found\r\n            const actualTemperature = this.#random.nextInt(temperature);\r\n            if (actualTemperature >= ProcessorModuleFire.#FIRE_MIN_TEMPERATURE) {\r\n                this.#elementArea.setElementHead(x, y, ProcessorModuleFire.createFireElementHead(actualTemperature));\r\n                this.#elementArea.setElementTail(x, y, ProcessorModuleFire.createFireElementTail(actualTemperature));\r\n            }\r\n            return 0b01;\r\n        }\r\n\r\n        // visual change\r\n        if (VisualEffects.isVisualBurnApplicable(elementHead)) {\r\n            if (this.#random.nextInt(1000) === 0) {\r\n                const elementTail = this.#elementArea.getElementTail(x, y);\r\n                this.#elementArea.setElementTail(x, y, VisualEffects.visualBurn(elementTail, 1, 2));\r\n            }\r\n        }\r\n\r\n        return 0b00;\r\n    }\r\n\r\n    // UTILS\r\n\r\n    ignite(elementHead, x, y, heatModIndex) {\r\n        let modifiedElementHead = ElementHead.setBehaviour(elementHead, ElementHead.BEHAVIOUR_FIRE_SOURCE);\r\n        modifiedElementHead = ElementHead.setTemperature(modifiedElementHead, ElementHead.hmiToFlameHeat(heatModIndex));\r\n        this.#elementArea.setElementHead(x, y, modifiedElementHead);\r\n        // change visual\r\n        const elementTail = this.#elementArea.getElementTail(x, y);\r\n        this.#elementArea.setElementTail(x, y, VisualEffects.visualBurn(elementTail, 2));\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2023-07-23\r\n */\r\nexport default class CircleIterator {\r\n\r\n    // This may look ugly but it's all I need\r\n\r\n    // BLUEPRINT_3 and BLUEPRINT_4 are not needed, but they are used frequently\r\n\r\n    static BLUEPRINT_3 = [\r\n        '  333',\r\n        ' 32223',\r\n        '3211123',\r\n        '3210123',\r\n        '3211123',\r\n        ' 32223',\r\n        '  333',\r\n    ];\r\n\r\n    static BLUEPRINT_4 = [\r\n        '   444   ',\r\n        '  43334',\r\n        ' 4322234',\r\n        '432111234',\r\n        '432101234',\r\n        '432111234',\r\n        ' 4322234',\r\n        '  43334',\r\n        '   444'\r\n    ];\r\n\r\n    static BLUEPRINT_9 = [\r\n        '       99999       ',\r\n        '     998888899',\r\n        '   9988777778899',\r\n        '  998776666677899',\r\n        '  987665555566789',\r\n        ' 98766554445566789',\r\n        ' 98765543334556789',\r\n        '9876554322234556789',\r\n        '9876543211123456789',\r\n        '9876543210123456789',\r\n        '9876543211123456789',\r\n        '9876554322234556789',\r\n        ' 98765543334556789',\r\n        ' 98766554445566789',\r\n        '  987665555566789',\r\n        '  998776666677899',\r\n        '   9988777778899',\r\n        '     998888899',\r\n        '       99999'\r\n    ];\r\n\r\n    /**\r\n     *\r\n     * @param blueprint {string[]}\r\n     * @param handler {function(dx: number, dy: number, level: number)}\r\n     */\r\n    static iterate(blueprint, handler) {\r\n        const w = blueprint[0].length;\r\n        const h = blueprint.length;\r\n        const offsetX = Math.trunc(w / 2);\r\n        const offsetY = Math.trunc(h / 2);\r\n\r\n        for (let i = 0; i < blueprint.length; i++) {\r\n            const row = blueprint[i];\r\n            for (let j = 0; j < row.length; j++) {\r\n                const char = row.charAt(j);\r\n                if (char !== ' ') {\r\n                    handler(j - offsetX, i - offsetY, +char);\r\n                }\r\n            }\r\n        }\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport ElementHead from \"../ElementHead.js\";\r\nimport CircleIterator from \"../CircleIterator.js\";\r\nimport VisualEffects from \"./VisualEffects.js\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-05-05\r\n */\r\nexport default class ProcessorModuleMeteor {\r\n\r\n    // TODO: leave some metal behind...\r\n    // TODO: when water hit?\r\n\r\n    static DIRECTION_FROM_TOP = 0;\r\n    static DIRECTION_FROM_LEFT = 1;\r\n    static DIRECTION_FROM_RIGHT = 2;\r\n\r\n    static #HEAT = 100;\r\n\r\n    static #EXPLOSION_MAX_HEAT_LVL_8 = 255;\r\n    static #EXPLOSION_MAX_HEAT_LVL_9 = 220;\r\n    static #EXPLOSION_MAX_HEAT_VARIANCE = 60;\r\n\r\n    /** @type ElementArea */\r\n    #elementArea;\r\n\r\n    /** @type DeterministicRandom */\r\n    #random;\r\n\r\n    /** @type ProcessorContext */\r\n    #processorContext;\r\n\r\n    constructor(elementArea, random, processorContext) {\r\n        this.#elementArea = elementArea;\r\n        this.#random = random;\r\n        this.#processorContext = processorContext;\r\n    }\r\n\r\n    behaviourMeteor(elementHead, x, y) {\r\n        this.#spawnFire(elementHead, x, y);\r\n\r\n        const special = ElementHead.getSpecial(elementHead);\r\n        const move = special & 0x1;\r\n        let newSpecial = special ^ (!move);\r\n        elementHead = ElementHead.setSpecial(elementHead, newSpecial);\r\n        this.#elementArea.setElementHead(x, y, elementHead);\r\n        if (!move) {\r\n            return;  // move only once per simulation iteration\r\n        }\r\n\r\n        // resolve direction\r\n        const slope = 4;\r\n        const direction = (special & (~0x1)) >> 1;\r\n        let tx, ty;\r\n        if (direction === ProcessorModuleMeteor.DIRECTION_FROM_TOP) {\r\n            ty = y + 1;\r\n            tx = x;\r\n        } else if (direction === ProcessorModuleMeteor.DIRECTION_FROM_LEFT) {\r\n            ty = y + 1;\r\n            tx = x + (ty % slope === 0 ? 1 : 0);\r\n        } else if (direction === ProcessorModuleMeteor.DIRECTION_FROM_RIGHT) {\r\n            ty = y + 1;\r\n            tx = x - (ty % slope === 0 ? 1 : 0);\r\n        } else {\r\n            // unknown direction\r\n            ty = y + 1;\r\n            tx = x;\r\n        }\r\n\r\n        if (this.#elementArea.isValidPosition(tx, ty)) {\r\n            if (this.#processorContext.isFallThroughEnabled() && ty === this.#elementArea.getHeight() - 1) {\r\n                // handle meteor in fallthrough mode\r\n                if (this.#canMove(tx, 0)) {\r\n                    // teleport\r\n                    this.#elementArea.swap(x, y, tx, 0);\r\n                    this.#processorContext.trigger(tx, 0);\r\n                }\r\n            } else if (this.#canMove(tx, ty)) {\r\n                // move\r\n                this.#elementArea.swap(x, y, tx, ty);\r\n            } else {\r\n               this.#explode(elementHead, x, y);\r\n            }\r\n        } else {\r\n            this.#explode(elementHead, x, y);\r\n        }\r\n    }\r\n\r\n    #canMove(x, y) {\r\n        const targetElementHead = this.#elementArea.getElementHead(x, y);\r\n        const typeClass = ElementHead.getTypeClass(targetElementHead);\r\n        if (typeClass <= ElementHead.TYPE_GAS || typeClass === ElementHead.TYPE_FLUID) {\r\n            return true;\r\n        }\r\n        const behaviour = ElementHead.getBehaviour(targetElementHead);\r\n        if (behaviour === ElementHead.BEHAVIOUR_TREE_LEAF) {\r\n            return true;\r\n        }\r\n        if (behaviour === ElementHead.BEHAVIOUR_GRASS) {\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    #spawnFire(elementHead, x, y) {\r\n        CircleIterator.iterate(CircleIterator.BLUEPRINT_4, (dx, dy, level) => {\r\n            if (level === 0) {\r\n                return;  // ignore center\r\n            }\r\n\r\n            const tx = x + dx;\r\n            const ty = y + dy;\r\n            if (this.#elementArea.isValidPosition(tx, ty)) {\r\n                let targetElementHead = this.#elementArea.getElementHead(tx, ty);\r\n                if (ElementHead.getTypeClass(targetElementHead) <= ElementHead.TYPE_GAS) {\r\n                    const brush = this.#processorContext.getDefaults().getBrushFire();\r\n                    this.#elementArea.setElement(tx, ty, brush.apply(tx, ty, this.#random));\r\n                } else {\r\n                    const modifiedElementHead = ElementHead.setTemperature(targetElementHead, ProcessorModuleMeteor.#HEAT);\r\n                    this.#elementArea.setElementHead(tx, ty, modifiedElementHead);\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    #explode(elementHead, x, y) {\r\n        CircleIterator.iterate(CircleIterator.BLUEPRINT_9, (dx, dy, level) => {\r\n            const tx = x + dx;\r\n            const ty = y + dy;\r\n            if (this.#elementArea.isValidPosition(tx, ty)) {\r\n                let targetElementHead = this.#elementArea.getElementHead(tx, ty);\r\n                if (level !== 0 && ElementHead.getBehaviour(targetElementHead) === ElementHead.BEHAVIOUR_METEOR) {\r\n                    // do not destroy other meteors\r\n                    return;\r\n                }\r\n\r\n                if (level <= 7) {\r\n                    // destroy elements & spawn fire\r\n                    const brush = this.#processorContext.getDefaults().getBrushFire();\r\n                    this.#elementArea.setElement(tx, ty, brush.apply(tx, ty, this.#random));\r\n                } else {\r\n                    // set temperature, apply visual changes, break solid elements\r\n\r\n                    // set temperature\r\n                    const maxHeat = (level === 8)\r\n                            ? ProcessorModuleMeteor.#EXPLOSION_MAX_HEAT_LVL_8\r\n                            : ProcessorModuleMeteor.#EXPLOSION_MAX_HEAT_LVL_9;\r\n                    const heat = maxHeat - this.#random.nextInt(ProcessorModuleMeteor.#EXPLOSION_MAX_HEAT_VARIANCE);\r\n                    targetElementHead = ElementHead.setTemperature(targetElementHead, heat);\r\n\r\n                    // visual burnt effect (color)\r\n                    if (VisualEffects.isVisualBurnApplicable(targetElementHead)) {\r\n                        let targetElementTail = this.#elementArea.getElementTail(tx, ty);\r\n                        if (level === 8) {\r\n                            targetElementTail = VisualEffects.visualBurn(targetElementTail, 2);\r\n                        } else {\r\n                            targetElementTail = VisualEffects.visualBurn(targetElementTail, 1);\r\n                        }\r\n                        this.#elementArea.setElementTail(tx, ty, targetElementTail);\r\n                    }\r\n\r\n                    // turn some solid elements into fragments\r\n                    if (ElementHead.getTypeClass(targetElementHead) === ElementHead.TYPE_STATIC) {\r\n                        if (level === 8 || (level === 9 && this.#random.nextInt(10) < 3)) {\r\n                            const type = ElementHead.type8Powder(ElementHead.TYPE_POWDER, 5);\r\n                            targetElementHead = ElementHead.setType(targetElementHead, type);\r\n                        }\r\n                    }\r\n\r\n                    this.#elementArea.setElementHead(tx, ty, targetElementHead);\r\n                }\r\n            }\r\n        });\r\n    }\r\n}\r\n","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport ElementHead from \"../ElementHead.js\";\r\nimport VisualEffects from \"./VisualEffects\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2023-12-08\r\n */\r\nexport default class ProcessorModuleGrass {\r\n\r\n    static #MAX_TEMPERATURE = 20;\r\n\r\n    static canGrowUpHere(elementArea, x, y) {\r\n        if (x < 0 || y - 1 < 0) {\r\n            return false;\r\n        }\r\n        if (x >= elementArea.getWidth() || y + 1 >= elementArea.getHeight()) {\r\n            return false;\r\n        }\r\n        let e1 = elementArea.getElementHead(x, y);\r\n        if (ElementHead.getTypeClass(e1) !== ElementHead.TYPE_AIR) {\r\n            return false;\r\n        }\r\n        if (ElementHead.getTemperature(e1) >= this.#MAX_TEMPERATURE) {\r\n            return false;\r\n        }\r\n        let e2 = elementArea.getElementHead(x, y + 1);\r\n        if (ElementHead.getBehaviour(e2) !== ElementHead.BEHAVIOUR_SOIL) {\r\n            return false;\r\n        }\r\n        if (ElementHead.getTemperature(e2) >= this.#MAX_TEMPERATURE) {\r\n            return false;\r\n        }\r\n        let e3 = elementArea.getElementHead(x, y - 1);\r\n        if (ElementHead.getTypeClass(e3) !== ElementHead.TYPE_AIR) {\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    static spawnHere(elementArea, x, y, brush, random) {\r\n        let element = brush.apply(x, y, random);\r\n        let offset = 0;\r\n        for (let i = ElementHead.getSpecial(element.elementHead); i >= 0; i--) {\r\n            if (y - offset < 0) {\r\n                break;\r\n            }\r\n            elementArea.setElementHead(x, y - offset, ElementHead.setSpecial(element.elementHead, i));\r\n            elementArea.setElementTail(x, y - offset, element.elementTail)\r\n            offset++;\r\n        }\r\n    }\r\n\r\n\r\n    /** @type ElementArea */\r\n    #elementArea;\r\n\r\n    /** @type DeterministicRandom */\r\n    #random;\r\n\r\n    /** @type ProcessorContext */\r\n    #processorContext;\r\n\r\n    constructor(elementArea, random, processorContext) {\r\n        this.#elementArea = elementArea;\r\n        this.#random = random;\r\n        this.#processorContext = processorContext;\r\n    }\r\n\r\n    behaviourGrass(elementHead, x, y) {\r\n        // check temperature\r\n        if (ElementHead.getTemperature(elementHead) > ProcessorModuleGrass.#MAX_TEMPERATURE) {\r\n            this.#elementArea.setElementHead(x, y, ElementHead.setBehaviour(elementHead, 0));\r\n            const elementTail = this.#elementArea.getElementTail(x, y);\r\n            const visualEffectForce = this.#random.nextInt(2) + 1;\r\n            this.#elementArea.setElementTail(x, y, VisualEffects.visualBurn(elementTail, visualEffectForce))\r\n        }\r\n\r\n        let random = this.#random.nextInt(100);\r\n        if (random < 3) {\r\n            // check above\r\n            if (y > 0) {\r\n                let above1 = this.#elementArea.getElementHead(x, y - 1);\r\n                if (ElementHead.getBehaviour(above1) !== ElementHead.BEHAVIOUR_GRASS) {\r\n                    let typeAbove1 = ElementHead.getTypeClass(above1);\r\n                    if (typeAbove1 > ElementHead.TYPE_FLUID\r\n                            || (typeAbove1 === ElementHead.TYPE_FLUID && this.#random.nextInt(100) === 0)) {\r\n                        // note: it takes longer for water to suffocate the grass\r\n                        // remove grass\r\n                        this.#elementArea.setElement(x, y, this.#processorContext.getDefaults().getDefaultElement());\r\n                        return;\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (random === 0) {\r\n                // grow up\r\n                let growIndex = ElementHead.getSpecial(elementHead);\r\n                if (growIndex === 0) {\r\n                    // maximum height\r\n                    if (this.#random.nextInt(5) === 0) {\r\n                        // remove top element to create some movement\r\n                        this.#elementArea.setElement(x, y, this.#processorContext.getDefaults().getDefaultElement());\r\n                    }\r\n                    return;\r\n                }\r\n                if (y === 0) {\r\n                    return;\r\n                }\r\n                let above1 = this.#elementArea.getElementHead(x, y - 1);\r\n                if (ElementHead.getTypeClass(above1) !== ElementHead.TYPE_AIR) {\r\n                    return;\r\n                }\r\n                if (y > 1) {\r\n                    let above2 = this.#elementArea.getElementHead(x, y - 2);\r\n                    if (ElementHead.getTypeClass(above2) !== ElementHead.TYPE_AIR) {\r\n                        return;\r\n                    }\r\n                }\r\n                this.#elementArea.setElementHead(x, y - 1, ElementHead.setSpecial(elementHead, growIndex - 1));\r\n                this.#elementArea.setElementTail(x, y - 1, this.#elementArea.getElementTail(x, y));\r\n            } else if (random === 1) {\r\n                // grow right\r\n                if (ProcessorModuleGrass.canGrowUpHere(this.#elementArea, x + 1, y + 1)) {\r\n                    const brush = this.#processorContext.getDefaults().getBrushGrass();\r\n                    this.#elementArea.setElement(x + 1, y + 1, brush.apply(x, y, this.#random));\r\n                }\r\n            } else if (random === 2) {\r\n                // grow left\r\n                if (ProcessorModuleGrass.canGrowUpHere(this.#elementArea, x - 1, y + 1)) {\r\n                    const brush = this.#processorContext.getDefaults().getBrushGrass();\r\n                    this.#elementArea.setElement(x - 1, y + 1, brush.apply(x, y, this.#random));\r\n                }\r\n            }\r\n        }\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport ElementHead from \"../ElementHead.js\";\r\nimport ElementTail from \"../ElementTail\";\r\nimport ProcessorContext from \"./ProcessorContext.js\";\r\nimport DeterministicRandom from \"../DeterministicRandom.js\";\r\nimport VisualEffects from \"./VisualEffects\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-04-12\r\n */\r\nexport default class ProcessorModuleTree {\r\n\r\n    static TYPE_TRUNK = 1;\r\n    static TYPE_BRANCH = 2;\r\n    static TYPE_LEAF = 3;\r\n    static TYPE_ROOT = 4;\r\n\r\n    static #MAX_TREE_TEMPERATURE = 100;\r\n    static #MAX_WOOD_TEMPERATURE = 50;\r\n    static #MAX_LEAF_TEMPERATURE = 40;\r\n\r\n    static #NOISE = VisualEffects.visualNoiseProvider(7616891641);\r\n\r\n    static #LEAF_NOISE = (elementTail, x, y) => {\r\n        return ProcessorModuleTree.#NOISE.visualNoise(elementTail, x, y, 10, 0.5, 1, 68, 77, 40);\r\n    };\r\n\r\n    static #TRUNK_NOISE = (elementTail, x, y) => {\r\n        return ProcessorModuleTree.#NOISE.visualNoise(elementTail, x, y, 4, 0.5, 0.9, 87, 61, 39);\r\n    };\r\n\r\n    static spawnHere(elementArea, x, y, type, brush, random, processorContext, levelsToGrow = -1) {\r\n        type = type % (1 << ElementHead.FIELD_SPECIAL_SIZE);\r\n\r\n        const element = brush.apply(x, y, random);\r\n        element.elementHead = ElementHead.setSpecial(element.elementHead, type);  // override tree type\r\n        elementArea.setElement(x, y, element);\r\n\r\n        // tree fast grow\r\n        const template = processorContext.getDefaults().getTreeTrunkTemplates()[type];\r\n        if (template === undefined) {\r\n            throw 'Tree template not found: ' + type;\r\n        }\r\n        const treeModule = new ProcessorModuleTree(elementArea, random, processorContext);\r\n        treeModule.#treeGrow(element.elementHead, x, y, template, levelsToGrow);\r\n\r\n        // roots fast grow\r\n        for (let i = 1; i < 10; i++) {\r\n            for (let j = 0; j < 9; j++) {\r\n                const tx = x + j - 4;\r\n                const ty = y + i;\r\n\r\n                if (!elementArea.isValidPosition(tx, ty)) {\r\n                    continue;\r\n                }\r\n                const targetElement = elementArea.getElementHead(tx, ty);\r\n                if (ElementHead.getBehaviour(targetElement) !== ElementHead.BEHAVIOUR_TREE_ROOT) {\r\n                    continue;\r\n                }\r\n                const growIndex = ElementHead.getSpecial(targetElement);\r\n                if (growIndex === 0) {\r\n                    continue;\r\n                }\r\n\r\n                const direction = random.nextInt(10);\r\n                treeModule.#treeRootGrow(tx, ty, targetElement, growIndex, direction);\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    /** @type ElementArea */\r\n    #elementArea;\r\n\r\n    /** @type DeterministicRandom */\r\n    #random;\r\n\r\n    /** @type ProcessorContext */\r\n    #processorContext;\r\n\r\n    #trunkTreeTemplates;\r\n    #leafClusterTemplates;\r\n\r\n    constructor(elementArea, random, processorContext) {\r\n        this.#elementArea = elementArea;\r\n        this.#random = random;\r\n        this.#processorContext = processorContext;\r\n\r\n        this.#trunkTreeTemplates = this.#processorContext.getDefaults().getTreeTrunkTemplates()\r\n        this.#leafClusterTemplates = this.#processorContext.getDefaults().getTreeLeafClusterTemplates()\r\n    }\r\n\r\n    behaviourTree(elementHead, x, y) {\r\n        // check temperature\r\n        if (ElementHead.getTemperature(elementHead) > ProcessorModuleTree.#MAX_TREE_TEMPERATURE) {\r\n            // => destroy tree instantly\r\n            this.#elementArea.setElementHead(x, y, ElementHead.setBehaviour(elementHead, 0));\r\n            return;\r\n        }\r\n\r\n        const random = this.#random.nextInt(ProcessorContext.OPT_CYCLES_PER_SECOND);\r\n        if (random === 0) {\r\n            // check status\r\n            const trunkTemplateId = ElementHead.getSpecial(elementHead);\r\n            const template = this.#trunkTreeTemplates[trunkTemplateId];\r\n            if (template === undefined) {\r\n                throw 'Tree template not found: ' + trunkTemplateId;\r\n            }\r\n            const level = this.#treeGrow(elementHead, x, y, template, 1);\r\n            this.#treeCheckStatus(x, y, level, template);\r\n        }\r\n    }\r\n\r\n    #treeGrow(elementHead, x, y, template, levelsToGrow = 1) {\r\n        let leafClusterIdRndSalt = this.#treeCreateOrGetSeed(x, y - 2);\r\n\r\n        let level = 0;\r\n        let levelGrown = 0;\r\n\r\n        let parallelBranches = [{\r\n            entries: template.entries,\r\n            index: 0,\r\n            x: 0,\r\n            y: 0,\r\n            brush: null\r\n        }];\r\n\r\n        let grow = (nx, ny, brush, noise, increment) => {\r\n            let element = brush.apply(nx, ny, this.#random);\r\n            if (noise === null) {\r\n                this.#elementArea.setElement(nx, ny, element);\r\n            } else {\r\n                const tx = (x - nx) + (10 * x);  // unique pattern for each tree\r\n                const ty = (y - ny) + (10 * y);\r\n                const modifiedTail = noise(element.elementTail, tx, ty);\r\n                this.#elementArea.setElementHeadAndTail(nx, ny, element.elementHead, modifiedTail);\r\n            }\r\n            this.#processorContext.trigger(nx, ny);\r\n            this.#processorContext.triggerSolidCreated(element.elementHead, nx, ny);\r\n            if (increment) {\r\n                level++;\r\n                levelGrown++;\r\n            }\r\n        }\r\n\r\n        while (parallelBranches.length > 0) {\r\n            const length = parallelBranches.length;\r\n            let cleanupBranches = false;\r\n\r\n            for (let i = 0; i < length; i++) {\r\n                const branch = parallelBranches[i];\r\n\r\n                if (branch.index >= branch.entries.length) {\r\n                    // end of branch\r\n                    cleanupBranches = true;\r\n                    continue;\r\n                }\r\n\r\n                const node = branch.entries[branch.index++];\r\n                const [templateX, templateY, nodeType] = node;\r\n                const nx = x + templateX + branch.x;\r\n                const ny = y - templateY - branch.y;\r\n\r\n                if (this.#elementArea.isValidPosition(nx, ny)) {\r\n                    const currentElementHead = this.#elementArea.getElementHead(nx, ny);\r\n                    const currentElementBehaviour = ElementHead.getBehaviour(currentElementHead);\r\n\r\n                    switch (nodeType) {\r\n                        case ProcessorModuleTree.TYPE_LEAF:\r\n                            if (currentElementBehaviour === ElementHead.BEHAVIOUR_TREE_LEAF) {\r\n                                // is already here\r\n                                // update leaf vitality (if not dead already)\r\n                                if (ElementHead.getSpecial(currentElementHead) < 15) {\r\n                                    this.#elementArea.setElementHead(nx, ny, ElementHead.setSpecial(currentElementHead, 0));\r\n                                }\r\n                            } else if (currentElementBehaviour === ElementHead.BEHAVIOUR_TREE_TRUNK) {\r\n                                // replace trunk\r\n                                grow(nx, ny, branch.brush, ProcessorModuleTree.#LEAF_NOISE, false);\r\n                            } else if (ElementHead.getTypeClass(currentElementHead) === ElementHead.TYPE_AIR) {\r\n                                grow(nx, ny, branch.brush, ProcessorModuleTree.#LEAF_NOISE, false);\r\n                            }\r\n                            break;\r\n\r\n                        case ProcessorModuleTree.TYPE_TRUNK:\r\n                            if (currentElementBehaviour === ElementHead.BEHAVIOUR_TREE_TRUNK) {\r\n                                level++;  // trunk is already here\r\n                            } else if (currentElementBehaviour === ElementHead.BEHAVIOUR_TREE_LEAF) {\r\n                                level++;  // leaf is already here\r\n                            }\r\n                            let trunkGrow = false;\r\n                            if (ElementHead.getTypeClass(currentElementHead) === ElementHead.TYPE_AIR) {\r\n                                trunkGrow = true;\r\n                            } else if (currentElementBehaviour === ElementHead.BEHAVIOUR_SOIL) {\r\n                                trunkGrow = true;\r\n                            } else if (currentElementBehaviour === ElementHead.BEHAVIOUR_GRASS) {\r\n                                trunkGrow = true;\r\n                            } else if (templateY < 5) {\r\n                                // bottom trunk only...\r\n                                if (ElementHead.getTypeClass(currentElementHead) !== ElementHead.TYPE_STATIC) {\r\n                                    trunkGrow = true;\r\n                                }\r\n                            }\r\n                            if (trunkGrow) {\r\n                                const treeBrush = (templateY > 0)\r\n                                    ? this.#processorContext.getDefaults().getBrushTreeWood()\r\n                                    : this.#processorContext.getDefaults().getBrushTreeWoodDark();\r\n                                grow(nx, ny, treeBrush, ProcessorModuleTree.#TRUNK_NOISE, true);\r\n                                if (templateY === 2 && templateX === 0) {\r\n                                    // set seed\r\n                                    this.#treeSetSeed(nx, ny, leafClusterIdRndSalt);\r\n                                }\r\n                            }\r\n                            break;\r\n\r\n                        case ProcessorModuleTree.TYPE_BRANCH:\r\n                            let branchGrow = false;\r\n                            if (currentElementBehaviour === ElementHead.BEHAVIOUR_TREE_LEAF) {\r\n                                level++;  // is already here\r\n                                // update leaf vitality (if not dead already)\r\n                                if (ElementHead.getSpecial(currentElementHead) < 15) {\r\n                                    this.#elementArea.setElementHead(nx, ny, ElementHead.setSpecial(currentElementHead, 0));\r\n                                }\r\n                            } else if (currentElementBehaviour === ElementHead.BEHAVIOUR_TREE_TRUNK) {\r\n                                level++;  // is already here\r\n                            } else if (ElementHead.getTypeClass(currentElementHead) === ElementHead.TYPE_AIR) {\r\n                                branchGrow = true;\r\n                            } else {\r\n                                break;  // an obstacle...\r\n                            }\r\n\r\n                            let rnd = DeterministicRandom.next(leafClusterIdRndSalt + templateX + templateY);\r\n                            let leafClusterId = Math.trunc(rnd * this.#leafClusterTemplates.length);\r\n                            let leafCluster = this.#leafClusterTemplates[leafClusterId];\r\n                            let leafBrush = (Math.trunc(rnd * 1024) % 2 === 0)\r\n                                    ? this.#processorContext.getDefaults().getBrushTreeLeaf()\r\n                                    : this.#processorContext.getDefaults().getBrushTreeLeafDark();\r\n                            parallelBranches.push({\r\n                                entries: leafCluster.entries,\r\n                                index: 0,\r\n                                x: templateX,\r\n                                y: templateY,\r\n                                brush: leafBrush\r\n                            });\r\n                            if (branchGrow) {\r\n                                grow(nx, ny, leafBrush, ProcessorModuleTree.#LEAF_NOISE, true);\r\n                            }\r\n                            break;\r\n\r\n                        case ProcessorModuleTree.TYPE_ROOT:\r\n                            if (currentElementBehaviour === ElementHead.BEHAVIOUR_TREE_ROOT) {\r\n                                level++;  // is already here\r\n                            } else {\r\n                                grow(nx, ny, this.#processorContext.getDefaults().getBrushTreeRoot(), null, true);\r\n                            }\r\n                            break;\r\n\r\n                        default:\r\n                            throw 'Unknown type: ' + nodeType;\r\n                    }\r\n                }\r\n\r\n                let newParallelEntries = (node.length > 3) ? node[3] : undefined;\r\n                if (newParallelEntries !== undefined) {\r\n                    parallelBranches.push({\r\n                        entries: newParallelEntries,\r\n                        index: 0,\r\n                        x: branch.x,\r\n                        y: branch.y,\r\n                        brush: branch.brush\r\n                    });\r\n                }\r\n            }\r\n\r\n            if (levelsToGrow !== -1 && levelGrown >= levelsToGrow) {\r\n                break;  // terminate\r\n            }\r\n\r\n            if (cleanupBranches) {\r\n                for (let i = parallelBranches.length - 1; i >= 0; i--) {\r\n                    let branch = parallelBranches[i];\r\n                    if (branch.index >= branch.entries.length) {\r\n                        parallelBranches.splice(i, 1);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return level;\r\n    }\r\n\r\n    #treeCreateOrGetSeed(x, y) {\r\n        if (this.#elementArea.isValidPosition(x, y)) {\r\n            let elementHead = this.#elementArea.getElementHead(x, y);\r\n            if (ElementHead.getBehaviour(elementHead) === ElementHead.BEHAVIOUR_TREE_TRUNK) {\r\n                return ElementHead.getSpecial(elementHead);\r\n            }\r\n        }\r\n        return this.#random.nextInt(1 << ElementHead.FIELD_SPECIAL_SIZE);\r\n    }\r\n\r\n    #treeSetSeed(x, y, seed) {\r\n        // assume point exists\r\n        // assume tree trunk\r\n        let elementHead = this.#elementArea.getElementHead(x, y);\r\n        elementHead = ElementHead.setSpecial(elementHead, seed);\r\n        this.#elementArea.setElementHead(x, y, elementHead)\r\n    }\r\n\r\n    #treeCheckStatus(x, y, level, template) {\r\n        // check tree status\r\n        // - last tree status is carried by tree trunk above\r\n        if (y > 0) {\r\n            let carrierElementHead = this.#elementArea.getElementHead(x, y - 1);\r\n            if (ElementHead.getBehaviour(carrierElementHead) === ElementHead.BEHAVIOUR_TREE_TRUNK) {\r\n                const maxStage = 15;\r\n                let lastStage = ElementHead.getSpecial(carrierElementHead);\r\n                let currentStage = Math.trunc(level / template.entriesCount * maxStage);\r\n                if (lastStage - currentStage > 5) {\r\n                    // too big damage taken => kill tree\r\n                    this.#elementArea.setElementHead(x, y - 1, ElementHead.setSpecial(carrierElementHead, 0));\r\n                    const treeWoodBrush = this.#processorContext.getDefaults().getBrushTreeWoodDark();\r\n                    this.#elementArea.setElement(x, y, treeWoodBrush.apply(x, y, this.#random));\r\n                } else {\r\n                    // update stage\r\n                    this.#elementArea.setElementHead(x, y - 1, ElementHead.setSpecial(carrierElementHead, currentStage));\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    behaviourTreeRoot(elementHead, x, y) {\r\n        // check temperature\r\n        if (ElementHead.getTemperature(elementHead) > ProcessorModuleTree.#MAX_TREE_TEMPERATURE) {\r\n            // => destroy instantly\r\n            this.#elementArea.setElementHead(x, y, ElementHead.setBehaviour(elementHead, 0));\r\n            return;\r\n        }\r\n\r\n        let growIndex = ElementHead.getSpecial(elementHead);\r\n        if (growIndex === 0) {\r\n            // maximum size\r\n            if (this.#processorContext.getIteration() % 1000 === 0) {\r\n                this.#treeRootHardenSurroundingElements(x, y);\r\n            }\r\n            return;\r\n        }\r\n\r\n        let random = this.#random.nextInt(ProcessorContext.OPT_CYCLES_PER_SECOND * 10);\r\n        if (random < 10) {\r\n            this.#treeRootGrow(x, y, elementHead, growIndex, random);\r\n        }\r\n    }\r\n\r\n    #treeRootHardenSurroundingElements(x, y) {\r\n        const targetX = x + this.#random.nextInt(3) - 1;\r\n        const targetY = y + this.#random.nextInt(3) - 1;\r\n\r\n        if (this.#elementArea.isValidPosition(targetX, targetY)) {\r\n            let targetElementHead = this.#elementArea.getElementHead(targetX, targetY);\r\n            let type = ElementHead.getTypeClass(targetElementHead);\r\n            if (type === ElementHead.TYPE_POWDER || type === ElementHead.TYPE_POWDER_WET || type === ElementHead.TYPE_POWDER_FLOATING) {\r\n                let newType = ElementHead.type8(ElementHead.type8Solid(ElementHead.TYPE_STATIC, 3));\r\n                let modifiedElementHead = ElementHead.setType(targetElementHead, newType);\r\n                this.#elementArea.setElementHead(targetX, targetY, modifiedElementHead);\r\n            }\r\n        }\r\n    }\r\n\r\n    #treeRootGrow(x, y, elementHead, growIndex, direction) {\r\n        let doGrow = (nx, ny) => {\r\n            this.#elementArea.setElementHead(x, y, ElementHead.setSpecial(elementHead, 0));\r\n\r\n            let element = this.#processorContext.getDefaults().getBrushTreeRoot().apply(nx, ny, this.#random);\r\n            let modifiedHead = ElementHead.setSpecial(element.elementHead, growIndex - 1);\r\n            this.#elementArea.setElementHead(nx, ny, modifiedHead);\r\n            this.#elementArea.setElementTail(nx, ny, element.elementTail);\r\n        }\r\n\r\n        // grow down first if there is a free space\r\n        if (y < this.#elementArea.getHeight() - 1) {\r\n            let targetElementHead = this.#elementArea.getElementHead(x, y + 1);\r\n            if (ElementHead.getTypeClass(targetElementHead) === ElementHead.TYPE_AIR) {\r\n                doGrow(x, y + 1);\r\n                return;\r\n            }\r\n        }\r\n\r\n        // grow in random way\r\n        let nx = x;\r\n        let ny = y;\r\n        if (direction === 9 || direction === 8 || direction === 7) {\r\n            nx += 1;\r\n            ny += 1;\r\n        } else if (direction === 6 || direction === 5 || direction === 4) {\r\n            nx += -1;\r\n            ny += 1;\r\n        } else {\r\n            ny += 1;\r\n        }\r\n\r\n        if (this.#elementArea.isValidPosition(nx, ny)) {\r\n            let targetElementHead = this.#elementArea.getElementHead(nx, ny);\r\n            if (ElementHead.getTypeClass(targetElementHead) !== ElementHead.TYPE_STATIC) {\r\n                doGrow(nx, ny);\r\n            }\r\n        }\r\n    }\r\n\r\n    behaviourTreeLeaf(elementHead, x, y) {\r\n        let vitality = ElementHead.getSpecial(elementHead);\r\n        if (vitality < 15) {\r\n            // check temperature\r\n            const temperature = ElementHead.getTemperature(elementHead);\r\n            if (temperature > ProcessorModuleTree.#MAX_LEAF_TEMPERATURE) {\r\n                // => destroy instantly, keep temperature\r\n                this.#dryLeaf(elementHead, x, y);\r\n                return;\r\n            }\r\n\r\n            // decrement vitality (if not dead already)\r\n            if (this.#processorContext.getIteration() % 32 === 0) {\r\n                if (this.#random.nextInt(10) === 0) {\r\n                    vitality++;\r\n                    if (vitality >= 15) {\r\n                        this.#dryLeaf(elementHead, x, y);\r\n                        return;\r\n                    } else {\r\n                        elementHead = ElementHead.setSpecial(elementHead, vitality);\r\n                        this.#elementArea.setElementHead(x, y, elementHead);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        // once a while \"transport\" element from above/left/right/left-above/right-above if possible\r\n        if (this.#processorContext.getIteration() % 4 === 0 && this.#random.nextInt(10) === 0) {\r\n\r\n            const directions = [[0, -1], [0, -1], [-1, 0], [1, 0], [-1, -1], [1, -1]];\r\n            const randomDirection = directions[this.#random.nextInt(directions.length)];\r\n            const sourceX = x + randomDirection[0];\r\n            const sourceY = y + randomDirection[1];\r\n\r\n            const sourceElementHead = this.#elementArea.getElementHeadOrNull(sourceX, sourceY);\r\n            if (sourceElementHead !== null\r\n                    && ElementHead.getTypeClass(sourceElementHead) >= ElementHead.TYPE_FLUID\r\n                    && ElementHead.getTypeClass(sourceElementHead) < ElementHead.TYPE_STATIC) {\r\n\r\n                let destX = x;\r\n                let destY = y;\r\n                for (let step = 0; step < 25; step++) {\r\n                    destX += this.#random.nextInt(3) - 1;  // random walk\r\n                    destY += 1;\r\n\r\n                    const destElementHead = this.#elementArea.getElementHeadOrNull(destX, destY);\r\n                    if (destElementHead === null) {\r\n                        break;\r\n                    }\r\n                    const destBehaviour = ElementHead.getBehaviour(destElementHead);\r\n                    if (destBehaviour === ElementHead.BEHAVIOUR_TREE_LEAF) {\r\n                        continue;\r\n                    }\r\n                    const destTypeClass = ElementHead.getTypeClass(destElementHead);\r\n                    if (destTypeClass <= ElementHead.TYPE_GAS) {\r\n                        this.#elementArea.swap(sourceX, sourceY, destX, destY);\r\n                        return;\r\n                    }\r\n                    break;\r\n                }\r\n\r\n                // destroy buried leaf\r\n                if (this.#random.nextInt(20) === 0) {\r\n                    this.#elementArea.setElement(x, y, this.#processorContext.getDefaults().getDefaultElement());\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    #dryLeaf(elementHead, x, y) {\r\n        const elementTail = this.#elementArea.getElementTail(x, y);\r\n\r\n        // multiplication and alpha blending (for lighter color)\r\n        const alpha = 0.85;\r\n        const whiteBackground = 255 * (1.0 - alpha);\r\n        let newElementTail = ElementTail.setColor(\r\n            Math.trunc(ElementTail.getColorRed(elementTail) * 1.4 * alpha + whiteBackground) & 0xFF,\r\n            Math.trunc(ElementTail.getColorGreen(elementTail) * 0.9 * alpha + whiteBackground) & 0xFF,\r\n            Math.trunc(ElementTail.getColorBlue(elementTail) * 0.8 * alpha + whiteBackground) & 0xFF\r\n        )\r\n\r\n        const newElementHead = ElementHead.setSpecial(elementHead, 15);\r\n        this.#elementArea.setElementHeadAndTail(x, y, newElementHead, newElementTail);\r\n    }\r\n}\r\n","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport ElementHead from \"../ElementHead.js\";\r\nimport VisualEffects from \"./VisualEffects\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-05-26\r\n */\r\nexport default class ProcessorModuleLiquid {\r\n\r\n    static RET_FLAG_ACTIVE = 0b10;\r\n    static RET_FLAG_SKIP_TEMP = 0b01;\r\n\r\n    static FIRST_LIGHT = ElementHead.SPECIAL_LIQUID_LIGHT_OIL;\r\n    static FIRST_HEAVY = ElementHead.SPECIAL_LIQUID_HEAVY_MOLTEN;\r\n\r\n\r\n    /** @type ElementArea */\r\n    #elementArea;\r\n\r\n    /** @type DeterministicRandom */\r\n    #random;\r\n\r\n    /** @type ProcessorContext */\r\n    #processorContext;\r\n\r\n    constructor(elementArea, random, processorContext) {\r\n        this.#elementArea = elementArea;\r\n        this.#random = random;\r\n        this.#processorContext = processorContext;\r\n    }\r\n\r\n    behaviourLiquid(elementHead, x, y) {\r\n        const special = ElementHead.getSpecial(elementHead);\r\n        switch (special) {\r\n            case ElementHead.SPECIAL_LIQUID_WATER:\r\n                return this.#behaviourSubtypeWater(elementHead, x, y);\r\n            case ElementHead.SPECIAL_LIQUID_LIGHT_OIL:\r\n                return this.#behaviourSubtypeLightOil(elementHead, x, y);\r\n            case ElementHead.SPECIAL_LIQUID_HEAVY_MOLTEN:\r\n                return this.#behaviourSubtypeHeavyMolten(elementHead, x, y);\r\n        }\r\n        return 0;\r\n    }\r\n\r\n    testBehaviourLiquid(elementHead, x, y) {\r\n        const special = ElementHead.getSpecial(elementHead);\r\n        switch (special) {\r\n            case ElementHead.SPECIAL_LIQUID_WATER:\r\n                return this.#testBehaviourSubtypeWater(elementHead, x, y);\r\n            case ElementHead.SPECIAL_LIQUID_LIGHT_OIL:\r\n                return this.#testBehaviourSubtypeLightOil(elementHead, x, y);\r\n            case ElementHead.SPECIAL_LIQUID_HEAVY_MOLTEN:\r\n                return this.#testBehaviourSubtypeHeavyMolten(elementHead, x, y);\r\n        }\r\n        return false;\r\n    }\r\n\r\n    #behaviourSubtypeWater(elementHead, x, y) {\r\n        const typeClass = ElementHead.getTypeClass(elementHead);\r\n        const temperature = ElementHead.getTemperature(elementHead);\r\n\r\n        if (typeClass === ElementHead.TYPE_FLUID) {\r\n            if (temperature > 20) {\r\n                const brush = this.#processorContext.getDefaults().getBrushSteam();\r\n                const element = brush.apply(x, y, this.#random);\r\n                const newElementHead = ElementHead.setTemperature(element.elementHead, temperature);\r\n                this.#elementArea.setElementHeadAndTail(x, y, newElementHead, element.elementTail);\r\n                return ProcessorModuleLiquid.RET_FLAG_ACTIVE | ProcessorModuleLiquid.RET_FLAG_SKIP_TEMP;\r\n            }\r\n\r\n        } else if (typeClass === ElementHead.TYPE_GAS) {\r\n            if (temperature < 10) {\r\n                const brush = this.#processorContext.getDefaults().getBrushWater();\r\n                const element = brush.apply(x, y, this.#random);\r\n                const newElementHead = ElementHead.setTemperature(element.elementHead, temperature);\r\n                this.#elementArea.setElementHeadAndTail(x, y, newElementHead, element.elementTail);\r\n                return ProcessorModuleLiquid.RET_FLAG_ACTIVE | ProcessorModuleLiquid.RET_FLAG_SKIP_TEMP;\r\n            }\r\n        }\r\n        return 0;\r\n    }\r\n\r\n    #testBehaviourSubtypeWater(elementHead, x, y) {\r\n        const typeClass = ElementHead.getTypeClass(elementHead);\r\n        const temperature = ElementHead.getTemperature(elementHead);\r\n\r\n        if (typeClass === ElementHead.TYPE_FLUID) {\r\n            return temperature > 20;\r\n        } else if (typeClass === ElementHead.TYPE_GAS) {\r\n            return temperature < 10;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    #behaviourSubtypeHeavyMolten(elementHead, x, y) {\r\n        const typeClass = ElementHead.getTypeClass(elementHead);\r\n        if (typeClass !== ElementHead.TYPE_FLUID) {\r\n            return 0;\r\n        }\r\n\r\n        let skipTemperature = 0;\r\n\r\n        const rnd = this.#random.nextInt(8);\r\n\r\n        // moving\r\n        if (rnd % 4 === 0) {\r\n            // gravity down...\r\n            if (this.#testMoveHeavyFluid(x, y + 1)) {\r\n                this.#elementArea.swap(x, y, x, y + 1);\r\n                skipTemperature = ProcessorModuleLiquid.RET_FLAG_SKIP_TEMP;\r\n            } else {\r\n                if (rnd === 4) {\r\n                    if (this.#testMoveHeavyFluid(x + 1, y)) {\r\n                        this.#elementArea.swap(x, y, x + 1, y);\r\n                        skipTemperature = ProcessorModuleLiquid.RET_FLAG_SKIP_TEMP;\r\n                    }\r\n                } else {\r\n                    if (this.#testMoveHeavyFluid(x - 1, y)) {\r\n                        this.#elementArea.swap(x, y, x - 1, y);\r\n                        skipTemperature = ProcessorModuleLiquid.RET_FLAG_SKIP_TEMP;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        const active = ProcessorModuleLiquid.RET_FLAG_ACTIVE;  // it doesn't matter because of temperature...\r\n        return active | skipTemperature;\r\n    }\r\n\r\n    #testBehaviourSubtypeHeavyMolten(elementHead, x, y) {\r\n        const typeClass = ElementHead.getTypeClass(elementHead);\r\n        if (typeClass !== ElementHead.TYPE_FLUID) {\r\n            return false;\r\n        }\r\n        return true;  // it doesn't matter because of temperature...\r\n    }\r\n\r\n    #behaviourSubtypeLightOil(elementHead, x, y) {\r\n        const typeClass = ElementHead.getTypeClass(elementHead);\r\n        if (typeClass !== ElementHead.TYPE_FLUID) {\r\n            return 0;\r\n        }\r\n\r\n        let skipTemperature = 0;\r\n\r\n        const rnd = this.#random.nextInt(32);\r\n\r\n        // moving\r\n        if (rnd % 16 === 0) {\r\n            // gravity down...\r\n            if (this.#testMoveLightFluid(x, y - 1)) {\r\n                this.#elementArea.swap(x, y, x, y - 1);\r\n                skipTemperature = ProcessorModuleLiquid.RET_FLAG_SKIP_TEMP;\r\n            } else {\r\n                if (rnd === 0) {\r\n                    if (this.#testMoveLightFluid(x + 1, y)) {\r\n                        this.#elementArea.swap(x, y, x + 1, y);\r\n                        skipTemperature = ProcessorModuleLiquid.RET_FLAG_SKIP_TEMP;\r\n                    }\r\n                } else {\r\n                    if (this.#testMoveLightFluid(x - 1, y)) {\r\n                        this.#elementArea.swap(x, y, x - 1, y);\r\n                        skipTemperature = ProcessorModuleLiquid.RET_FLAG_SKIP_TEMP;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        // staining\r\n        if (rnd === 7) {\r\n            const targetHead = this.#elementArea.getElementHeadOrNull(x, y + 1);\r\n            if (targetHead !== null) {\r\n                if (ElementHead.getTypeClass(targetHead) >= ElementHead.TYPE_FLUID) {\r\n                    let targetTail = this.#elementArea.getElementTail(x, y + 1);\r\n                    targetTail = VisualEffects.visualBurn(targetTail, 1, 1);\r\n                    this.#elementArea.setElementTail(x, y + 1, targetTail);\r\n                }\r\n            }\r\n        }\r\n\r\n        return skipTemperature;\r\n    }\r\n\r\n    #testBehaviourSubtypeLightOil(elementHead, x, y) {\r\n        const typeClass = ElementHead.getTypeClass(elementHead);\r\n        if (typeClass !== ElementHead.TYPE_FLUID) {\r\n            return false;\r\n        }\r\n\r\n        return this.#testMoveLightFluid(x, y - 1)\r\n            || this.#testMoveLightFluid(x + 1, y)\r\n            || this.#testMoveLightFluid(x - 1, y);\r\n    }\r\n\r\n    // --- utilities\r\n\r\n    #testMoveHeavyFluid(nx, ny) {\r\n        const targetElementHead = this.#elementArea.getElementHeadOrNull(nx, ny);\r\n        if (targetElementHead === null) {\r\n            return false;\r\n        }\r\n        if (ElementHead.getTypeClass(targetElementHead) !== ElementHead.TYPE_FLUID) {\r\n            return false;\r\n        }\r\n        const special = ElementHead.getSpecial(targetElementHead);\r\n        return special < ProcessorModuleLiquid.FIRST_HEAVY;\r\n\r\n    }\r\n\r\n    #testMoveLightFluid(nx, ny) {\r\n        const targetElementHead = this.#elementArea.getElementHeadOrNull(nx, ny);\r\n        if (targetElementHead === null) {\r\n            return false;\r\n        }\r\n        if (ElementHead.getTypeClass(targetElementHead) !== ElementHead.TYPE_FLUID) {\r\n            return false;\r\n        }\r\n        const special = ElementHead.getSpecial(targetElementHead);\r\n        return !(special >= ProcessorModuleLiquid.FIRST_LIGHT && special <= ProcessorModuleLiquid.FIRST_HEAVY);\r\n    }\r\n}\r\n","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport ElementHead from \"../ElementHead.js\";\r\nimport ElementTail from \"../ElementTail\";\r\nimport DeterministicRandom from \"../DeterministicRandom.js\";\r\nimport ProcessorContext from \"./ProcessorContext.js\";\r\nimport GameDefaults from \"../GameDefaults\";\r\nimport ProcessorModuleSolidBody from \"./ProcessorModuleSolidBody\";\r\nimport ProcessorModuleEntity from \"./ProcessorModuleEntity\";\r\nimport ProcessorModuleFire from \"./ProcessorModuleFire.js\";\r\nimport ProcessorModuleMeteor from \"./ProcessorModuleMeteor.js\";\r\nimport ProcessorModuleGrass from \"./ProcessorModuleGrass.js\";\r\nimport ProcessorModuleTree from \"./ProcessorModuleTree.js\";\r\nimport ProcessorModuleLiquid from \"./ProcessorModuleLiquid\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-05-22\r\n */\r\nexport default class Processor extends ProcessorContext {\r\n\r\n    /** @type ElementArea */\r\n    #elementArea;\r\n\r\n    /** @type number */\r\n    #width;\r\n    /** @type number */\r\n    #height;\r\n\r\n    /** @type number */\r\n    #chunkSize;\r\n    /** @type number */\r\n    #horChunkCount;\r\n    /** @type number */\r\n    #verChunkCount;\r\n\r\n    /** @type boolean[] */\r\n    #activeChunks\r\n    /** @type boolean[] */\r\n    #changedChunks\r\n    /** @type number[] */\r\n    #chunkLastFullTest;\r\n\r\n    /** @type number */\r\n    #iteration = 0;\r\n\r\n    /** @type DeterministicRandom */\r\n    #random;\r\n\r\n    /** @type boolean */\r\n    #fallThroughEnabled = false;\r\n    /** @type boolean */\r\n    #erasingEnabled = false;\r\n\r\n    /** @type GameDefaults */\r\n    #defaults;\r\n\r\n    static RANDOM_DATA_COUNT = 32;\r\n\r\n    /** @type Uint32Array[] */\r\n    #rndChunkOrder = [];\r\n    /** @type Uint32Array[] */\r\n    #rndChunkXRnd = [];\r\n    /** @type Uint32Array[] */\r\n    #rndChunkXOrder = [];\r\n\r\n    /** @type ProcessorModuleSolidBody */\r\n    #moduleSolidBody;\r\n    /** @type ProcessorModuleEntity */\r\n    #moduleEntity;\r\n    /** @type ProcessorModuleLiquid */\r\n    #moduleLiquid;\r\n    /** @type ProcessorModuleFire */\r\n    #moduleFire;\r\n    /** @type ProcessorModuleMeteor */\r\n    #moduleMeteor;\r\n    /** @type ProcessorModuleGrass */\r\n    #moduleGrass;\r\n    /** @type ProcessorModuleTree */\r\n    #moduleTree;\r\n\r\n    /** @type Extension[] */\r\n    #extensions = [];\r\n\r\n    constructor(elementArea, chunkSize, random, defaults, sceneMetadata) {\r\n        super();\r\n        this.#elementArea = elementArea;\r\n        this.#width = elementArea.getWidth();\r\n        this.#height = elementArea.getHeight();\r\n\r\n        this.#chunkSize = chunkSize;\r\n        if (this.#chunkSize > 255) {\r\n            throw 'Chunk size limit: 255';\r\n        }\r\n        this.#horChunkCount = Math.ceil(this.#width / this.#chunkSize);\r\n        this.#verChunkCount = Math.ceil(this.#height / this.#chunkSize);\r\n        this.#activeChunks = new Array(this.#horChunkCount * this.#verChunkCount).fill(true);\r\n        this.#changedChunks = new Array(this.#horChunkCount * this.#verChunkCount).fill(true);\r\n        this.#chunkLastFullTest = new Array(this.#horChunkCount * this.#verChunkCount).fill(-1);\r\n\r\n        let rndDataRandom = new DeterministicRandom(0);\r\n        this.#rndChunkOrder = Processor.#generateArrayOfOrderData(\r\n            Processor.RANDOM_DATA_COUNT, this.#horChunkCount, rndDataRandom);\r\n        this.#rndChunkXRnd = Processor.#generateArrayOfRandomData(\r\n            Processor.RANDOM_DATA_COUNT, this.#chunkSize, this.#chunkSize, rndDataRandom);\r\n        this.#rndChunkXOrder = Processor.#generateArrayOfOrderData(\r\n            Processor.RANDOM_DATA_COUNT, this.#chunkSize, rndDataRandom);\r\n\r\n        this.#random = random;\r\n        this.#defaults = defaults;\r\n\r\n        this.#moduleSolidBody = new ProcessorModuleSolidBody(elementArea, random, this);\r\n        this.#moduleEntity = new ProcessorModuleEntity(elementArea, random, this);\r\n        this.#moduleLiquid = new ProcessorModuleLiquid(elementArea, random, this);\r\n        this.#moduleFire = new ProcessorModuleFire(elementArea, random, this);\r\n        this.#moduleMeteor = new ProcessorModuleMeteor(elementArea, random, this);\r\n        this.#moduleGrass = new ProcessorModuleGrass(elementArea, random, this);\r\n        this.#moduleTree = new ProcessorModuleTree(elementArea, random, this);\r\n\r\n        if (sceneMetadata) {\r\n            this.#iteration = sceneMetadata.iteration;\r\n            this.#fallThroughEnabled = sceneMetadata.fallThroughEnabled;\r\n            this.#erasingEnabled = sceneMetadata.erasingEnabled;\r\n        }\r\n    }\r\n\r\n    static #shuffle(array, iterations, random) {\r\n        for (let i = 0; i < iterations; i++) {\r\n            let a = random.nextInt(array.length);\r\n            let b = random.nextInt(array.length);\r\n            [array[a], array[b]] = [array[b], array[a]];\r\n        }\r\n    }\r\n\r\n    static #generateArrayOfOrderData(arrayLength, count, random) {\r\n        let data = Processor.#generateOrderData(count);\r\n        Processor.#shuffle(data, arrayLength, random);\r\n\r\n        let array = Array(arrayLength);\r\n        for (let i = 0; i < arrayLength; i++) {\r\n            Processor.#shuffle(data, Math.ceil(arrayLength / 4), random);\r\n            array[i] = new Uint8Array(data);\r\n        }\r\n        return array;\r\n    }\r\n\r\n    static #generateOrderData(count) {\r\n        let array = new Uint8Array(count);\r\n        for (let i = 0; i < count; i++) {\r\n            array[i] = i;\r\n        }\r\n        return array;\r\n    }\r\n\r\n    static #generateArrayOfRandomData(arrayLength, count, max, random) {\r\n        let array = Array(arrayLength);\r\n        for (let i = 0; i < arrayLength; i++) {\r\n            array[i] = Processor.#generateRandomData(count, max, random);\r\n        }\r\n        return array;\r\n    }\r\n\r\n    static #generateRandomData(count, max, random) {\r\n        let array = new Uint8Array(count);\r\n        for (let i = 0; i < count; i++) {\r\n            array[i] = random.nextInt(max);\r\n        }\r\n        return array;\r\n    }\r\n\r\n    getIteration() {\r\n        return this.#iteration;\r\n    }\r\n\r\n    getDefaults() {\r\n        return this.#defaults;\r\n    }\r\n\r\n    setFallThroughEnabled(enabled) {\r\n        this.#fallThroughEnabled = enabled;\r\n    }\r\n\r\n    setErasingEnabled(enabled) {\r\n        this.#erasingEnabled = enabled;\r\n    }\r\n\r\n    isFallThroughEnabled() {\r\n        return this.#fallThroughEnabled;\r\n    }\r\n\r\n    isErasingEnabled() {\r\n        return this.#erasingEnabled;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param extension {Extension}\r\n     */\r\n    addExtension(extension) {\r\n        this.#extensions.push(extension);\r\n    }\r\n\r\n    trigger(x, y) {\r\n        const cx = Math.floor(x / this.#chunkSize);\r\n        const cy = Math.floor(y / this.#chunkSize);\r\n        const chunkIndex = cy * this.#horChunkCount + cx;\r\n        this.#activeChunks[chunkIndex] = true;\r\n        // this.#changedChunks[chunkIndex] = true;\r\n    }\r\n\r\n    triggerSolidCreated(elementHead, x, y) {\r\n        this.#moduleSolidBody.onSolidCreated(elementHead, x, y);\r\n    }\r\n\r\n    getActiveChunks() {\r\n        return this.#activeChunks;\r\n    }\r\n\r\n    getChangedChunks() {\r\n        return this.#changedChunks;\r\n    }\r\n\r\n    cleanChangedChunks() {\r\n        this.#changedChunks.fill(false);\r\n    }\r\n\r\n    next() {\r\n        this.#moduleSolidBody.onNextIteration();\r\n\r\n        const activeChunks = Array.from(this.#activeChunks);\r\n        this.#activeChunks.fill(false);\r\n\r\n        // TODO: try extra temperature active chunks with extra loop\r\n        // element temperature is processed once per 9 iterations...\r\n        //   x\r\n        // y 1 2 3\r\n        //   4 5 6\r\n        //   7 8 9\r\n        const temperatureProcessingMod = this.#iteration % 9;\r\n        const temperatureProcessingMod3Y = Math.trunc(temperatureProcessingMod / 3);\r\n        const temperatureProcessingMod3X = temperatureProcessingMod % 3;\r\n\r\n        for (let cy = this.#verChunkCount - 1; cy >= 0; cy--) {\r\n            const cyTop = cy * this.#chunkSize;\r\n            const cyBottom = Math.min((cy + 1) * this.#chunkSize - 1, this.#height - 1);\r\n\r\n            const chunkOrder = this.#rndChunkOrder[this.#random.nextInt(Processor.RANDOM_DATA_COUNT)];\r\n            const fullChunkLoop = this.#random.nextInt(2) === 0;\r\n\r\n            const chunkActiveElements = new Uint16Array(this.#horChunkCount);\r\n\r\n            for (let y = cyBottom; y >= cyTop; y--) {\r\n                for (let i = 0; i < this.#horChunkCount; i++) {\r\n                    const cx = chunkOrder[i];\r\n                    const chunkIndex = cy * this.#horChunkCount + cx;\r\n\r\n                    const idx = this.#random.nextInt(Processor.RANDOM_DATA_COUNT);\r\n                    const chunkXOder = (fullChunkLoop) ? this.#rndChunkXOrder[idx] : this.#rndChunkXRnd[idx];\r\n\r\n                    if (activeChunks[chunkIndex]) {\r\n                        // standard iteration\r\n                        let activeElements = chunkActiveElements[cx];\r\n                        for (let j = 0; j < this.#chunkSize; j++) {\r\n                            let x = cx * this.#chunkSize + chunkXOder[j];\r\n                            if (x < this.#width) {\r\n                                const processTemperature = (x % 3 === temperatureProcessingMod3X)\r\n                                        && (y % 3 === temperatureProcessingMod3Y);\r\n                                const activeElement = this.#nextPoint(x, y, processTemperature);\r\n                                if (activeElement) {\r\n                                    activeElements++;\r\n                                }\r\n                            }\r\n                        }\r\n                        chunkActiveElements[cx] = activeElements;\r\n                    }\r\n                }\r\n            }\r\n\r\n            // fast check deactivated chunks (borders only - if they have active neighbours)\r\n            for (let cx = 0; cx < this.#horChunkCount; cx++) {\r\n                const chunkIndex = cy * this.#horChunkCount + cx;\r\n                if (!activeChunks[chunkIndex]) {\r\n                    if (this.#fastTest(cx, cy, activeChunks)) {\r\n                        // wake up chunk\r\n                        activeChunks[chunkIndex] = true;\r\n                        chunkActiveElements[cx] = 1;\r\n                    }\r\n                }\r\n            }\r\n\r\n            // deactivate chunks if possible\r\n            if (fullChunkLoop) {\r\n                for (let cx = 0; cx < this.#horChunkCount; cx++) {\r\n                    const chunkIndex = cy * this.#horChunkCount + cx;\r\n                    if (activeChunks[chunkIndex] && chunkActiveElements[cx] === 0) {\r\n                        // full test before deactivation\r\n\r\n                        // this test is quite expensive, so we don't want to perform it every time\r\n                        const lastFullTest = this.#chunkLastFullTest[chunkIndex];\r\n                        if (lastFullTest === -1 || this.#iteration - lastFullTest >= 10) {\r\n                            if (!this.#fullTest(cx, cy)) {\r\n                                activeChunks[chunkIndex] = false;\r\n                                this.#changedChunks[chunkIndex] = true;  // last repaint\r\n                                this.#chunkLastFullTest[chunkIndex] = this.#iteration;\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        // erasing mode\r\n        if (this.#erasingEnabled) {\r\n            const defaultElement = this.#defaults.getDefaultElement();\r\n            for (let x = 0; x < this.#width; x++) {\r\n                this.#elementArea.setElement(x, 0, defaultElement);\r\n                this.#elementArea.setElement(x, this.#height - 1, defaultElement);\r\n            }\r\n            for (let y = 1; y < this.#height - 1; y++) {\r\n                this.#elementArea.setElement(0, y, defaultElement);\r\n                this.#elementArea.setElement(this.#width - 1, y, defaultElement);\r\n            }\r\n        }\r\n\r\n        // merge active chunks\r\n        for (let i = 0; i < this.#horChunkCount * this.#verChunkCount; i++) {\r\n            let active = activeChunks[i];\r\n            if (active) {\r\n                this.#activeChunks[i] = true;\r\n                this.#changedChunks[i] = true;\r\n            }\r\n        }\r\n\r\n        // run extensions\r\n        for (let extension of this.#extensions) {\r\n            extension.run();\r\n        }\r\n\r\n        this.#iteration++;\r\n    }\r\n\r\n    #fastTest(cx, cy, activeChunks) {\r\n        // left\r\n        if (cx > 0 && activeChunks[(cy * this.#horChunkCount) + cx - 1]) {\r\n            const x = cx * this.#chunkSize;\r\n            const my = Math.min((cy + 1) * this.#chunkSize, this.#height);\r\n            for (let y = cy * this.#chunkSize; y < my; y++) {\r\n                if (this.#testPoint(x, y)) {\r\n                    return true;\r\n                }\r\n            }\r\n        }\r\n\r\n        // right\r\n        if (cx < (this.#horChunkCount - 1) && activeChunks[(cy * this.#horChunkCount) + cx + 1]) {\r\n            const x = Math.min(((cx + 1) * this.#chunkSize) - 1, this.#width - 1);\r\n            const my = Math.min((cy + 1) * this.#chunkSize, this.#height);\r\n            for (let y = cy * this.#chunkSize; y < my; y++) {\r\n                if (this.#testPoint(x, y)) {\r\n                    return true;\r\n                }\r\n            }\r\n        }\r\n\r\n        // top\r\n        if ((cy > 0) && activeChunks[((cy - 1) * this.#horChunkCount) + cx]\r\n            || (this.#fallThroughEnabled\r\n                && cy === 0\r\n                && activeChunks[((this.#verChunkCount - 1) * this.#horChunkCount) + cx])) {\r\n\r\n            const y = cy * this.#chunkSize;\r\n            const mx = Math.min((cx + 1) * this.#chunkSize, this.#width);\r\n            for (let x = cx * this.#chunkSize; x < mx; x++) {\r\n                if (this.#testPoint(x, y)) {\r\n                    return true;\r\n                }\r\n            }\r\n        }\r\n\r\n        // bottom\r\n        if (cy < (this.#verChunkCount - 1) && activeChunks[((cy + 1) * this.#horChunkCount) + cx]) {\r\n            const y = (cy + 1) * this.#chunkSize - 1;\r\n            const mx = Math.min((cx + 1) * this.#chunkSize, this.#width);\r\n            for (let x = cx * this.#chunkSize; x < mx; x++) {\r\n                if (this.#testPoint(x, y)) {\r\n                    return true;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    #fullTest(cx, cy) {\r\n        const mx = Math.min((cx + 1) * this.#chunkSize, this.#width);\r\n        const my = Math.min((cy + 1) * this.#chunkSize, this.#height);\r\n        for (let y = cy * this.#chunkSize; y < my; y++) {\r\n            for (let x = cx * this.#chunkSize; x < mx; x++) {\r\n                if (this.#testPoint(x, y)) {\r\n                    return true;\r\n                }\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    #testPoint(x, y) {\r\n        const elementHead = this.#elementArea.getElementHead(x, y);\r\n\r\n        if (ElementHead.getTemperature(elementHead) > 0) {\r\n            return true;\r\n        }\r\n        if (this.#testMovingBehaviour(elementHead, x, y)) {\r\n            return true;\r\n        }\r\n        switch (ElementHead.getBehaviour(elementHead)) {\r\n            case ElementHead.BEHAVIOUR_NONE:\r\n            case ElementHead.BEHAVIOUR_SOIL:\r\n            case ElementHead.BEHAVIOUR_TREE_TRUNK:\r\n                return false;\r\n            case ElementHead.BEHAVIOUR_LIQUID:\r\n                return this.#moduleLiquid.testBehaviourLiquid(elementHead, x, y);\r\n            default:\r\n                return true;\r\n        }\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param elementHead\r\n     * @param x {number}\r\n     * @param y {number}\r\n     * @returns {boolean}\r\n     */\r\n    #testMovingBehaviour(elementHead, x, y) {\r\n        const type = ElementHead.getTypeClass(elementHead);\r\n        switch (type) {\r\n            case ElementHead.TYPE_AIR:\r\n                // no action\r\n                return false;\r\n\r\n            case ElementHead.TYPE_POWDER:\r\n            case ElementHead.TYPE_POWDER_FLOATING:\r\n            case ElementHead.TYPE_POWDER_WET:\r\n                if (ElementHead.getTypeModifierPowderSliding(elementHead)) {\r\n                    return true;\r\n                } else {\r\n                    return this.#testMove(elementHead, x, y, x, y + 1);\r\n                }\r\n\r\n            case ElementHead.TYPE_FLUID:\r\n                return this.#testMove(elementHead, x, y, x, y + 1)\r\n                        || this.#testMove(elementHead, x, y, x + 1, y)\r\n                        || this.#testMove(elementHead, x, y, x - 1, y);\r\n\r\n            case ElementHead.TYPE_GAS:\r\n                return this.#testMove(elementHead, x, y, x, y - 1)\r\n                    || this.#testMove(elementHead, x, y, x + 1, y)\r\n                    || this.#testMove(elementHead, x, y, x - 1, y);\r\n\r\n            case ElementHead.TYPE_STATIC:\r\n                const fallingId = ElementHead.getTypeModifierSolidBodyId(elementHead);\r\n                return (fallingId !== 0);\r\n\r\n            default:\r\n                return true;\r\n        }\r\n        throw \"Unknown element type: \" + type;\r\n    }\r\n\r\n    #testMove(elementHead, x, y, x2, y2) {\r\n        if (!this.#elementArea.isValidPosition(x2, y2)) {\r\n            if (this.#fallThroughEnabled && y === this.#height - 1) {\r\n                // try fall through\r\n                y2 = 0;\r\n                if (!this.#elementArea.isValidPosition(x2, y2)) {\r\n                    return false;\r\n                }\r\n                // continue move...\r\n            } else {\r\n                return false;\r\n            }\r\n        }\r\n\r\n        let elementHead2 = this.#elementArea.getElementHead(x2, y2);\r\n        return this.#canMove(elementHead, elementHead2);\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param x {number}\r\n     * @param y {number}\r\n     * @param processTemperature {boolean}\r\n     * @return {boolean} active\r\n     */\r\n    #nextPoint(x, y, processTemperature) {\r\n        const elementHead = this.#elementArea.getElementHead(x, y);\r\n        const moved = this.#performMovingBehaviour(elementHead, x, y);\r\n\r\n        if (moved) {\r\n            return true;\r\n        }\r\n\r\n        const behaviour = ElementHead.getBehaviour(elementHead);\r\n        let active = false;\r\n        switch (behaviour) {\r\n            case ElementHead.BEHAVIOUR_NONE:\r\n            case ElementHead.BEHAVIOUR_SOIL:\r\n                break;\r\n            case ElementHead.BEHAVIOUR_LIQUID:\r\n                const r = this.#moduleLiquid.behaviourLiquid(elementHead, x, y);\r\n                if ((r & ProcessorModuleLiquid.RET_FLAG_ACTIVE) === ProcessorModuleLiquid.RET_FLAG_ACTIVE) {\r\n                    active = true;\r\n                }\r\n                if ((r & ProcessorModuleLiquid.RET_FLAG_SKIP_TEMP) === ProcessorModuleLiquid.RET_FLAG_SKIP_TEMP) {\r\n                    processTemperature = false;\r\n                }\r\n                break;\r\n            case ElementHead.BEHAVIOUR_FIRE:\r\n                this.#moduleFire.behaviourFire(elementHead, x, y);\r\n                active = true;\r\n                processTemperature = false;\r\n                break;\r\n            case ElementHead.BEHAVIOUR_GRASS:\r\n                this.#moduleGrass.behaviourGrass(elementHead, x, y);\r\n                active = true;\r\n                break;\r\n            case ElementHead.BEHAVIOUR_TREE:\r\n                this.#moduleTree.behaviourTree(elementHead, x, y);\r\n                active = true;\r\n                break;\r\n            case ElementHead.BEHAVIOUR_TREE_LEAF:\r\n                this.#moduleTree.behaviourTreeLeaf(elementHead, x, y);\r\n                active = true;\r\n                break;\r\n            case ElementHead.BEHAVIOUR_TREE_TRUNK:\r\n                break;\r\n            case ElementHead.BEHAVIOUR_TREE_ROOT:\r\n                this.#moduleTree.behaviourTreeRoot(elementHead, x, y);\r\n                active = true;\r\n                break;\r\n            case ElementHead.BEHAVIOUR_FIRE_SOURCE:\r\n                this.#moduleFire.behaviourFireSource(elementHead, x, y);\r\n                active = true;\r\n                processTemperature = false;\r\n                break;\r\n            case ElementHead.BEHAVIOUR_METEOR:\r\n                this.#moduleMeteor.behaviourMeteor(elementHead, x, y);\r\n                active = true;\r\n                processTemperature = false;\r\n                break;\r\n            case ElementHead.BEHAVIOUR_ENTITY:\r\n                this.#moduleEntity.behaviourEntity(elementHead, x, y);\r\n                processTemperature = true;\r\n                active = true;\r\n                break;\r\n            default:\r\n                throw \"Unknown element behaviour: \" + behaviour;\r\n        }\r\n\r\n        if (processTemperature) {\r\n            const temperatureRelatedActivity = this.#temperature(elementHead, x, y);\r\n            return active || temperatureRelatedActivity;\r\n        } else {\r\n            return active\r\n        }\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param elementHead\r\n     * @param x {number}\r\n     * @param y {number}\r\n     * @return boolean\r\n     */\r\n    #temperature(elementHead, x, y) {\r\n        const temp = ElementHead.getTemperature(elementHead);\r\n\r\n        if (temp === 0) {\r\n            const heatModIndex = ElementHead.getHeatModIndex(elementHead);\r\n            if (temp < ElementHead.hmiToHardeningTemperature(heatModIndex)) {\r\n                this.#tryHardening(elementHead, x, y, heatModIndex, true);\r\n                return true;\r\n            }\r\n            return false;\r\n        }\r\n\r\n        // conduct temperature\r\n\r\n        let tx = x, ty = y;\r\n        switch (this.#random.nextInt(4)) {\r\n            case 0: ty--; break;  // Up\r\n            case 1: tx++; break;  // Right\r\n            case 2: ty++; break;  // Down\r\n            case 3: tx--; break;  // Left\r\n        }\r\n\r\n        const heatModIndex = ElementHead.getHeatModIndex(elementHead);\r\n        const heatLoss = (this.#random.nextInt(10000) < ElementHead.hmiToHeatLossChanceTo10000(heatModIndex));\r\n        let newTemp;\r\n\r\n        if (this.#elementArea.isValidPosition(tx, ty)) {\r\n            const targetElementHead = this.#elementArea.getElementHead(tx, ty);\r\n            const targetTemp = ElementHead.getTemperature(targetElementHead);\r\n\r\n            if (temp + targetTemp > 1) {\r\n                const conductiveIndex = ElementHead.hmiToConductiveIndex(heatModIndex);\r\n                newTemp = Math.trunc((conductiveIndex * targetTemp) + (1 - conductiveIndex) * temp);\r\n            }\r\n\r\n            if (temp - newTemp !== 0) {\r\n                if (heatLoss) {\r\n                    newTemp--;\r\n                }\r\n                newTemp = Math.max(newTemp, 0);\r\n\r\n                // update target temp\r\n\r\n                let newTargetTemp;\r\n                if (targetTemp - newTemp > 10) {\r\n                    // limit max absolute dec change - it will look more natural...\r\n                    newTargetTemp = targetTemp - 10;\r\n                } else {\r\n                    newTargetTemp = targetTemp + (temp - newTemp);\r\n                }\r\n\r\n                newTargetTemp = Math.max(newTargetTemp, 0);\r\n                this.#elementArea.setElementHead(tx, ty, ElementHead.setTemperature(targetElementHead, newTargetTemp));\r\n                this.trigger(tx, ty);\r\n\r\n                // update this temp\r\n\r\n                if (temp - newTemp > 10) {\r\n                    // limit max absolute dec change - it will look more natural...\r\n                    newTemp = temp - 10;\r\n                }\r\n                elementHead = ElementHead.setTemperature(elementHead, newTemp);\r\n                this.#elementArea.setElementHead(x, y, elementHead);\r\n\r\n            }\r\n        } else {\r\n            if (heatLoss) {\r\n                newTemp = Math.max(temp - 1, 0);\r\n                elementHead = ElementHead.setTemperature(elementHead, newTemp);\r\n                this.#elementArea.setElementHead(x, y, elementHead);\r\n            }\r\n        }\r\n\r\n        // self-ignition\r\n        const chanceToIgnite = ElementHead.hmiToSelfIgnitionChanceTo10000(heatModIndex);\r\n        if (newTemp > 100 && chanceToIgnite > 0) {\r\n            if (ElementHead.getBehaviour(elementHead) === ElementHead.BEHAVIOUR_FIRE_SOURCE) {\r\n                // already in fire\r\n            } else {\r\n                if (this.#random.nextInt(10000) < chanceToIgnite) {\r\n                    this.#moduleFire.ignite(elementHead, x, y, heatModIndex);\r\n                    return true;\r\n                }\r\n            }\r\n        }\r\n\r\n        // melting\r\n        if (newTemp > ElementHead.hmiToMeltingTemperature(heatModIndex)) {\r\n            elementHead = ElementHead.setType(elementHead, ElementHead.TYPE_FLUID);\r\n            elementHead = ElementHead.setHeatModIndex(elementHead, ElementHead.hmiToMeltingHMI(heatModIndex));\r\n\r\n            let elementTail = this.#elementArea.getElementTail(x, y);\r\n            elementTail = ElementTail.setBlurType(elementTail, ElementTail.BLUR_TYPE_1);\r\n\r\n            this.#elementArea.setElementHeadAndTail(x, y, elementHead, elementTail);\r\n            return true;\r\n        }\r\n\r\n        // hardening\r\n        if (newTemp < ElementHead.hmiToHardeningTemperature(heatModIndex)) {\r\n            this.#tryHardening(elementHead, x, y, heatModIndex, false);\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    #tryHardening(elementHead, x, y, heatModIndex, force) {\r\n        // there must be a solid element nearby\r\n        if (force || this.#findHardeningSupport(x, y)) {\r\n            elementHead = ElementHead.setType(elementHead, ElementHead.type8Solid(ElementHead.TYPE_STATIC, 2));\r\n            elementHead = ElementHead.setHeatModIndex(elementHead, ElementHead.hmiToHardeningHMI(heatModIndex));\r\n\r\n            let elementTail = this.#elementArea.getElementTail(x, y);\r\n            elementTail = ElementTail.setBlurType(elementTail, ElementTail.BLUR_TYPE_NONE);\r\n\r\n            this.#elementArea.setElementHeadAndTail(x, y, elementHead, elementTail);\r\n        }\r\n    }\r\n\r\n    #findHardeningSupport(x, y) {\r\n        // below\r\n        if (y !== this.#height - 1) {\r\n            if (this.#isHardeningSupport(this.#elementArea.getElementHead(x, y + 1))) {\r\n                return true;\r\n            }\r\n        } else {\r\n            // bottom\r\n            if (!this.#fallThroughEnabled && !this.#erasingEnabled) {\r\n                return true;\r\n            }\r\n        }\r\n\r\n        // left\r\n        if (this.#elementArea.isValidPosition(x - 1, y)) {\r\n            if (this.#isHardeningSupport(this.#elementArea.getElementHead(x - 1, y))) {\r\n                return true;\r\n            }\r\n        }\r\n\r\n        // right\r\n        if (this.#elementArea.isValidPosition(x + 1, y)) {\r\n            if (this.#isHardeningSupport(this.#elementArea.getElementHead(x + 1, y))) {\r\n                return true;\r\n            }\r\n        }\r\n\r\n        return false;  // support not found\r\n    }\r\n\r\n    #isHardeningSupport(targetElementHead) {\r\n        const typeClass = ElementHead.getTypeClass(targetElementHead);\r\n        if (typeClass > ElementHead.TYPE_FLUID) {\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param elementHead\r\n     * @param x {number}\r\n     * @param y {number}\r\n     * @returns {boolean}\r\n     */\r\n    #performMovingBehaviour(elementHead, x, y) {\r\n        const type = ElementHead.getTypeClass(elementHead);\r\n        switch (type) {\r\n            case ElementHead.TYPE_AIR:\r\n                // no action\r\n                return false;\r\n\r\n            case ElementHead.TYPE_POWDER:\r\n            case ElementHead.TYPE_POWDER_WET:\r\n            case ElementHead.TYPE_POWDER_FLOATING:\r\n                if (this.#move(elementHead, x, y, x, y + 1)) {\r\n                    // moved down\r\n\r\n                    if (y % 2 === 0) {\r\n                        this.#wake(x - 1, y + 1, 0);\r\n                    } else {\r\n                        this.#wake(x + 1, y + 1, 1);\r\n                    }\r\n\r\n                    this.#wake(x, y + 1, y % 2);\r\n\r\n                    if (y % 2 === 0) {\r\n                        this.#wake(x + 1, y, 0);\r\n                    } else {\r\n                        this.#wake(x - 1, y, 1);\r\n                    }\r\n\r\n                    return true;\r\n                } else {\r\n                    if (ElementHead.getTypeModifierPowderSliding(elementHead) === 1) {\r\n                        const momentum = ElementHead.getTypeModifierPowderMomentum(elementHead);\r\n\r\n                        const r = this.#random.nextInt(1000000);\r\n                        if (r > Processor.#asMomentumMoveInMillion(momentum)) {\r\n                            // stop - lost momentum\r\n                            this.#elementArea.setElementHead(x, y, ElementHead.setTypeModifierPowderSliding(elementHead, 0));\r\n                            return false;\r\n                        }\r\n\r\n                        const direction = ElementHead.getTypeModifierPowderDirection(elementHead);\r\n                        this.#wake(x, y + 1, direction);\r\n\r\n                        const directionX = (direction === 0) ? -1 : 1;\r\n                        if (this.#move(elementHead, x, y, x + directionX, y)) {\r\n                            // moved horizontally\r\n                            this.#wake(x + directionX, y + 1, direction);\r\n                            this.#wake(x - directionX, y, direction);\r\n                            return true;\r\n                        } else {\r\n                            // stop - nowhere to go\r\n                            this.#wake(x + directionX, y + 1, direction);\r\n                            this.#elementArea.setElementHead(x, y, ElementHead.setTypeModifierPowderSliding(elementHead, 0));\r\n                            return false;\r\n                        }\r\n                    }\r\n                    return false;\r\n                }\r\n                return false;\r\n\r\n            case ElementHead.TYPE_FLUID:\r\n                // slow moving fluid\r\n                // if (!this.#move(elementHead, x, y, x, y + 1)) {\r\n                //     let rnd = this.#random.nextInt(2);\r\n                //     if (rnd === 0) {\r\n                //         return this.#move(elementHead, x, y, x + 1, y)\r\n                //     } else {\r\n                //         return this.#move(elementHead, x, y, x - 1, y)\r\n                //     }\r\n                // }\r\n                // return true;\r\n\r\n                // fast moving fluid (it can move by 3)\r\n                if (!this.#move(elementHead, x, y, x, y + 1)) {\r\n                    let rnd = this.#random.nextInt(2);\r\n                    if (rnd === 0) {\r\n                        if (this.#move(elementHead, x, y, x + 1, y)) {\r\n                            this.#wake(x + 1, y + 1, 1);\r\n                            if (this.#move(elementHead, x + 1, y, x + 2, y)) {\r\n                                if (this.#move(elementHead, x + 2, y, x + 3, y)) {\r\n                                    this.trigger(x + 3, y);\r\n                                } else {\r\n                                    this.trigger(x + 2, y);\r\n                                }\r\n                            }\r\n                            return true;\r\n                        }\r\n                        return false;\r\n                    } else {\r\n                        if (this.#move(elementHead, x, y, x - 1, y)) {\r\n                            this.#wake(x - 1, y + 1, 0);\r\n                            if (this.#move(elementHead, x - 1, y, x - 2, y)) {\r\n                                if (this.#move(elementHead, x - 2, y, x - 3, y)) {\r\n                                    this.trigger(x - 3, y);\r\n                                } else {\r\n                                    this.trigger(x - 2, y);\r\n                                }\r\n                            }\r\n                            return true;\r\n                        }\r\n                        return false;\r\n                    }\r\n                }\r\n                return true;\r\n\r\n            case ElementHead.TYPE_GAS:\r\n                let rnd = this.#random.nextInt(8);\r\n                if (rnd === 0 || rnd === 2) {\r\n                    if (this.#move(elementHead, x, y, x, y - 1)) {\r\n                        // moved up\r\n                        this.trigger(x, y - 1);\r\n                        return true;\r\n                    }\r\n                }\r\n                if (rnd === 3) {\r\n                    if (this.#move(elementHead, x, y, x + 1, y)) {\r\n                        // moved right\r\n                        this.trigger(x + 1, y);\r\n                        return true;\r\n                    }\r\n                }\r\n                if (rnd === 4) {\r\n                    if (this.#move(elementHead, x, y, x - 1, y)) {\r\n                        // moved left\r\n                        this.trigger(x - 1, y);\r\n                        return true;\r\n                    }\r\n                }\r\n                return false;\r\n\r\n            case ElementHead.TYPE_STATIC:\r\n                const fallingId = ElementHead.getTypeModifierSolidBodyId(elementHead);\r\n                if (fallingId === 0) {\r\n                    return false;\r\n                } else {\r\n                    return this.#moduleSolidBody.behaviourSolid(elementHead, x, y);\r\n                }\r\n\r\n            case ElementHead.TYPE_EFFECT:\r\n                // no action\r\n                return false;\r\n        }\r\n        throw \"Unknown element type: \" + type;\r\n    }\r\n\r\n    #move(elementHead, x, y, x2, y2) {\r\n        if (!this.#elementArea.isValidPosition(x2, y2)) {\r\n            if (this.#fallThroughEnabled && y === this.#height - 1) {\r\n                // try fall through\r\n                y2 = 0;\r\n                if (!this.#elementArea.isValidPosition(x2, y2)) {\r\n                    return false;\r\n                }\r\n                // continue move...\r\n            } else {\r\n                return false;\r\n            }\r\n        }\r\n\r\n        const elementHead2 = this.#elementArea.getElementHead(x2, y2);\r\n        const elementType2 = ElementHead.getTypeClass(elementHead2);\r\n        if (elementType2 === ElementHead.TYPE_POWDER_FLOATING || elementType2 === ElementHead.TYPE_POWDER) {\r\n            return false;\r\n        }\r\n\r\n        const elementType1 = ElementHead.getTypeClass(elementHead);\r\n        if (elementType1 > elementType2) {\r\n            // move\r\n\r\n            if (elementType1 === ElementHead.TYPE_POWDER && elementType2 === ElementHead.TYPE_FLUID) {\r\n                // element may cover element2\r\n\r\n                const elementHeadWithAbsorbedFluid = ElementHead.setTypeClass(elementHead, ElementHead.TYPE_POWDER_WET);\r\n                const elementTail = this.#elementArea.getElementTail(x, y);\r\n\r\n                // sometimes element2 will not be covered - it looks better\r\n                if (this.#random.nextInt(100) > 9) {\r\n                    this.#elementArea.setElement(x, y, this.#defaults.getDefaultElement());\r\n                } else {\r\n                    const elementTail2 = this.#elementArea.getElementTail(x2, y2);\r\n                    this.#elementArea.setElementHead(x, y, elementHead2);\r\n                    this.#elementArea.setElementTail(x, y, elementTail2);\r\n                }\r\n                this.#elementArea.setElementHead(x2, y2, elementHeadWithAbsorbedFluid);\r\n                this.#elementArea.setElementTail(x2, y2, elementTail);\r\n\r\n            } else {\r\n                // swap\r\n\r\n                const elementTail = this.#elementArea.getElementTail(x, y);\r\n                const elementTail2 = this.#elementArea.getElementTail(x2, y2);\r\n\r\n                this.#elementArea.setElementHead(x2, y2, elementHead);\r\n                this.#elementArea.setElementHead(x, y, elementHead2);\r\n                this.#elementArea.setElementTail(x2, y2, elementTail);\r\n                this.#elementArea.setElementTail(x, y, elementTail2);\r\n            }\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    #canMove(elementHead1, elementHead2) {\r\n        const elementType2 = ElementHead.getTypeClass(elementHead2);\r\n        if (elementType2 === ElementHead.TYPE_POWDER_FLOATING || elementType2 === ElementHead.TYPE_POWDER) {\r\n            return false;\r\n        }\r\n\r\n        const elementType1 = ElementHead.getTypeClass(elementHead1);\r\n        return elementType1 > elementType2;\r\n    }\r\n\r\n    #wake(x, y, direction) {\r\n        if (this.#elementArea.isValidPosition(x, y)) {\r\n            let elementHead = this.#elementArea.getElementHead(x, y);\r\n            const type = ElementHead.getTypeClass(elementHead);\r\n            if (type === ElementHead.TYPE_POWDER\r\n                    || type === ElementHead.TYPE_POWDER_WET\r\n                    || type === ElementHead.TYPE_POWDER_FLOATING) {\r\n\r\n                const momentum = ElementHead.getTypeModifierPowderMomentum(elementHead);\r\n                if (momentum === 0) {\r\n                    return;  // never wake up\r\n                }\r\n\r\n                const directionX = (direction === 0) ? -1 : 1;\r\n                if (this.#elementArea.isValidPosition(x + directionX, y)) {\r\n                    const nextElementHead = this.#elementArea.getElementHead(x + directionX, y);\r\n                    if (!this.#canMove(elementHead, nextElementHead)) {\r\n                        return;  // target element has no space to move\r\n                    }\r\n                }\r\n\r\n                const r = this.#random.nextInt(1000000);\r\n                if (r > Processor.#asMomentumWakeupInMillion(momentum)) {\r\n                    return;  // not this time\r\n                }\r\n\r\n                elementHead = ElementHead.setTypeModifierPowderSliding(elementHead, 1);\r\n                elementHead = ElementHead.setTypeModifierPowderDirection(elementHead, direction);\r\n                this.#elementArea.setElementHead(x, y, elementHead);\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    static #asMomentumMoveInMillion(momentum) {\r\n        return [0, 400000, 600000, 700000, 700000, 800000, 950000, 950000][momentum];  // none .. almost always\r\n    }\r\n\r\n    static #asMomentumWakeupInMillion(momentum) {\r\n        return [0, 400000, 400000, 400000, 600000, 600000, 850000, 900000][momentum];  // never .. almost always\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\n/**\r\n * @interface\r\n *\r\n * @author Patrik Harag\r\n * @version 2023-08-27\r\n */\r\nexport default class Renderer {\r\n\r\n    trigger(x, y) {\r\n        throw 'Not implemented';\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param changedChunks {boolean[]}\r\n     * @return {void}\r\n     */\r\n    render(changedChunks) {\r\n        throw 'Not implemented';\r\n    }\r\n}\r\n","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\n/**\r\n * @interface\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-05-25\r\n */\r\nexport default class RendererInitializer {\r\n\r\n    getContextType() {\r\n        throw 'Not implemented'\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param elementArea\r\n     * @param chunkSize\r\n     * @param context\r\n     * @return {Renderer}\r\n     */\r\n    initialize(elementArea, chunkSize, context) {\r\n        throw 'Not implemented'\r\n    }\r\n}\r\n","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\n/**\r\n * @typedef {object} MarkerConfig\r\n * @property {CSSStyleDeclaration} style\r\n * @property {string|HTMLElement} label\r\n * @property {string|undefined} group\r\n * @property {boolean} visible\r\n */\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-05-25\r\n */\r\nexport default class Marker {\r\n\r\n    /** @type number */\r\n    #x1;\r\n    /** @type number */\r\n    #y1;\r\n    /** @type number */\r\n    #x2;\r\n    /** @type number */\r\n    #y2;\r\n\r\n    /** @type MarkerConfig */\r\n    #config;\r\n\r\n    /** @type boolean */\r\n    #visible = true;\r\n    /** @type function(boolean)[] */\r\n    #onVisibleChanged = [];\r\n\r\n    constructor(x1, y1, x2, y2, config) {\r\n        this.#x1 = x1;\r\n        this.#y1 = y1;\r\n        this.#x2 = x2;\r\n        this.#y2 = y2;\r\n        this.#config = config;\r\n        this.#visible = config.visible === true;\r\n    }\r\n\r\n    getPosition() {\r\n        return [ this.#x1, this.#y1, this.#x2, this.#y2 ];\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @returns {MarkerConfig}\r\n     */\r\n    getConfig() {\r\n        return this.#config;\r\n    }\r\n\r\n    // visibility\r\n\r\n    isVisible() {\r\n        return this.#visible;\r\n    }\r\n\r\n    setVisible(visible) {\r\n        if (this.#visible !== visible) {\r\n            // handlers are triggered only on change\r\n            this.#visible = visible;\r\n            for (let handler of this.#onVisibleChanged) {\r\n                handler(visible);\r\n            }\r\n        }\r\n    }\r\n\r\n    addOnVisibleChanged(handler) {\r\n        this.#onVisibleChanged.push(handler);\r\n    }\r\n}\r\n","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport FloodFillPainter from \"./FloodFillPainter.js\";\r\nimport Element from \"./Element.js\";\r\nimport ElementArea from \"./ElementArea.js\";\r\nimport Brush from \"./brush/Brush.js\";\r\nimport CircleIterator from \"./CircleIterator.js\";\r\nimport Marker from \"./Marker\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-05-08\r\n */\r\nexport default class SandGameGraphics {\r\n\r\n    /** @type ElementArea */\r\n    #elementArea;\r\n\r\n    /** @type SandGameEntities */\r\n    #entities;\r\n\r\n    /** @type DeterministicRandom */\r\n    #random;\r\n\r\n    /** @type GameDefaults */\r\n    #defaults;\r\n\r\n    /** @type {function(number,number)} */\r\n    #triggerFunction;\r\n\r\n    constructor(elementArea, entities, random, defaults, triggerFunction) {\r\n        this.#elementArea = elementArea;\r\n        this.#entities = entities;\r\n        this.#random = random;\r\n        this.#defaults = defaults;\r\n        this.#triggerFunction = triggerFunction;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param aX {number}\r\n     * @param aY {number}\r\n     * @param bX {number}\r\n     * @param bY {number}\r\n     */\r\n    swap(aX, aY, bX, bY) {\r\n        aX = Math.trunc(aX);\r\n        aY = Math.trunc(aY);\r\n        bX = Math.trunc(bX);\r\n        bY = Math.trunc(bY);\r\n\r\n        if (this.#elementArea.isValidPosition(aX, aY) && this.#elementArea.isValidPosition(bX, bY)) {\r\n            this.#elementArea.swap(aX, aY, bX, bY);\r\n            this.#triggerFunction(aX, aY);\r\n            this.#triggerFunction(bX, bY);\r\n        }\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param x {number}\r\n     * @param y {number}\r\n     * @param brushOrElement {Brush|Element|null}\r\n     */\r\n    draw(x, y, brushOrElement) {\r\n        x = Math.trunc(x);\r\n        y = Math.trunc(y);\r\n\r\n        if (this.#elementArea.isValidPosition(x, y)) {\r\n            if (brushOrElement === null) {\r\n                this.#elementArea.setElement(x, y, this.#defaults.getDefaultElement());\r\n                this.#triggerFunction(x, y);\r\n            } else if (brushOrElement instanceof Element) {\r\n                this.#elementArea.setElement(x, y, brushOrElement);\r\n                this.#triggerFunction(x, y);\r\n            } else if (brushOrElement instanceof Brush) {\r\n                let oldElement = this.#elementArea.getElement(x, y);\r\n                let newElement = brushOrElement.apply(x, y, this.#random, oldElement);\r\n                this.#elementArea.setElement(x, y, newElement);\r\n                this.#triggerFunction(x, y);\r\n            } else {\r\n                throw 'Brush or Element expected';\r\n            }\r\n        }\r\n    }\r\n\r\n    drawRectangle(x1, y1, x2, y2, brushOrElement, supportNegativeCoordinates = false) {\r\n        if (!(brushOrElement instanceof Brush || brushOrElement instanceof Element)) {\r\n            throw 'Brush expected';\r\n        }\r\n\r\n        x1 = Math.trunc(x1);\r\n        y1 = Math.trunc(y1);\r\n        x2 = Math.trunc(x2);\r\n        y2 = Math.trunc(y2);\r\n\r\n        if (supportNegativeCoordinates) {\r\n            x1 = (x1 >= 0) ? x1 : this.getWidth() + x1 + 1;\r\n            x2 = (x2 >= 0) ? x2 : this.getWidth() + x2 + 1;\r\n            y1 = (y1 >= 0) ? y1 : this.getHeight() + y1 + 1;\r\n            y2 = (y2 >= 0) ? y2 : this.getHeight() + y2 + 1;\r\n        }\r\n\r\n        x1 = Math.max(Math.min(x1, this.getWidth()), 0);\r\n        x2 = Math.max(Math.min(x2, this.getWidth()), 0);\r\n        y1 = Math.max(Math.min(y1, this.getHeight()), 0);\r\n        y2 = Math.max(Math.min(y2, this.getHeight()), 0);\r\n\r\n        for (let y = y1; y < y2; y++) {\r\n            for (let x = x1; x < x2; x++) {\r\n                this.draw(x, y, brushOrElement);\r\n            }\r\n        }\r\n    }\r\n\r\n    drawRectangleWH(x, y, w, h, brush) {\r\n        this.drawRectangle(x, y, x + w, y + h, brush, false);\r\n    }\r\n\r\n    drawLine(x1, y1, x2, y2, size, brushOrElement, round=false) {\r\n        if (!(brushOrElement instanceof Brush || brushOrElement instanceof Element)) {\r\n            throw 'Brush expected';\r\n        }\r\n\r\n        x1 = Math.trunc(x1);\r\n        y1 = Math.trunc(y1);\r\n        x2 = Math.trunc(x2);\r\n        y2 = Math.trunc(y2);\r\n\r\n        let consumer;\r\n        if (round) {\r\n            let maxLevel = Math.trunc(size / 2);\r\n\r\n            let blueprint;\r\n            if (maxLevel <= 3) {\r\n                blueprint = CircleIterator.BLUEPRINT_3;\r\n            } else if (maxLevel === 4) {\r\n                blueprint = CircleIterator.BLUEPRINT_4;\r\n            } else {\r\n                blueprint = CircleIterator.BLUEPRINT_9;\r\n            }\r\n\r\n            consumer = (x, y) => {\r\n                CircleIterator.iterate(blueprint, (dx, dy, level) => {\r\n                    if (level <= maxLevel) {\r\n                        this.draw(x + dx, y + dy, brushOrElement);\r\n                    }\r\n                });\r\n            };\r\n        } else {\r\n            const d = Math.ceil(size / 2);\r\n            consumer = (x, y) => {\r\n                this.drawRectangle(x - d, y - d, x + d, y + d, brushOrElement);\r\n            };\r\n        }\r\n\r\n        SandGameGraphics.#lineAlgorithm(x1, y1, x2, y2, consumer);\r\n    }\r\n\r\n    static #lineAlgorithm(x1, y1, x2, y2, consumer) {\r\n        consumer(x1, y1);\r\n\r\n        if ((x1 !== x2) || (y1 !== y2)) {\r\n            const moveX = x1 < x2 ? 1 : -1;\r\n            const moveY = y1 < y2 ? 1 : -1;\r\n\r\n            const dx = Math.abs(x2 - x1);\r\n            const dy = Math.abs(y2 - y1);\r\n            let diff = dx - dy;\r\n\r\n            while ((x1 !== x2) || (y1 !== y2)) {\r\n                const p = 2 * diff;\r\n\r\n                if (p > -dy) {\r\n                    diff = diff - dy;\r\n                    x1 = x1 + moveX;\r\n                }\r\n                if (p < dx) {\r\n                    diff = diff + dx;\r\n                    y1 = y1 + moveY;\r\n                }\r\n                consumer(x1, y1);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param shape {Marker}\r\n     * @param brushOrElement {Brush|Element}\r\n     */\r\n    drawShape(shape, brushOrElement) {\r\n        if (shape instanceof Marker) {\r\n            const [x1, y1, x2, y2] = shape.getPosition();\r\n            this.drawRectangle(x1, y1, x2, y2, brushOrElement, false);\r\n        } else {\r\n            throw 'Shape not supported';\r\n        }\r\n    }\r\n\r\n    fill(brush) {\r\n        this.drawRectangle(0, 0, this.#elementArea.getWidth(), this.#elementArea.getHeight(), brush);\r\n    }\r\n\r\n    floodFill(x, y, brush, neighbourhood) {\r\n        x = Math.trunc(x);\r\n        y = Math.trunc(y);\r\n\r\n        let floodFillPainter = new FloodFillPainter(this.#elementArea, neighbourhood, this);\r\n        floodFillPainter.paint(x, y, brush);\r\n    }\r\n\r\n    replace(elementTarget, elementReplacement) {\r\n        const width = this.getWidth();\r\n        const height = this.getHeight();\r\n        for (let y = 0; y < height; y++) {\r\n            for (let x = 0; x < width; x++) {\r\n                const next = this.#elementArea.getElement(x, y);\r\n                if (next.elementHead === elementTarget.elementHead && next.elementTail === elementTarget.elementTail) {\r\n                    this.#elementArea.setElement(x, y, elementReplacement);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    flipVertically() {\r\n        const width = this.getWidth();\r\n        const height = this.getHeight();\r\n        const halfHeight = Math.trunc(height / 2);\r\n        for (let x = 0; x < width; x++) {\r\n            for (let yd = 0; yd < halfHeight; yd++) {\r\n                this.swap(x, yd, x, height - yd - 1);\r\n            }\r\n        }\r\n    }\r\n\r\n    flipHorizontally() {\r\n        const width = this.getWidth();\r\n        const height = this.getHeight();\r\n        const halfWidth = Math.trunc(width / 2);\r\n        for (let y = 0; y < height; y++) {\r\n            for (let xd = 0; xd < halfWidth; xd++) {\r\n                this.swap(xd, y, width - xd - 1, y);\r\n            }\r\n        }\r\n    }\r\n\r\n    insertElementArea(elementArea, offsetX = 0, offsetY = 0) {\r\n        for (let y = 0; y < elementArea.getHeight(); y++) {\r\n            for (let x = 0; x < elementArea.getWidth(); x++) {\r\n                if (this.#elementArea.isValidPosition(x + offsetX, y + offsetY)) {\r\n                    const elementHead = elementArea.getElementHead(x, y);\r\n                    const elementTail = elementArea.getElementTail(x, y);\r\n                    this.#elementArea.setElementHeadAndTail(x + offsetX, y + offsetY, elementHead, elementTail);\r\n                    this.#triggerFunction(x + offsetX, y + offsetY);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    getWidth() {\r\n        return this.#elementArea.getWidth();\r\n    }\r\n\r\n    getHeight() {\r\n        return this.#elementArea.getHeight();\r\n    }\r\n\r\n    entities() {\r\n        return this.#entities;\r\n    }\r\n\r\n    getDefaults() {\r\n        return this.#defaults;\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport Entity from \"./entity/Entity\";\r\n\r\n/**\r\n * Public API for working with entities.\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-05-04\r\n */\r\nexport default class SandGameEntities {\r\n\r\n    /** @type number */\r\n    #width;\r\n    /** @type number */\r\n    #height;\r\n\r\n    /** @type EntityManager */\r\n    #entityManager;\r\n\r\n    /** @type {function(number,number)} */\r\n    #triggerFunction;\r\n\r\n    constructor(width, height, entityManager, triggerFunction) {\r\n        this.#width = width;\r\n        this.#height = height;\r\n        this.#entityManager = entityManager;\r\n        this.#triggerFunction = triggerFunction;\r\n    }\r\n\r\n    insertEntity(serializedEntity) {\r\n        if (serializedEntity instanceof Entity) {\r\n            throw 'Entity instance not supported here';\r\n        }\r\n\r\n        // check is not out of bounds\r\n        if (typeof serializedEntity.y === 'number') {\r\n            if (serializedEntity.y < 0 || serializedEntity.y >= this.#height) {\r\n                return;  // out of bounds\r\n            }\r\n        }\r\n        if (typeof serializedEntity.x === 'number') {\r\n            if (serializedEntity.x < 0 || serializedEntity.x >= this.#width) {\r\n                return;  // out of bounds\r\n            }\r\n        }\r\n\r\n        this.#entityManager.addSerializedEntity(serializedEntity);\r\n\r\n        if (typeof serializedEntity.x === 'number' && typeof serializedEntity.y === 'number') {\r\n            this.#triggerFunction(serializedEntity.x, serializedEntity.y);\r\n        }\r\n    }\r\n\r\n    // TODO: hide _elementArea, etc.\r\n    /**\r\n     *\r\n     * @param x\r\n     * @param y\r\n     * @returns {Entity[]}\r\n     */\r\n    getAt(x, y) {\r\n        return this.#entityManager.getAt(x, y);\r\n    }\r\n\r\n    assignWaypoint(x, y) {\r\n        for (const entity of this.#entityManager.getEntities()) {\r\n            if (typeof entity.assignWaypoint === 'function') {\r\n                entity.assignWaypoint(x, y);\r\n            }\r\n        }\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport Marker from \"./Marker\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-05-25\r\n */\r\nexport default class SandGameOverlay {\r\n\r\n    /** @type number */\r\n    #width;\r\n    /** @type number */\r\n    #height;\r\n\r\n    /** @type Marker[] */\r\n    #markers = [];\r\n\r\n    /** @type function(Marker)[] */\r\n    #onMarkerAdded = [];\r\n\r\n    constructor(width, height) {\r\n        this.#width = width;\r\n        this.#height = height;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param x1\r\n     * @param y1\r\n     * @param x2\r\n     * @param y2\r\n     * @param config {MarkerConfig}\r\n     * @param supportNegativeCoordinates {boolean}\r\n     * @returns {Marker}\r\n     */\r\n    createRectangle(x1, y1, x2, y2, config, supportNegativeCoordinates = false) {\r\n        x1 = Math.trunc(x1);\r\n        y1 = Math.trunc(y1);\r\n        x2 = Math.trunc(x2);\r\n        y2 = Math.trunc(y2);\r\n\r\n        if (supportNegativeCoordinates) {\r\n            x1 = (x1 >= 0) ? x1 : this.#width + x1 + 1;\r\n            x2 = (x2 >= 0) ? x2 : this.#width + x2 + 1;\r\n            y1 = (y1 >= 0) ? y1 : this.#height + y1 + 1;\r\n            y2 = (y2 >= 0) ? y2 : this.#height + y2 + 1;\r\n        }\r\n\r\n        x1 = Math.max(Math.min(x1, this.#width - 1), 0);\r\n        x2 = Math.max(Math.min(x2, this.#width - 1), 0);\r\n        y1 = Math.max(Math.min(y1, this.#height - 1), 0);\r\n        y2 = Math.max(Math.min(y2, this.#height - 1), 0);\r\n\r\n        const marker = new Marker(x1, y1, x2, y2, config);\r\n        this.#markers.push(marker);\r\n        for (let handler of this.#onMarkerAdded) {\r\n            handler(marker);\r\n        }\r\n\r\n        return marker;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param x\r\n     * @param y\r\n     * @param w\r\n     * @param h\r\n     * @param config {MarkerConfig}\r\n     * @returns {Marker}\r\n     */\r\n    createRectangleWH(x, y, w, h, config) {\r\n        return this.createRectangle(x, y, x + w, y + h, config);\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param group {string|undefined}\r\n     * @returns {Marker[]}\r\n     */\r\n    getMarkers(group = undefined) {\r\n        if (group === undefined) {\r\n            return [...this.#markers];\r\n        } else {\r\n            // TODO: cache?\r\n            return this.#markers.filter(m => m.getConfig().group === group);\r\n        }\r\n    }\r\n\r\n    addOnMarkerAdded(handler) {\r\n        this.#onMarkerAdded.push(handler);\r\n    }\r\n\r\n    getWidth() {\r\n        return this.#width;\r\n    }\r\n\r\n    getHeight() {\r\n        return this.#height\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\n/**\r\n * @typedef {object} SplashConfig\r\n * @property {HTMLElement|string} content\r\n * @property {CSSStyleDeclaration} style\r\n * @property {SplashButton[]} buttons\r\n * @property {boolean} visible\r\n */\r\n/**\r\n * @typedef {object} SplashButton\r\n * @property {string} title\r\n * @property {string} class\r\n * @property {boolean} focus\r\n * @property {function(Splash):void} action\r\n */\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-01-13\r\n */\r\nexport default class Splash {\r\n\r\n    /** @type SplashConfig */\r\n    #config;\r\n\r\n    /** @type boolean */\r\n    #visible;\r\n    /** @type function(boolean)[] */\r\n    #onVisibleChanged = [];\r\n\r\n    /**\r\n     *\r\n     * @param config {SplashConfig}\r\n     */\r\n    constructor(config) {\r\n        this.#config = config;\r\n        this.#visible = config.visible === true;\r\n    }\r\n\r\n    getConfig() {\r\n        return this.#config;  // TODO: immutable\r\n    }\r\n\r\n    // visibility\r\n\r\n    isVisible() {\r\n        return this.#visible;\r\n    }\r\n\r\n    setVisible(visible) {\r\n        if (this.#visible !== visible) {\r\n            // handlers are triggered only on change\r\n            this.#visible = visible;\r\n            for (let handler of this.#onVisibleChanged) {\r\n                handler(visible);\r\n            }\r\n        }\r\n    }\r\n\r\n    addOnVisibleChanged(handler) {\r\n        this.#onVisibleChanged.push(handler);\r\n    }\r\n}\r\n","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\n/**\r\n * @typedef {object} ObjectiveConfig\r\n * @property {string} name\r\n * @property {string} description\r\n * @property {boolean} visible\r\n * @property {boolean} active\r\n * @property {function(iteration:number)} checkHandler\r\n */\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-01-13\r\n */\r\nexport default class Objective {\r\n\r\n    /** @type ObjectiveConfig */\r\n    #config;\r\n\r\n    /** @type boolean */\r\n    #visible;\r\n    /** @type function(boolean)[] */\r\n    #onVisibleChanged = [];\r\n\r\n    /** @type boolean */\r\n    #active;\r\n    /** @type function(boolean)[] */\r\n    #onActiveChanged = [];\r\n\r\n    /** @type boolean */\r\n    #completed = false;\r\n    /** @type function(boolean)[] */\r\n    #onCompletedChanged = [];\r\n\r\n    /**\r\n     *\r\n     * @param config {ObjectiveConfig}\r\n     */\r\n    constructor(config) {\r\n        this.#config = config;\r\n        this.#visible = config.visible === true;\r\n        this.#active = config.active === true;\r\n    }\r\n\r\n    getConfig() {\r\n        return this.#config;  // TODO: immutable\r\n    }\r\n\r\n    // visible\r\n\r\n    isVisible() {\r\n        return this.#visible;\r\n    }\r\n\r\n    setVisible(visible) {\r\n        if (this.#visible !== visible) {\r\n            // handlers are triggered only on change\r\n            this.#visible = visible;\r\n            for (let handler of this.#onVisibleChanged) {\r\n                handler(visible);\r\n            }\r\n        }\r\n    }\r\n\r\n    addOnVisibleChanged(handler) {\r\n        this.#onVisibleChanged.push(handler);\r\n    }\r\n\r\n    // active\r\n\r\n    isActive() {\r\n        return this.#active;\r\n    }\r\n\r\n    setActive(active) {\r\n        if (this.#active !== active) {\r\n            // handlers are triggered only on change\r\n            this.#active = active;\r\n            for (let handler of this.#onActiveChanged) {\r\n                handler(active);\r\n            }\r\n        }\r\n    }\r\n\r\n    addOnActiveChanged(handler) {\r\n        this.#onActiveChanged.push(handler);\r\n    }\r\n\r\n    // status\r\n\r\n    isCompleted() {\r\n        return this.#completed;\r\n    }\r\n\r\n    setCompleted(completed) {\r\n        if (this.#completed !== completed) {\r\n            // handlers are triggered only on change\r\n            this.#completed = completed;\r\n            for (let handler of this.#onCompletedChanged) {\r\n                handler(completed);\r\n            }\r\n        }\r\n    }\r\n\r\n    addOnCompleted(handler) {\r\n        this.#onCompletedChanged.push(handler);\r\n    }\r\n}\r\n","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport Splash from \"./Splash\";\r\nimport Objective from \"./Objective\";\r\nimport Analytics from \"../Analytics\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-01-11\r\n */\r\nexport default class SandGameScenario {\r\n\r\n    /** @type Splash[] */\r\n    #splashes = [];\r\n\r\n    /** @type function(Splash)[] */\r\n    #onSplashAdded = [];\r\n\r\n    /** @type Objective[] */\r\n    #objectives = [];\r\n\r\n    /** @type function(Objective)[] */\r\n    #onObjectiveAdded = [];\r\n\r\n    #statusCompleted = false;\r\n\r\n    /** @type function()[] */\r\n    #onStatusCompleted = [];\r\n\r\n    constructor() {\r\n        // empty\r\n    }\r\n\r\n    // splash\r\n\r\n    /**\r\n     *\r\n     * @param config {SplashConfig}\r\n     * @returns {Splash}\r\n     */\r\n    createSplash(config) {\r\n        const splash = new Splash(config);\r\n        this.#splashes.push(splash);\r\n        for (let handler of this.#onSplashAdded) {\r\n            handler(splash);\r\n        }\r\n        return splash;\r\n    }\r\n\r\n    getSplashes() {\r\n        return [...this.#splashes];\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param handler {function(Splash)}\r\n     */\r\n    addOnSplashAdded(handler) {\r\n        this.#onSplashAdded.push(handler);\r\n    }\r\n\r\n    // objectives\r\n\r\n    /**\r\n     *\r\n     * @param config {ObjectiveConfig}\r\n     * @returns {Objective}\r\n     */\r\n    createObjective(config) {\r\n        const objective = new Objective(config);\r\n        this.#objectives.push(objective);\r\n        for (let handler of this.#onObjectiveAdded) {\r\n            handler(objective);\r\n        }\r\n        return objective;\r\n    }\r\n\r\n    getObjectives() {\r\n        return [...this.#objectives];\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param handler {function(Objective)}\r\n     */\r\n    addOnObjectiveAdded(handler) {\r\n        this.#onObjectiveAdded.push(handler);\r\n    }\r\n\r\n    // status\r\n\r\n    setCompleted() {\r\n        if (!this.#statusCompleted) {\r\n            this.#statusCompleted = true;\r\n            Analytics.triggerFeatureUsed(Analytics.FEATURE_SCENARIO_COMPLETED);\r\n            for (let handler of this.#onStatusCompleted) {\r\n                handler();\r\n            }\r\n        }\r\n    }\r\n\r\n    addOnStatusCompleted(handler) {\r\n        this.#onStatusCompleted.push(handler);\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-04-20\r\n */\r\nexport default class Snapshot {\r\n\r\n    /** @type SnapshotMetadata */\r\n    metadata;\r\n\r\n    /** @type ArrayBuffer */\r\n    dataHeads;\r\n\r\n    /** @type ArrayBuffer */\r\n    dataTails;\r\n\r\n    /** @type object[] */\r\n    serializedEntities;\r\n\r\n}\r\n","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-04-20\r\n */\r\nexport default class SnapshotMetadata {\r\n\r\n    static CURRENT_FORMAT_VERSION = 7;\r\n\r\n\r\n    /** @type number */\r\n    formatVersion;\r\n\r\n    /** @type string */\r\n    appVersion;\r\n\r\n    /** @type number|undefined */\r\n    created;\r\n\r\n    /** @type number|undefined */\r\n    width;\r\n\r\n    /** @type number|undefined */\r\n    height;\r\n\r\n    /** @type number|undefined */\r\n    scale;\r\n\r\n    /** @type number|undefined */\r\n    random;\r\n\r\n    /** @type number|undefined */\r\n    iteration;\r\n\r\n    /** @type boolean|undefined */\r\n    fallThroughEnabled;\r\n\r\n    /** @type boolean|undefined */\r\n    erasingEnabled;\r\n}\r\n","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2022-09-21\r\n */\r\nexport default class TemplateBlockPainter {\r\n\r\n    /** @type SandGameGraphics */\r\n    #graphics;\r\n\r\n    /** @type string|string[]|null */\r\n    #blueprint = null;\r\n    /** @type object|null */\r\n    #brushes = null;\r\n\r\n    /** @type number */\r\n    #maxHeight = Number.MAX_SAFE_INTEGER;\r\n\r\n    /** @type string */\r\n    #verticalAlign = 'bottom';\r\n\r\n    /**\r\n     *\r\n     * @param graphics {SandGameGraphics}\r\n     */\r\n    constructor(graphics) {\r\n        this.#graphics = graphics;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param blueprint {string|string[]}\r\n     * @returns {TemplateBlockPainter}\r\n     */\r\n    withBlueprint(blueprint) {\r\n        this.#blueprint = blueprint;\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param brushes\r\n     * @returns {TemplateBlockPainter}\r\n     */\r\n    withBrushes(brushes) {\r\n        this.#brushes = brushes;\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param maxHeight max template height\r\n     * @param align {string} bottom|top\r\n     * @returns {TemplateBlockPainter}\r\n     */\r\n    withMaxHeight(maxHeight, align = 'bottom') {\r\n        this.#maxHeight = maxHeight;\r\n        this.#verticalAlign = align;\r\n        return this;\r\n    }\r\n\r\n    paint() {\r\n        if (this.#blueprint === null || this.#blueprint.length === 0) {\r\n            throw 'Blueprint not set';\r\n        }\r\n        if (this.#brushes === null) {\r\n            throw 'Brushes not set';\r\n        }\r\n\r\n        const blueprint = (typeof this.#blueprint === 'string')\r\n            ? this.#blueprint.split('\\n')\r\n            : this.#blueprint;\r\n\r\n        const w = blueprint[0].length;\r\n        const h = blueprint.length;\r\n\r\n        const ww = Math.ceil(this.#graphics.getWidth() / w);\r\n        const hh = Math.ceil(Math.min(this.#graphics.getHeight(), this.#maxHeight) / h);\r\n        // note: rounding up is intentional - we don't want gaps, drawRectangle can handle drawing out of canvas\r\n\r\n        const verticalOffset = (this.#verticalAlign === 'bottom' ? this.#graphics.getHeight() - (hh * h) : 0);\r\n\r\n        for (let y = 0; y < h; y++) {\r\n            const line = blueprint[y];\r\n            for (let x = 0; x < Math.min(w, line.length); x++) {\r\n                const char = line.charAt(x);\r\n                let brush = this.#brushes[char];\r\n                if (brush === undefined) {\r\n                    if (char === ' ') {\r\n                        // let this cell empty\r\n                        continue;\r\n                    }\r\n                    throw 'Brush not found: ' + char;\r\n                }\r\n                this.#graphics.drawRectangle(\r\n                    x * ww, verticalOffset + (y * hh),\r\n                    x * ww + ww + 1, verticalOffset + (y * hh) + hh + 1, brush);\r\n            }\r\n        }\r\n    }\r\n}","module.exports = class Spline {\n  constructor(xs, ys) {\n    this.xs = xs;\n    this.ys = ys;\n    this.ks = this.getNaturalKs(new Float64Array(this.xs.length));\n  }\n\n  getNaturalKs(ks) {\n    const n = this.xs.length - 1;\n    const A = zerosMat(n + 1, n + 2);\n\n    for (\n      let i = 1;\n      i < n;\n      i++ // rows\n    ) {\n      A[i][i - 1] = 1 / (this.xs[i] - this.xs[i - 1]);\n      A[i][i] =\n        2 *\n        (1 / (this.xs[i] - this.xs[i - 1]) + 1 / (this.xs[i + 1] - this.xs[i]));\n      A[i][i + 1] = 1 / (this.xs[i + 1] - this.xs[i]);\n      A[i][n + 1] =\n        3 *\n        ((this.ys[i] - this.ys[i - 1]) /\n          ((this.xs[i] - this.xs[i - 1]) * (this.xs[i] - this.xs[i - 1])) +\n          (this.ys[i + 1] - this.ys[i]) /\n            ((this.xs[i + 1] - this.xs[i]) * (this.xs[i + 1] - this.xs[i])));\n    }\n\n    A[0][0] = 2 / (this.xs[1] - this.xs[0]);\n    A[0][1] = 1 / (this.xs[1] - this.xs[0]);\n    A[0][n + 1] =\n      (3 * (this.ys[1] - this.ys[0])) /\n      ((this.xs[1] - this.xs[0]) * (this.xs[1] - this.xs[0]));\n\n    A[n][n - 1] = 1 / (this.xs[n] - this.xs[n - 1]);\n    A[n][n] = 2 / (this.xs[n] - this.xs[n - 1]);\n    A[n][n + 1] =\n      (3 * (this.ys[n] - this.ys[n - 1])) /\n      ((this.xs[n] - this.xs[n - 1]) * (this.xs[n] - this.xs[n - 1]));\n\n    return solve(A, ks);\n  }\n\n  /**\n   * inspired by https://stackoverflow.com/a/40850313/4417327\n   */\n  getIndexBefore(target) {\n    let low = 0;\n    let high = this.xs.length;\n    let mid = 0;\n    while (low < high) {\n      mid = Math.floor((low + high) / 2);\n      if (this.xs[mid] < target && mid !== low) {\n        low = mid;\n      } else if (this.xs[mid] >= target && mid !== high) {\n        high = mid;\n      } else {\n        high = low;\n      }\n    }\n    return low + 1;\n  }\n\n  at(x) {\n    let i = this.getIndexBefore(x);\n    const t = (x - this.xs[i - 1]) / (this.xs[i] - this.xs[i - 1]);\n    const a =\n      this.ks[i - 1] * (this.xs[i] - this.xs[i - 1]) -\n      (this.ys[i] - this.ys[i - 1]);\n    const b =\n      -this.ks[i] * (this.xs[i] - this.xs[i - 1]) +\n      (this.ys[i] - this.ys[i - 1]);\n    const q =\n      (1 - t) * this.ys[i - 1] +\n      t * this.ys[i] +\n      t * (1 - t) * (a * (1 - t) + b * t);\n    return q;\n  }\n};\n\nfunction solve(A, ks) {\n  const m = A.length;\n  let h = 0;\n  let k = 0;\n  while (h < m && k <= m) {\n    let i_max = 0;\n    let max = -Infinity;\n    for (let i = h; i < m; i++) {\n      const v = Math.abs(A[i][k]);\n      if (v > max) {\n        i_max = i;\n        max = v;\n      }\n    }\n\n    if (A[i_max][k] === 0) {\n      k++;\n    } else {\n      swapRows(A, h, i_max);\n      for (let i = h + 1; i < m; i++) {\n        const f = A[i][k] / A[h][k];\n        A[i][k] = 0;\n        for (let j = k + 1; j <= m; j++) A[i][j] -= A[h][j] * f;\n      }\n      h++;\n      k++;\n    }\n  }\n\n  for (\n    let i = m - 1;\n    i >= 0;\n    i-- // rows = columns\n  ) {\n    var v = 0;\n    if (A[i][i]) {\n      v = A[i][m] / A[i][i];\n    }\n    ks[i] = v;\n    for (\n      let j = i - 1;\n      j >= 0;\n      j-- // rows\n    ) {\n      A[j][m] -= A[j][i] * v;\n      A[j][i] = 0;\n    }\n  }\n  return ks;\n}\n\nfunction zerosMat(r, c) {\n  const A = [];\n  for (let i = 0; i < r; i++) A.push(new Float64Array(c));\n  return A;\n}\n\nfunction swapRows(m, k, l) {\n  let p = m[k];\n  m[k] = m[l];\n  m[l] = p;\n}\n","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport Spline from \"cubic-spline\";\r\nimport { createNoise2D } from \"simplex-noise\";\r\nimport ProcessorModuleGrass from \"./processing/ProcessorModuleGrass.js\";\r\nimport ProcessorModuleTree from \"./processing/ProcessorModuleTree.js\";\r\nimport DeterministicRandom from \"./DeterministicRandom\";\r\nimport ElementHead from \"./ElementHead\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-04-27\r\n */\r\nexport default class TemplateLayeredPainter {\r\n\r\n    /** @type ElementArea */\r\n    #elementArea;\r\n\r\n    /** @type SandGameGraphics */\r\n    #graphics;\r\n\r\n    /** @type DeterministicRandom */\r\n    #random;\r\n\r\n    /** @type ProcessorContext */\r\n    #processorContext;\r\n\r\n    #lastLevel;\r\n\r\n    /**\r\n     *\r\n     * @param elementArea {ElementArea}\r\n     * @param graphics {SandGameGraphics}\r\n     * @param random {DeterministicRandom}\r\n     * @param processorContext {ProcessorContext}\r\n     */\r\n    constructor(elementArea, graphics, random, processorContext) {\r\n        this.#elementArea = elementArea;\r\n        this.#graphics = graphics;\r\n        this.#random = random;\r\n        this.#processorContext = processorContext;\r\n        this.#lastLevel = new Array(elementArea.getWidth()).fill(0);\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param constant {number}\r\n     * @param relative {boolean}\r\n     * @param brush {Brush}\r\n     * @param shuffleWithLevelBelow {number}\r\n     * @returns {TemplateLayeredPainter}\r\n     */\r\n    layer(constant, relative, brush, shuffleWithLevelBelow = 0) {\r\n        function func(x) {\r\n            return Math.trunc(constant);\r\n        }\r\n\r\n        this.layerFunction(func, relative, brush, shuffleWithLevelBelow);\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param points {[number,number][]}\r\n     * @param relative {boolean}\r\n     * @param brush {Brush}\r\n     * @param shuffleWithLevelBelow {number}\r\n     * @returns {TemplateLayeredPainter}\r\n     */\r\n    layerSpline(points, relative, brush, shuffleWithLevelBelow = 0) {\r\n        const xs = new Array(points.length);\r\n        const ys = new Array(points.length);\r\n        for (let i = 0; i < points.length; i++) {\r\n            xs[i] = points[i][0];\r\n            ys[i] = points[i][1];\r\n        }\r\n        const spline = new Spline(xs, ys);\r\n        function func (x) {\r\n            return Math.max(Math.trunc(spline.at(x)), 0);\r\n        }\r\n\r\n        this.layerFunction(func, relative, brush, shuffleWithLevelBelow);\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param config {{seed:number,factor:number,threshold:number,force:number}[]}\r\n     * @param relative {boolean}\r\n     * @param brush {Brush}\r\n     * @param shuffleWithLevelBelow {number}\r\n     * @returns {TemplateLayeredPainter}\r\n     */\r\n    layerPerlin(config, relative, brush, shuffleWithLevelBelow = 0) {\r\n        const levels = [];\r\n        for (let levelConfig of config) {\r\n            if (levelConfig.seed === undefined) {\r\n                DeterministicRandom.DEFAULT.next();\r\n                levelConfig.seed = DeterministicRandom.DEFAULT.getState();\r\n            }\r\n            if (levelConfig.factor === undefined) {\r\n                throw 'factor not defined';\r\n            }\r\n            if (levelConfig.threshold === undefined) {\r\n                throw 'threshold not defined';\r\n            }\r\n            if (levelConfig.force === undefined) {\r\n                throw 'force not defined';\r\n            }\r\n\r\n            const random = new DeterministicRandom(levelConfig.seed);\r\n            const noise2d = createNoise2D(() => random.next());\r\n\r\n            levels.push({ instance: noise2d, levelConfig: levelConfig });\r\n        }\r\n\r\n        function func(x) {\r\n            let result = 0;\r\n            for (const { instance, levelConfig } of levels) {\r\n                const { factor, threshold, force } = levelConfig;\r\n\r\n                let value = (instance(x / factor, 0) + 1) / 2;  // 0..1\r\n\r\n                // apply threshold\r\n                if (value < threshold) {\r\n                    value = 0;\r\n                }\r\n                value = (value - threshold) * (1 / (1 - threshold));  // normalized 0..1\r\n\r\n                // apply force\r\n                value = value * force;\r\n\r\n                result += value;\r\n            }\r\n            return Math.trunc(result);\r\n        }\r\n\r\n        this.layerFunction(func, relative, brush, shuffleWithLevelBelow);\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param func {function(x:number):number}\r\n     * @param relative {boolean}\r\n     * @param brush {Brush}\r\n     * @param shuffleWithLevelBelow {number}\r\n     * @returns {TemplateLayeredPainter}\r\n     */\r\n    layerFunction(func, relative, brush, shuffleWithLevelBelow = 0) {\r\n        for (let x = 0; x < this.#elementArea.getWidth(); x++) {\r\n            const lastLevel = this.#lastLevel[x];\r\n\r\n            const level = (relative)\r\n                    ? lastLevel + func(x)\r\n                    : func(x);\r\n\r\n            if (lastLevel < level) {\r\n                let count = 0;\r\n                for (let i = lastLevel; i < level && i < this.#elementArea.getHeight(); i++) {\r\n                    let y = this.#elementArea.getHeight() - 1 - i;\r\n                    this.#graphics.draw(x, y, brush);\r\n                    count++;\r\n                }\r\n\r\n                // shuffle\r\n                if (shuffleWithLevelBelow > 0 && count > 0) {\r\n                    for (let i = 0; i < shuffleWithLevelBelow; i++) {\r\n                        const max = Math.min(Math.trunc(count / 2), 10);\r\n                        if (max > 1) {\r\n                            const r = this.#random.nextInt(Math.ceil(max)) - Math.trunc(max / 2);\r\n                            const y1 = this.#elementArea.getHeight() - 1 - lastLevel + r;\r\n                            const y2 = this.#elementArea.getHeight() - 1 - lastLevel + r + 1;\r\n                            if (y1 < this.#elementArea.getHeight() && y2 < this.#elementArea.getHeight()) {\r\n                                this.#elementArea.swap(x, y1, x, y2);\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n\r\n                this.#lastLevel[x] = level;\r\n            }\r\n        }\r\n        return this;\r\n    }\r\n\r\n    grass(from = 0, to = -1) {\r\n        if (to === -1) {\r\n            to = this.#elementArea.getWidth();\r\n        }\r\n        for (let x = from; x < to; x++) {\r\n            const lastLevel = this.#lastLevel[x];\r\n            const y = this.#elementArea.getHeight() - 1 - lastLevel;\r\n\r\n            if (ProcessorModuleGrass.canGrowUpHere(this.#elementArea, x, y)) {\r\n                const brush = this.#processorContext.getDefaults().getBrushGrass();\r\n                ProcessorModuleGrass.spawnHere(this.#elementArea, x, y, brush, this.#random);\r\n            }\r\n        }\r\n\r\n        // TODO: update lastLevel\r\n        return this;\r\n    }\r\n\r\n    tree(x, type = undefined, levelsToGrow = undefined, force = false) {\r\n        if (x <= 5 || x >= this.#elementArea.getWidth() - 5) {\r\n            return this;  // out of bounds\r\n        }\r\n\r\n        const lastLevel = this.#lastLevel[x];\r\n        const y = this.#elementArea.getHeight() - 1 - lastLevel;\r\n\r\n        const brush = this.#processorContext.getDefaults().getBrushTree();\r\n\r\n        // check element under\r\n        if (this.#elementArea.isValidPosition(x, y + 1)) {\r\n            if (!force) {\r\n                const elementHeadUnder = this.#elementArea.getElementHead(x, y + 1);\r\n                if (ElementHead.getBehaviour(elementHeadUnder) !== ElementHead.BEHAVIOUR_SOIL) {\r\n                    return this;\r\n                }\r\n            }\r\n        } else {\r\n            return this;\r\n        }\r\n\r\n        if (type === undefined) {\r\n            type = this.#random.nextInt(8);\r\n        }\r\n\r\n        ProcessorModuleTree.spawnHere(this.#elementArea, x, y, type, brush, this.#random, this.#processorContext, levelsToGrow);\r\n\r\n        // TODO: update lastLevel\r\n        return this;\r\n    }\r\n\r\n    tool(x, relativeY, tool) {\r\n        if (x < 0 || x >= this.#elementArea.getWidth()) {\r\n            return this;  // out of bounds\r\n        }\r\n\r\n        const lastLevel = this.#lastLevel[x];\r\n        const y = this.#elementArea.getHeight() - relativeY - lastLevel;\r\n        if (y < 0 || y >= this.#elementArea.getHeight()) {\r\n            return this;  // out of bounds\r\n        }\r\n\r\n        tool.applyPoint(x, y, this.#graphics, false);\r\n\r\n        // TODO: update lastLevel\r\n        return this;\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport Counter from \"./Counter.js\";\r\nimport DeterministicRandom from \"./DeterministicRandom.js\";\r\nimport Element from \"./Element.js\";\r\nimport ElementHead from \"./ElementHead.js\";\r\nimport ElementTail from \"./ElementTail.js\";\r\nimport ElementArea from \"./ElementArea.js\";\r\nimport EntityManager from \"./entity/EntityManager\";\r\nimport Processor from \"./processing/Processor.js\";\r\nimport Renderer from \"./rendering/Renderer.js\";\r\nimport RendererInitializer from \"./rendering/RendererInitializer.js\";\r\nimport SandGameGraphics from \"./SandGameGraphics.js\";\r\nimport SandGameEntities from \"./SandGameEntities\";\r\nimport SandGameOverlay from \"./SandGameOverlay\";\r\nimport SandGameScenario from \"./SandGameScenario\";\r\nimport GameState from \"./GameState\";\r\nimport Snapshot from \"./Snapshot.js\";\r\nimport SnapshotMetadata from \"./SnapshotMetadata.js\";\r\nimport TemplateBlockPainter from \"./TemplateBlockPainter.js\";\r\nimport TemplateLayeredPainter from \"./TemplateLayeredPainter.js\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-05-04\r\n */\r\nexport default class SandGame {\r\n\r\n    /** @type ElementArea */\r\n    #elementArea;\r\n\r\n    /** @type number */\r\n    #width;\r\n\r\n    /** @type number */\r\n    #height;\r\n\r\n    /** @type EntityManager */\r\n    #entityManager;\r\n\r\n    /** @type DeterministicRandom */\r\n    #random;\r\n\r\n    /** @type Counter */\r\n    #framesCounter;\r\n\r\n    /** @type Counter */\r\n    #iterationsCounter;\r\n\r\n    /** @type Processor */\r\n    #processor;\r\n\r\n    /** @type Renderer */\r\n    #renderer;\r\n\r\n    /** @type number|null */\r\n    #processorIntervalHandle = null;\r\n\r\n    /** @type number|null */\r\n    #rendererIntervalHandle = null;\r\n\r\n    /** @type function[] */\r\n    #onRendered = [];\r\n    /** @type function[] */\r\n    #onRenderingFailed = [];\r\n\r\n    /** @type function(number)[] */\r\n    #onProcessed = [];\r\n\r\n    /** @type SandGameGraphics */\r\n    #graphics;\r\n\r\n    /** @type SandGameEntities */\r\n    #entities;\r\n\r\n    /** @type SandGameOverlay */\r\n    #overlay;\r\n\r\n    /** @type SandGameScenario */\r\n    #scenario;\r\n\r\n    /**\r\n     *\r\n     * @param elementArea {ElementArea}\r\n     * @param serializedEntities {object[]}\r\n     * @param sceneMetadata {SnapshotMetadata|null}\r\n     * @param gameDefaults {GameDefaults}\r\n     * @param context {CanvasRenderingContext2D|WebGLRenderingContext}\r\n     * @param rendererInitializer {RendererInitializer}\r\n     */\r\n    constructor(elementArea, serializedEntities, sceneMetadata, gameDefaults,\r\n            context, rendererInitializer) {\r\n\r\n        this.#random = new DeterministicRandom((sceneMetadata) ? sceneMetadata.random : 0);\r\n        this.#elementArea = elementArea;\r\n        this.#width = elementArea.getWidth();\r\n        this.#height = elementArea.getHeight();\r\n        this.#framesCounter = new Counter();\r\n        this.#iterationsCounter = new Counter();\r\n        this.#processor = new Processor(this.#elementArea, 16, this.#random, gameDefaults, sceneMetadata);\r\n        this.#renderer = rendererInitializer.initialize(this.#elementArea, 16, context);\r\n        this.#entityManager = new EntityManager(serializedEntities, new GameState(elementArea, this.#random, this.#processor, null));\r\n        const triggerFunction = (x, y) => {\r\n            this.#processor.trigger(x, y);\r\n            this.#renderer.trigger(x, y);\r\n        };\r\n        this.#entities = new SandGameEntities(elementArea.getWidth(), elementArea.getHeight(), this.#entityManager, triggerFunction);\r\n        this.#graphics = new SandGameGraphics(this.#elementArea, this.#entities, this.#random, gameDefaults, triggerFunction);\r\n        this.#overlay = new SandGameOverlay(elementArea.getWidth(), elementArea.getHeight());\r\n        this.#scenario = new SandGameScenario();\r\n\r\n        this.#initExtensions(gameDefaults);\r\n        this.#initObjectives();\r\n    }\r\n\r\n    #initObjectives() {\r\n        let activeObjectives = [];\r\n        const updateActiveObjectives = () => {\r\n            activeObjectives = this.#scenario.getObjectives().filter(o => {\r\n                return o.isActive() && (typeof o.getConfig().checkHandler === 'function');\r\n            });\r\n        };\r\n\r\n        this.#scenario.addOnObjectiveAdded(objective => {\r\n            updateActiveObjectives();\r\n            objective.addOnActiveChanged(() => updateActiveObjectives());\r\n            objective.addOnCompleted(() => updateActiveObjectives());\r\n        });\r\n        this.#onProcessed.push(() => {\r\n            for (let objective of activeObjectives) {\r\n                objective.getConfig().checkHandler(this.#processor.getIteration() - 1);\r\n            }\r\n        });\r\n    }\r\n\r\n    #initExtensions(gameDefaults) {\r\n        const gameState = new GameState(this.#elementArea, this.#random, this.#processor, this.#entityManager);\r\n        const extensionsFactory = gameDefaults.getExtensionsFactory();\r\n        const extensions = extensionsFactory(gameState);\r\n        for (const extension of extensions) {\r\n            this.#processor.addExtension(extension);\r\n        }\r\n    }\r\n\r\n    getBrushCollection() {\r\n        return this.#processor.getDefaults().getBrushCollection();\r\n    }\r\n\r\n    startProcessing() {\r\n        if (this.#processorIntervalHandle === null) {\r\n            const interval = Math.trunc(1000 / Processor.OPT_CYCLES_PER_SECOND);  // ms\r\n            this.#processorIntervalHandle = setInterval(() => this.doProcessing(), interval);\r\n        }\r\n    }\r\n\r\n    startRendering() {\r\n        if (this.#rendererIntervalHandle === null) {\r\n            const interval = Math.trunc(1000 / Processor.OPT_FRAMES_PER_SECOND);  // ms\r\n            this.#rendererIntervalHandle = setInterval(() => this.doRendering(), interval);\r\n        }\r\n    }\r\n\r\n    stopProcessing() {\r\n        if (this.#processorIntervalHandle !== null) {\r\n            clearInterval(this.#processorIntervalHandle);\r\n            this.#processorIntervalHandle = null;\r\n        }\r\n        this.#iterationsCounter.clear();\r\n    }\r\n\r\n    stopRendering() {\r\n        if (this.#rendererIntervalHandle !== null) {\r\n            clearInterval(this.#rendererIntervalHandle);\r\n            this.#rendererIntervalHandle = null;\r\n        }\r\n        this.#framesCounter.clear();\r\n    }\r\n\r\n    doProcessing() {\r\n        // TODO: error reporting\r\n\r\n        this.#entityManager.performBeforeProcessing();\r\n        this.#processor.next();\r\n        this.#entityManager.performAfterProcessing();\r\n\r\n        const t = Date.now();\r\n        this.#iterationsCounter.tick(t);\r\n        for (let func of this.#onProcessed) {\r\n            func(this.#processor.getIteration());\r\n        }\r\n    }\r\n\r\n    doRendering() {\r\n        const changedChunks = this.#processor.getChangedChunks();\r\n        try {\r\n            this.#renderer.render(changedChunks);\r\n        } catch (e) {\r\n            this.stopRendering();\r\n            for (let func of this.#onRenderingFailed) {\r\n                func(e);\r\n            }\r\n            return;\r\n        }\r\n        const t = Date.now();\r\n        this.#framesCounter.tick(t);\r\n        for (let func of this.#onRendered) {\r\n            func(changedChunks);\r\n        }\r\n        this.#processor.cleanChangedChunks();\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @returns {SandGameGraphics}\r\n     */\r\n    graphics() {\r\n        return this.#graphics;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @returns {SandGameEntities}\r\n     */\r\n    entities() {\r\n        return this.#entities;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @returns {SandGameOverlay}\r\n     */\r\n    overlay() {\r\n        return this.#overlay;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @returns {SandGameScenario}\r\n     */\r\n    scenario() {\r\n        return this.#scenario;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @returns {TemplateBlockPainter}\r\n     */\r\n    blockTemplate() {\r\n        return new TemplateBlockPainter(this.graphics());\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @returns {TemplateLayeredPainter}\r\n     */\r\n    layeredTemplate() {\r\n        return new TemplateLayeredPainter(this.#elementArea, this.graphics(), this.#random, this.#processor);\r\n    }\r\n\r\n    setBoxedMode() {\r\n        this.#processor.setFallThroughEnabled(false);\r\n        this.#processor.setErasingEnabled(false);\r\n    }\r\n\r\n    setFallThroughMode() {\r\n        this.#processor.setFallThroughEnabled(true);\r\n        this.#processor.setErasingEnabled(false);\r\n    }\r\n\r\n    setErasingMode() {\r\n        this.#processor.setFallThroughEnabled(false);\r\n        this.#processor.setErasingEnabled(true);\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param handler {function(iteration:number)}\r\n     */\r\n    addOnProcessed(handler) {\r\n        this.#onProcessed.push(handler);\r\n    }\r\n\r\n    addOnRendered(handler) {\r\n        this.#onRendered.push(handler);\r\n    }\r\n\r\n    addOnRenderingFailed(handler) {\r\n        this.#onRenderingFailed.push(handler);\r\n    }\r\n\r\n    getFramesPerSecond() {\r\n        return this.#framesCounter.getValue();\r\n    }\r\n\r\n    getIterationsPerSecond() {\r\n        return this.#iterationsCounter.getValue();\r\n    }\r\n\r\n    getWidth() {\r\n        return this.#width;\r\n    }\r\n\r\n    getHeight() {\r\n        return this.#height;\r\n    }\r\n\r\n    getChunkSize() {\r\n        return 16;\r\n    }\r\n\r\n    /**\r\n     * @returns {Snapshot}\r\n     */\r\n    createSnapshot() {\r\n        let metadata = new SnapshotMetadata();\r\n        metadata.formatVersion = SnapshotMetadata.CURRENT_FORMAT_VERSION;\r\n        metadata.created = new Date().getTime();\r\n        metadata.width = this.#width;\r\n        metadata.height = this.#height;\r\n        metadata.random = this.#random.getState();\r\n        metadata.iteration = this.#processor.getIteration();\r\n        metadata.fallThroughEnabled = this.#processor.isFallThroughEnabled();\r\n        metadata.erasingEnabled = this.#processor.isErasingEnabled();\r\n\r\n        let snapshot = new Snapshot();\r\n        snapshot.metadata = metadata;\r\n        snapshot.dataHeads = this.#elementArea.getDataHeads();\r\n        snapshot.dataTails = this.#elementArea.getDataTails();\r\n        snapshot.serializedEntities = this.#entityManager.serializeEntities();\r\n        return snapshot;\r\n    }\r\n\r\n    debugElementAt(x, y) {\r\n        if (!this.#elementArea.isValidPosition(x, y)) {\r\n            return 'Out of bounds';\r\n        }\r\n\r\n        const elementHead = this.#elementArea.getElementHead(x, y);\r\n        const elementTail = this.#elementArea.getElementTail(x, y);\r\n\r\n        function toHex(n) {\r\n            let t = n.toString(16).padStart(8, '0');\r\n            return '0x' + t;\r\n        }\r\n        let hex = toHex(elementHead) + ' ' + toHex(elementTail);\r\n\r\n        const json = {\r\n            type: {\r\n                class: ElementHead.getTypeClass(elementHead),\r\n            },\r\n            behaviour: {\r\n                type: ElementHead.getBehaviour(elementHead),\r\n                special: ElementHead.getSpecial(elementHead)\r\n            },\r\n            heatModIndex: ElementHead.getHeatModIndex(elementHead),\r\n            temperature: ElementHead.getTemperature(elementHead),\r\n            color: [\r\n                ElementTail.getColorRed(elementTail),\r\n                ElementTail.getColorGreen(elementTail),\r\n                ElementTail.getColorBlue(elementTail)\r\n            ],\r\n            blurType: ElementTail.getBlurType(elementTail),\r\n            burntLevel: ElementTail.getBurntLevel(elementTail),\r\n            heatEffect: ElementTail.getHeatEffect(elementTail)\r\n        };\r\n\r\n        if (json.type.class === ElementHead.TYPE_STATIC) {\r\n            json.type.neighbourhood = ElementHead.getTypeModifierSolidNeighbourhoodType(elementHead);\r\n            json.type.body = ElementHead.getTypeModifierSolidBodyId(elementHead);\r\n        }\r\n\r\n        let structure = JSON.stringify(json)\r\n                .replaceAll('\"', '')\r\n                .replaceAll(',', ', ')\r\n                .replaceAll(':', '=');\r\n        structure = structure.substring(1, structure.length - 1);  // remove {}\r\n\r\n        return hex + '\\n' + structure;\r\n    }\r\n}\r\n","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\n/**\r\n * @interface\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-05-08\r\n */\r\nexport default class Scene {\r\n\r\n    /**\r\n     * @returns [width: number, height: number]\r\n     */\r\n    countSize(prefWidth, prefHeight) {\r\n        throw 'Not implemented';\r\n    }\r\n\r\n    /**\r\n     * @param prefWidth {number}\r\n     * @param prefHeight {number}\r\n     * @param defaults {GameDefaults}\r\n     * @param context {CanvasRenderingContext2D|WebGLRenderingContext}\r\n     * @param rendererInitializer {RendererInitializer}\r\n     * @returns Promise<SandGame>\r\n     */\r\n    createSandGame(prefWidth, prefHeight, defaults, context, rendererInitializer) {\r\n        throw 'Not implemented';\r\n    }\r\n\r\n    /**\r\n     * @param prefWidth\r\n     * @param prefHeight\r\n     * @param defaultElement\r\n     * @returns ElementArea\r\n     */\r\n    createElementArea(prefWidth, prefHeight, defaultElement) {\r\n        throw 'Not implemented';\r\n    }\r\n\r\n    /**\r\n     * Creates entities in serialized state.\r\n     * It may not be supported, but it doesn't mean that there are none - they man be generated in createSandGame.\r\n     *\r\n     * @returns {object[]}\r\n     */\r\n    createEntities() {\r\n        return null;\r\n    }\r\n\r\n    executeOnOpened(sandGame) {\r\n        // no action by default\r\n    }\r\n}\r\n","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport Scene from \"./Scene.js\";\r\nimport SandGame from \"../SandGame.js\";\r\nimport ElementArea from \"../ElementArea.js\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-04-20\r\n */\r\nexport default class SceneImplTmpResize extends Scene {\r\n\r\n    /**\r\n     * @type Snapshot\r\n     */\r\n    #snapshot;\r\n\r\n    constructor(snapshot) {\r\n        super();\r\n        this.#snapshot = snapshot;\r\n    }\r\n\r\n    countSize(prefWidth, prefHeight) {\r\n        return [prefWidth, prefHeight];\r\n    }\r\n\r\n    async createSandGame(prefWidth, prefHeight, defaults, context, rendererInitializer) {\r\n        const oldWidth = this.#snapshot.metadata.width;\r\n        const oldHeight = this.#snapshot.metadata.height;\r\n        const oldMetadata = this.#snapshot.metadata;\r\n        const oldElementArea = ElementArea.from(oldWidth, oldHeight, this.#snapshot.dataHeads, this.#snapshot.dataTails);\r\n        const oldSerializedEntities = this.#snapshot.serializedEntities;\r\n\r\n        const newElementArea = this.createElementArea(prefWidth, prefHeight, defaults.getDefaultElement());\r\n        const newSandGame = new SandGame(newElementArea, [], oldMetadata, defaults, context, rendererInitializer);\r\n\r\n        let offsetY;\r\n        if (prefHeight === oldHeight) {\r\n            offsetY = 0;\r\n        } else if (prefHeight > oldHeight) {\r\n            offsetY = prefHeight - oldHeight;\r\n        } else {\r\n            offsetY = -(oldHeight - prefHeight);\r\n        }\r\n\r\n        // copy elements\r\n        newSandGame.graphics().insertElementArea(oldElementArea, 0, offsetY);\r\n\r\n        // copy entities\r\n        for (let serializedEntity of oldSerializedEntities) {\r\n            // map entity position\r\n            const serializedClone = Object.assign({}, serializedEntity);\r\n            if (offsetY !== 0) {\r\n                if (typeof serializedClone.y === 'number') {\r\n                    serializedClone.y += offsetY;\r\n                }\r\n            }\r\n            newSandGame.entities().insertEntity(serializedClone);\r\n        }\r\n\r\n        return newSandGame;\r\n    }\r\n\r\n    createElementArea(prefWidth, prefHeight, defaultElement) {\r\n        return ElementArea.create(prefWidth, prefHeight, defaultElement);\r\n    }\r\n}\r\n","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport Tool from \"../core/tool/Tool.js\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-01-15\r\n */\r\nexport default class ServiceToolManager {\r\n\r\n    #primaryTool;\r\n    #secondaryTool;\r\n    #tertiaryTool;\r\n\r\n    /** @type function(Tool)[] */\r\n    #onPrimaryToolChanged = [];\r\n\r\n\r\n    /** @type boolean */\r\n    #inputDisabled;\r\n    /** @type function(boolean)[] */\r\n    #onInputDisabledChanged = [];\r\n\r\n    constructor(primaryTool, secondaryTool, tertiaryTool) {\r\n        this.#primaryTool = primaryTool;\r\n        this.#secondaryTool = secondaryTool;\r\n        this.#tertiaryTool = tertiaryTool;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param tool {Tool}\r\n     * @returns void\r\n     */\r\n    setPrimaryTool(tool) {\r\n        this.#primaryTool = tool;\r\n        for (let handler of this.#onPrimaryToolChanged) {\r\n            handler(tool);\r\n        }\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param tool {Tool}\r\n     * @returns void\r\n     */\r\n    setSecondaryTool(tool) {\r\n        this.#secondaryTool = tool;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param tool {Tool}\r\n     * @returns void\r\n     */\r\n    setTertiaryTool(tool) {\r\n        this.#tertiaryTool = tool;\r\n    }\r\n\r\n    /**\r\n     * @returns {Tool}\r\n     */\r\n    getPrimaryTool() {\r\n        return this.#primaryTool;\r\n    }\r\n\r\n    /**\r\n     * @returns {Tool}\r\n     */\r\n    getSecondaryTool() {\r\n        return this.#secondaryTool;\r\n    }\r\n\r\n    /**\r\n     * @returns {Tool}\r\n     */\r\n    getTertiaryTool() {\r\n        return this.#tertiaryTool;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param handler {function(Tool)}\r\n     */\r\n    addOnPrimaryToolChanged(handler) {\r\n        this.#onPrimaryToolChanged.push(handler);\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @returns {boolean}\r\n     */\r\n    isInputDisabled() {\r\n        return this.#inputDisabled;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param handler {function(boolean)}\r\n     */\r\n    addOnInputDisabledChanged(handler) {\r\n        this.#onInputDisabledChanged.push(handler);\r\n    }\r\n\r\n    setInputDisabled(disabled) {\r\n        if (this.#inputDisabled !== disabled) {\r\n            this.#inputDisabled = disabled;\r\n            for (let handler of this.#onInputDisabledChanged) {\r\n                handler(disabled);\r\n            }\r\n        }\r\n    }\r\n\r\n    createRevertAction() {\r\n        const oldPrimary = this.getPrimaryTool();\r\n        const oldSecondary = this.getSecondaryTool();\r\n        const oldTertiary = this.getTertiaryTool();\r\n        return () => {\r\n            this.setPrimaryTool(oldPrimary);\r\n            this.setSecondaryTool(oldSecondary);\r\n            this.setTertiaryTool(oldTertiary);\r\n        };\r\n    }\r\n}\r\n","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport Scene from \"./Scene.js\";\r\nimport SandGame from \"../SandGame\";\r\nimport ElementArea from \"../ElementArea.js\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-04-20\r\n */\r\nexport default class SceneImplSnapshot extends Scene {\r\n\r\n    /**\r\n     * @type Snapshot\r\n     */\r\n    #snapshot;\r\n\r\n    /**\r\n     *\r\n     * @param snapshot {Snapshot}\r\n     */\r\n    constructor(snapshot) {\r\n        super();\r\n        this.#snapshot = snapshot;\r\n    }\r\n\r\n    countSize(prefWidth, prefHeight) {\r\n        return [this.#snapshot.metadata.width, this.#snapshot.metadata.height];\r\n    }\r\n\r\n    async createSandGame(prefWidth, prefHeight, defaults, context, rendererInitializer) {\r\n        const elementArea = this.createElementArea(prefWidth, prefHeight, defaults.getDefaultElement());\r\n        const serializedEntities = this.createEntities();\r\n        const metadata = this.#snapshot.metadata;\r\n        return new SandGame(elementArea, serializedEntities, metadata, defaults, context, rendererInitializer);\r\n    }\r\n\r\n    createElementArea(prefWidth, prefHeight, defaultElement) {\r\n        return ElementArea.from(\r\n                this.#snapshot.metadata.width,\r\n                this.#snapshot.metadata.height,\r\n                this.#snapshot.dataHeads,\r\n                this.#snapshot.dataTails);\r\n    }\r\n\r\n    createEntities() {\r\n        return this.#snapshot.serializedEntities;\r\n    }\r\n}\r\n","// DEFLATE is a complex format; to read this code, you should probably check the RFC first:\n// https://tools.ietf.org/html/rfc1951\n// You may also wish to take a look at the guide I made about this program:\n// https://gist.github.com/101arrowz/253f31eb5abc3d9275ab943003ffecad\n// Some of the following code is similar to that of UZIP.js:\n// https://github.com/photopea/UZIP.js\n// However, the vast majority of the codebase has diverged from UZIP.js to increase performance and reduce bundle size.\n// Sometimes 0 will appear where -1 would be more appropriate. This is because using a uint\n// is better for memory in most engines (I *think*).\nvar ch2 = {};\nvar wk = (function (c, id, msg, transfer, cb) {\n    var w = new Worker(ch2[id] || (ch2[id] = URL.createObjectURL(new Blob([\n        c + ';addEventListener(\"error\",function(e){e=e.error;postMessage({$e$:[e.message,e.code,e.stack]})})'\n    ], { type: 'text/javascript' }))));\n    w.onmessage = function (e) {\n        var d = e.data, ed = d.$e$;\n        if (ed) {\n            var err = new Error(ed[0]);\n            err['code'] = ed[1];\n            err.stack = ed[2];\n            cb(err, null);\n        }\n        else\n            cb(null, d);\n    };\n    w.postMessage(msg, transfer);\n    return w;\n});\n\n// aliases for shorter compressed code (most minifers don't do this)\nvar u8 = Uint8Array, u16 = Uint16Array, u32 = Uint32Array;\n// fixed length extra bits\nvar fleb = new u8([0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3, 4, 4, 4, 4, 5, 5, 5, 5, 0, /* unused */ 0, 0, /* impossible */ 0]);\n// fixed distance extra bits\n// see fleb note\nvar fdeb = new u8([0, 0, 0, 0, 1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6, 7, 7, 8, 8, 9, 9, 10, 10, 11, 11, 12, 12, 13, 13, /* unused */ 0, 0]);\n// code length index map\nvar clim = new u8([16, 17, 18, 0, 8, 7, 9, 6, 10, 5, 11, 4, 12, 3, 13, 2, 14, 1, 15]);\n// get base, reverse index map from extra bits\nvar freb = function (eb, start) {\n    var b = new u16(31);\n    for (var i = 0; i < 31; ++i) {\n        b[i] = start += 1 << eb[i - 1];\n    }\n    // numbers here are at max 18 bits\n    var r = new u32(b[30]);\n    for (var i = 1; i < 30; ++i) {\n        for (var j = b[i]; j < b[i + 1]; ++j) {\n            r[j] = ((j - b[i]) << 5) | i;\n        }\n    }\n    return [b, r];\n};\nvar _a = freb(fleb, 2), fl = _a[0], revfl = _a[1];\n// we can ignore the fact that the other numbers are wrong; they never happen anyway\nfl[28] = 258, revfl[258] = 28;\nvar _b = freb(fdeb, 0), fd = _b[0], revfd = _b[1];\n// map of value to reverse (assuming 16 bits)\nvar rev = new u16(32768);\nfor (var i = 0; i < 32768; ++i) {\n    // reverse table algorithm from SO\n    var x = ((i & 0xAAAA) >>> 1) | ((i & 0x5555) << 1);\n    x = ((x & 0xCCCC) >>> 2) | ((x & 0x3333) << 2);\n    x = ((x & 0xF0F0) >>> 4) | ((x & 0x0F0F) << 4);\n    rev[i] = (((x & 0xFF00) >>> 8) | ((x & 0x00FF) << 8)) >>> 1;\n}\n// create huffman tree from u8 \"map\": index -> code length for code index\n// mb (max bits) must be at most 15\n// TODO: optimize/split up?\nvar hMap = (function (cd, mb, r) {\n    var s = cd.length;\n    // index\n    var i = 0;\n    // u16 \"map\": index -> # of codes with bit length = index\n    var l = new u16(mb);\n    // length of cd must be 288 (total # of codes)\n    for (; i < s; ++i) {\n        if (cd[i])\n            ++l[cd[i] - 1];\n    }\n    // u16 \"map\": index -> minimum code for bit length = index\n    var le = new u16(mb);\n    for (i = 0; i < mb; ++i) {\n        le[i] = (le[i - 1] + l[i - 1]) << 1;\n    }\n    var co;\n    if (r) {\n        // u16 \"map\": index -> number of actual bits, symbol for code\n        co = new u16(1 << mb);\n        // bits to remove for reverser\n        var rvb = 15 - mb;\n        for (i = 0; i < s; ++i) {\n            // ignore 0 lengths\n            if (cd[i]) {\n                // num encoding both symbol and bits read\n                var sv = (i << 4) | cd[i];\n                // free bits\n                var r_1 = mb - cd[i];\n                // start value\n                var v = le[cd[i] - 1]++ << r_1;\n                // m is end value\n                for (var m = v | ((1 << r_1) - 1); v <= m; ++v) {\n                    // every 16 bit value starting with the code yields the same result\n                    co[rev[v] >>> rvb] = sv;\n                }\n            }\n        }\n    }\n    else {\n        co = new u16(s);\n        for (i = 0; i < s; ++i) {\n            if (cd[i]) {\n                co[i] = rev[le[cd[i] - 1]++] >>> (15 - cd[i]);\n            }\n        }\n    }\n    return co;\n});\n// fixed length tree\nvar flt = new u8(288);\nfor (var i = 0; i < 144; ++i)\n    flt[i] = 8;\nfor (var i = 144; i < 256; ++i)\n    flt[i] = 9;\nfor (var i = 256; i < 280; ++i)\n    flt[i] = 7;\nfor (var i = 280; i < 288; ++i)\n    flt[i] = 8;\n// fixed distance tree\nvar fdt = new u8(32);\nfor (var i = 0; i < 32; ++i)\n    fdt[i] = 5;\n// fixed length map\nvar flm = /*#__PURE__*/ hMap(flt, 9, 0), flrm = /*#__PURE__*/ hMap(flt, 9, 1);\n// fixed distance map\nvar fdm = /*#__PURE__*/ hMap(fdt, 5, 0), fdrm = /*#__PURE__*/ hMap(fdt, 5, 1);\n// find max of array\nvar max = function (a) {\n    var m = a[0];\n    for (var i = 1; i < a.length; ++i) {\n        if (a[i] > m)\n            m = a[i];\n    }\n    return m;\n};\n// read d, starting at bit p and mask with m\nvar bits = function (d, p, m) {\n    var o = (p / 8) | 0;\n    return ((d[o] | (d[o + 1] << 8)) >> (p & 7)) & m;\n};\n// read d, starting at bit p continuing for at least 16 bits\nvar bits16 = function (d, p) {\n    var o = (p / 8) | 0;\n    return ((d[o] | (d[o + 1] << 8) | (d[o + 2] << 16)) >> (p & 7));\n};\n// get end of byte\nvar shft = function (p) { return ((p + 7) / 8) | 0; };\n// typed array slice - allows garbage collector to free original reference,\n// while being more compatible than .slice\nvar slc = function (v, s, e) {\n    if (s == null || s < 0)\n        s = 0;\n    if (e == null || e > v.length)\n        e = v.length;\n    // can't use .constructor in case user-supplied\n    var n = new (v.BYTES_PER_ELEMENT == 2 ? u16 : v.BYTES_PER_ELEMENT == 4 ? u32 : u8)(e - s);\n    n.set(v.subarray(s, e));\n    return n;\n};\n/**\n * Codes for errors generated within this library\n */\nexport var FlateErrorCode = {\n    UnexpectedEOF: 0,\n    InvalidBlockType: 1,\n    InvalidLengthLiteral: 2,\n    InvalidDistance: 3,\n    StreamFinished: 4,\n    NoStreamHandler: 5,\n    InvalidHeader: 6,\n    NoCallback: 7,\n    InvalidUTF8: 8,\n    ExtraFieldTooLong: 9,\n    InvalidDate: 10,\n    FilenameTooLong: 11,\n    StreamFinishing: 12,\n    InvalidZipData: 13,\n    UnknownCompressionMethod: 14\n};\n// error codes\nvar ec = [\n    'unexpected EOF',\n    'invalid block type',\n    'invalid length/literal',\n    'invalid distance',\n    'stream finished',\n    'no stream handler',\n    ,\n    'no callback',\n    'invalid UTF-8 data',\n    'extra field too long',\n    'date not in range 1980-2099',\n    'filename too long',\n    'stream finishing',\n    'invalid zip data'\n    // determined by unknown compression method\n];\n;\nvar err = function (ind, msg, nt) {\n    var e = new Error(msg || ec[ind]);\n    e.code = ind;\n    if (Error.captureStackTrace)\n        Error.captureStackTrace(e, err);\n    if (!nt)\n        throw e;\n    return e;\n};\n// expands raw DEFLATE data\nvar inflt = function (dat, buf, st) {\n    // source length\n    var sl = dat.length;\n    if (!sl || (st && st.f && !st.l))\n        return buf || new u8(0);\n    // have to estimate size\n    var noBuf = !buf || st;\n    // no state\n    var noSt = !st || st.i;\n    if (!st)\n        st = {};\n    // Assumes roughly 33% compression ratio average\n    if (!buf)\n        buf = new u8(sl * 3);\n    // ensure buffer can fit at least l elements\n    var cbuf = function (l) {\n        var bl = buf.length;\n        // need to increase size to fit\n        if (l > bl) {\n            // Double or set to necessary, whichever is greater\n            var nbuf = new u8(Math.max(bl * 2, l));\n            nbuf.set(buf);\n            buf = nbuf;\n        }\n    };\n    //  last chunk         bitpos           bytes\n    var final = st.f || 0, pos = st.p || 0, bt = st.b || 0, lm = st.l, dm = st.d, lbt = st.m, dbt = st.n;\n    // total bits\n    var tbts = sl * 8;\n    do {\n        if (!lm) {\n            // BFINAL - this is only 1 when last chunk is next\n            final = bits(dat, pos, 1);\n            // type: 0 = no compression, 1 = fixed huffman, 2 = dynamic huffman\n            var type = bits(dat, pos + 1, 3);\n            pos += 3;\n            if (!type) {\n                // go to end of byte boundary\n                var s = shft(pos) + 4, l = dat[s - 4] | (dat[s - 3] << 8), t = s + l;\n                if (t > sl) {\n                    if (noSt)\n                        err(0);\n                    break;\n                }\n                // ensure size\n                if (noBuf)\n                    cbuf(bt + l);\n                // Copy over uncompressed data\n                buf.set(dat.subarray(s, t), bt);\n                // Get new bitpos, update byte count\n                st.b = bt += l, st.p = pos = t * 8, st.f = final;\n                continue;\n            }\n            else if (type == 1)\n                lm = flrm, dm = fdrm, lbt = 9, dbt = 5;\n            else if (type == 2) {\n                //  literal                            lengths\n                var hLit = bits(dat, pos, 31) + 257, hcLen = bits(dat, pos + 10, 15) + 4;\n                var tl = hLit + bits(dat, pos + 5, 31) + 1;\n                pos += 14;\n                // length+distance tree\n                var ldt = new u8(tl);\n                // code length tree\n                var clt = new u8(19);\n                for (var i = 0; i < hcLen; ++i) {\n                    // use index map to get real code\n                    clt[clim[i]] = bits(dat, pos + i * 3, 7);\n                }\n                pos += hcLen * 3;\n                // code lengths bits\n                var clb = max(clt), clbmsk = (1 << clb) - 1;\n                // code lengths map\n                var clm = hMap(clt, clb, 1);\n                for (var i = 0; i < tl;) {\n                    var r = clm[bits(dat, pos, clbmsk)];\n                    // bits read\n                    pos += r & 15;\n                    // symbol\n                    var s = r >>> 4;\n                    // code length to copy\n                    if (s < 16) {\n                        ldt[i++] = s;\n                    }\n                    else {\n                        //  copy   count\n                        var c = 0, n = 0;\n                        if (s == 16)\n                            n = 3 + bits(dat, pos, 3), pos += 2, c = ldt[i - 1];\n                        else if (s == 17)\n                            n = 3 + bits(dat, pos, 7), pos += 3;\n                        else if (s == 18)\n                            n = 11 + bits(dat, pos, 127), pos += 7;\n                        while (n--)\n                            ldt[i++] = c;\n                    }\n                }\n                //    length tree                 distance tree\n                var lt = ldt.subarray(0, hLit), dt = ldt.subarray(hLit);\n                // max length bits\n                lbt = max(lt);\n                // max dist bits\n                dbt = max(dt);\n                lm = hMap(lt, lbt, 1);\n                dm = hMap(dt, dbt, 1);\n            }\n            else\n                err(1);\n            if (pos > tbts) {\n                if (noSt)\n                    err(0);\n                break;\n            }\n        }\n        // Make sure the buffer can hold this + the largest possible addition\n        // Maximum chunk size (practically, theoretically infinite) is 2^17;\n        if (noBuf)\n            cbuf(bt + 131072);\n        var lms = (1 << lbt) - 1, dms = (1 << dbt) - 1;\n        var lpos = pos;\n        for (;; lpos = pos) {\n            // bits read, code\n            var c = lm[bits16(dat, pos) & lms], sym = c >>> 4;\n            pos += c & 15;\n            if (pos > tbts) {\n                if (noSt)\n                    err(0);\n                break;\n            }\n            if (!c)\n                err(2);\n            if (sym < 256)\n                buf[bt++] = sym;\n            else if (sym == 256) {\n                lpos = pos, lm = null;\n                break;\n            }\n            else {\n                var add = sym - 254;\n                // no extra bits needed if less\n                if (sym > 264) {\n                    // index\n                    var i = sym - 257, b = fleb[i];\n                    add = bits(dat, pos, (1 << b) - 1) + fl[i];\n                    pos += b;\n                }\n                // dist\n                var d = dm[bits16(dat, pos) & dms], dsym = d >>> 4;\n                if (!d)\n                    err(3);\n                pos += d & 15;\n                var dt = fd[dsym];\n                if (dsym > 3) {\n                    var b = fdeb[dsym];\n                    dt += bits16(dat, pos) & ((1 << b) - 1), pos += b;\n                }\n                if (pos > tbts) {\n                    if (noSt)\n                        err(0);\n                    break;\n                }\n                if (noBuf)\n                    cbuf(bt + 131072);\n                var end = bt + add;\n                for (; bt < end; bt += 4) {\n                    buf[bt] = buf[bt - dt];\n                    buf[bt + 1] = buf[bt + 1 - dt];\n                    buf[bt + 2] = buf[bt + 2 - dt];\n                    buf[bt + 3] = buf[bt + 3 - dt];\n                }\n                bt = end;\n            }\n        }\n        st.l = lm, st.p = lpos, st.b = bt, st.f = final;\n        if (lm)\n            final = 1, st.m = lbt, st.d = dm, st.n = dbt;\n    } while (!final);\n    return bt == buf.length ? buf : slc(buf, 0, bt);\n};\n// starting at p, write the minimum number of bits that can hold v to d\nvar wbits = function (d, p, v) {\n    v <<= p & 7;\n    var o = (p / 8) | 0;\n    d[o] |= v;\n    d[o + 1] |= v >>> 8;\n};\n// starting at p, write the minimum number of bits (>8) that can hold v to d\nvar wbits16 = function (d, p, v) {\n    v <<= p & 7;\n    var o = (p / 8) | 0;\n    d[o] |= v;\n    d[o + 1] |= v >>> 8;\n    d[o + 2] |= v >>> 16;\n};\n// creates code lengths from a frequency table\nvar hTree = function (d, mb) {\n    // Need extra info to make a tree\n    var t = [];\n    for (var i = 0; i < d.length; ++i) {\n        if (d[i])\n            t.push({ s: i, f: d[i] });\n    }\n    var s = t.length;\n    var t2 = t.slice();\n    if (!s)\n        return [et, 0];\n    if (s == 1) {\n        var v = new u8(t[0].s + 1);\n        v[t[0].s] = 1;\n        return [v, 1];\n    }\n    t.sort(function (a, b) { return a.f - b.f; });\n    // after i2 reaches last ind, will be stopped\n    // freq must be greater than largest possible number of symbols\n    t.push({ s: -1, f: 25001 });\n    var l = t[0], r = t[1], i0 = 0, i1 = 1, i2 = 2;\n    t[0] = { s: -1, f: l.f + r.f, l: l, r: r };\n    // efficient algorithm from UZIP.js\n    // i0 is lookbehind, i2 is lookahead - after processing two low-freq\n    // symbols that combined have high freq, will start processing i2 (high-freq,\n    // non-composite) symbols instead\n    // see https://reddit.com/r/photopea/comments/ikekht/uzipjs_questions/\n    while (i1 != s - 1) {\n        l = t[t[i0].f < t[i2].f ? i0++ : i2++];\n        r = t[i0 != i1 && t[i0].f < t[i2].f ? i0++ : i2++];\n        t[i1++] = { s: -1, f: l.f + r.f, l: l, r: r };\n    }\n    var maxSym = t2[0].s;\n    for (var i = 1; i < s; ++i) {\n        if (t2[i].s > maxSym)\n            maxSym = t2[i].s;\n    }\n    // code lengths\n    var tr = new u16(maxSym + 1);\n    // max bits in tree\n    var mbt = ln(t[i1 - 1], tr, 0);\n    if (mbt > mb) {\n        // more algorithms from UZIP.js\n        // TODO: find out how this code works (debt)\n        //  ind    debt\n        var i = 0, dt = 0;\n        //    left            cost\n        var lft = mbt - mb, cst = 1 << lft;\n        t2.sort(function (a, b) { return tr[b.s] - tr[a.s] || a.f - b.f; });\n        for (; i < s; ++i) {\n            var i2_1 = t2[i].s;\n            if (tr[i2_1] > mb) {\n                dt += cst - (1 << (mbt - tr[i2_1]));\n                tr[i2_1] = mb;\n            }\n            else\n                break;\n        }\n        dt >>>= lft;\n        while (dt > 0) {\n            var i2_2 = t2[i].s;\n            if (tr[i2_2] < mb)\n                dt -= 1 << (mb - tr[i2_2]++ - 1);\n            else\n                ++i;\n        }\n        for (; i >= 0 && dt; --i) {\n            var i2_3 = t2[i].s;\n            if (tr[i2_3] == mb) {\n                --tr[i2_3];\n                ++dt;\n            }\n        }\n        mbt = mb;\n    }\n    return [new u8(tr), mbt];\n};\n// get the max length and assign length codes\nvar ln = function (n, l, d) {\n    return n.s == -1\n        ? Math.max(ln(n.l, l, d + 1), ln(n.r, l, d + 1))\n        : (l[n.s] = d);\n};\n// length codes generation\nvar lc = function (c) {\n    var s = c.length;\n    // Note that the semicolon was intentional\n    while (s && !c[--s])\n        ;\n    var cl = new u16(++s);\n    //  ind      num         streak\n    var cli = 0, cln = c[0], cls = 1;\n    var w = function (v) { cl[cli++] = v; };\n    for (var i = 1; i <= s; ++i) {\n        if (c[i] == cln && i != s)\n            ++cls;\n        else {\n            if (!cln && cls > 2) {\n                for (; cls > 138; cls -= 138)\n                    w(32754);\n                if (cls > 2) {\n                    w(cls > 10 ? ((cls - 11) << 5) | 28690 : ((cls - 3) << 5) | 12305);\n                    cls = 0;\n                }\n            }\n            else if (cls > 3) {\n                w(cln), --cls;\n                for (; cls > 6; cls -= 6)\n                    w(8304);\n                if (cls > 2)\n                    w(((cls - 3) << 5) | 8208), cls = 0;\n            }\n            while (cls--)\n                w(cln);\n            cls = 1;\n            cln = c[i];\n        }\n    }\n    return [cl.subarray(0, cli), s];\n};\n// calculate the length of output from tree, code lengths\nvar clen = function (cf, cl) {\n    var l = 0;\n    for (var i = 0; i < cl.length; ++i)\n        l += cf[i] * cl[i];\n    return l;\n};\n// writes a fixed block\n// returns the new bit pos\nvar wfblk = function (out, pos, dat) {\n    // no need to write 00 as type: TypedArray defaults to 0\n    var s = dat.length;\n    var o = shft(pos + 2);\n    out[o] = s & 255;\n    out[o + 1] = s >>> 8;\n    out[o + 2] = out[o] ^ 255;\n    out[o + 3] = out[o + 1] ^ 255;\n    for (var i = 0; i < s; ++i)\n        out[o + i + 4] = dat[i];\n    return (o + 4 + s) * 8;\n};\n// writes a block\nvar wblk = function (dat, out, final, syms, lf, df, eb, li, bs, bl, p) {\n    wbits(out, p++, final);\n    ++lf[256];\n    var _a = hTree(lf, 15), dlt = _a[0], mlb = _a[1];\n    var _b = hTree(df, 15), ddt = _b[0], mdb = _b[1];\n    var _c = lc(dlt), lclt = _c[0], nlc = _c[1];\n    var _d = lc(ddt), lcdt = _d[0], ndc = _d[1];\n    var lcfreq = new u16(19);\n    for (var i = 0; i < lclt.length; ++i)\n        lcfreq[lclt[i] & 31]++;\n    for (var i = 0; i < lcdt.length; ++i)\n        lcfreq[lcdt[i] & 31]++;\n    var _e = hTree(lcfreq, 7), lct = _e[0], mlcb = _e[1];\n    var nlcc = 19;\n    for (; nlcc > 4 && !lct[clim[nlcc - 1]]; --nlcc)\n        ;\n    var flen = (bl + 5) << 3;\n    var ftlen = clen(lf, flt) + clen(df, fdt) + eb;\n    var dtlen = clen(lf, dlt) + clen(df, ddt) + eb + 14 + 3 * nlcc + clen(lcfreq, lct) + (2 * lcfreq[16] + 3 * lcfreq[17] + 7 * lcfreq[18]);\n    if (flen <= ftlen && flen <= dtlen)\n        return wfblk(out, p, dat.subarray(bs, bs + bl));\n    var lm, ll, dm, dl;\n    wbits(out, p, 1 + (dtlen < ftlen)), p += 2;\n    if (dtlen < ftlen) {\n        lm = hMap(dlt, mlb, 0), ll = dlt, dm = hMap(ddt, mdb, 0), dl = ddt;\n        var llm = hMap(lct, mlcb, 0);\n        wbits(out, p, nlc - 257);\n        wbits(out, p + 5, ndc - 1);\n        wbits(out, p + 10, nlcc - 4);\n        p += 14;\n        for (var i = 0; i < nlcc; ++i)\n            wbits(out, p + 3 * i, lct[clim[i]]);\n        p += 3 * nlcc;\n        var lcts = [lclt, lcdt];\n        for (var it = 0; it < 2; ++it) {\n            var clct = lcts[it];\n            for (var i = 0; i < clct.length; ++i) {\n                var len = clct[i] & 31;\n                wbits(out, p, llm[len]), p += lct[len];\n                if (len > 15)\n                    wbits(out, p, (clct[i] >>> 5) & 127), p += clct[i] >>> 12;\n            }\n        }\n    }\n    else {\n        lm = flm, ll = flt, dm = fdm, dl = fdt;\n    }\n    for (var i = 0; i < li; ++i) {\n        if (syms[i] > 255) {\n            var len = (syms[i] >>> 18) & 31;\n            wbits16(out, p, lm[len + 257]), p += ll[len + 257];\n            if (len > 7)\n                wbits(out, p, (syms[i] >>> 23) & 31), p += fleb[len];\n            var dst = syms[i] & 31;\n            wbits16(out, p, dm[dst]), p += dl[dst];\n            if (dst > 3)\n                wbits16(out, p, (syms[i] >>> 5) & 8191), p += fdeb[dst];\n        }\n        else {\n            wbits16(out, p, lm[syms[i]]), p += ll[syms[i]];\n        }\n    }\n    wbits16(out, p, lm[256]);\n    return p + ll[256];\n};\n// deflate options (nice << 13) | chain\nvar deo = /*#__PURE__*/ new u32([65540, 131080, 131088, 131104, 262176, 1048704, 1048832, 2114560, 2117632]);\n// empty\nvar et = /*#__PURE__*/ new u8(0);\n// compresses data into a raw DEFLATE buffer\nvar dflt = function (dat, lvl, plvl, pre, post, lst) {\n    var s = dat.length;\n    var o = new u8(pre + s + 5 * (1 + Math.ceil(s / 7000)) + post);\n    // writing to this writes to the output buffer\n    var w = o.subarray(pre, o.length - post);\n    var pos = 0;\n    if (!lvl || s < 8) {\n        for (var i = 0; i <= s; i += 65535) {\n            // end\n            var e = i + 65535;\n            if (e >= s) {\n                // write final block\n                w[pos >> 3] = lst;\n            }\n            pos = wfblk(w, pos + 1, dat.subarray(i, e));\n        }\n    }\n    else {\n        var opt = deo[lvl - 1];\n        var n = opt >>> 13, c = opt & 8191;\n        var msk_1 = (1 << plvl) - 1;\n        //    prev 2-byte val map    curr 2-byte val map\n        var prev = new u16(32768), head = new u16(msk_1 + 1);\n        var bs1_1 = Math.ceil(plvl / 3), bs2_1 = 2 * bs1_1;\n        var hsh = function (i) { return (dat[i] ^ (dat[i + 1] << bs1_1) ^ (dat[i + 2] << bs2_1)) & msk_1; };\n        // 24576 is an arbitrary number of maximum symbols per block\n        // 424 buffer for last block\n        var syms = new u32(25000);\n        // length/literal freq   distance freq\n        var lf = new u16(288), df = new u16(32);\n        //  l/lcnt  exbits  index  l/lind  waitdx  bitpos\n        var lc_1 = 0, eb = 0, i = 0, li = 0, wi = 0, bs = 0;\n        for (; i < s; ++i) {\n            // hash value\n            // deopt when i > s - 3 - at end, deopt acceptable\n            var hv = hsh(i);\n            // index mod 32768    previous index mod\n            var imod = i & 32767, pimod = head[hv];\n            prev[imod] = pimod;\n            head[hv] = imod;\n            // We always should modify head and prev, but only add symbols if\n            // this data is not yet processed (\"wait\" for wait index)\n            if (wi <= i) {\n                // bytes remaining\n                var rem = s - i;\n                if ((lc_1 > 7000 || li > 24576) && rem > 423) {\n                    pos = wblk(dat, w, 0, syms, lf, df, eb, li, bs, i - bs, pos);\n                    li = lc_1 = eb = 0, bs = i;\n                    for (var j = 0; j < 286; ++j)\n                        lf[j] = 0;\n                    for (var j = 0; j < 30; ++j)\n                        df[j] = 0;\n                }\n                //  len    dist   chain\n                var l = 2, d = 0, ch_1 = c, dif = (imod - pimod) & 32767;\n                if (rem > 2 && hv == hsh(i - dif)) {\n                    var maxn = Math.min(n, rem) - 1;\n                    var maxd = Math.min(32767, i);\n                    // max possible length\n                    // not capped at dif because decompressors implement \"rolling\" index population\n                    var ml = Math.min(258, rem);\n                    while (dif <= maxd && --ch_1 && imod != pimod) {\n                        if (dat[i + l] == dat[i + l - dif]) {\n                            var nl = 0;\n                            for (; nl < ml && dat[i + nl] == dat[i + nl - dif]; ++nl)\n                                ;\n                            if (nl > l) {\n                                l = nl, d = dif;\n                                // break out early when we reach \"nice\" (we are satisfied enough)\n                                if (nl > maxn)\n                                    break;\n                                // now, find the rarest 2-byte sequence within this\n                                // length of literals and search for that instead.\n                                // Much faster than just using the start\n                                var mmd = Math.min(dif, nl - 2);\n                                var md = 0;\n                                for (var j = 0; j < mmd; ++j) {\n                                    var ti = (i - dif + j + 32768) & 32767;\n                                    var pti = prev[ti];\n                                    var cd = (ti - pti + 32768) & 32767;\n                                    if (cd > md)\n                                        md = cd, pimod = ti;\n                                }\n                            }\n                        }\n                        // check the previous match\n                        imod = pimod, pimod = prev[imod];\n                        dif += (imod - pimod + 32768) & 32767;\n                    }\n                }\n                // d will be nonzero only when a match was found\n                if (d) {\n                    // store both dist and len data in one Uint32\n                    // Make sure this is recognized as a len/dist with 28th bit (2^28)\n                    syms[li++] = 268435456 | (revfl[l] << 18) | revfd[d];\n                    var lin = revfl[l] & 31, din = revfd[d] & 31;\n                    eb += fleb[lin] + fdeb[din];\n                    ++lf[257 + lin];\n                    ++df[din];\n                    wi = i + l;\n                    ++lc_1;\n                }\n                else {\n                    syms[li++] = dat[i];\n                    ++lf[dat[i]];\n                }\n            }\n        }\n        pos = wblk(dat, w, lst, syms, lf, df, eb, li, bs, i - bs, pos);\n        // this is the easiest way to avoid needing to maintain state\n        if (!lst && pos & 7)\n            pos = wfblk(w, pos + 1, et);\n    }\n    return slc(o, 0, pre + shft(pos) + post);\n};\n// CRC32 table\nvar crct = /*#__PURE__*/ (function () {\n    var t = new Int32Array(256);\n    for (var i = 0; i < 256; ++i) {\n        var c = i, k = 9;\n        while (--k)\n            c = ((c & 1) && -306674912) ^ (c >>> 1);\n        t[i] = c;\n    }\n    return t;\n})();\n// CRC32\nvar crc = function () {\n    var c = -1;\n    return {\n        p: function (d) {\n            // closures have awful performance\n            var cr = c;\n            for (var i = 0; i < d.length; ++i)\n                cr = crct[(cr & 255) ^ d[i]] ^ (cr >>> 8);\n            c = cr;\n        },\n        d: function () { return ~c; }\n    };\n};\n// Alder32\nvar adler = function () {\n    var a = 1, b = 0;\n    return {\n        p: function (d) {\n            // closures have awful performance\n            var n = a, m = b;\n            var l = d.length | 0;\n            for (var i = 0; i != l;) {\n                var e = Math.min(i + 2655, l);\n                for (; i < e; ++i)\n                    m += n += d[i];\n                n = (n & 65535) + 15 * (n >> 16), m = (m & 65535) + 15 * (m >> 16);\n            }\n            a = n, b = m;\n        },\n        d: function () {\n            a %= 65521, b %= 65521;\n            return (a & 255) << 24 | (a >>> 8) << 16 | (b & 255) << 8 | (b >>> 8);\n        }\n    };\n};\n;\n// deflate with opts\nvar dopt = function (dat, opt, pre, post, st) {\n    return dflt(dat, opt.level == null ? 6 : opt.level, opt.mem == null ? Math.ceil(Math.max(8, Math.min(13, Math.log(dat.length))) * 1.5) : (12 + opt.mem), pre, post, !st);\n};\n// Walmart object spread\nvar mrg = function (a, b) {\n    var o = {};\n    for (var k in a)\n        o[k] = a[k];\n    for (var k in b)\n        o[k] = b[k];\n    return o;\n};\n// worker clone\n// This is possibly the craziest part of the entire codebase, despite how simple it may seem.\n// The only parameter to this function is a closure that returns an array of variables outside of the function scope.\n// We're going to try to figure out the variable names used in the closure as strings because that is crucial for workerization.\n// We will return an object mapping of true variable name to value (basically, the current scope as a JS object).\n// The reason we can't just use the original variable names is minifiers mangling the toplevel scope.\n// This took me three weeks to figure out how to do.\nvar wcln = function (fn, fnStr, td) {\n    var dt = fn();\n    var st = fn.toString();\n    var ks = st.slice(st.indexOf('[') + 1, st.lastIndexOf(']')).replace(/\\s+/g, '').split(',');\n    for (var i = 0; i < dt.length; ++i) {\n        var v = dt[i], k = ks[i];\n        if (typeof v == 'function') {\n            fnStr += ';' + k + '=';\n            var st_1 = v.toString();\n            if (v.prototype) {\n                // for global objects\n                if (st_1.indexOf('[native code]') != -1) {\n                    var spInd = st_1.indexOf(' ', 8) + 1;\n                    fnStr += st_1.slice(spInd, st_1.indexOf('(', spInd));\n                }\n                else {\n                    fnStr += st_1;\n                    for (var t in v.prototype)\n                        fnStr += ';' + k + '.prototype.' + t + '=' + v.prototype[t].toString();\n                }\n            }\n            else\n                fnStr += st_1;\n        }\n        else\n            td[k] = v;\n    }\n    return [fnStr, td];\n};\nvar ch = [];\n// clone bufs\nvar cbfs = function (v) {\n    var tl = [];\n    for (var k in v) {\n        if (v[k].buffer) {\n            tl.push((v[k] = new v[k].constructor(v[k])).buffer);\n        }\n    }\n    return tl;\n};\n// use a worker to execute code\nvar wrkr = function (fns, init, id, cb) {\n    var _a;\n    if (!ch[id]) {\n        var fnStr = '', td_1 = {}, m = fns.length - 1;\n        for (var i = 0; i < m; ++i)\n            _a = wcln(fns[i], fnStr, td_1), fnStr = _a[0], td_1 = _a[1];\n        ch[id] = wcln(fns[m], fnStr, td_1);\n    }\n    var td = mrg({}, ch[id][1]);\n    return wk(ch[id][0] + ';onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage=' + init.toString() + '}', id, td, cbfs(td), cb);\n};\n// base async inflate fn\nvar bInflt = function () { return [u8, u16, u32, fleb, fdeb, clim, fl, fd, flrm, fdrm, rev, ec, hMap, max, bits, bits16, shft, slc, err, inflt, inflateSync, pbf, gu8]; };\nvar bDflt = function () { return [u8, u16, u32, fleb, fdeb, clim, revfl, revfd, flm, flt, fdm, fdt, rev, deo, et, hMap, wbits, wbits16, hTree, ln, lc, clen, wfblk, wblk, shft, slc, dflt, dopt, deflateSync, pbf]; };\n// gzip extra\nvar gze = function () { return [gzh, gzhl, wbytes, crc, crct]; };\n// gunzip extra\nvar guze = function () { return [gzs, gzl]; };\n// zlib extra\nvar zle = function () { return [zlh, wbytes, adler]; };\n// unzlib extra\nvar zule = function () { return [zlv]; };\n// post buf\nvar pbf = function (msg) { return postMessage(msg, [msg.buffer]); };\n// get u8\nvar gu8 = function (o) { return o && o.size && new u8(o.size); };\n// async helper\nvar cbify = function (dat, opts, fns, init, id, cb) {\n    var w = wrkr(fns, init, id, function (err, dat) {\n        w.terminate();\n        cb(err, dat);\n    });\n    w.postMessage([dat, opts], opts.consume ? [dat.buffer] : []);\n    return function () { w.terminate(); };\n};\n// auto stream\nvar astrm = function (strm) {\n    strm.ondata = function (dat, final) { return postMessage([dat, final], [dat.buffer]); };\n    return function (ev) { return strm.push(ev.data[0], ev.data[1]); };\n};\n// async stream attach\nvar astrmify = function (fns, strm, opts, init, id) {\n    var t;\n    var w = wrkr(fns, init, id, function (err, dat) {\n        if (err)\n            w.terminate(), strm.ondata.call(strm, err);\n        else {\n            if (dat[1])\n                w.terminate();\n            strm.ondata.call(strm, err, dat[0], dat[1]);\n        }\n    });\n    w.postMessage(opts);\n    strm.push = function (d, f) {\n        if (!strm.ondata)\n            err(5);\n        if (t)\n            strm.ondata(err(4, 0, 1), null, !!f);\n        w.postMessage([d, t = f], [d.buffer]);\n    };\n    strm.terminate = function () { w.terminate(); };\n};\n// read 2 bytes\nvar b2 = function (d, b) { return d[b] | (d[b + 1] << 8); };\n// read 4 bytes\nvar b4 = function (d, b) { return (d[b] | (d[b + 1] << 8) | (d[b + 2] << 16) | (d[b + 3] << 24)) >>> 0; };\nvar b8 = function (d, b) { return b4(d, b) + (b4(d, b + 4) * 4294967296); };\n// write bytes\nvar wbytes = function (d, b, v) {\n    for (; v; ++b)\n        d[b] = v, v >>>= 8;\n};\n// gzip header\nvar gzh = function (c, o) {\n    var fn = o.filename;\n    c[0] = 31, c[1] = 139, c[2] = 8, c[8] = o.level < 2 ? 4 : o.level == 9 ? 2 : 0, c[9] = 3; // assume Unix\n    if (o.mtime != 0)\n        wbytes(c, 4, Math.floor(new Date(o.mtime || Date.now()) / 1000));\n    if (fn) {\n        c[3] = 8;\n        for (var i = 0; i <= fn.length; ++i)\n            c[i + 10] = fn.charCodeAt(i);\n    }\n};\n// gzip footer: -8 to -4 = CRC, -4 to -0 is length\n// gzip start\nvar gzs = function (d) {\n    if (d[0] != 31 || d[1] != 139 || d[2] != 8)\n        err(6, 'invalid gzip data');\n    var flg = d[3];\n    var st = 10;\n    if (flg & 4)\n        st += d[10] | (d[11] << 8) + 2;\n    for (var zs = (flg >> 3 & 1) + (flg >> 4 & 1); zs > 0; zs -= !d[st++])\n        ;\n    return st + (flg & 2);\n};\n// gzip length\nvar gzl = function (d) {\n    var l = d.length;\n    return ((d[l - 4] | d[l - 3] << 8 | d[l - 2] << 16) | (d[l - 1] << 24)) >>> 0;\n};\n// gzip header length\nvar gzhl = function (o) { return 10 + ((o.filename && (o.filename.length + 1)) || 0); };\n// zlib header\nvar zlh = function (c, o) {\n    var lv = o.level, fl = lv == 0 ? 0 : lv < 6 ? 1 : lv == 9 ? 3 : 2;\n    c[0] = 120, c[1] = (fl << 6) | (fl ? (32 - 2 * fl) : 1);\n};\n// zlib valid\nvar zlv = function (d) {\n    if ((d[0] & 15) != 8 || (d[0] >>> 4) > 7 || ((d[0] << 8 | d[1]) % 31))\n        err(6, 'invalid zlib data');\n    if (d[1] & 32)\n        err(6, 'invalid zlib data: preset dictionaries not supported');\n};\nfunction AsyncCmpStrm(opts, cb) {\n    if (!cb && typeof opts == 'function')\n        cb = opts, opts = {};\n    this.ondata = cb;\n    return opts;\n}\n// zlib footer: -4 to -0 is Adler32\n/**\n * Streaming DEFLATE compression\n */\nvar Deflate = /*#__PURE__*/ (function () {\n    function Deflate(opts, cb) {\n        if (!cb && typeof opts == 'function')\n            cb = opts, opts = {};\n        this.ondata = cb;\n        this.o = opts || {};\n    }\n    Deflate.prototype.p = function (c, f) {\n        this.ondata(dopt(c, this.o, 0, 0, !f), f);\n    };\n    /**\n     * Pushes a chunk to be deflated\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Deflate.prototype.push = function (chunk, final) {\n        if (!this.ondata)\n            err(5);\n        if (this.d)\n            err(4);\n        this.d = final;\n        this.p(chunk, final || false);\n    };\n    return Deflate;\n}());\nexport { Deflate };\n/**\n * Asynchronous streaming DEFLATE compression\n */\nvar AsyncDeflate = /*#__PURE__*/ (function () {\n    function AsyncDeflate(opts, cb) {\n        astrmify([\n            bDflt,\n            function () { return [astrm, Deflate]; }\n        ], this, AsyncCmpStrm.call(this, opts, cb), function (ev) {\n            var strm = new Deflate(ev.data);\n            onmessage = astrm(strm);\n        }, 6);\n    }\n    return AsyncDeflate;\n}());\nexport { AsyncDeflate };\nexport function deflate(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        err(7);\n    return cbify(data, opts, [\n        bDflt,\n    ], function (ev) { return pbf(deflateSync(ev.data[0], ev.data[1])); }, 0, cb);\n}\n/**\n * Compresses data with DEFLATE without any wrapper\n * @param data The data to compress\n * @param opts The compression options\n * @returns The deflated version of the data\n */\nexport function deflateSync(data, opts) {\n    return dopt(data, opts || {}, 0, 0);\n}\n/**\n * Streaming DEFLATE decompression\n */\nvar Inflate = /*#__PURE__*/ (function () {\n    /**\n     * Creates an inflation stream\n     * @param cb The callback to call whenever data is inflated\n     */\n    function Inflate(cb) {\n        this.s = {};\n        this.p = new u8(0);\n        this.ondata = cb;\n    }\n    Inflate.prototype.e = function (c) {\n        if (!this.ondata)\n            err(5);\n        if (this.d)\n            err(4);\n        var l = this.p.length;\n        var n = new u8(l + c.length);\n        n.set(this.p), n.set(c, l), this.p = n;\n    };\n    Inflate.prototype.c = function (final) {\n        this.d = this.s.i = final || false;\n        var bts = this.s.b;\n        var dt = inflt(this.p, this.o, this.s);\n        this.ondata(slc(dt, bts, this.s.b), this.d);\n        this.o = slc(dt, this.s.b - 32768), this.s.b = this.o.length;\n        this.p = slc(this.p, (this.s.p / 8) | 0), this.s.p &= 7;\n    };\n    /**\n     * Pushes a chunk to be inflated\n     * @param chunk The chunk to push\n     * @param final Whether this is the final chunk\n     */\n    Inflate.prototype.push = function (chunk, final) {\n        this.e(chunk), this.c(final);\n    };\n    return Inflate;\n}());\nexport { Inflate };\n/**\n * Asynchronous streaming DEFLATE decompression\n */\nvar AsyncInflate = /*#__PURE__*/ (function () {\n    /**\n     * Creates an asynchronous inflation stream\n     * @param cb The callback to call whenever data is deflated\n     */\n    function AsyncInflate(cb) {\n        this.ondata = cb;\n        astrmify([\n            bInflt,\n            function () { return [astrm, Inflate]; }\n        ], this, 0, function () {\n            var strm = new Inflate();\n            onmessage = astrm(strm);\n        }, 7);\n    }\n    return AsyncInflate;\n}());\nexport { AsyncInflate };\nexport function inflate(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        err(7);\n    return cbify(data, opts, [\n        bInflt\n    ], function (ev) { return pbf(inflateSync(ev.data[0], gu8(ev.data[1]))); }, 1, cb);\n}\n/**\n * Expands DEFLATE data with no wrapper\n * @param data The data to decompress\n * @param out Where to write the data. Saves memory if you know the decompressed size and provide an output buffer of that length.\n * @returns The decompressed version of the data\n */\nexport function inflateSync(data, out) {\n    return inflt(data, out);\n}\n// before you yell at me for not just using extends, my reason is that TS inheritance is hard to workerize.\n/**\n * Streaming GZIP compression\n */\nvar Gzip = /*#__PURE__*/ (function () {\n    function Gzip(opts, cb) {\n        this.c = crc();\n        this.l = 0;\n        this.v = 1;\n        Deflate.call(this, opts, cb);\n    }\n    /**\n     * Pushes a chunk to be GZIPped\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Gzip.prototype.push = function (chunk, final) {\n        Deflate.prototype.push.call(this, chunk, final);\n    };\n    Gzip.prototype.p = function (c, f) {\n        this.c.p(c);\n        this.l += c.length;\n        var raw = dopt(c, this.o, this.v && gzhl(this.o), f && 8, !f);\n        if (this.v)\n            gzh(raw, this.o), this.v = 0;\n        if (f)\n            wbytes(raw, raw.length - 8, this.c.d()), wbytes(raw, raw.length - 4, this.l);\n        this.ondata(raw, f);\n    };\n    return Gzip;\n}());\nexport { Gzip };\n/**\n * Asynchronous streaming GZIP compression\n */\nvar AsyncGzip = /*#__PURE__*/ (function () {\n    function AsyncGzip(opts, cb) {\n        astrmify([\n            bDflt,\n            gze,\n            function () { return [astrm, Deflate, Gzip]; }\n        ], this, AsyncCmpStrm.call(this, opts, cb), function (ev) {\n            var strm = new Gzip(ev.data);\n            onmessage = astrm(strm);\n        }, 8);\n    }\n    return AsyncGzip;\n}());\nexport { AsyncGzip };\nexport function gzip(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        err(7);\n    return cbify(data, opts, [\n        bDflt,\n        gze,\n        function () { return [gzipSync]; }\n    ], function (ev) { return pbf(gzipSync(ev.data[0], ev.data[1])); }, 2, cb);\n}\n/**\n * Compresses data with GZIP\n * @param data The data to compress\n * @param opts The compression options\n * @returns The gzipped version of the data\n */\nexport function gzipSync(data, opts) {\n    if (!opts)\n        opts = {};\n    var c = crc(), l = data.length;\n    c.p(data);\n    var d = dopt(data, opts, gzhl(opts), 8), s = d.length;\n    return gzh(d, opts), wbytes(d, s - 8, c.d()), wbytes(d, s - 4, l), d;\n}\n/**\n * Streaming GZIP decompression\n */\nvar Gunzip = /*#__PURE__*/ (function () {\n    /**\n     * Creates a GUNZIP stream\n     * @param cb The callback to call whenever data is inflated\n     */\n    function Gunzip(cb) {\n        this.v = 1;\n        Inflate.call(this, cb);\n    }\n    /**\n     * Pushes a chunk to be GUNZIPped\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Gunzip.prototype.push = function (chunk, final) {\n        Inflate.prototype.e.call(this, chunk);\n        if (this.v) {\n            var s = this.p.length > 3 ? gzs(this.p) : 4;\n            if (s >= this.p.length && !final)\n                return;\n            this.p = this.p.subarray(s), this.v = 0;\n        }\n        if (final) {\n            if (this.p.length < 8)\n                err(6, 'invalid gzip data');\n            this.p = this.p.subarray(0, -8);\n        }\n        // necessary to prevent TS from using the closure value\n        // This allows for workerization to function correctly\n        Inflate.prototype.c.call(this, final);\n    };\n    return Gunzip;\n}());\nexport { Gunzip };\n/**\n * Asynchronous streaming GZIP decompression\n */\nvar AsyncGunzip = /*#__PURE__*/ (function () {\n    /**\n     * Creates an asynchronous GUNZIP stream\n     * @param cb The callback to call whenever data is deflated\n     */\n    function AsyncGunzip(cb) {\n        this.ondata = cb;\n        astrmify([\n            bInflt,\n            guze,\n            function () { return [astrm, Inflate, Gunzip]; }\n        ], this, 0, function () {\n            var strm = new Gunzip();\n            onmessage = astrm(strm);\n        }, 9);\n    }\n    return AsyncGunzip;\n}());\nexport { AsyncGunzip };\nexport function gunzip(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        err(7);\n    return cbify(data, opts, [\n        bInflt,\n        guze,\n        function () { return [gunzipSync]; }\n    ], function (ev) { return pbf(gunzipSync(ev.data[0])); }, 3, cb);\n}\n/**\n * Expands GZIP data\n * @param data The data to decompress\n * @param out Where to write the data. GZIP already encodes the output size, so providing this doesn't save memory.\n * @returns The decompressed version of the data\n */\nexport function gunzipSync(data, out) {\n    return inflt(data.subarray(gzs(data), -8), out || new u8(gzl(data)));\n}\n/**\n * Streaming Zlib compression\n */\nvar Zlib = /*#__PURE__*/ (function () {\n    function Zlib(opts, cb) {\n        this.c = adler();\n        this.v = 1;\n        Deflate.call(this, opts, cb);\n    }\n    /**\n     * Pushes a chunk to be zlibbed\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Zlib.prototype.push = function (chunk, final) {\n        Deflate.prototype.push.call(this, chunk, final);\n    };\n    Zlib.prototype.p = function (c, f) {\n        this.c.p(c);\n        var raw = dopt(c, this.o, this.v && 2, f && 4, !f);\n        if (this.v)\n            zlh(raw, this.o), this.v = 0;\n        if (f)\n            wbytes(raw, raw.length - 4, this.c.d());\n        this.ondata(raw, f);\n    };\n    return Zlib;\n}());\nexport { Zlib };\n/**\n * Asynchronous streaming Zlib compression\n */\nvar AsyncZlib = /*#__PURE__*/ (function () {\n    function AsyncZlib(opts, cb) {\n        astrmify([\n            bDflt,\n            zle,\n            function () { return [astrm, Deflate, Zlib]; }\n        ], this, AsyncCmpStrm.call(this, opts, cb), function (ev) {\n            var strm = new Zlib(ev.data);\n            onmessage = astrm(strm);\n        }, 10);\n    }\n    return AsyncZlib;\n}());\nexport { AsyncZlib };\nexport function zlib(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        err(7);\n    return cbify(data, opts, [\n        bDflt,\n        zle,\n        function () { return [zlibSync]; }\n    ], function (ev) { return pbf(zlibSync(ev.data[0], ev.data[1])); }, 4, cb);\n}\n/**\n * Compress data with Zlib\n * @param data The data to compress\n * @param opts The compression options\n * @returns The zlib-compressed version of the data\n */\nexport function zlibSync(data, opts) {\n    if (!opts)\n        opts = {};\n    var a = adler();\n    a.p(data);\n    var d = dopt(data, opts, 2, 4);\n    return zlh(d, opts), wbytes(d, d.length - 4, a.d()), d;\n}\n/**\n * Streaming Zlib decompression\n */\nvar Unzlib = /*#__PURE__*/ (function () {\n    /**\n     * Creates a Zlib decompression stream\n     * @param cb The callback to call whenever data is inflated\n     */\n    function Unzlib(cb) {\n        this.v = 1;\n        Inflate.call(this, cb);\n    }\n    /**\n     * Pushes a chunk to be unzlibbed\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Unzlib.prototype.push = function (chunk, final) {\n        Inflate.prototype.e.call(this, chunk);\n        if (this.v) {\n            if (this.p.length < 2 && !final)\n                return;\n            this.p = this.p.subarray(2), this.v = 0;\n        }\n        if (final) {\n            if (this.p.length < 4)\n                err(6, 'invalid zlib data');\n            this.p = this.p.subarray(0, -4);\n        }\n        // necessary to prevent TS from using the closure value\n        // This allows for workerization to function correctly\n        Inflate.prototype.c.call(this, final);\n    };\n    return Unzlib;\n}());\nexport { Unzlib };\n/**\n * Asynchronous streaming Zlib decompression\n */\nvar AsyncUnzlib = /*#__PURE__*/ (function () {\n    /**\n     * Creates an asynchronous Zlib decompression stream\n     * @param cb The callback to call whenever data is deflated\n     */\n    function AsyncUnzlib(cb) {\n        this.ondata = cb;\n        astrmify([\n            bInflt,\n            zule,\n            function () { return [astrm, Inflate, Unzlib]; }\n        ], this, 0, function () {\n            var strm = new Unzlib();\n            onmessage = astrm(strm);\n        }, 11);\n    }\n    return AsyncUnzlib;\n}());\nexport { AsyncUnzlib };\nexport function unzlib(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        err(7);\n    return cbify(data, opts, [\n        bInflt,\n        zule,\n        function () { return [unzlibSync]; }\n    ], function (ev) { return pbf(unzlibSync(ev.data[0], gu8(ev.data[1]))); }, 5, cb);\n}\n/**\n * Expands Zlib data\n * @param data The data to decompress\n * @param out Where to write the data. Saves memory if you know the decompressed size and provide an output buffer of that length.\n * @returns The decompressed version of the data\n */\nexport function unzlibSync(data, out) {\n    return inflt((zlv(data), data.subarray(2, -4)), out);\n}\n// Default algorithm for compression (used because having a known output size allows faster decompression)\nexport { gzip as compress, AsyncGzip as AsyncCompress };\n// Default algorithm for compression (used because having a known output size allows faster decompression)\nexport { gzipSync as compressSync, Gzip as Compress };\n/**\n * Streaming GZIP, Zlib, or raw DEFLATE decompression\n */\nvar Decompress = /*#__PURE__*/ (function () {\n    /**\n     * Creates a decompression stream\n     * @param cb The callback to call whenever data is decompressed\n     */\n    function Decompress(cb) {\n        this.G = Gunzip;\n        this.I = Inflate;\n        this.Z = Unzlib;\n        this.ondata = cb;\n    }\n    /**\n     * Pushes a chunk to be decompressed\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Decompress.prototype.push = function (chunk, final) {\n        if (!this.ondata)\n            err(5);\n        if (!this.s) {\n            if (this.p && this.p.length) {\n                var n = new u8(this.p.length + chunk.length);\n                n.set(this.p), n.set(chunk, this.p.length);\n            }\n            else\n                this.p = chunk;\n            if (this.p.length > 2) {\n                var _this_1 = this;\n                var cb = function () { _this_1.ondata.apply(_this_1, arguments); };\n                this.s = (this.p[0] == 31 && this.p[1] == 139 && this.p[2] == 8)\n                    ? new this.G(cb)\n                    : ((this.p[0] & 15) != 8 || (this.p[0] >> 4) > 7 || ((this.p[0] << 8 | this.p[1]) % 31))\n                        ? new this.I(cb)\n                        : new this.Z(cb);\n                this.s.push(this.p, final);\n                this.p = null;\n            }\n        }\n        else\n            this.s.push(chunk, final);\n    };\n    return Decompress;\n}());\nexport { Decompress };\n/**\n * Asynchronous streaming GZIP, Zlib, or raw DEFLATE decompression\n */\nvar AsyncDecompress = /*#__PURE__*/ (function () {\n    /**\n   * Creates an asynchronous decompression stream\n   * @param cb The callback to call whenever data is decompressed\n   */\n    function AsyncDecompress(cb) {\n        this.G = AsyncGunzip;\n        this.I = AsyncInflate;\n        this.Z = AsyncUnzlib;\n        this.ondata = cb;\n    }\n    /**\n     * Pushes a chunk to be decompressed\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    AsyncDecompress.prototype.push = function (chunk, final) {\n        Decompress.prototype.push.call(this, chunk, final);\n    };\n    return AsyncDecompress;\n}());\nexport { AsyncDecompress };\nexport function decompress(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        err(7);\n    return (data[0] == 31 && data[1] == 139 && data[2] == 8)\n        ? gunzip(data, opts, cb)\n        : ((data[0] & 15) != 8 || (data[0] >> 4) > 7 || ((data[0] << 8 | data[1]) % 31))\n            ? inflate(data, opts, cb)\n            : unzlib(data, opts, cb);\n}\n/**\n * Expands compressed GZIP, Zlib, or raw DEFLATE data, automatically detecting the format\n * @param data The data to decompress\n * @param out Where to write the data. Saves memory if you know the decompressed size and provide an output buffer of that length.\n * @returns The decompressed version of the data\n */\nexport function decompressSync(data, out) {\n    return (data[0] == 31 && data[1] == 139 && data[2] == 8)\n        ? gunzipSync(data, out)\n        : ((data[0] & 15) != 8 || (data[0] >> 4) > 7 || ((data[0] << 8 | data[1]) % 31))\n            ? inflateSync(data, out)\n            : unzlibSync(data, out);\n}\n// flatten a directory structure\nvar fltn = function (d, p, t, o) {\n    for (var k in d) {\n        var val = d[k], n = p + k, op = o;\n        if (Array.isArray(val))\n            op = mrg(o, val[1]), val = val[0];\n        if (val instanceof u8)\n            t[n] = [val, op];\n        else {\n            t[n += '/'] = [new u8(0), op];\n            fltn(val, n, t, o);\n        }\n    }\n};\n// text encoder\nvar te = typeof TextEncoder != 'undefined' && /*#__PURE__*/ new TextEncoder();\n// text decoder\nvar td = typeof TextDecoder != 'undefined' && /*#__PURE__*/ new TextDecoder();\n// text decoder stream\nvar tds = 0;\ntry {\n    td.decode(et, { stream: true });\n    tds = 1;\n}\ncatch (e) { }\n// decode UTF8\nvar dutf8 = function (d) {\n    for (var r = '', i = 0;;) {\n        var c = d[i++];\n        var eb = (c > 127) + (c > 223) + (c > 239);\n        if (i + eb > d.length)\n            return [r, slc(d, i - 1)];\n        if (!eb)\n            r += String.fromCharCode(c);\n        else if (eb == 3) {\n            c = ((c & 15) << 18 | (d[i++] & 63) << 12 | (d[i++] & 63) << 6 | (d[i++] & 63)) - 65536,\n                r += String.fromCharCode(55296 | (c >> 10), 56320 | (c & 1023));\n        }\n        else if (eb & 1)\n            r += String.fromCharCode((c & 31) << 6 | (d[i++] & 63));\n        else\n            r += String.fromCharCode((c & 15) << 12 | (d[i++] & 63) << 6 | (d[i++] & 63));\n    }\n};\n/**\n * Streaming UTF-8 decoding\n */\nvar DecodeUTF8 = /*#__PURE__*/ (function () {\n    /**\n     * Creates a UTF-8 decoding stream\n     * @param cb The callback to call whenever data is decoded\n     */\n    function DecodeUTF8(cb) {\n        this.ondata = cb;\n        if (tds)\n            this.t = new TextDecoder();\n        else\n            this.p = et;\n    }\n    /**\n     * Pushes a chunk to be decoded from UTF-8 binary\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    DecodeUTF8.prototype.push = function (chunk, final) {\n        if (!this.ondata)\n            err(5);\n        final = !!final;\n        if (this.t) {\n            this.ondata(this.t.decode(chunk, { stream: true }), final);\n            if (final) {\n                if (this.t.decode().length)\n                    err(8);\n                this.t = null;\n            }\n            return;\n        }\n        if (!this.p)\n            err(4);\n        var dat = new u8(this.p.length + chunk.length);\n        dat.set(this.p);\n        dat.set(chunk, this.p.length);\n        var _a = dutf8(dat), ch = _a[0], np = _a[1];\n        if (final) {\n            if (np.length)\n                err(8);\n            this.p = null;\n        }\n        else\n            this.p = np;\n        this.ondata(ch, final);\n    };\n    return DecodeUTF8;\n}());\nexport { DecodeUTF8 };\n/**\n * Streaming UTF-8 encoding\n */\nvar EncodeUTF8 = /*#__PURE__*/ (function () {\n    /**\n     * Creates a UTF-8 decoding stream\n     * @param cb The callback to call whenever data is encoded\n     */\n    function EncodeUTF8(cb) {\n        this.ondata = cb;\n    }\n    /**\n     * Pushes a chunk to be encoded to UTF-8\n     * @param chunk The string data to push\n     * @param final Whether this is the last chunk\n     */\n    EncodeUTF8.prototype.push = function (chunk, final) {\n        if (!this.ondata)\n            err(5);\n        if (this.d)\n            err(4);\n        this.ondata(strToU8(chunk), this.d = final || false);\n    };\n    return EncodeUTF8;\n}());\nexport { EncodeUTF8 };\n/**\n * Converts a string into a Uint8Array for use with compression/decompression methods\n * @param str The string to encode\n * @param latin1 Whether or not to interpret the data as Latin-1. This should\n *               not need to be true unless decoding a binary string.\n * @returns The string encoded in UTF-8/Latin-1 binary\n */\nexport function strToU8(str, latin1) {\n    if (latin1) {\n        var ar_1 = new u8(str.length);\n        for (var i = 0; i < str.length; ++i)\n            ar_1[i] = str.charCodeAt(i);\n        return ar_1;\n    }\n    if (te)\n        return te.encode(str);\n    var l = str.length;\n    var ar = new u8(str.length + (str.length >> 1));\n    var ai = 0;\n    var w = function (v) { ar[ai++] = v; };\n    for (var i = 0; i < l; ++i) {\n        if (ai + 5 > ar.length) {\n            var n = new u8(ai + 8 + ((l - i) << 1));\n            n.set(ar);\n            ar = n;\n        }\n        var c = str.charCodeAt(i);\n        if (c < 128 || latin1)\n            w(c);\n        else if (c < 2048)\n            w(192 | (c >> 6)), w(128 | (c & 63));\n        else if (c > 55295 && c < 57344)\n            c = 65536 + (c & 1023 << 10) | (str.charCodeAt(++i) & 1023),\n                w(240 | (c >> 18)), w(128 | ((c >> 12) & 63)), w(128 | ((c >> 6) & 63)), w(128 | (c & 63));\n        else\n            w(224 | (c >> 12)), w(128 | ((c >> 6) & 63)), w(128 | (c & 63));\n    }\n    return slc(ar, 0, ai);\n}\n/**\n * Converts a Uint8Array to a string\n * @param dat The data to decode to string\n * @param latin1 Whether or not to interpret the data as Latin-1. This should\n *               not need to be true unless encoding to binary string.\n * @returns The original UTF-8/Latin-1 string\n */\nexport function strFromU8(dat, latin1) {\n    if (latin1) {\n        var r = '';\n        for (var i = 0; i < dat.length; i += 16384)\n            r += String.fromCharCode.apply(null, dat.subarray(i, i + 16384));\n        return r;\n    }\n    else if (td)\n        return td.decode(dat);\n    else {\n        var _a = dutf8(dat), out = _a[0], ext = _a[1];\n        if (ext.length)\n            err(8);\n        return out;\n    }\n}\n;\n// deflate bit flag\nvar dbf = function (l) { return l == 1 ? 3 : l < 6 ? 2 : l == 9 ? 1 : 0; };\n// skip local zip header\nvar slzh = function (d, b) { return b + 30 + b2(d, b + 26) + b2(d, b + 28); };\n// read zip header\nvar zh = function (d, b, z) {\n    var fnl = b2(d, b + 28), fn = strFromU8(d.subarray(b + 46, b + 46 + fnl), !(b2(d, b + 8) & 2048)), es = b + 46 + fnl, bs = b4(d, b + 20);\n    var _a = z && bs == 4294967295 ? z64e(d, es) : [bs, b4(d, b + 24), b4(d, b + 42)], sc = _a[0], su = _a[1], off = _a[2];\n    return [b2(d, b + 10), sc, su, fn, es + b2(d, b + 30) + b2(d, b + 32), off];\n};\n// read zip64 extra field\nvar z64e = function (d, b) {\n    for (; b2(d, b) != 1; b += 4 + b2(d, b + 2))\n        ;\n    return [b8(d, b + 12), b8(d, b + 4), b8(d, b + 20)];\n};\n// extra field length\nvar exfl = function (ex) {\n    var le = 0;\n    if (ex) {\n        for (var k in ex) {\n            var l = ex[k].length;\n            if (l > 65535)\n                err(9);\n            le += l + 4;\n        }\n    }\n    return le;\n};\n// write zip header\nvar wzh = function (d, b, f, fn, u, c, ce, co) {\n    var fl = fn.length, ex = f.extra, col = co && co.length;\n    var exl = exfl(ex);\n    wbytes(d, b, ce != null ? 0x2014B50 : 0x4034B50), b += 4;\n    if (ce != null)\n        d[b++] = 20, d[b++] = f.os;\n    d[b] = 20, b += 2; // spec compliance? what's that?\n    d[b++] = (f.flag << 1) | (c < 0 && 8), d[b++] = u && 8;\n    d[b++] = f.compression & 255, d[b++] = f.compression >> 8;\n    var dt = new Date(f.mtime == null ? Date.now() : f.mtime), y = dt.getFullYear() - 1980;\n    if (y < 0 || y > 119)\n        err(10);\n    wbytes(d, b, (y << 25) | ((dt.getMonth() + 1) << 21) | (dt.getDate() << 16) | (dt.getHours() << 11) | (dt.getMinutes() << 5) | (dt.getSeconds() >>> 1)), b += 4;\n    if (c != -1) {\n        wbytes(d, b, f.crc);\n        wbytes(d, b + 4, c < 0 ? -c - 2 : c);\n        wbytes(d, b + 8, f.size);\n    }\n    wbytes(d, b + 12, fl);\n    wbytes(d, b + 14, exl), b += 16;\n    if (ce != null) {\n        wbytes(d, b, col);\n        wbytes(d, b + 6, f.attrs);\n        wbytes(d, b + 10, ce), b += 14;\n    }\n    d.set(fn, b);\n    b += fl;\n    if (exl) {\n        for (var k in ex) {\n            var exf = ex[k], l = exf.length;\n            wbytes(d, b, +k);\n            wbytes(d, b + 2, l);\n            d.set(exf, b + 4), b += 4 + l;\n        }\n    }\n    if (col)\n        d.set(co, b), b += col;\n    return b;\n};\n// write zip footer (end of central directory)\nvar wzf = function (o, b, c, d, e) {\n    wbytes(o, b, 0x6054B50); // skip disk\n    wbytes(o, b + 8, c);\n    wbytes(o, b + 10, c);\n    wbytes(o, b + 12, d);\n    wbytes(o, b + 16, e);\n};\n/**\n * A pass-through stream to keep data uncompressed in a ZIP archive.\n */\nvar ZipPassThrough = /*#__PURE__*/ (function () {\n    /**\n     * Creates a pass-through stream that can be added to ZIP archives\n     * @param filename The filename to associate with this data stream\n     */\n    function ZipPassThrough(filename) {\n        this.filename = filename;\n        this.c = crc();\n        this.size = 0;\n        this.compression = 0;\n    }\n    /**\n     * Processes a chunk and pushes to the output stream. You can override this\n     * method in a subclass for custom behavior, but by default this passes\n     * the data through. You must call this.ondata(err, chunk, final) at some\n     * point in this method.\n     * @param chunk The chunk to process\n     * @param final Whether this is the last chunk\n     */\n    ZipPassThrough.prototype.process = function (chunk, final) {\n        this.ondata(null, chunk, final);\n    };\n    /**\n     * Pushes a chunk to be added. If you are subclassing this with a custom\n     * compression algorithm, note that you must push data from the source\n     * file only, pre-compression.\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    ZipPassThrough.prototype.push = function (chunk, final) {\n        if (!this.ondata)\n            err(5);\n        this.c.p(chunk);\n        this.size += chunk.length;\n        if (final)\n            this.crc = this.c.d();\n        this.process(chunk, final || false);\n    };\n    return ZipPassThrough;\n}());\nexport { ZipPassThrough };\n// I don't extend because TypeScript extension adds 1kB of runtime bloat\n/**\n * Streaming DEFLATE compression for ZIP archives. Prefer using AsyncZipDeflate\n * for better performance\n */\nvar ZipDeflate = /*#__PURE__*/ (function () {\n    /**\n     * Creates a DEFLATE stream that can be added to ZIP archives\n     * @param filename The filename to associate with this data stream\n     * @param opts The compression options\n     */\n    function ZipDeflate(filename, opts) {\n        var _this_1 = this;\n        if (!opts)\n            opts = {};\n        ZipPassThrough.call(this, filename);\n        this.d = new Deflate(opts, function (dat, final) {\n            _this_1.ondata(null, dat, final);\n        });\n        this.compression = 8;\n        this.flag = dbf(opts.level);\n    }\n    ZipDeflate.prototype.process = function (chunk, final) {\n        try {\n            this.d.push(chunk, final);\n        }\n        catch (e) {\n            this.ondata(e, null, final);\n        }\n    };\n    /**\n     * Pushes a chunk to be deflated\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    ZipDeflate.prototype.push = function (chunk, final) {\n        ZipPassThrough.prototype.push.call(this, chunk, final);\n    };\n    return ZipDeflate;\n}());\nexport { ZipDeflate };\n/**\n * Asynchronous streaming DEFLATE compression for ZIP archives\n */\nvar AsyncZipDeflate = /*#__PURE__*/ (function () {\n    /**\n     * Creates a DEFLATE stream that can be added to ZIP archives\n     * @param filename The filename to associate with this data stream\n     * @param opts The compression options\n     */\n    function AsyncZipDeflate(filename, opts) {\n        var _this_1 = this;\n        if (!opts)\n            opts = {};\n        ZipPassThrough.call(this, filename);\n        this.d = new AsyncDeflate(opts, function (err, dat, final) {\n            _this_1.ondata(err, dat, final);\n        });\n        this.compression = 8;\n        this.flag = dbf(opts.level);\n        this.terminate = this.d.terminate;\n    }\n    AsyncZipDeflate.prototype.process = function (chunk, final) {\n        this.d.push(chunk, final);\n    };\n    /**\n     * Pushes a chunk to be deflated\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    AsyncZipDeflate.prototype.push = function (chunk, final) {\n        ZipPassThrough.prototype.push.call(this, chunk, final);\n    };\n    return AsyncZipDeflate;\n}());\nexport { AsyncZipDeflate };\n// TODO: Better tree shaking\n/**\n * A zippable archive to which files can incrementally be added\n */\nvar Zip = /*#__PURE__*/ (function () {\n    /**\n     * Creates an empty ZIP archive to which files can be added\n     * @param cb The callback to call whenever data for the generated ZIP archive\n     *           is available\n     */\n    function Zip(cb) {\n        this.ondata = cb;\n        this.u = [];\n        this.d = 1;\n    }\n    /**\n     * Adds a file to the ZIP archive\n     * @param file The file stream to add\n     */\n    Zip.prototype.add = function (file) {\n        var _this_1 = this;\n        if (!this.ondata)\n            err(5);\n        // finishing or finished\n        if (this.d & 2)\n            this.ondata(err(4 + (this.d & 1) * 8, 0, 1), null, false);\n        else {\n            var f = strToU8(file.filename), fl_1 = f.length;\n            var com = file.comment, o = com && strToU8(com);\n            var u = fl_1 != file.filename.length || (o && (com.length != o.length));\n            var hl_1 = fl_1 + exfl(file.extra) + 30;\n            if (fl_1 > 65535)\n                this.ondata(err(11, 0, 1), null, false);\n            var header = new u8(hl_1);\n            wzh(header, 0, file, f, u, -1);\n            var chks_1 = [header];\n            var pAll_1 = function () {\n                for (var _i = 0, chks_2 = chks_1; _i < chks_2.length; _i++) {\n                    var chk = chks_2[_i];\n                    _this_1.ondata(null, chk, false);\n                }\n                chks_1 = [];\n            };\n            var tr_1 = this.d;\n            this.d = 0;\n            var ind_1 = this.u.length;\n            var uf_1 = mrg(file, {\n                f: f,\n                u: u,\n                o: o,\n                t: function () {\n                    if (file.terminate)\n                        file.terminate();\n                },\n                r: function () {\n                    pAll_1();\n                    if (tr_1) {\n                        var nxt = _this_1.u[ind_1 + 1];\n                        if (nxt)\n                            nxt.r();\n                        else\n                            _this_1.d = 1;\n                    }\n                    tr_1 = 1;\n                }\n            });\n            var cl_1 = 0;\n            file.ondata = function (err, dat, final) {\n                if (err) {\n                    _this_1.ondata(err, dat, final);\n                    _this_1.terminate();\n                }\n                else {\n                    cl_1 += dat.length;\n                    chks_1.push(dat);\n                    if (final) {\n                        var dd = new u8(16);\n                        wbytes(dd, 0, 0x8074B50);\n                        wbytes(dd, 4, file.crc);\n                        wbytes(dd, 8, cl_1);\n                        wbytes(dd, 12, file.size);\n                        chks_1.push(dd);\n                        uf_1.c = cl_1, uf_1.b = hl_1 + cl_1 + 16, uf_1.crc = file.crc, uf_1.size = file.size;\n                        if (tr_1)\n                            uf_1.r();\n                        tr_1 = 1;\n                    }\n                    else if (tr_1)\n                        pAll_1();\n                }\n            };\n            this.u.push(uf_1);\n        }\n    };\n    /**\n     * Ends the process of adding files and prepares to emit the final chunks.\n     * This *must* be called after adding all desired files for the resulting\n     * ZIP file to work properly.\n     */\n    Zip.prototype.end = function () {\n        var _this_1 = this;\n        if (this.d & 2) {\n            this.ondata(err(4 + (this.d & 1) * 8, 0, 1), null, true);\n            return;\n        }\n        if (this.d)\n            this.e();\n        else\n            this.u.push({\n                r: function () {\n                    if (!(_this_1.d & 1))\n                        return;\n                    _this_1.u.splice(-1, 1);\n                    _this_1.e();\n                },\n                t: function () { }\n            });\n        this.d = 3;\n    };\n    Zip.prototype.e = function () {\n        var bt = 0, l = 0, tl = 0;\n        for (var _i = 0, _a = this.u; _i < _a.length; _i++) {\n            var f = _a[_i];\n            tl += 46 + f.f.length + exfl(f.extra) + (f.o ? f.o.length : 0);\n        }\n        var out = new u8(tl + 22);\n        for (var _b = 0, _c = this.u; _b < _c.length; _b++) {\n            var f = _c[_b];\n            wzh(out, bt, f, f.f, f.u, -f.c - 2, l, f.o);\n            bt += 46 + f.f.length + exfl(f.extra) + (f.o ? f.o.length : 0), l += f.b;\n        }\n        wzf(out, bt, this.u.length, tl, l);\n        this.ondata(null, out, true);\n        this.d = 2;\n    };\n    /**\n     * A method to terminate any internal workers used by the stream. Subsequent\n     * calls to add() will fail.\n     */\n    Zip.prototype.terminate = function () {\n        for (var _i = 0, _a = this.u; _i < _a.length; _i++) {\n            var f = _a[_i];\n            f.t();\n        }\n        this.d = 2;\n    };\n    return Zip;\n}());\nexport { Zip };\nexport function zip(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        err(7);\n    var r = {};\n    fltn(data, '', r, opts);\n    var k = Object.keys(r);\n    var lft = k.length, o = 0, tot = 0;\n    var slft = lft, files = new Array(lft);\n    var term = [];\n    var tAll = function () {\n        for (var i = 0; i < term.length; ++i)\n            term[i]();\n    };\n    var cbd = function (a, b) {\n        mt(function () { cb(a, b); });\n    };\n    mt(function () { cbd = cb; });\n    var cbf = function () {\n        var out = new u8(tot + 22), oe = o, cdl = tot - o;\n        tot = 0;\n        for (var i = 0; i < slft; ++i) {\n            var f = files[i];\n            try {\n                var l = f.c.length;\n                wzh(out, tot, f, f.f, f.u, l);\n                var badd = 30 + f.f.length + exfl(f.extra);\n                var loc = tot + badd;\n                out.set(f.c, loc);\n                wzh(out, o, f, f.f, f.u, l, tot, f.m), o += 16 + badd + (f.m ? f.m.length : 0), tot = loc + l;\n            }\n            catch (e) {\n                return cbd(e, null);\n            }\n        }\n        wzf(out, o, files.length, cdl, oe);\n        cbd(null, out);\n    };\n    if (!lft)\n        cbf();\n    var _loop_1 = function (i) {\n        var fn = k[i];\n        var _a = r[fn], file = _a[0], p = _a[1];\n        var c = crc(), size = file.length;\n        c.p(file);\n        var f = strToU8(fn), s = f.length;\n        var com = p.comment, m = com && strToU8(com), ms = m && m.length;\n        var exl = exfl(p.extra);\n        var compression = p.level == 0 ? 0 : 8;\n        var cbl = function (e, d) {\n            if (e) {\n                tAll();\n                cbd(e, null);\n            }\n            else {\n                var l = d.length;\n                files[i] = mrg(p, {\n                    size: size,\n                    crc: c.d(),\n                    c: d,\n                    f: f,\n                    m: m,\n                    u: s != fn.length || (m && (com.length != ms)),\n                    compression: compression\n                });\n                o += 30 + s + exl + l;\n                tot += 76 + 2 * (s + exl) + (ms || 0) + l;\n                if (!--lft)\n                    cbf();\n            }\n        };\n        if (s > 65535)\n            cbl(err(11, 0, 1), null);\n        if (!compression)\n            cbl(null, file);\n        else if (size < 160000) {\n            try {\n                cbl(null, deflateSync(file, p));\n            }\n            catch (e) {\n                cbl(e, null);\n            }\n        }\n        else\n            term.push(deflate(file, p, cbl));\n    };\n    // Cannot use lft because it can decrease\n    for (var i = 0; i < slft; ++i) {\n        _loop_1(i);\n    }\n    return tAll;\n}\n/**\n * Synchronously creates a ZIP file. Prefer using `zip` for better performance\n * with more than one file.\n * @param data The directory structure for the ZIP archive\n * @param opts The main options, merged with per-file options\n * @returns The generated ZIP archive\n */\nexport function zipSync(data, opts) {\n    if (!opts)\n        opts = {};\n    var r = {};\n    var files = [];\n    fltn(data, '', r, opts);\n    var o = 0;\n    var tot = 0;\n    for (var fn in r) {\n        var _a = r[fn], file = _a[0], p = _a[1];\n        var compression = p.level == 0 ? 0 : 8;\n        var f = strToU8(fn), s = f.length;\n        var com = p.comment, m = com && strToU8(com), ms = m && m.length;\n        var exl = exfl(p.extra);\n        if (s > 65535)\n            err(11);\n        var d = compression ? deflateSync(file, p) : file, l = d.length;\n        var c = crc();\n        c.p(file);\n        files.push(mrg(p, {\n            size: file.length,\n            crc: c.d(),\n            c: d,\n            f: f,\n            m: m,\n            u: s != fn.length || (m && (com.length != ms)),\n            o: o,\n            compression: compression\n        }));\n        o += 30 + s + exl + l;\n        tot += 76 + 2 * (s + exl) + (ms || 0) + l;\n    }\n    var out = new u8(tot + 22), oe = o, cdl = tot - o;\n    for (var i = 0; i < files.length; ++i) {\n        var f = files[i];\n        wzh(out, f.o, f, f.f, f.u, f.c.length);\n        var badd = 30 + f.f.length + exfl(f.extra);\n        out.set(f.c, f.o + badd);\n        wzh(out, o, f, f.f, f.u, f.c.length, f.o, f.m), o += 16 + badd + (f.m ? f.m.length : 0);\n    }\n    wzf(out, o, files.length, cdl, oe);\n    return out;\n}\n/**\n * Streaming pass-through decompression for ZIP archives\n */\nvar UnzipPassThrough = /*#__PURE__*/ (function () {\n    function UnzipPassThrough() {\n    }\n    UnzipPassThrough.prototype.push = function (data, final) {\n        this.ondata(null, data, final);\n    };\n    UnzipPassThrough.compression = 0;\n    return UnzipPassThrough;\n}());\nexport { UnzipPassThrough };\n/**\n * Streaming DEFLATE decompression for ZIP archives. Prefer AsyncZipInflate for\n * better performance.\n */\nvar UnzipInflate = /*#__PURE__*/ (function () {\n    /**\n     * Creates a DEFLATE decompression that can be used in ZIP archives\n     */\n    function UnzipInflate() {\n        var _this_1 = this;\n        this.i = new Inflate(function (dat, final) {\n            _this_1.ondata(null, dat, final);\n        });\n    }\n    UnzipInflate.prototype.push = function (data, final) {\n        try {\n            this.i.push(data, final);\n        }\n        catch (e) {\n            this.ondata(e, null, final);\n        }\n    };\n    UnzipInflate.compression = 8;\n    return UnzipInflate;\n}());\nexport { UnzipInflate };\n/**\n * Asynchronous streaming DEFLATE decompression for ZIP archives\n */\nvar AsyncUnzipInflate = /*#__PURE__*/ (function () {\n    /**\n     * Creates a DEFLATE decompression that can be used in ZIP archives\n     */\n    function AsyncUnzipInflate(_, sz) {\n        var _this_1 = this;\n        if (sz < 320000) {\n            this.i = new Inflate(function (dat, final) {\n                _this_1.ondata(null, dat, final);\n            });\n        }\n        else {\n            this.i = new AsyncInflate(function (err, dat, final) {\n                _this_1.ondata(err, dat, final);\n            });\n            this.terminate = this.i.terminate;\n        }\n    }\n    AsyncUnzipInflate.prototype.push = function (data, final) {\n        if (this.i.terminate)\n            data = slc(data, 0);\n        this.i.push(data, final);\n    };\n    AsyncUnzipInflate.compression = 8;\n    return AsyncUnzipInflate;\n}());\nexport { AsyncUnzipInflate };\n/**\n * A ZIP archive decompression stream that emits files as they are discovered\n */\nvar Unzip = /*#__PURE__*/ (function () {\n    /**\n     * Creates a ZIP decompression stream\n     * @param cb The callback to call whenever a file in the ZIP archive is found\n     */\n    function Unzip(cb) {\n        this.onfile = cb;\n        this.k = [];\n        this.o = {\n            0: UnzipPassThrough\n        };\n        this.p = et;\n    }\n    /**\n     * Pushes a chunk to be unzipped\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Unzip.prototype.push = function (chunk, final) {\n        var _this_1 = this;\n        if (!this.onfile)\n            err(5);\n        if (!this.p)\n            err(4);\n        if (this.c > 0) {\n            var len = Math.min(this.c, chunk.length);\n            var toAdd = chunk.subarray(0, len);\n            this.c -= len;\n            if (this.d)\n                this.d.push(toAdd, !this.c);\n            else\n                this.k[0].push(toAdd);\n            chunk = chunk.subarray(len);\n            if (chunk.length)\n                return this.push(chunk, final);\n        }\n        else {\n            var f = 0, i = 0, is = void 0, buf = void 0;\n            if (!this.p.length)\n                buf = chunk;\n            else if (!chunk.length)\n                buf = this.p;\n            else {\n                buf = new u8(this.p.length + chunk.length);\n                buf.set(this.p), buf.set(chunk, this.p.length);\n            }\n            var l = buf.length, oc = this.c, add = oc && this.d;\n            var _loop_2 = function () {\n                var _a;\n                var sig = b4(buf, i);\n                if (sig == 0x4034B50) {\n                    f = 1, is = i;\n                    this_1.d = null;\n                    this_1.c = 0;\n                    var bf = b2(buf, i + 6), cmp_1 = b2(buf, i + 8), u = bf & 2048, dd = bf & 8, fnl = b2(buf, i + 26), es = b2(buf, i + 28);\n                    if (l > i + 30 + fnl + es) {\n                        var chks_3 = [];\n                        this_1.k.unshift(chks_3);\n                        f = 2;\n                        var sc_1 = b4(buf, i + 18), su_1 = b4(buf, i + 22);\n                        var fn_1 = strFromU8(buf.subarray(i + 30, i += 30 + fnl), !u);\n                        if (sc_1 == 4294967295) {\n                            _a = dd ? [-2] : z64e(buf, i), sc_1 = _a[0], su_1 = _a[1];\n                        }\n                        else if (dd)\n                            sc_1 = -1;\n                        i += es;\n                        this_1.c = sc_1;\n                        var d_1;\n                        var file_1 = {\n                            name: fn_1,\n                            compression: cmp_1,\n                            start: function () {\n                                if (!file_1.ondata)\n                                    err(5);\n                                if (!sc_1)\n                                    file_1.ondata(null, et, true);\n                                else {\n                                    var ctr = _this_1.o[cmp_1];\n                                    if (!ctr)\n                                        file_1.ondata(err(14, 'unknown compression type ' + cmp_1, 1), null, false);\n                                    d_1 = sc_1 < 0 ? new ctr(fn_1) : new ctr(fn_1, sc_1, su_1);\n                                    d_1.ondata = function (err, dat, final) { file_1.ondata(err, dat, final); };\n                                    for (var _i = 0, chks_4 = chks_3; _i < chks_4.length; _i++) {\n                                        var dat = chks_4[_i];\n                                        d_1.push(dat, false);\n                                    }\n                                    if (_this_1.k[0] == chks_3 && _this_1.c)\n                                        _this_1.d = d_1;\n                                    else\n                                        d_1.push(et, true);\n                                }\n                            },\n                            terminate: function () {\n                                if (d_1 && d_1.terminate)\n                                    d_1.terminate();\n                            }\n                        };\n                        if (sc_1 >= 0)\n                            file_1.size = sc_1, file_1.originalSize = su_1;\n                        this_1.onfile(file_1);\n                    }\n                    return \"break\";\n                }\n                else if (oc) {\n                    if (sig == 0x8074B50) {\n                        is = i += 12 + (oc == -2 && 8), f = 3, this_1.c = 0;\n                        return \"break\";\n                    }\n                    else if (sig == 0x2014B50) {\n                        is = i -= 4, f = 3, this_1.c = 0;\n                        return \"break\";\n                    }\n                }\n            };\n            var this_1 = this;\n            for (; i < l - 4; ++i) {\n                var state_1 = _loop_2();\n                if (state_1 === \"break\")\n                    break;\n            }\n            this.p = et;\n            if (oc < 0) {\n                var dat = f ? buf.subarray(0, is - 12 - (oc == -2 && 8) - (b4(buf, is - 16) == 0x8074B50 && 4)) : buf.subarray(0, i);\n                if (add)\n                    add.push(dat, !!f);\n                else\n                    this.k[+(f == 2)].push(dat);\n            }\n            if (f & 2)\n                return this.push(buf.subarray(i), final);\n            this.p = buf.subarray(i);\n        }\n        if (final) {\n            if (this.c)\n                err(13);\n            this.p = null;\n        }\n    };\n    /**\n     * Registers a decoder with the stream, allowing for files compressed with\n     * the compression type provided to be expanded correctly\n     * @param decoder The decoder constructor\n     */\n    Unzip.prototype.register = function (decoder) {\n        this.o[decoder.compression] = decoder;\n    };\n    return Unzip;\n}());\nexport { Unzip };\nvar mt = typeof queueMicrotask == 'function' ? queueMicrotask : typeof setTimeout == 'function' ? setTimeout : function (fn) { fn(); };\nexport function unzip(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        err(7);\n    var term = [];\n    var tAll = function () {\n        for (var i = 0; i < term.length; ++i)\n            term[i]();\n    };\n    var files = {};\n    var cbd = function (a, b) {\n        mt(function () { cb(a, b); });\n    };\n    mt(function () { cbd = cb; });\n    var e = data.length - 22;\n    for (; b4(data, e) != 0x6054B50; --e) {\n        if (!e || data.length - e > 65558) {\n            cbd(err(13, 0, 1), null);\n            return tAll;\n        }\n    }\n    ;\n    var lft = b2(data, e + 8);\n    if (lft) {\n        var c = lft;\n        var o = b4(data, e + 16);\n        var z = o == 4294967295 || c == 65535;\n        if (z) {\n            var ze = b4(data, e - 12);\n            z = b4(data, ze) == 0x6064B50;\n            if (z) {\n                c = lft = b4(data, ze + 32);\n                o = b4(data, ze + 48);\n            }\n        }\n        var fltr = opts && opts.filter;\n        var _loop_3 = function (i) {\n            var _a = zh(data, o, z), c_1 = _a[0], sc = _a[1], su = _a[2], fn = _a[3], no = _a[4], off = _a[5], b = slzh(data, off);\n            o = no;\n            var cbl = function (e, d) {\n                if (e) {\n                    tAll();\n                    cbd(e, null);\n                }\n                else {\n                    if (d)\n                        files[fn] = d;\n                    if (!--lft)\n                        cbd(null, files);\n                }\n            };\n            if (!fltr || fltr({\n                name: fn,\n                size: sc,\n                originalSize: su,\n                compression: c_1\n            })) {\n                if (!c_1)\n                    cbl(null, slc(data, b, b + sc));\n                else if (c_1 == 8) {\n                    var infl = data.subarray(b, b + sc);\n                    if (sc < 320000) {\n                        try {\n                            cbl(null, inflateSync(infl, new u8(su)));\n                        }\n                        catch (e) {\n                            cbl(e, null);\n                        }\n                    }\n                    else\n                        term.push(inflate(infl, { size: su }, cbl));\n                }\n                else\n                    cbl(err(14, 'unknown compression type ' + c_1, 1), null);\n            }\n            else\n                cbl(null, null);\n        };\n        for (var i = 0; i < c; ++i) {\n            _loop_3(i);\n        }\n    }\n    else\n        cbd(null, {});\n    return tAll;\n}\n/**\n * Synchronously decompresses a ZIP archive. Prefer using `unzip` for better\n * performance with more than one file.\n * @param data The raw compressed ZIP file\n * @param opts The ZIP extraction options\n * @returns The decompressed files\n */\nexport function unzipSync(data, opts) {\n    var files = {};\n    var e = data.length - 22;\n    for (; b4(data, e) != 0x6054B50; --e) {\n        if (!e || data.length - e > 65558)\n            err(13);\n    }\n    ;\n    var c = b2(data, e + 8);\n    if (!c)\n        return {};\n    var o = b4(data, e + 16);\n    var z = o == 4294967295 || c == 65535;\n    if (z) {\n        var ze = b4(data, e - 12);\n        z = b4(data, ze) == 0x6064B50;\n        if (z) {\n            c = b4(data, ze + 32);\n            o = b4(data, ze + 48);\n        }\n    }\n    var fltr = opts && opts.filter;\n    for (var i = 0; i < c; ++i) {\n        var _a = zh(data, o, z), c_2 = _a[0], sc = _a[1], su = _a[2], fn = _a[3], no = _a[4], off = _a[5], b = slzh(data, off);\n        o = no;\n        if (!fltr || fltr({\n            name: fn,\n            size: sc,\n            originalSize: su,\n            compression: c_2\n        })) {\n            if (!c_2)\n                files[fn] = slc(data, b, b + sc);\n            else if (c_2 == 8)\n                files[fn] = inflateSync(data.subarray(b, b + sc), new u8(su));\n            else\n                err(14, 'unknown compression type ' + c_2);\n        }\n    }\n    return files;\n}\n","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport { strFromU8, strToU8, zipSync } from \"fflate\";\r\nimport Snapshot from \"../core/Snapshot\";\r\nimport SnapshotMetadata from \"../core/SnapshotMetadata\";\r\nimport ElementArea from \"../core/ElementArea\";\r\nimport ElementHead from \"../core/ElementHead\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-04-20\r\n */\r\nexport default class ResourceSnapshot {\r\n\r\n    static METADATA_JSON_NAME = 'snapshot.json';\r\n    static LEGACY_METADATA_JSON_NAME = 'metadata.json';\r\n\r\n    /**\r\n     *\r\n     * @param snapshot {Snapshot}\r\n     * @returns Uint8Array\r\n     */\r\n    static createZip(snapshot) {\r\n        const metadata = strToU8(JSON.stringify(snapshot.metadata, null, 2));\r\n        const entities = strToU8(JSON.stringify(snapshot.serializedEntities, null, 2));\r\n\r\n        let zipData = {\r\n            'snapshot.json': metadata,\r\n            'data-heads.bin': new Uint8Array(snapshot.dataHeads),\r\n            'data-tails.bin': new Uint8Array(snapshot.dataTails),\r\n            'data-entities.json': entities,\r\n        };\r\n        return zipSync(zipData, {level: 9});\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param zip {{[path: string]: Uint8Array}}\r\n     * @returns Snapshot\r\n     */\r\n    static parse(zip) {\r\n        function parseJson(fileName) {\r\n            return JSON.parse(strFromU8(zip[fileName]));\r\n        }\r\n\r\n        // load metadata\r\n        let metadataJson;\r\n        if (zip[ResourceSnapshot.METADATA_JSON_NAME]) {\r\n            // snapshot | legacy snapshot\r\n            metadataJson = parseJson(ResourceSnapshot.METADATA_JSON_NAME);\r\n        } else if (zip[ResourceSnapshot.LEGACY_METADATA_JSON_NAME]) {\r\n            // legacy snapshot\r\n            metadataJson = parseJson(ResourceSnapshot.LEGACY_METADATA_JSON_NAME);\r\n        } else {\r\n            throw 'Metadata not found';\r\n        }\r\n        let snapshot = new Snapshot();\r\n        snapshot.metadata = Object.assign(new SnapshotMetadata(), metadataJson);\r\n\r\n        if (typeof snapshot.metadata.width !== \"number\") {\r\n            throw 'Metadata property wrong format: width';\r\n        }\r\n        if (typeof snapshot.metadata.height !== \"number\") {\r\n            throw 'Metadata property wrong format: height';\r\n        }\r\n\r\n        // load element data\r\n        if (snapshot.metadata.formatVersion < 3) {\r\n            // ensure backward compatibility\r\n            // legacy interleaving buffer (element head 1, element tail 1, element head 2, element tail 2, ...)\r\n            const dataRaw = zip['data.bin'];\r\n            if (dataRaw) {\r\n                if (dataRaw.byteLength % 8 !== 0) {\r\n                    throw 'Buffer length is not divisible by 8';\r\n                }\r\n                const elements = dataRaw.byteLength / 8;\r\n                const dataHeads = new Uint8Array(new ArrayBuffer(elements * 4));\r\n                const dataTails = new Uint8Array(new ArrayBuffer(elements * 4));\r\n                for (let i = 0; i < elements; i++) {\r\n                    for (let j = 0; j < 4; j++) {  // 4 bytes\r\n                        dataHeads[(i * 4) + j] = dataRaw[(i * 8) + j];\r\n                        dataTails[(i * 4) + j] = dataRaw[(i * 8) + j + 4];\r\n                    }\r\n                }\r\n                snapshot.dataHeads = dataHeads.buffer;\r\n                snapshot.dataTails = dataTails.buffer;\r\n            } else {\r\n                throw 'data.bin not found';\r\n            }\r\n        } else {\r\n            // one buffer for element heads and one for element tails\r\n            const dataRawHeads = zip['data-heads.bin'];\r\n            if (dataRawHeads) {\r\n                snapshot.dataHeads = dataRawHeads.buffer;\r\n            } else {\r\n                throw 'data-heads.bin not found';\r\n            }\r\n            const dataRawTails = zip['data-tails.bin'];\r\n            if (!dataRawTails) {\r\n                throw 'data-tails.bin not found';\r\n            }\r\n            snapshot.dataTails = dataRawTails.buffer;\r\n        }\r\n\r\n        // load entities\r\n        if (snapshot.metadata.formatVersion > 6) {\r\n            snapshot.serializedEntities = parseJson('data-entities.json');\r\n            if (!Array.isArray(snapshot.serializedEntities)) {\r\n                throw 'Entities corrupted';\r\n            }\r\n        } else {\r\n            snapshot.serializedEntities = [];\r\n        }\r\n\r\n        // ensure backward compatibility\r\n        if (snapshot.metadata.formatVersion === 1) {\r\n            // after 23w32a first byte of element head was changed (powder elements reworked)\r\n            ResourceSnapshot.#convertToV2(snapshot);\r\n            snapshot.metadata.formatVersion = 2;\r\n        }\r\n        if (snapshot.metadata.formatVersion === 2) {\r\n            // interleaving buffer >> element head buffer & element tail buffer\r\n            snapshot.metadata.formatVersion = 3;\r\n        }\r\n        if (snapshot.metadata.formatVersion === 3) {\r\n            // temperature conducting, element type class changes\r\n            ResourceSnapshot.#convertToV4(snapshot);\r\n            snapshot.metadata.formatVersion = 4;\r\n        }\r\n        if (snapshot.metadata.formatVersion === 4) {\r\n            // new trees\r\n            ResourceSnapshot.#convertToV5(snapshot);\r\n            snapshot.metadata.formatVersion = 5;\r\n        }\r\n        if (snapshot.metadata.formatVersion === 5) {\r\n            // conductivity, flammability... >> heat mod index\r\n            ResourceSnapshot.#convertToV6(snapshot);\r\n            snapshot.metadata.formatVersion = 6;\r\n        }\r\n        if (snapshot.metadata.formatVersion === 6) {\r\n            // entities, fish head & fish body behaviour removed\r\n            ResourceSnapshot.#convertToV7(snapshot);\r\n            snapshot.metadata.formatVersion = 7;\r\n        }\r\n\r\n        return snapshot;\r\n    }\r\n\r\n    static #convertToV2(snapshot) {\r\n        const elementArea = ElementArea.from(\r\n            snapshot.metadata.width, snapshot.metadata.height,\r\n            snapshot.dataHeads, snapshot.dataTails);\r\n\r\n        for (let y = 0; y < snapshot.metadata.height; y++) {\r\n            for (let x = 0; x < snapshot.metadata.width; x++) {\r\n\r\n                // TODO: dry flag ignored\r\n                let elementHead = elementArea.getElementHead(x, y);\r\n                let oldType = elementHead & 0b111;  // type without dry flag\r\n                let oldWeight = (elementHead >> 4) & 0x0000000F;\r\n\r\n                if (oldType === 0x0 && oldWeight === 0x0) {\r\n                    // air\r\n                } else if (oldType === 0x0) {\r\n                    // static\r\n                    elementArea.setElementHead(x, y, ElementHead.setType(elementHead, 0x7));\r\n                } else if (oldType === 0x1) {\r\n                    // falling (grass only)\r\n                    elementArea.setElementHead(x, y, ElementHead.setType(elementHead, 0x5));\r\n                } else if (oldType === 0x2) {\r\n                    // sand 1 (soil, gravel)\r\n                    elementArea.setElementHead(x, y, ElementHead.setType(elementHead, 0x5 | (4 << 5)));\r\n                } else if (oldType === 0x3) {\r\n                    // sand 2 (sand)\r\n                    elementArea.setElementHead(x, y, ElementHead.setType(elementHead, 0x5 | (6 << 5)));\r\n                } else if (oldType === 0x4 || oldType === 0x5) {\r\n                    // fluid 1 (not used) or fluid 2 (water)\r\n                    elementArea.setElementHead(x, y, ElementHead.setType(elementHead, 0x3));\r\n                }\r\n            }\r\n        }\r\n\r\n        snapshot.dataHeads = elementArea.getDataHeads();\r\n        snapshot.dataTails = elementArea.getDataTails();\r\n    }\r\n\r\n    static #convertToV4(snapshot) {\r\n        const elementArea = ElementArea.from(\r\n            snapshot.metadata.width, snapshot.metadata.height,\r\n            snapshot.dataHeads, snapshot.dataTails);\r\n\r\n        for (let y = 0; y < snapshot.metadata.height; y++) {\r\n            for (let x = 0; x < snapshot.metadata.width; x++) {\r\n                let elementHead = elementArea.getElementHead(x, y);\r\n                let elementTail = elementArea.getElementTail(x, y);\r\n\r\n                let typeClass = elementHead & 0b111;\r\n\r\n                // element type class changes\r\n                if (typeClass > 0x1 && typeClass < 0x7) {\r\n                    typeClass++;\r\n                    elementHead = (elementHead & 0xFFFFFFF8) | typeClass;\r\n                }\r\n\r\n                // set at least some conductivity type and heat effect type\r\n                switch (typeClass) {\r\n                    case 0x5: // powder element\r\n                    case 0x6: // powder element wet\r\n                    case 0x7: // static\r\n                        elementHead = elementHead | 0x00400000;\r\n                        elementTail = elementTail | 0x10000000;\r\n                        break;\r\n                }\r\n\r\n                // set water behaviour\r\n                if (typeClass === 0x4) {\r\n                    elementHead = (elementHead & 0xFFFFF0FF) | (0xC << 8)\r\n                }\r\n\r\n                elementArea.setElementHead(x, y, elementHead);\r\n                elementArea.setElementTail(x, y, elementTail);\r\n            }\r\n        }\r\n\r\n        snapshot.dataHeads = elementArea.getDataHeads();\r\n        snapshot.dataTails = elementArea.getDataTails();\r\n    }\r\n\r\n    static #convertToV5(snapshot) {\r\n        const elementArea = ElementArea.from(\r\n            snapshot.metadata.width, snapshot.metadata.height,\r\n            snapshot.dataHeads, snapshot.dataTails);\r\n\r\n        for (let y = 0; y < snapshot.metadata.height; y++) {\r\n            for (let x = 0; x < snapshot.metadata.width; x++) {\r\n                let elementHead = elementArea.getElementHead(x, y);\r\n\r\n                // unset tree and leaf behaviour and special\r\n                let behaviour = (elementHead >> 8) & 0x0000000F;\r\n                if (behaviour === 0x5 || behaviour === 0x8) {\r\n                    elementHead = (elementHead & 0xFFFF00FF);\r\n                }\r\n\r\n                elementArea.setElementHead(x, y, elementHead);\r\n            }\r\n        }\r\n\r\n        snapshot.dataHeads = elementArea.getDataHeads();\r\n        snapshot.dataTails = elementArea.getDataTails();\r\n    }\r\n\r\n    static #convertToV6(snapshot) {\r\n        const elementArea = ElementArea.from(\r\n            snapshot.metadata.width, snapshot.metadata.height,\r\n            snapshot.dataHeads, snapshot.dataTails);\r\n\r\n        for (let y = 0; y < snapshot.metadata.height; y++) {\r\n            for (let x = 0; x < snapshot.metadata.width; x++) {\r\n                const elementHead = elementArea.getElementHead(x, y);\r\n\r\n                // map old 4 constants to heat mod index\r\n\r\n                const flammableType = (elementHead >> 16) & 0x00000003;\r\n                const flameHeatType = (elementHead >> 18) & 0x00000003;\r\n                const burnableType = (elementHead >> 20) & 0x00000003;\r\n                const conductivityType = (elementHead >> 22) & 0x00000003;\r\n\r\n                // [0.2, 0.25, 0.3, 0.45][conductivityType];  // small .. big    conductiveIndex\r\n                // [2500, 500, 20, 10][conductivityType];  // big .. small       heatLossChanceTo10000\r\n                // [0, 100, 4500, 10000][flammableType];  // never .. quickly    flammableChanceTo10000\r\n                // [0, 2, 3, 5][flammableType];  // never .. quickly             selfIgnitionChanceTo10000\r\n                // [0, 165, 220, 255][flameHeatType];  // none .. very hot       flameHeat\r\n                // [0, 2, 100, 1000][burnableType];  // none .. fast             burnDownChanceTo10000\r\n\r\n                // all used combinations\r\n                let heatModIndex = 0;  // default\r\n                if (flammableType === 0 && flameHeatType === 0 && burnableType === 0 && conductivityType === 0) {\r\n                    heatModIndex = 0;\r\n                } else if (flammableType === 0 && flameHeatType === 0 && burnableType === 0 && conductivityType === 1) {\r\n                    heatModIndex = 1;\r\n                } else if (flammableType === 0 && flameHeatType === 0 && burnableType === 0 && conductivityType === 2) {\r\n                    heatModIndex = 2;\r\n                } else if (flammableType === 0 && flameHeatType === 0 && burnableType === 0 && conductivityType === 3) {\r\n                    heatModIndex = 3;\r\n                } else if (flammableType === 2 && flameHeatType === 1 && burnableType === 3 && conductivityType === 0) {\r\n                    heatModIndex = 4;\r\n                } else if (flammableType === 1 && flameHeatType === 1 && burnableType === 1 && conductivityType === 0) {\r\n                    heatModIndex = 5;\r\n                } else if (flammableType === 2 && flameHeatType === 1 && burnableType === 2 && conductivityType === 0) {\r\n                    heatModIndex = 6;\r\n                }\r\n\r\n                const newElementHead = (elementHead & 0xFF00FFFF) | (heatModIndex << 16);\r\n                elementArea.setElementHead(x, y, newElementHead);\r\n            }\r\n        }\r\n\r\n        snapshot.dataHeads = elementArea.getDataHeads();\r\n        snapshot.dataTails = elementArea.getDataTails();\r\n    }\r\n\r\n    static #convertToV7(snapshot) {\r\n        const elementArea = ElementArea.from(\r\n            snapshot.metadata.width, snapshot.metadata.height,\r\n            snapshot.dataHeads, snapshot.dataTails);\r\n\r\n        for (let y = 0; y < snapshot.metadata.height; y++) {\r\n            for (let x = 0; x < snapshot.metadata.width; x++) {\r\n                let elementHead = elementArea.getElementHead(x, y);\r\n\r\n                // map fish elements to fish entity\r\n                let behaviour = (elementHead >> 8) & 0x0000000F;\r\n                if (behaviour === 0x3) {\r\n                    snapshot.serializedEntities.push({ entity: 'fish', x: x, y: y });\r\n                }\r\n\r\n                // unset fish head & fish body behaviour and special\r\n                // set entity behaviour\r\n                if (behaviour === 0x3 || behaviour === 0x4) {\r\n                    elementHead = (elementHead & 0xFFFF00FF) | (0xD << 8);\r\n                }\r\n\r\n                elementArea.setElementHead(x, y, elementHead);\r\n            }\r\n        }\r\n\r\n        snapshot.dataHeads = elementArea.getDataHeads();\r\n        snapshot.dataTails = elementArea.getDataTails();\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport Scene from \"./Scene.js\";\r\nimport SandGame from \"../SandGame.js\";\r\n\r\n/**\r\n * Create flipped scene using object composition.\r\n *\r\n * @author Patrik Harag\r\n * @version 2023-12-20\r\n */\r\nexport default class SceneImplModFlip extends Scene {\r\n\r\n    /**\r\n     * @type Scene\r\n     */\r\n    #original;\r\n\r\n    #flipHorizontally;\r\n    #flipVertically;\r\n\r\n    constructor(scene, flipHorizontally, flipVertically) {\r\n        super();\r\n        this.#original = scene;\r\n        this.#flipHorizontally = flipHorizontally;\r\n        this.#flipVertically = flipVertically;\r\n    }\r\n\r\n    countSize(prefWidth, prefHeight) {\r\n        this.#original.countSize(prefWidth, prefHeight);\r\n    }\r\n\r\n    async createSandGame(prefWidth, prefHeight, defaults, context, rendererInitializer) {\r\n        let elementArea = this.createElementArea(prefWidth, prefHeight, defaults.getDefaultElement());\r\n        return new SandGame(elementArea, [], null, defaults, context, rendererInitializer);\r\n        // TODO: sceneMetadata not set\r\n        // TODO: entities support\r\n    }\r\n\r\n    createElementArea(prefWidth, prefHeight, defaultElement) {\r\n        const elementArea = this.#original.createElementArea(prefWidth, prefHeight, defaultElement);\r\n\r\n        const width = elementArea.getWidth();\r\n        const height = elementArea.getHeight();\r\n\r\n        if (this.#flipHorizontally) {\r\n            for (let y = 0; y < height; y++) {\r\n                for (let x = 0; x < Math.trunc(width / 2); x++) {\r\n                    elementArea.swap(x, y, width - 1 - x, y);\r\n                }\r\n            }\r\n        }\r\n\r\n        if (this.#flipVertically) {\r\n            for (let y = 0; y < Math.trunc(height / 2); y++) {\r\n                for (let x = 0; x < width; x++) {\r\n                    elementArea.swap(x, y, x, height - 1 - y);\r\n                }\r\n            }\r\n        }\r\n\r\n        return elementArea;\r\n    }\r\n}\r\n","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport Scene from \"./Scene.js\";\r\nimport SandGame from \"../SandGame\";\r\nimport ElementArea from \"../ElementArea.js\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2023-12-20\r\n */\r\nexport default class SceneImplTemplate extends Scene {\r\n\r\n    /**\r\n     * @type ElementArea\r\n     */\r\n    #elementArea;\r\n\r\n    /**\r\n     *\r\n     * @param elementArea {ElementArea}\r\n     */\r\n    constructor(elementArea) {\r\n        super();\r\n        this.#elementArea = elementArea;\r\n    }\r\n\r\n    countSize(prefWidth, prefHeight) {\r\n        return [this.#elementArea.getWidth(), this.#elementArea.getHeight()];\r\n    }\r\n\r\n    async createSandGame(prefWidth, prefHeight, defaults, context, rendererInitializer) {\r\n        let elementArea = this.createElementArea(prefWidth, prefHeight, defaults.getDefaultElement());\r\n        return new SandGame(elementArea, [], null, defaults, context, rendererInitializer);\r\n    }\r\n\r\n    createElementArea(prefWidth, prefHeight, defaultElement) {\r\n        return ElementArea.from(\r\n                this.#elementArea.getWidth(),\r\n                this.#elementArea.getHeight(),\r\n                this.#elementArea.getDataHeads(),\r\n                this.#elementArea.getDataTails());\r\n    }\r\n}\r\n","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport Assets from \"../Assets\";\r\nimport Brush from \"../core/brush/Brush\";\r\nimport ElementArea from \"../core/ElementArea\";\r\nimport ElementTail from \"../core/ElementTail\";\r\nimport Scene from \"../core/scene/Scene\";\r\nimport SceneImplTemplate from \"../core/scene/SceneImplTemplate\";\r\nimport DeterministicRandom from \"../core/DeterministicRandom\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2023-12-09\r\n */\r\nexport default class ResourceUtils {\r\n\r\n    /**\r\n     *\r\n     * @param objectUrl\r\n     * @param maxWidth\r\n     * @param maxHeight\r\n     * @returns {Promise<ImageData>}\r\n     */\r\n    static loadImageData(objectUrl, maxWidth, maxHeight) {\r\n        // TODO: security - it will also fetch an external image\r\n        return Assets.asImageData(objectUrl, maxWidth, maxHeight);\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param data {ArrayBuffer} ArrayBuffer\r\n     * @param type {string} type\r\n     * @returns {string}\r\n     */\r\n    static asObjectUrl(data, type='image/png') {\r\n        // https://gist.github.com/candycode/f18ae1767b2b0aba568e\r\n        const arrayBufferView = new Uint8Array(data);\r\n        const blob = new Blob([ arrayBufferView ], { type: type });\r\n        const urlCreator = window.URL || window.webkitURL;\r\n        return urlCreator.createObjectURL(blob);\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param imageData {ImageData}\r\n     * @param brush {Brush}\r\n     * @param defaultElement {Element}\r\n     * @param threshold {number} 0-255\r\n     * @returns Scene\r\n     */\r\n    static createSceneFromImageTemplate(imageData, brush, defaultElement, threshold) {\r\n        const width = imageData.width;\r\n        const height = imageData.height;\r\n\r\n        const elementArea = ElementArea.create(width, height, defaultElement);\r\n\r\n        const random = new DeterministicRandom(0);\r\n\r\n        for (let y = 0; y < height; y++) {\r\n            for (let x = 0; x < width; x++) {\r\n                const index = (y * width + x) * 4;\r\n\r\n                let red = imageData.data[index];\r\n                let green = imageData.data[index + 1];\r\n                let blue = imageData.data[index + 2];\r\n                const alpha = imageData.data[index + 3];\r\n\r\n                // perform alpha blending if needed\r\n                if (alpha !== 0xFF) {\r\n                    red = Math.trunc((red * alpha) / 0xFF) + 0xFF - alpha;\r\n                    green = Math.trunc((green * alpha) / 0xFF) + 0xFF - alpha;\r\n                    blue = Math.trunc((blue * alpha) / 0xFF) + 0xFF - alpha;\r\n                }\r\n\r\n                // filter out background\r\n                if (red > 0xFF-threshold && green > 0xFF-threshold && blue > 0xFF-threshold) {\r\n                    continue;  // white\r\n                }\r\n\r\n                const element = brush.apply(x, y, random);\r\n                const elementHead = element.elementHead;\r\n                const elementTail = ElementTail.setColor(element.elementTail, red, green, blue);\r\n                elementArea.setElementHeadAndTail(x, y, elementHead, elementTail);\r\n            }\r\n        }\r\n\r\n        return new SceneImplTemplate(elementArea);\r\n    }\r\n\r\n    static getImageTypeOrNull(filename) {\r\n        filename = filename.toLowerCase();\r\n        if (filename.endsWith('.png')) {\r\n            return 'image/png'\r\n        }\r\n        if (filename.endsWith('.jpg') || filename.endsWith('.jpeg')) {\r\n            return 'image/jpg'\r\n        }\r\n        if (filename.endsWith('.bmp')) {\r\n            return 'image/bmp'\r\n        }\r\n        if (filename.endsWith('.gif')) {\r\n            return 'image/gif'\r\n        }\r\n        return null;\r\n    }\r\n}\r\n","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport Tool from \"../core/tool/Tool\";\r\nimport Tools from \"../core/tool/Tools\";\r\nimport Brush from \"../core/brush/Brush\";\r\nimport BrushDefs from \"../def/BrushDefs\";\r\nimport ElementArea from \"../core/ElementArea\";\r\nimport SceneImplModFlip from \"../core/scene/SceneImplModFlip\";\r\nimport ResourceUtils from \"./ResourceUtils\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-05-11\r\n */\r\nexport default class ResourceTool {\r\n\r\n    static METADATA_JSON_NAME = 'tool.json';\r\n\r\n    /**\r\n     *\r\n     * @param metadataJson {any}\r\n     * @param zip {{[path: string]: Uint8Array}|null}\r\n     * @returns {Promise<Tool>}\r\n     */\r\n    static async parse(metadataJson, zip) {\r\n        const info = metadataJson.info;\r\n        const action = metadataJson.action;\r\n\r\n        if (action === undefined) {\r\n            throw 'Tool definition: action not set';\r\n        }\r\n        const type = action.type;\r\n\r\n        if (type === 'image-template') {\r\n            const scenes = await this.#parseImageTemplate(action, zip);\r\n            return Tools.insertScenesTool(scenes, undefined, info);\r\n\r\n        } else if (type === 'random-template') {\r\n            const scenes = await this.#parseRandomTemplate(action, zip);\r\n            return Tools.insertScenesTool(scenes, undefined, info);\r\n\r\n        } else {\r\n            throw 'Tool action not supported: ' + type;\r\n        }\r\n    }\r\n\r\n    static async #parseRandomTemplate(json, zip) {\r\n        const actions = json.actions;\r\n        if (actions === undefined || actions.length === undefined || actions.length === 0) {\r\n            throw 'Image template: actions not set';\r\n        }\r\n\r\n        let scenes = [];\r\n        for (let i = 0; i < actions.length; i++) {\r\n            const action = actions[i];\r\n            const type = action.type;\r\n            if (type === 'image-template') {\r\n                const items = await this.#parseImageTemplate(action, zip);\r\n                scenes.push(...items);\r\n            } else {\r\n                throw 'Tool action not supported: ' + type;\r\n            }\r\n        }\r\n        return scenes;\r\n    }\r\n\r\n    static async #parseImageTemplate(json, zip) {\r\n        let imageData = await this.#parseImageData(json, zip);\r\n\r\n        const thresholdPar = json.threshold;\r\n        if (thresholdPar === undefined) {\r\n            throw 'Image template: threshold not set';\r\n        }\r\n        const threshold = parseInt(thresholdPar);\r\n\r\n        const brushPar = json.brush;\r\n        if (brushPar === undefined) {\r\n            throw 'Image template: brush not set';\r\n        }\r\n        let brush = null;\r\n        if (typeof brushPar === 'string') {\r\n            brush = BrushDefs.byCodeName(brushPar);\r\n        } else if (typeof brushPar === 'object' && brushPar instanceof Brush) {\r\n            brush = brushPar;\r\n        }\r\n        if (brush === null) {\r\n            throw 'Image template: brush not found: ' + brushPar;\r\n        }\r\n\r\n        const defaultElement = ElementArea.TRANSPARENT_ELEMENT;\r\n        const scene = ResourceUtils.createSceneFromImageTemplate(imageData, brush, defaultElement, threshold);\r\n        const scenes = [scene];\r\n\r\n        const randomFlipHorizontally = json.randomFlipHorizontally;\r\n        if (randomFlipHorizontally) {\r\n            scenes.push(new SceneImplModFlip(scene, true, false));\r\n        }\r\n\r\n        const randomFlipVertically = json.randomFlipVertically;\r\n        if (randomFlipVertically) {\r\n            for (const s of [...scenes]) {\r\n                scenes.push(new SceneImplModFlip(s, false, true));\r\n            }\r\n        }\r\n\r\n        return scenes;\r\n    }\r\n\r\n    static async #parseImageData(json, zip) {\r\n        const imageDataPar = json.imageData;\r\n        if (imageDataPar !== undefined) {\r\n            return await ResourceUtils.loadImageData(imageDataPar, undefined, undefined);\r\n        }\r\n\r\n        const imageFilePar = json.imageFile;\r\n        if (imageFilePar !== undefined && zip !== null && zip[imageFilePar]) {\r\n            const imageType = ResourceUtils.getImageTypeOrNull(imageFilePar);\r\n            if (imageType !== null) {\r\n                const objectUrl = ResourceUtils.asObjectUrl(zip[imageFilePar].buffer);\r\n                return ResourceUtils.loadImageData(objectUrl, undefined, undefined);\r\n            }\r\n        }\r\n        throw 'Image template: imageData/imageFile not set';\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport Snapshot from \"../core/Snapshot\";\r\nimport Scene from \"../core/scene/Scene\";\r\nimport SceneImplSnapshot from \"../core/scene/SceneImplSnapshot\";\r\nimport Tool from \"../core/tool/Tool\";\r\nimport { strFromU8, unzipSync } from 'fflate';\r\nimport ResourceSnapshot from \"./ResourceSnapshot\";\r\nimport ResourceTool from \"./ResourceTool\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2023-12-09\r\n */\r\nexport default class Resources {\r\n\r\n    static JSON_RESOURCE_TYPE_FIELD = 'resourceType';\r\n\r\n    /**\r\n     *\r\n     * @param snapshot {Snapshot}\r\n     * @returns Uint8Array\r\n     */\r\n    static createResourceFromSnapshot(snapshot) {\r\n        return ResourceSnapshot.createZip(snapshot);\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param content {ArrayBuffer}\r\n     * @returns Promise<Scene|Tool>\r\n     */\r\n    static async parseZipResource(content) {\r\n        const zip = unzipSync(new Uint8Array(content));\r\n\r\n        function parseJson(fileName) {\r\n            return JSON.parse(strFromU8(zip[fileName]));\r\n        }\r\n\r\n        if (zip[ResourceSnapshot.METADATA_JSON_NAME] || zip[ResourceSnapshot.LEGACY_METADATA_JSON_NAME]) {\r\n            // snapshot | legacy snapshot\r\n            const snapshot = ResourceSnapshot.parse(zip);\r\n            return new SceneImplSnapshot(snapshot);\r\n        }\r\n        if (zip[ResourceTool.METADATA_JSON_NAME]) {\r\n            // tool\r\n            const metadataJson = parseJson(ResourceTool.METADATA_JSON_NAME);\r\n            return await ResourceTool.parse(metadataJson, zip);\r\n        }\r\n        throw 'Wrong format';\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param content {ArrayBuffer}\r\n     * @returns Promise<Tool>\r\n     */\r\n    static async parseJsonResource(content) {\r\n        const text = strFromU8(new Uint8Array(content));\r\n        const metadataJson = JSON.parse(text);\r\n\r\n        const type = metadataJson[Resources.JSON_RESOURCE_TYPE_FIELD];\r\n        if (type === 'tool') {\r\n            return await ResourceTool.parse(metadataJson, null);\r\n        }\r\n        throw 'Wrong json format';\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param json\r\n     * @returns {Promise<Tool>}\r\n     */\r\n    static async parseToolDefinition(json) {\r\n        return ResourceTool.parse(json, null);\r\n    }\r\n}\r\n","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\n/**\r\n * @interface\r\n *\r\n * @author Patrik Harag\r\n * @version 2023-12-22\r\n */\r\nexport default class Component {\r\n\r\n    /**\r\n     *\r\n     * @param controller {Controller}\r\n     * @return {HTMLElement}\r\n     */\r\n    createNode(controller) {\r\n        throw 'Not implemented';\r\n    }\r\n}\r\n","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport BrushDefs from \"../../def/BrushDefs\";\r\nimport DomBuilder from \"../DomBuilder\";\r\nimport ToolDefs from \"../../def/ToolDefs\";\r\nimport Component from \"./Component\";\r\n\r\n/**\r\n * Creates template form and remembers last values.\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-05-19\r\n */\r\nexport default class ComponentFormTemplate extends Component {\r\n\r\n    #thresholdValue = 50;\r\n    #maxWidth = 300;\r\n    #maxHeight = 200;\r\n    #materialValue = 'sand';\r\n    #materialBrush = BrushDefs.SAND;\r\n\r\n    createNode() {\r\n        return DomBuilder.element('form', null, [\r\n            DomBuilder.element('fieldset', {class: 'mb-3 row'}, [\r\n                DomBuilder.element('legend', {class: 'col-form-label col-sm-3 float-sm-left pt-0'}, 'Material'),\r\n                DomBuilder.div({class: 'col-sm-9', style: 'column-count: 2;'}, [\r\n                    this.#creatMaterialFormGroup(BrushDefs.SAND, ToolDefs.SAND.getInfo()),\r\n                    this.#creatMaterialFormGroup(BrushDefs.SOIL, ToolDefs.SOIL.getInfo()),\r\n                    this.#creatMaterialFormGroup(BrushDefs.THERMITE, ToolDefs.THERMITE.getInfo()),\r\n                    this.#creatMaterialFormGroup(BrushDefs.WALL, ToolDefs.WALL.getInfo()),\r\n                    this.#creatMaterialFormGroup(BrushDefs.METAL, ToolDefs.METAL.getInfo()),\r\n                    this.#creatMaterialFormGroup(BrushDefs.WOOD, ToolDefs.WOOD.getInfo()),\r\n                ])\r\n            ]),\r\n            DomBuilder.element('fieldset', {class: 'mb-3 row'}, [\r\n                DomBuilder.element('legend', {class: 'col-form-label col-sm-3 float-sm-left pt-0'}, 'Background threshold'),\r\n                DomBuilder.div({class: 'col-sm-9'}, [\r\n                    this.#createThresholdSliderFormGroup(),\r\n                ])\r\n            ]),\r\n            DomBuilder.element('fieldset', {class: 'mb-3 row'}, [\r\n                DomBuilder.element('legend', {class: 'col-form-label col-sm-3 float-sm-left pt-0'}, 'Max size'),\r\n                DomBuilder.div({class: 'col-sm-9'}, [\r\n                    this.#createMaxWidthFormGroup(),\r\n                    this.#createMaxHeightFormGroup(),\r\n                ])\r\n            ])\r\n        ]);\r\n    }\r\n\r\n    #createThresholdSliderFormGroup() {\r\n        const id = 'image-template_threshold-slider';\r\n\r\n        const label = DomBuilder.element('label', {'for': id}, 'Value: ' + this.#thresholdValue);\r\n\r\n        const slider = DomBuilder.element('input', {\r\n            id: id,\r\n            class: 'form-range',\r\n            type: 'range',\r\n            min: 0, max: 255, value: this.#thresholdValue\r\n        });\r\n        slider.addEventListener('input', (e) => {\r\n            this.#thresholdValue = e.target.value;\r\n            label.textContent = 'Value: ' + this.#thresholdValue;\r\n        });\r\n\r\n        return DomBuilder.div({class: 'mb-3'}, [\r\n            slider,\r\n            DomBuilder.element('small', null, label)\r\n        ]);\r\n    }\r\n\r\n    #createMaxWidthFormGroup() {\r\n        const id = 'image-template_max-width';\r\n\r\n        const label = DomBuilder.element('label', {'for': id}, 'Width: ' + this.#maxWidth);\r\n\r\n        const slider = DomBuilder.element('input', {\r\n            id: id,\r\n            class: 'form-range',\r\n            type: 'range',\r\n            min: 25, max: 800, value: this.#maxWidth\r\n        });\r\n        slider.addEventListener('input', (e) => {\r\n            this.#maxWidth = e.target.value;\r\n            label.textContent = 'Width: ' + this.#maxWidth;\r\n        });\r\n\r\n        return DomBuilder.div({class: 'mb-3'}, [\r\n            slider,\r\n            DomBuilder.element('small', null, label)\r\n        ]);\r\n    }\r\n\r\n    #createMaxHeightFormGroup() {\r\n        const id = 'image-template_max-height';\r\n\r\n        const label = DomBuilder.element('label', {'for': id}, 'Height: ' + this.#maxHeight);\r\n\r\n        const slider = DomBuilder.element('input', {\r\n            id: id,\r\n            class: 'form-range',\r\n            type: 'range',\r\n            min: 25, max: 800, value: this.#maxHeight\r\n        });\r\n        slider.addEventListener('input', (e) => {\r\n            this.#maxHeight = e.target.value;\r\n            label.textContent = 'Height: ' + this.#maxHeight;\r\n        });\r\n\r\n        return DomBuilder.div({class: 'mb-3'}, [\r\n            slider,\r\n            DomBuilder.element('small', null, label)\r\n        ]);\r\n    }\r\n\r\n    #creatMaterialFormGroup(brush, toolInfo) {\r\n        const codename = toolInfo.getCodeName();\r\n\r\n        const checked = (this.#materialValue === codename);\r\n        const id = 'image-template_checkbox-material-' + codename;\r\n\r\n        const input = DomBuilder.element('input', {\r\n            class: 'form-check-input',\r\n            type: 'radio',\r\n            name: 'template-material',\r\n            id: id,\r\n            value: codename,\r\n            checked: (checked) ? checked : null\r\n        });\r\n        input.addEventListener('click', () => {\r\n            this.#materialBrush = brush;\r\n            this.#materialValue = codename;\r\n        });\r\n\r\n        const labelAttributes = {\r\n            class: 'form-check-label btn btn-secondary btn-sm',\r\n            'for': id,\r\n            style: toolInfo.getBadgeStyle()\r\n        };\r\n        return DomBuilder.div({class: 'form-check'}, [\r\n            input,\r\n            DomBuilder.element('label', labelAttributes, toolInfo.getDisplayName())\r\n        ]);\r\n    }\r\n\r\n    getThresholdValue() {\r\n        return this.#thresholdValue;\r\n    }\r\n\r\n    getMaterialBrush() {\r\n        return this.#materialBrush;\r\n    }\r\n\r\n    getMaxWidth() {\r\n        return this.#maxWidth;\r\n    }\r\n\r\n    getMaxHeight() {\r\n        return this.#maxHeight;\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport DomBuilder from \"./DomBuilder.js\";\r\nimport ElementArea from \"../core/ElementArea.js\";\r\nimport Resources from \"../io/Resources.js\";\r\nimport ResourceUtils from \"../io/ResourceUtils\";\r\nimport Analytics from \"../Analytics.js\";\r\nimport Scene from \"../core/scene/Scene\";\r\nimport Tool from \"../core/tool/Tool\";\r\nimport Tools from \"../core/tool/Tools\";\r\nimport InsertElementAreaTool from \"../core/tool/InsertElementAreaTool\";\r\nimport InsertRandomSceneTool from \"../core/tool/InsertRandomSceneTool\";\r\nimport ComponentFormTemplate from \"./component/ComponentFormTemplate\";\r\n\r\n// TODO: refactor\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-02-06\r\n */\r\nexport default class ServiceIO {\r\n\r\n    /** @type Controller */\r\n    #controller;\r\n\r\n    /** @type ComponentFormTemplate */\r\n    #templateForm;\r\n\r\n    constructor(controller) {\r\n        this.#controller = controller;\r\n        this.#templateForm = new ComponentFormTemplate();\r\n    }\r\n\r\n    initFileDragAndDrop(domNode) {\r\n        ['dragenter', 'dragover'].forEach(eventName => {\r\n            domNode.addEventListener(eventName, e => {\r\n                e.preventDefault()\r\n                e.stopPropagation()\r\n                domNode.classList.add('drag-and-drop-highlight');\r\n            });\r\n        });\r\n\r\n        domNode.addEventListener('dragleave', e => {\r\n            e.preventDefault()\r\n            e.stopPropagation()\r\n            domNode.classList.remove('drag-and-drop-highlight');\r\n        });\r\n\r\n        domNode.addEventListener('drop', e => {\r\n            e.preventDefault()\r\n            e.stopPropagation()\r\n            domNode.classList.remove('drag-and-drop-highlight');\r\n\r\n            this.loadFromFiles(e.dataTransfer.files);\r\n        });\r\n    }\r\n\r\n    loadFromFiles(files) {\r\n        if (!files) {\r\n            return;\r\n        }\r\n        let file = files[0];\r\n\r\n        let reader = new FileReader();\r\n        reader.onload = (readerEvent) => {\r\n            let content = readerEvent.target.result;\r\n            this.loadFromArrayBuffer(content, file.name);\r\n        }\r\n        reader.readAsArrayBuffer(file);\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param content {ArrayBuffer}\r\n     * @param filename {string}\r\n     */\r\n    loadFromArrayBuffer(content, filename) {\r\n        try {\r\n            let imageTypeOrNull = ResourceUtils.getImageTypeOrNull(filename);\r\n            if (imageTypeOrNull !== null) {\r\n                this.#loadImageTemplate(content, imageTypeOrNull);\r\n            } else if (filename.endsWith(\".json\")) {\r\n                Resources.parseJsonResource(content)\r\n                        .then(resource => this.#importResource(resource))\r\n                        .catch(e => this.#handleError(e));\r\n            } else {\r\n                Resources.parseZipResource(content)\r\n                        .then(resource => this.#importResource(resource))\r\n                        .catch(e => this.#handleError(e));\r\n            }\r\n        } catch (e) {\r\n            this.#handleError(e);\r\n        }\r\n    }\r\n\r\n    #loadImageTemplate(content, imageType) {\r\n        const handleImageTemplate = (brush, threshold, maxWidth, maxHeight) => {\r\n            const objectUrl = ResourceUtils.asObjectUrl(content, imageType);\r\n            const defaultElement = ElementArea.TRANSPARENT_ELEMENT;\r\n            ResourceUtils.loadImageData(objectUrl, maxWidth, maxHeight)\r\n                .then(imageData => {\r\n                    try {\r\n                        const scene = ResourceUtils.createSceneFromImageTemplate(imageData, brush, defaultElement, threshold);\r\n                        this.#importImageTemplate(scene);\r\n                    } catch (e) {\r\n                        this.#handleError(e);\r\n                    }\r\n                })\r\n                .catch(e => this.#handleError(e));\r\n        };\r\n\r\n        let dialog = DomBuilder.bootstrapDialogBuilder();\r\n        dialog.setHeaderContent('Image template');\r\n        dialog.setBodyContent(this.#templateForm.createNode());\r\n        dialog.addSubmitButton('Place', () => {\r\n            let materialBrush = this.#templateForm.getMaterialBrush();\r\n            let thresholdValue = this.#templateForm.getThresholdValue();\r\n            let maxWidth = this.#templateForm.getMaxWidth();\r\n            let maxHeight = this.#templateForm.getMaxHeight();\r\n            handleImageTemplate(materialBrush, thresholdValue, maxWidth, maxHeight);\r\n        });\r\n        dialog.addCloseButton('Close');\r\n        dialog.show(this.#controller.getDialogAnchor());\r\n    }\r\n\r\n    #importImageTemplate(scene) {\r\n        this.#controller.pasteScene(scene);\r\n        Analytics.triggerFeatureUsed(Analytics.FEATURE_IO_IMAGE_TEMPLATE);\r\n    }\r\n\r\n    #importResource(resource) {\r\n        if (resource instanceof Scene) {\r\n            this.#importScene(resource);\r\n\r\n        } else if (resource instanceof Tool) {\r\n            const tool = resource;\r\n            const toolManager = this.#controller.getToolManager();\r\n            if (tool instanceof InsertElementAreaTool || tool instanceof InsertRandomSceneTool) {\r\n                const revert = toolManager.createRevertAction();\r\n                toolManager.setPrimaryTool(tool);\r\n                toolManager.setSecondaryTool(Tools.actionTool(revert));\r\n            } else {\r\n                toolManager.setPrimaryTool(tool);\r\n            }\r\n\r\n        } else {\r\n            this.#handleError('Unknown resource type');\r\n        }\r\n    }\r\n\r\n    #importScene(scene) {\r\n        try {\r\n            let dialog = DomBuilder.bootstrapDialogBuilder();\r\n            dialog.setHeaderContent('Import scene');\r\n            dialog.setBodyContent([\r\n                DomBuilder.par(null, \"The imported scene can be opened or placed on the current scene.\")\r\n            ]);\r\n            dialog.addSubmitButton('Open', () => {\r\n                Analytics.triggerFeatureUsed(Analytics.FEATURE_IO_IMPORT);\r\n                return this.#controller.openScene(scene);\r\n            });\r\n            dialog.addSubmitButton('Place', () => {\r\n                Analytics.triggerFeatureUsed(Analytics.FEATURE_IO_IMPORT);\r\n                return this.#controller.pasteScene(scene);\r\n            });\r\n            dialog.addCloseButton('Close');\r\n            dialog.show(this.#controller.getDialogAnchor());\r\n        } catch (ex) {\r\n            this.#handleError(ex);\r\n        }\r\n    }\r\n\r\n    #handleError(e) {\r\n        let dialog = DomBuilder.bootstrapDialogBuilder();\r\n        dialog.setHeaderContent('Error');\r\n        dialog.setBodyContent([\r\n            DomBuilder.par(null, \"Error while loading resource:\"),\r\n            DomBuilder.element('code', null, '' + e)\r\n        ]);\r\n        dialog.addCloseButton('Close');\r\n        dialog.show(this.#controller.getDialogAnchor());\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport ElementTail from \"../ElementTail\";\r\nimport ElementArea from \"../ElementArea\";\r\nimport RenderingMode from \"./RenderingMode\";\r\nimport Renderer from \"./Renderer\";\r\n\r\n/**\r\n * Double buffered renderer. With motion blur.\r\n *\r\n * @author Patrik Harag\r\n * @version 2023-08-27\r\n */\r\nexport default class Renderer2D extends Renderer {\r\n\r\n    /**\r\n     *\r\n     * @param elementArea {ElementArea}\r\n     * @param context {CanvasRenderingContext2D}\r\n     * @param alpha 0x00 = fully transparent, 0xFF = fully opaque\r\n     */\r\n    static renderPreview(elementArea, context, alpha=0xFF) {\r\n        const w = elementArea.getWidth();\r\n        const h = elementArea.getHeight();\r\n\r\n        const buffer = context.createImageData(w, h);\r\n        const data = buffer.data;\r\n\r\n        for (let x = 0; x < w; x++) {\r\n            for (let y = 0; y < h; y++) {\r\n                const pixelIndex = w * y + x;\r\n                const dataIndex = pixelIndex * 4;\r\n\r\n                const elementTail = elementArea.getElementTail(x, y);\r\n\r\n                if (elementTail === ElementArea.TRANSPARENT_ELEMENT.elementTail\r\n                        && elementArea.getElementHead(x, y) === ElementArea.TRANSPARENT_ELEMENT.elementHead) {\r\n\r\n                    // transparent\r\n                    data[dataIndex + 3] = 0;\r\n                } else {\r\n                    data[dataIndex] = ElementTail.getColorRed(elementTail);\r\n                    data[dataIndex + 1] = ElementTail.getColorGreen(elementTail);\r\n                    data[dataIndex + 2] = ElementTail.getColorBlue(elementTail);\r\n                    data[dataIndex + 3] = alpha;\r\n                }\r\n            }\r\n        }\r\n\r\n        context.putImageData(buffer, 0, 0, 0, 0, w, h);\r\n    }\r\n\r\n\r\n    /** @type CanvasRenderingContext2D */\r\n    #context;\r\n\r\n    /** @type RenderingMode|null */\r\n    #mode = null;\r\n\r\n    /** @type ElementArea */\r\n    #elementArea;\r\n\r\n    /** @type number */\r\n    #width;\r\n    /** @type number */\r\n    #height;\r\n\r\n    /** @type number */\r\n    #chunkSize;\r\n    /** @type number */\r\n    #horChunkCount;\r\n    /** @type number */\r\n    #verChunkCount;\r\n\r\n    /** @type boolean[] */\r\n    #triggeredChunks\r\n\r\n    /** @type ImageData */\r\n    #buffer;\r\n\r\n    /** @type boolean[] */\r\n    #blur;\r\n\r\n    /** @type boolean[] */\r\n    #canBeBlurred;\r\n\r\n    constructor(elementArea, chunkSize, context) {\r\n        super();\r\n        this.#context = context;\r\n        this.#elementArea = elementArea;\r\n        this.#width = elementArea.getWidth();\r\n        this.#height = elementArea.getHeight();\r\n\r\n        this.#chunkSize = chunkSize;\r\n        this.#horChunkCount = Math.ceil(this.#width / this.#chunkSize);\r\n        this.#verChunkCount = Math.ceil(this.#height / this.#chunkSize);\r\n        this.#triggeredChunks = new Array(this.#horChunkCount * this.#verChunkCount).fill(true);\r\n\r\n        this.#buffer = this.#context.createImageData(this.#width, this.#height);\r\n        // set up alpha color component\r\n        const data = this.#buffer.data;\r\n        for (let y = 0; y < this.#height; y++) {\r\n            for (let x = 0; x < this.#width; x++) {\r\n                let index = 4 * (this.#width * y + x);\r\n                data[index + 3] = 0xFF;\r\n            }\r\n        }\r\n\r\n        this.#blur = new Array(this.#width * this.#height).fill(false);\r\n        this.#canBeBlurred = new Array(this.#width * this.#height).fill(false);\r\n    }\r\n\r\n    trigger(x, y) {\r\n        const cx = Math.trunc(x / this.#chunkSize);\r\n        const cy = Math.trunc(y / this.#chunkSize);\r\n        const chunkIndex = cy * this.#horChunkCount + cx;\r\n        this.#triggeredChunks[chunkIndex] = true;\r\n    }\r\n\r\n    triggerChunk(cx, cy) {\r\n        const chunkIndex = cy * this.#horChunkCount + cx;\r\n        this.#triggeredChunks[chunkIndex] = true;\r\n    }\r\n\r\n    triggerChunks(activeChunks) {\r\n        if (activeChunks.length !== this.#triggeredChunks.length) {\r\n            throw 'Array must be of the same size';\r\n        }\r\n        for (let i = 0; i < activeChunks.length; i++) {\r\n            const active = activeChunks[i];\r\n            if (active) {\r\n                this.#triggeredChunks[i] = active;\r\n            }\r\n        }\r\n    }\r\n\r\n    setMode(mode) {\r\n        this.#mode = mode;\r\n        // ensure repaint\r\n        this.#triggeredChunks.fill(true);\r\n        this.#blur.fill(false);\r\n        this.#canBeBlurred.fill(false);\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param changedChunks {boolean[]}\r\n     * @return {void}\r\n     */\r\n    render(changedChunks) {\r\n        for (let cy = 0; cy < this.#verChunkCount; cy++) {\r\n            for (let cx = 0; cx < this.#horChunkCount; cx++) {\r\n                const chunkIndex = cy * this.#horChunkCount + cx;\r\n\r\n                const triggered = this.#triggeredChunks[chunkIndex];\r\n                if (triggered) {\r\n                    // unset\r\n                    this.#triggeredChunks[chunkIndex] = false;\r\n                }\r\n\r\n                const changed = changedChunks[chunkIndex];\r\n                if (changed) {\r\n                    // repaint at least once\r\n                    this.#triggeredChunks[chunkIndex] = true;\r\n                }\r\n\r\n                if (triggered || changed) {\r\n\r\n                    // neighbours can be changed without triggering\r\n                    let includeRowUnder = false;\r\n                    if (cy + 1 < this.#horChunkCount) {\r\n                        const chunkIndexUnder = (cy + 1) * this.#horChunkCount + cx;\r\n                        if (!this.#triggeredChunks[chunkIndexUnder] && !changedChunks[chunkIndexUnder]) {\r\n                            includeRowUnder = true;\r\n                        }\r\n                    }\r\n\r\n                    this.#renderChunk(cx, cy, includeRowUnder);\r\n                }\r\n            }\r\n        }\r\n\r\n        // TODO: ? multiple partial putImageData\r\n        this.#context.putImageData(this.#buffer, 0, 0, 0, 0, this.#width, this.#height);\r\n    }\r\n\r\n    #renderChunk(cx, cy, includeRowUnder) {\r\n        const mx = Math.min((cx + 1) * this.#chunkSize, this.#width);\r\n        const my = Math.min((cy + 1) * this.#chunkSize + (includeRowUnder ? 1 : 0), this.#height);\r\n        for (let y = cy * this.#chunkSize; y < my; y++) {\r\n            for (let x = cx * this.#chunkSize; x < mx; x++) {\r\n                this.#renderPixel(x, y, this.#buffer.data);\r\n            }\r\n        }\r\n    }\r\n\r\n    #renderPixel(x, y, data) {\r\n        const elementTail = this.#elementArea.getElementTail(x, y);\r\n\r\n        const pixelIndex = this.#width * y + x;\r\n        const dataIndex = pixelIndex * 4;\r\n\r\n        const blurBehaviour = ElementTail.getBlurType(elementTail);\r\n\r\n        if (blurBehaviour === ElementTail.BLUR_TYPE_BACKGROUND) {\r\n            // motion blur\r\n\r\n            if (this.#canBeBlurred[pixelIndex] && Renderer2D.#isWhite(elementTail)) {\r\n                // init fading here\r\n\r\n                this.#blur[pixelIndex] = true;\r\n                this.#canBeBlurred[pixelIndex] = false;\r\n            }\r\n\r\n            if (this.#blur[pixelIndex]) {\r\n                // paint - continue fading\r\n\r\n                const r = data[dataIndex];\r\n                const g = data[dataIndex + 1];\r\n                const b = data[dataIndex + 2];\r\n\r\n                const alpha = 0.875 + (Math.random() * 0.1 - 0.05);\r\n                const whiteBackground = 255 * (1.0 - alpha);\r\n\r\n                const nr = Math.trunc((r * alpha) + whiteBackground);\r\n                const ng = Math.trunc((g * alpha) + whiteBackground);\r\n                const nb = Math.trunc((b * alpha) + whiteBackground);\r\n\r\n                if (r === nr && g === ng && b === nb) {\r\n                    // no change => fading completed\r\n                    this.#blur[pixelIndex] = false;\r\n                    data[dataIndex] = 0xFF;\r\n                    data[dataIndex + 1] = 0xFF;\r\n                    data[dataIndex + 2] = 0xFF;\r\n                } else {\r\n                    data[dataIndex] = nr;\r\n                    data[dataIndex + 1] = ng;\r\n                    data[dataIndex + 2] = nb;\r\n                    this.trigger(x, y);  // request next repaint\r\n                }\r\n                return;\r\n            }\r\n        }\r\n\r\n        // paint - no blur\r\n        if (this.#mode === null) {\r\n            data[dataIndex] = ElementTail.getColorRed(elementTail);\r\n            data[dataIndex + 1] = ElementTail.getColorGreen(elementTail);\r\n            data[dataIndex + 2] = ElementTail.getColorBlue(elementTail);\r\n            this.#canBeBlurred[pixelIndex] = (blurBehaviour === ElementTail.BLUR_TYPE_1);\r\n            this.#blur[pixelIndex] = false;\r\n        } else {\r\n            // custom rendering mode\r\n            let elementHead = this.#elementArea.getElementHead(x, y);\r\n            this.#mode.apply(data, dataIndex, elementHead, elementTail);\r\n        }\r\n    }\r\n\r\n    static #isWhite(element) {\r\n        return ElementTail.getColorRed(element) === 255\r\n            && ElementTail.getColorGreen(element) === 255\r\n            && ElementTail.getColorBlue(element) === 255;\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport Renderer2D from \"./Renderer2D\";\r\nimport RendererInitializer from \"./RendererInitializer\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-04-06\r\n */\r\nexport default class RendererInitializer2D extends RendererInitializer {\r\n\r\n    #mode;\r\n\r\n    constructor(mode) {\r\n        super();\r\n        this.#mode = mode;\r\n    }\r\n\r\n    getContextType() {\r\n        return '2d';\r\n    }\r\n\r\n    initialize(elementArea, chunkSize, context) {\r\n        let renderer = new Renderer2D(elementArea, chunkSize, context);\r\n        if (this.#mode !== null) {\r\n            renderer.setMode(this.#mode);\r\n        }\r\n        return renderer;\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport ElementArea from \"../ElementArea\";\r\nimport Renderer from \"./Renderer\";\r\n\r\nimport _ASSET_PALETTE_TEMPERATURE_COLORS from './assets/temperature.palette.csv';\r\n\r\nimport _SHADER_BLUR_VERT from './shaders/blur.vert.glsl';\r\nimport _SHADER_BLUR_FRAG from './shaders/blur.frag.glsl';\r\nimport _SHADER_MERGING_VERT from './shaders/merging.vert.glsl';\r\nimport _SHADER_MERGING_FRAG from './shaders/merging.frag.glsl';\r\n\r\n\r\n// TODO: Currently element tail bytes are stored as floats (0..1) in texture and then transformed back to integers\r\n// TODO: https://www.khronos.org/webgl/wiki/HandlingContextLost\r\n\r\n/**\r\n * WebGL renderer.\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-06-02\r\n */\r\nexport default class RendererWebGL extends Renderer {\r\n\r\n    /** @type WebGLRenderingContext */\r\n    #context;\r\n\r\n    /** @type ElementArea */\r\n    #elementArea;\r\n\r\n    /** @type number */\r\n    #width;\r\n    /** @type number */\r\n    #height;\r\n\r\n    #doRendering;\r\n\r\n    #timeStartMs;\r\n\r\n    constructor(elementArea, chunkSize, context) {\r\n        super();\r\n        this.#context = context;\r\n        this.#elementArea = elementArea;\r\n        this.#width = elementArea.getWidth();\r\n        this.#height = elementArea.getHeight();\r\n        this.#timeStartMs = new Date().getTime();\r\n\r\n        const gl = this.#context;\r\n\r\n        // --- build programs\r\n\r\n        const temperaturePaletteData = this.#parsePalette(_ASSET_PALETTE_TEMPERATURE_COLORS);\r\n        const temperaturePaletteSize = temperaturePaletteData.byteLength / 4;\r\n\r\n        const blurProgram = this.#loadProgram(gl, _SHADER_BLUR_VERT, _SHADER_BLUR_FRAG);\r\n        const blurProgramLocationTime = gl.getUniformLocation(blurProgram, \"u_time\");\r\n        const blurProgramLocationElementHeads = gl.getUniformLocation(blurProgram, \"u_element_heads\");\r\n        const blurProgramLocationElementTails = gl.getUniformLocation(blurProgram, \"u_element_tails\");\r\n        const blurProgramLocationBlur = gl.getUniformLocation(blurProgram, \"u_blur\");\r\n        const blurProgramLocationTemperaturePalette = gl.getUniformLocation(blurProgram, \"u_temperature_palette\");\r\n\r\n        const mergeProgram = this.#loadProgram(gl, _SHADER_MERGING_VERT, _SHADER_MERGING_FRAG);\r\n        const mergeProgramLocationElementHeads = gl.getUniformLocation(mergeProgram, \"u_element_heads\");\r\n        const mergeProgramLocationElementTails = gl.getUniformLocation(mergeProgram, \"u_element_tails\");\r\n        const mergeProgramLocationBlur = gl.getUniformLocation(mergeProgram, \"u_blur\");\r\n        const mergeProgramLocationTemperaturePalette = gl.getUniformLocation(mergeProgram, \"u_temperature_palette\");\r\n\r\n        // --- setup a unit quad\r\n\r\n        const positions = [\r\n            1,  1,\r\n            -1,  1,\r\n            -1, -1,\r\n            1,  1,\r\n            -1, -1,\r\n            1, -1,\r\n        ];\r\n        const vertBuffer = gl.createBuffer();\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, vertBuffer);\r\n        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(positions), gl.STATIC_DRAW);\r\n        gl.enableVertexAttribArray(0);\r\n        gl.vertexAttribPointer(0, 2, gl.FLOAT, false, 0, 0);\r\n\r\n        // --- prepare texture and associated frame buffer for motion blur\r\n        // it is not possible to sample a texture and render to that same texture at the same time\r\n        // two textures needs to be used - \"ping-pong\" approach\r\n\r\n        const createTextureAndFrameBuffer = (textureId) => {\r\n            const motionBlurData = new Uint8Array(this.#elementArea.getDataTails().byteLength).fill(0xFF);\r\n            const motionBlurTexture = gl.createTexture();\r\n            gl.activeTexture(textureId);\r\n            gl.bindTexture(gl.TEXTURE_2D, motionBlurTexture);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n            gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, this.#width, this.#height, 0, gl.RGBA, gl.UNSIGNED_BYTE, motionBlurData);\r\n\r\n            const motionBlurFrameBuffer = gl.createFramebuffer();\r\n            gl.bindFramebuffer(gl.FRAMEBUFFER, motionBlurFrameBuffer);\r\n            gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, motionBlurTexture, 0);\r\n\r\n            return motionBlurFrameBuffer;\r\n        }\r\n\r\n        const motionBlurFrameBuffer1 = createTextureAndFrameBuffer(gl.TEXTURE2);\r\n        const motionBlurFrameBuffer2 = createTextureAndFrameBuffer(gl.TEXTURE3);\r\n\r\n        // --- prepare element heads texture - TEXTURE0\r\n        // move the texture definition into rendering loop to create a memory leak - to test WebGL failure recovery\r\n\r\n        const elementHeadsTexture = gl.createTexture();\r\n        gl.activeTexture(gl.TEXTURE0);\r\n        gl.bindTexture(gl.TEXTURE_2D, elementHeadsTexture);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n\r\n        // --- prepare element tails texture - TEXTURE1\r\n        const elementTailsTexture = gl.createTexture();\r\n        gl.activeTexture(gl.TEXTURE1);\r\n        gl.bindTexture(gl.TEXTURE_2D, elementTailsTexture);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n\r\n        // --- prepare temperature colors\r\n\r\n        const temperaturePaletteTexture = gl.createTexture();\r\n        gl.activeTexture(gl.TEXTURE4);\r\n        gl.bindTexture(gl.TEXTURE_2D, temperaturePaletteTexture);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n\r\n        // ---\r\n\r\n        let blurTextureIndex = 2;  // \"ping-pong\" approach - see above\r\n        this.#doRendering = () => {\r\n\r\n            // update element heads texture\r\n            const elementHeads = new Uint8Array(this.#elementArea.getDataHeads());\r\n            gl.bindTexture(gl.TEXTURE_2D, elementHeadsTexture);\r\n            gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, this.#width, this.#height, 0, gl.RGBA, gl.UNSIGNED_BYTE, elementHeads);\r\n\r\n            // update element tails texture\r\n            const elementTails = new Uint8Array(this.#elementArea.getDataTails());\r\n            gl.bindTexture(gl.TEXTURE_2D, elementTailsTexture);\r\n            gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, this.#width, this.#height, 0, gl.RGBA, gl.UNSIGNED_BYTE, elementTails);\r\n\r\n            // update color palette texture\r\n            gl.bindTexture(gl.TEXTURE_2D, temperaturePaletteTexture);\r\n            gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, temperaturePaletteSize, 1, 0, gl.RGBA, gl.UNSIGNED_BYTE, temperaturePaletteData);\r\n\r\n            // render blurrable elements and blur into a texture\r\n            // - reduce blur from previous iterations (fading out) and render blurrable elements over\r\n            gl.bindFramebuffer(gl.FRAMEBUFFER, blurTextureIndex === 2 ? motionBlurFrameBuffer1 : motionBlurFrameBuffer2);\r\n\r\n            gl.useProgram(blurProgram);\r\n            gl.uniform1f(blurProgramLocationTime, (new Date().getTime() - this.#timeStartMs) * 0.001);  // in seconds...\r\n            gl.uniform1i(blurProgramLocationElementHeads, 0);  // texture 0\r\n            gl.uniform1i(blurProgramLocationElementTails, 1);  // texture 1\r\n            gl.uniform1i(blurProgramLocationBlur, (blurTextureIndex === 2) ? 3 : 2);  // texture 3 or 2\r\n            gl.uniform1i(blurProgramLocationTemperaturePalette, 4);  // texture 4\r\n\r\n            gl.drawArrays(gl.TRIANGLES, 0, positions.length / 2);\r\n\r\n            // render to canvas\r\n            // - blurrable elements and blur will be merged with elements that cannot be blurred\r\n            gl.bindFramebuffer(gl.FRAMEBUFFER, null);\r\n\r\n            gl.useProgram(mergeProgram);\r\n            gl.uniform1i(mergeProgramLocationElementHeads, 0);  // texture 0\r\n            gl.uniform1i(mergeProgramLocationElementTails, 1);  // texture 1\r\n            gl.uniform1i(mergeProgramLocationBlur, blurTextureIndex);  // texture 2 or 3\r\n            gl.uniform1i(mergeProgramLocationTemperaturePalette, 4);  // texture 4\r\n\r\n            gl.drawArrays(gl.TRIANGLES, 0, positions.length / 2);\r\n\r\n            blurTextureIndex = (blurTextureIndex === 2) ? 3 : 2;  // swap textures 2 and 3\r\n        };\r\n    }\r\n\r\n    trigger(x, y) {\r\n        // ignore\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param changedChunks {boolean[]}\r\n     * @return {void}\r\n     */\r\n    render(changedChunks) {\r\n        this.#doRendering();\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param gl {WebGLRenderingContext} The WebGLRenderingContext to use.\r\n     * @param vertexShader {string} vertex shader code\r\n     * @param fragmentShader {string} fragment shader code\r\n     * @return {WebGLProgram}\r\n     */\r\n    #loadProgram(gl, vertexShader, fragmentShader) {\r\n        const program = gl.createProgram();\r\n\r\n        gl.attachShader(program, this.#loadShader(gl, vertexShader, gl.VERTEX_SHADER));\r\n        gl.bindAttribLocation(program, 0, \"a_position\");\r\n\r\n        gl.attachShader(program, this.#loadShader(gl, fragmentShader, gl.FRAGMENT_SHADER));\r\n\r\n        gl.linkProgram(program);\r\n\r\n        // Check the link status\r\n        if (!gl.getProgramParameter(program, gl.LINK_STATUS) && !gl.isContextLost()) {\r\n            // Something went wrong with the link\r\n            const lastError = gl.getProgramInfoLog(program);\r\n            throw `Error in program linking: ${lastError}`;\r\n        }\r\n\r\n        return program;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param gl {WebGLRenderingContext} The WebGLRenderingContext to use.\r\n     * @param shaderSource {string} The shader source.\r\n     * @param shaderType {number} The type of shader.\r\n     * @return {WebGLShader}\r\n     */\r\n    #loadShader(gl, shaderSource, shaderType) {\r\n        // Create the shader object\r\n        const shader = gl.createShader(shaderType);\r\n        if (shader === null) {\r\n            throw 'Error compiling shader: cannot create shader';\r\n        }\r\n\r\n        // Load the shader source\r\n        gl.shaderSource(shader, shaderSource);\r\n\r\n        // Compile the shader\r\n        gl.compileShader(shader);\r\n\r\n        // Check the compile status\r\n        if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS) && !gl.isContextLost()) {\r\n            // Something went wrong during compilation; get the error\r\n            const lastError = gl.getShaderInfoLog(shader);\r\n            throw `Error compiling shader: ${lastError}`;\r\n        }\r\n\r\n        return shader;\r\n    }\r\n\r\n    #parsePalette(palette) {\r\n        const colors = palette.split('\\n').map(line => line.split(',').map(Number));\r\n        const array = new Uint8Array(colors.length * 4);\r\n        for (let i = 0; i < colors.length; i++) {\r\n            const color = colors[i];\r\n            array[i * 4] = color[0];  // r\r\n            array[i * 4 + 1] = color[1];  // g\r\n            array[i * 4 + 2] = color[2];  // b\r\n        }\r\n        return array;\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-04-06\r\n */\r\nexport default class RenderingWebGLException {\r\n\r\n    #error;\r\n\r\n    constructor(error) {\r\n        this.#error = error;\r\n    }\r\n\r\n    getError() {\r\n        return this.#error;\r\n    }\r\n}\r\n","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport RendererWebGL from \"./RendererWebGL\";\r\nimport RenderingWebGLException from \"./RenderingWebGLException\";\r\nimport RendererInitializer from \"./RendererInitializer\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-04-06\r\n */\r\nexport default class RendererInitializerWebGL extends RendererInitializer {\r\n\r\n    getContextType() {\r\n        return 'webgl2';\r\n    }\r\n\r\n    initialize(elementArea, chunkSize, context) {\r\n        try {\r\n            return new RendererWebGL(elementArea, chunkSize, context);\r\n        } catch (e) {\r\n            throw new RenderingWebGLException(e);\r\n        }\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport RendererInitializer2D from \"../core/rendering/RendererInitializer2D\";\r\nimport RendererInitializerWebGL from \"../core/rendering/RendererInitializerWebGL\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-05-25\r\n */\r\nexport default class RendererInitializerDefs {\r\n\r\n    static canvas2d(renderingMode = null) {\r\n        return new RendererInitializer2D(renderingMode);\r\n    }\r\n\r\n    static canvasWebGL() {\r\n        return new RendererInitializerWebGL();\r\n    }\r\n}\r\n","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\n/**\r\n * @interface\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-04-12\r\n */\r\nexport default class BrushCollection {\r\n\r\n    /**\r\n     *\r\n     * @returns {Object.<string,Brush>}\r\n     */\r\n    getExtraBrushes() {\r\n        throw 'Not implemented';\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param codeName {string}\r\n     * @returns {Brush|null}\r\n     */\r\n    byCodeName(codeName) {\r\n        throw 'Not implemented';\r\n    }\r\n}\r\n","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport BrushCollection from \"../core/brush/BrushCollection\";\r\nimport BrushDefs from \"./BrushDefs\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-04-12\r\n */\r\nexport default class BrushCollectionImpl extends BrushCollection {\r\n\r\n    /**\r\n     * @type {Object.<string,Brush>}\r\n     */\r\n    #extraBrushes;\r\n\r\n    constructor(extraBrushes) {\r\n        super();\r\n        this.#extraBrushes = extraBrushes;\r\n    }\r\n\r\n    getExtraBrushes() {\r\n        return { ...this.#extraBrushes };\r\n    }\r\n\r\n    byCodeName(codeName) {\r\n        const brush = this.#extraBrushes[codeName];\r\n        if (brush !== undefined) {\r\n            return brush;\r\n        }\r\n        return BrushDefs.byCodeName(codeName);\r\n    }\r\n}\r\n","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport GameDefaults from \"../core/GameDefaults\";\r\nimport Element from \"../core/Element\";\r\nimport Brush from \"../core/brush/Brush\";\r\nimport BrushDefs from \"./BrushDefs\";\r\nimport StructureDefs from \"./StructureDefs\";\r\nimport BrushCollectionImpl from \"./BrushCollectionImpl\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-04-27\r\n */\r\nexport default class GameDefaultsImpl extends GameDefaults {\r\n\r\n    /** @type function(GameState):Extension[] */ #extensionsFactory;\r\n\r\n    /** @type BrushCollection */ #brushCollection;\r\n\r\n    /** @type Element */ #defaultElement;\r\n\r\n    /** @type Brush */ #brushWater;\r\n    /** @type Brush */ #brushSteam;\r\n    /** @type Brush */ #brushGrass ;\r\n    /** @type Brush */ #brushTree;\r\n    /** @type Brush */ #brushTreeWood;\r\n    /** @type Brush */ #brushTreeWoodDark;\r\n    /** @type Brush */ #brushTreeLeaf;\r\n    /** @type Brush */ #brushTreeLeafDark;\r\n    /** @type Brush */ #brushTreeRoot;\r\n    /** @type Brush */ #brushFire;\r\n    /** @type Brush */ #brushAsh;\r\n\r\n    /**\r\n     *\r\n     * @param extraBrushes {Object.<string, Brush>}\r\n     * @param extensionsFactory {function(GameState):Extension[]}\r\n     */\r\n    constructor(extraBrushes = {}, extensionsFactory = () => []) {\r\n        super();\r\n\r\n        this.#extensionsFactory = extensionsFactory;\r\n        this.#brushCollection = new BrushCollectionImpl(extraBrushes);\r\n\r\n        function resolveBrush(codeName) {\r\n            const brush = extraBrushes[codeName];\r\n            if (brush === undefined || brush === null) {\r\n                const byCodeName = BrushDefs.byCodeName(codeName);\r\n                if (byCodeName === null) {\r\n                    throw `Brush '${codeName}' not found`;\r\n                }\r\n                return byCodeName;\r\n            } else {\r\n                if (brush instanceof Brush) {\r\n                    return brush;\r\n                }\r\n                throw `Provided brush '${codeName}' is not instance of Brush`;\r\n            }\r\n        }\r\n\r\n        this.#defaultElement = resolveBrush('air').apply(0, 0, undefined);\r\n\r\n        this.#brushWater = resolveBrush('water');\r\n        this.#brushSteam = resolveBrush('steam');\r\n        this.#brushGrass = resolveBrush('grass');\r\n        this.#brushTree = resolveBrush('tree');\r\n        this.#brushTreeWood = resolveBrush('tree_wood');\r\n        this.#brushTreeWoodDark = resolveBrush('tree_wood_dark');\r\n        this.#brushTreeLeaf = resolveBrush('tree_leaf');\r\n        this.#brushTreeLeafDark = resolveBrush('tree_leaf_dark');\r\n        this.#brushTreeRoot = resolveBrush('tree_root');\r\n        this.#brushFire = resolveBrush('fire');\r\n        this.#brushAsh = resolveBrush('ash');\r\n    }\r\n\r\n    getExtensionsFactory() {\r\n        return this.#extensionsFactory;\r\n    }\r\n\r\n    getBrushCollection() {\r\n        return this.#brushCollection;\r\n    }\r\n\r\n    getDefaultElement() {\r\n        return this.#defaultElement;\r\n    }\r\n\r\n    // brushes\r\n\r\n    getBrushWater() {\r\n        return this.#brushWater;\r\n    }\r\n\r\n    getBrushSteam() {\r\n        return this.#brushSteam;\r\n    }\r\n\r\n    getBrushGrass() {\r\n        return this.#brushGrass;\r\n    }\r\n\r\n    getBrushTree() {\r\n        return this.#brushTree;\r\n    }\r\n\r\n    getBrushTreeLeaf() {\r\n        return this.#brushTreeLeaf;\r\n    }\r\n\r\n    getBrushTreeLeafDark() {\r\n        return this.#brushTreeLeafDark;\r\n    }\r\n\r\n    getBrushTreeWood() {\r\n        return this.#brushTreeWood;\r\n    }\r\n\r\n    getBrushTreeWoodDark() {\r\n        return this.#brushTreeWoodDark;\r\n    }\r\n\r\n    getBrushTreeRoot() {\r\n        return this.#brushTreeRoot;\r\n    }\r\n\r\n    getBrushFire() {\r\n        return this.#brushFire;\r\n    }\r\n\r\n    getBrushAsh() {\r\n        return this.#brushAsh;\r\n    }\r\n\r\n    // structures\r\n\r\n    getTreeTrunkTemplates() {\r\n        return StructureDefs.TREE_TRUNK_TEMPLATES;\r\n    }\r\n\r\n    getTreeLeafClusterTemplates() {\r\n        return StructureDefs.TREE_CLUSTER_TEMPLATES;\r\n    }\r\n}\r\n","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport ElementArea from \"../core/ElementArea\";\r\nimport SandGame from \"../core/SandGame\";\r\nimport SceneImplTmpResize from \"../core/scene/SceneImplResize\";\r\nimport ServiceToolManager from \"./ServiceToolManager\";\r\nimport ServiceIO from \"./ServiceIO\";\r\nimport RendererInitializerDefs from \"../def/RendererInitializerDefs\";\r\nimport RenderingWebGLException from \"../core/rendering/RenderingWebGLException\";\r\nimport SceneImplSnapshot from \"../core/scene/SceneImplSnapshot\";\r\nimport DomBuilder from \"./DomBuilder\";\r\nimport GameDefaultsImpl from \"../def/GameDefaultsImpl\";\r\nimport Tools from \"../core/tool/Tools\";\r\nimport ToolInfo from \"../core/tool/ToolInfo\";\r\nimport Analytics from \"../Analytics\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-05-25\r\n */\r\nexport default class Controller {\r\n\r\n    #init = {\r\n        scale: 0.5,\r\n        canvasWidthPx: 700,\r\n        canvasHeightPx: 400,\r\n        scene: 'empty'\r\n    };\r\n\r\n    /** @type number */\r\n    #currentWidthPoints;\r\n    /** @type number */\r\n    #currentHeightPoints;\r\n    /** @type number */\r\n    #currentScale;\r\n\r\n    /** @type SandGame */\r\n    #sandGame = null;\r\n    /** @type GameDefaults */\r\n    #gameDefaults;\r\n    /** @type string */\r\n    #imageRendering = 'pixelated';\r\n    /** @type function[] */\r\n    #onImageRenderingStyleChanged = [];\r\n    /** @type boolean */\r\n    #simulationEnabled = false;\r\n    #rendererInitializer = RendererInitializerDefs.canvasWebGL();\r\n\r\n    /** @type Scene|null */\r\n    #initialScene = null;\r\n\r\n    /** @type ServiceToolManager */\r\n    #serviceToolManager;\r\n    /** @type ServiceIO */\r\n    #serviceIO = new ServiceIO(this);\r\n\r\n    /** @type HTMLElement */\r\n    #dialogAnchor;\r\n\r\n    /**\r\n     * @typedef {Object} CanvasProvider\r\n     * @property {function():HTMLElement} initialize\r\n     * @property {function():HTMLElement} getCanvasNode\r\n     */\r\n    /** @type CanvasProvider|null */\r\n    #canvasProvider = null;\r\n\r\n    /**\r\n     *\r\n     * @param init\r\n     * @param dialogAnchor\r\n     * @param toolManager\r\n     * @param gameDefaults {GameDefaults}\r\n     */\r\n    constructor(init, dialogAnchor, toolManager, gameDefaults) {\r\n        if (init) {\r\n            this.#init = init;\r\n        }\r\n\r\n        this.#dialogAnchor = dialogAnchor;\r\n        this.#serviceToolManager = toolManager;\r\n        this.#gameDefaults = gameDefaults;\r\n\r\n        this.#currentWidthPoints = Math.trunc(this.#init.canvasWidthPx * this.#init.scale);\r\n        this.#currentHeightPoints = Math.trunc(this.#init.canvasHeightPx * this.#init.scale);\r\n        this.#currentScale = this.#init.scale;\r\n    }\r\n\r\n    getVersion() {\r\n        return this.#init.version;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param canvasProvider {CanvasProvider}\r\n     */\r\n    registerCanvasProvider(canvasProvider) {\r\n        this.#canvasProvider = canvasProvider;\r\n    }\r\n\r\n    /**\r\n     * Returns initial scene definition - this is needed for restart etc.\r\n     *\r\n     * @returns {Scene|null}\r\n     */\r\n    getInitialScene() {\r\n        return this.#initialScene;\r\n    }\r\n\r\n    setInitialScene(scene) {\r\n        this.#initialScene = scene;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param scene {Scene}\r\n     */\r\n    setup(scene) {\r\n        this.setInitialScene(scene);\r\n        this.#initialize(scene);\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param scene {Scene}\r\n     */\r\n    #initialize(scene) {\r\n        if (this.#canvasProvider == null) {\r\n            throw 'Illegal state: canvas provider not registered!';\r\n        }\r\n        if (this.#dialogAnchor == null) {\r\n            throw 'Illegal state: dialog anchor not registered!';\r\n        }\r\n\r\n        const [w, h] = scene.countSize(this.#currentWidthPoints, this.#currentHeightPoints);\r\n        if (w !== this.#currentWidthPoints || h !== this.#currentHeightPoints) {\r\n            this.#currentWidthPoints = w;\r\n            this.#currentHeightPoints = h;\r\n            this.#currentScale = +(w / this.#init.canvasWidthPx).toFixed(3);\r\n        }\r\n\r\n        // init game\r\n        const context = this.#initializeContext();\r\n        this.#sandGame = null;\r\n        let promise;\r\n        try {\r\n            promise = scene.createSandGame(w, h, this.#gameDefaults, context, this.#rendererInitializer);\r\n        } catch (e) {\r\n            this.#reportSeriousFailure('Initialization failed', e);\r\n            return;\r\n        }\r\n\r\n        promise.then(sandGame => {\r\n            this.#sandGame = sandGame;\r\n            this.#sandGame.graphics().replace(ElementArea.TRANSPARENT_ELEMENT, this.#gameDefaults.getDefaultElement());\r\n\r\n            // call on opened\r\n            if (this.#initialScene !== null) {\r\n                this.#initialScene.executeOnOpened(this.#sandGame);\r\n            }\r\n\r\n            // handlers\r\n            this.#onInitialized.forEach(f => f(this.#sandGame));\r\n\r\n            // start rendering\r\n            this.#sandGame.addOnRenderingFailed((e) => {\r\n                this.#reportSeriousFailure('Rendering failure', e);\r\n            });\r\n            this.#sandGame.startRendering();\r\n\r\n            // start processing - if enabled\r\n            if (this.#simulationEnabled) {\r\n                this.#sandGame.startProcessing();\r\n                this.#onStarted.forEach(f => f());\r\n            }\r\n        }).catch(e => {\r\n            if (e instanceof RenderingWebGLException) {\r\n                setTimeout(() => {\r\n                    const cause = 'WebGL renderer initialization failed (' + e.getError() + '). '\r\n                            + 'Using fallback renderer; game performance and visuals will be affected!';\r\n                    this.#restartAfterInitializationRendererFailure(cause, scene);\r\n                }, 100);\r\n            } else {\r\n                this.#reportSeriousFailure('Initialization failed', e);\r\n            }\r\n        });\r\n    }\r\n\r\n    #initializeContext() {\r\n        const canvas = this.#canvasProvider.initialize();\r\n        let contextType = this.#rendererInitializer.getContextType();\r\n        let context = this.#initializeContextAs(canvas, contextType);\r\n        if ((contextType === 'webgl2') && (context === null || context === undefined)) {\r\n            // WebGL is not supported - unsupported at all / unsupported after recent failure\r\n            // - to test this, run Chrome with --disable-3d-apis\r\n            this.#reportFirstRenderingFailure(\"Unable to get WebGL context. Using fallback renderer; game performance and visual will be affected\");\r\n            this.#rendererInitializer = RendererInitializerDefs.canvas2d();\r\n            contextType = this.#rendererInitializer.getContextType();\r\n            context = this.#initializeContextAs(canvas, contextType);\r\n            Analytics.triggerFeatureUsed(Analytics.FEATURE_RENDERER_FALLBACK);\r\n        }\r\n        return context;\r\n    }\r\n\r\n    #initializeContextAs(canvasDomNode, contextId) {\r\n        if (contextId === 'webgl2') {\r\n            // handle WebGL failures\r\n\r\n            let contextLossHandled = false;\r\n            canvasDomNode.addEventListener('webglcontextlost', (e) => {\r\n                // GPU memory leak, GPU failure, etc.\r\n                // - to test this move the texture definition into rendering loop to create a memory leak\r\n\r\n                if (this.#sandGame !== null) {\r\n                    this.#sandGame.stopRendering();  // stop rendering immediately\r\n                }\r\n\r\n                if (!contextLossHandled) {\r\n                    contextLossHandled = true;\r\n                } else {\r\n                    return;  // already handled\r\n                }\r\n\r\n                const cause = 'WebGL context loss detected. Using fallback renderer; game performance and visuals will be affected';\r\n                e.preventDefault();\r\n                setTimeout(() => {\r\n                    this.#restartAfterRenderingFailure(cause);\r\n                }, 2000);\r\n            }, false);\r\n        }\r\n        return canvasDomNode.getContext(contextId);\r\n    }\r\n\r\n    close() {\r\n        if (this.#sandGame !== null) {\r\n            this.#sandGame.stopProcessing();\r\n            this.#sandGame.stopRendering();\r\n        }\r\n        for (let func of this.#onBeforeClosed) {\r\n            func();\r\n        }\r\n    }\r\n\r\n    enableGlobalShortcuts() {\r\n        document.onkeydown = (e) => {\r\n            // handle start stop\r\n            if (e.ctrlKey && !e.altKey && !e.shiftKey && e.key === 'Enter') {\r\n                e.preventDefault();\r\n                this.switchStartStop();\r\n            }\r\n            // handle next step\r\n            if (e.ctrlKey && !e.altKey && !e.shiftKey && e.key === ' ') {\r\n                e.preventDefault();\r\n                if (this.#sandGame !== null) {\r\n                    this.#sandGame.doProcessing();\r\n                }\r\n            }\r\n            // handle fast execute\r\n            if (e.ctrlKey && !e.altKey && e.shiftKey && e.key === ' ') {\r\n                e.preventDefault();\r\n                if (this.#sandGame !== null) {\r\n                    const input = prompt('Enter the number of iterations to run', '10000');\r\n                    const iterations = Math.abs(parseInt(input));\r\n                    const timeBefore = new Date();\r\n                    for (let i = 0; i < iterations; i++) {\r\n                        this.#sandGame.doProcessing();\r\n                        if (i % 2500 === 0) {\r\n                            console.log(`Performed ${i} of ${iterations} iterations`);\r\n                        }\r\n                    }\r\n                    const timeAfter = new Date();\r\n                    const elapsedMs = timeAfter.getTime() - timeBefore.getTime();\r\n                    console.log(`Performed ${iterations} iterations in ${elapsedMs} ms`);\r\n                }\r\n            }\r\n        };\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @returns {SandGame|null}\r\n     */\r\n    getSandGame() {\r\n        return this.#sandGame;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @returns {HTMLElement|null}\r\n     */\r\n    getCanvas() {\r\n        if (this.#canvasProvider !== null) {\r\n            return this.#canvasProvider.getCanvasNode();\r\n        }\r\n        return null;\r\n    }\r\n\r\n    // controller - simulation state\r\n\r\n    /** @type function(SandGame)[] */\r\n    #onInitialized = [];\r\n    /** @type function(SandGame)[] */\r\n    #onBeforeClosed = [];\r\n    /** @type function(Scene)[] */\r\n    #onBeforeNewSceneLoaded = [];\r\n    /** @type function[] */\r\n    #onStarted = [];\r\n    /** @type function[] */\r\n    #onStopped = [];\r\n    /** @type function(type:string,message:string)[] */\r\n    #onFailure = [];\r\n\r\n    /**\r\n     *\r\n     * @param handler {function(SandGame)}\r\n     * @returns void\r\n     */\r\n    addOnInitialized(handler) {\r\n        this.#onInitialized.push(handler);\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param handler {function(Scene)}\r\n     * @returns void\r\n     */\r\n    addOnBeforeNewSceneLoaded(handler) {\r\n        this.#onBeforeNewSceneLoaded.push(handler);\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param handler {function}\r\n     * @returns void\r\n     */\r\n    addOnBeforeClosed(handler) {\r\n        this.#onBeforeClosed.push(handler);\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param handler {function}\r\n     * @returns void\r\n     */\r\n    addOnStarted(handler) {\r\n        this.#onStarted.push(handler);\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param handler {function}\r\n     * @returns void\r\n     */\r\n    addOnStopped(handler) {\r\n        this.#onStopped.push(handler);\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param handler {function(type:string,message:string)}\r\n     * @returns void\r\n     */\r\n    addOnFailure(handler) {\r\n        this.#onFailure.push(handler);\r\n    }\r\n\r\n    #restartAfterInitializationRendererFailure(cause, scene) {\r\n        this.#reportFirstRenderingFailure(cause)\r\n        this.#rendererInitializer = RendererInitializerDefs.canvas2d();  // fallback to classic CPU renderer\r\n        this.#initialize(scene);\r\n        Analytics.triggerFeatureUsed(Analytics.FEATURE_RENDERER_FALLBACK);\r\n    }\r\n\r\n    #restartAfterRenderingFailure(cause) {\r\n        this.#reportFirstRenderingFailure(cause)\r\n        const snapshot = this.createSnapshot();\r\n        this.#rendererInitializer = RendererInitializerDefs.canvas2d();  // fallback to classic CPU renderer\r\n        this.openScene(new SceneImplSnapshot(snapshot));\r\n        Analytics.triggerFeatureUsed(Analytics.FEATURE_RENDERER_FALLBACK);\r\n    }\r\n\r\n    #reportFirstRenderingFailure(message) {\r\n        console.warn(message);\r\n        for (let handler of this.#onFailure) {\r\n            handler('rendering-warning', message);\r\n        }\r\n\r\n        let toast = DomBuilder.bootstrapToastBuilder();\r\n        toast.setHeaderContent(DomBuilder.element('strong', { style: 'color: orange;' }, 'Warning'));\r\n        toast.setBodyContent(DomBuilder.par(null, message));\r\n        toast.setDelay(60000);\r\n        toast.show(this.#dialogAnchor);\r\n    }\r\n\r\n    #reportSeriousFailure(message, e) {\r\n        console.error(message, e);\r\n\r\n        // normalize exception\r\n        if (e instanceof RenderingWebGLException) {\r\n            e = e.getError();\r\n        }\r\n        if (typeof e === 'object') {\r\n            if (e.message !== undefined) {\r\n                e = '' + e.message;\r\n            } else {\r\n                e = JSON.stringify(e);\r\n            }\r\n        }\r\n\r\n        const fullMessage = message + ': ' + e;\r\n        for (let handler of this.#onFailure) {\r\n            handler('serious', fullMessage);\r\n        }\r\n\r\n        let toast = DomBuilder.bootstrapToastBuilder();\r\n        toast.setHeaderContent(DomBuilder.element('strong', { style: 'color: red;' }, 'Error'));\r\n        toast.setBodyContent(DomBuilder.par(null, fullMessage));\r\n        toast.show(this.#dialogAnchor);\r\n    }\r\n\r\n    start() {\r\n        if (this.#sandGame !== null) {\r\n            if (!this.#simulationEnabled) {\r\n                this.#sandGame.startProcessing();\r\n                this.#onStarted.forEach(f => f());\r\n            }\r\n        }\r\n        this.#simulationEnabled = true;\r\n    }\r\n\r\n    switchStartStop() {\r\n        this.#simulationEnabled = !this.#simulationEnabled;\r\n        if (this.#sandGame !== null) {\r\n            if (this.#simulationEnabled) {\r\n                this.#simulationEnabled = true;\r\n                this.#sandGame.startProcessing();\r\n                this.#onStarted.forEach(f => f());\r\n            } else {\r\n                this.#sandGame.stopProcessing();\r\n                this.#onStopped.forEach(f => f());\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @returns Snapshot\r\n     */\r\n    createSnapshot() {\r\n        if (this.#sandGame !== null) {\r\n            let snapshot = this.#sandGame.createSnapshot();\r\n            snapshot.metadata.scale = this.getCurrentScale();\r\n            if (this.#init.version !== undefined) {\r\n                snapshot.metadata.appVersion = this.#init.version;\r\n            }\r\n            return snapshot;\r\n        } else {\r\n            return null;\r\n        }\r\n    }\r\n\r\n    openScene(scene) {\r\n        for (let handler of this.#onBeforeNewSceneLoaded) {\r\n            handler(scene);\r\n        }\r\n        this.close();\r\n\r\n        this.#initialize(scene);\r\n    }\r\n\r\n    pasteScene(scene) {\r\n        const toolManager = this.getToolManager();\r\n        const revert = toolManager.createRevertAction();\r\n\r\n        toolManager.setPrimaryTool(Tools.insertScenesTool([ scene ], revert));\r\n        toolManager.setSecondaryTool(Tools.actionTool(revert));\r\n    }\r\n\r\n    // controller / canvas size\r\n\r\n    /**\r\n     *\r\n     * @returns {number}\r\n     */\r\n    getCurrentWidthPoints() {\r\n        return this.#currentWidthPoints;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @returns {number}\r\n     */\r\n    getCurrentHeightPoints() {\r\n        return this.#currentHeightPoints;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @returns {number}\r\n     */\r\n    getCurrentScale() {\r\n        return this.#currentScale;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param width\r\n     * @param height\r\n     * @param scale\r\n     * @returns void\r\n     */\r\n    changeCanvasSize(width, height, scale) {\r\n        if (typeof width !== 'number' || !(width > 0 && width < 2048)) {\r\n            throw 'Incorrect width';\r\n        }\r\n        if (typeof height !== 'number' || !(height > 0 && height < 2048)) {\r\n            throw 'Incorrect height';\r\n        }\r\n        if (typeof scale !== 'number' || !(scale > 0 && scale <= 1)) {\r\n            throw 'Incorrect scale';\r\n        }\r\n\r\n        this.close();\r\n\r\n        this.#currentWidthPoints = width;\r\n        this.#currentHeightPoints = height;\r\n        this.#currentScale = scale;\r\n\r\n        this.#initialize(new SceneImplTmpResize(this.#sandGame.createSnapshot()));\r\n    }\r\n\r\n    // controller / options\r\n\r\n    /**\r\n     *\r\n     * @param initializer {RendererInitializer}\r\n     * @returns void\r\n     */\r\n    setRendererInitializer(initializer) {\r\n        this.#rendererInitializer = initializer;\r\n        if (this.#sandGame) {\r\n            this.close();\r\n            this.#initialize(new SceneImplSnapshot(this.#sandGame.createSnapshot()));\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @returns {RendererInitializer}\r\n     */\r\n    getRendererInitializer() {\r\n        return this.#rendererInitializer;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param style {string}\r\n     * @returns void\r\n     */\r\n    setCanvasImageRenderingStyle(style) {\r\n        this.#imageRendering = style;\r\n        for (let func of this.#onImageRenderingStyleChanged) {\r\n            func(style);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @returns {string}\r\n     */\r\n    getCanvasImageRenderingStyle() {\r\n        return this.#imageRendering;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param handler {function(string)}\r\n     * @returns void\r\n     */\r\n    addOnImageRenderingStyleChanged(handler) {\r\n        this.#onImageRenderingStyleChanged.push(handler);\r\n    }\r\n\r\n    // controller / services\r\n\r\n    /**\r\n     *\r\n     * @returns {ServiceToolManager}\r\n     */\r\n    getToolManager() {\r\n        return this.#serviceToolManager;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @returns {ServiceIO}\r\n     */\r\n    getIOManager() {\r\n        return this.#serviceIO;\r\n    }\r\n\r\n    // controller / ui\r\n\r\n    /**\r\n     *\r\n     * @returns {HTMLElement}\r\n     */\r\n    getDialogAnchor() {\r\n        return this.#dialogAnchor;\r\n    }\r\n}\r\n","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport Scene from \"./Scene.js\";\r\nimport SandGame from \"../SandGame.js\";\r\nimport ElementArea from \"../ElementArea.js\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-05-08\r\n */\r\nexport default class SceneImplHardcoded extends Scene {\r\n\r\n    name;\r\n    description;\r\n\r\n    /** @type function(SandGame):Promise<any>|any */\r\n    #onCreated;\r\n\r\n    /** @type function(SandGame) */\r\n    #onOpened;\r\n\r\n    constructor({name, description, onCreated, onOpened}) {\r\n        super();\r\n        this.#onCreated = onCreated;\r\n        this.#onOpened = onOpened;\r\n        this.name = name;\r\n        this.description = description;\r\n    }\r\n\r\n    countSize(prefWidth, prefHeight) {\r\n        return [prefWidth, prefHeight];\r\n    }\r\n\r\n    async createSandGame(prefWidth, prefHeight, defaults, context, rendererInitializer) {\r\n        let elementArea = this.createElementArea(prefWidth, prefHeight, defaults.getDefaultElement());\r\n        let sandGame = new SandGame(elementArea, [], null, defaults, context, rendererInitializer);\r\n        await this.#onCreated(sandGame);\r\n        return sandGame;\r\n    }\r\n\r\n    createElementArea(prefWidth, prefHeight, defaultElement) {\r\n        return ElementArea.create(prefWidth, prefHeight, defaultElement);\r\n    }\r\n\r\n    executeOnOpened(sandGame) {\r\n        if (this.#onOpened !== undefined) {\r\n            this.#onOpened(sandGame);\r\n        }\r\n    }\r\n}\r\n","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport SceneImplHardcoded from \"./SceneImplHardcoded\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-05-08\r\n */\r\nexport default class Scenes {\r\n\r\n    /**\r\n     *\r\n     * @param name {string}\r\n     * @param onCreated {function(SandGame):Promise<any>|any}\r\n     * @param onOpened {(function(SandGame):void)|undefined}\r\n     */\r\n    static custom(name, onCreated, onOpened = undefined) {\r\n        return new SceneImplHardcoded({\r\n            name: name,\r\n            onCreated: onCreated,\r\n            onOpened: onOpened\r\n        });\r\n    }\r\n}\r\n","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport Brushes from \"../core/brush/Brushes\";\r\nimport BrushDefs from \"./BrushDefs.js\";\r\nimport SceneImplHardcoded from \"../core/scene/SceneImplHardcoded.js\";\r\nimport Resources from \"../io/Resources\";\r\nimport TemplateDefs from \"./TemplateDefs\";\r\nimport ToolDefs from \"./ToolDefs\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-04-20\r\n */\r\nexport default class SceneDefs {\r\n\r\n    /** @type Scene */\r\n    static SCENE_EMPTY = new SceneImplHardcoded({\r\n        name: 'Empty',\r\n        description: 'Boxed mode',\r\n        onCreated: function (sandGame) {\r\n            sandGame.setBoxedMode();\r\n            // empty\r\n        }\r\n    });\r\n\r\n    /** @type Scene */\r\n    static SCENE_LANDSCAPE_1 = new SceneImplHardcoded({\r\n        name: 'Landscape 1',\r\n        description: 'Boxed mode',\r\n        onCreated: async function (sandGame) {\r\n            sandGame.setBoxedMode();\r\n\r\n            const soil = sandGame.getBrushCollection().byCodeName('soil');\r\n            const sand = sandGame.getBrushCollection().byCodeName('sand');\r\n            const water = sandGame.getBrushCollection().byCodeName('water');\r\n\r\n            const m = 40;\r\n            let layeredPainter = sandGame.layeredTemplate()\r\n                .layerSpline([[0, 35], [60, 35], [40 + m, 40], [60 + m, 50], [80 + m, 40], [200 + m, 20], [400 + m, 20], [1000 + m, 20]],\r\n                    true, Brushes.concat(soil, BrushDefs.EFFECT_NOISE_LG))\r\n                .layerSpline([[0, 0], [90 + m, 0], [110 + m, 10], [150 + m, 10], [250 + m, 0]],\r\n                        true, sand, 2)\r\n                .tool(30, 17, await Resources.parseToolDefinition(TemplateDefs.CABIN))\r\n                .tool(120 + m, 5, await Resources.parseToolDefinition(TemplateDefs.SAND_CASTLE))\r\n                .tree(60 + m, 1, 200)\r\n                .tree(30 + m, 5)\r\n                .grass(20 + m, 40 + m)\r\n                .grass(50 + m, 70 + m);\r\n\r\n            if (sandGame.getWidth() / sandGame.getHeight() > 1.5) {\r\n                // wide screens only\r\n                sandGame.blockTemplate()\r\n                    .withMaxHeight(120)\r\n                    .withBlueprint([\r\n                        '          ',\r\n                        '        ww',\r\n                        '          ',\r\n                        '       1  ',\r\n                        '     111111',\r\n                        '          ',\r\n                        '          ',\r\n                        '          ',\r\n                        '          ',\r\n                    ])\r\n                    .withBrushes({\r\n                        w: Brushes.withIntensity(0.5, water),\r\n                        1: sand\r\n                    })\r\n                    .paint();\r\n            } else {\r\n                layeredPainter\r\n                    .layer(26, false, water)\r\n                    .layer(27, false, Brushes.withIntensity(0.33, water));\r\n            }\r\n\r\n            layeredPainter.tool(65, 45, ToolDefs.BIRD);\r\n            layeredPainter.tool(70, 70, ToolDefs.BIRD);\r\n            layeredPainter.tool(71, 75, ToolDefs.BIRD);\r\n            layeredPainter.tool(125, 55, ToolDefs.BIRD);\r\n            layeredPainter.tool(130, 50, ToolDefs.BIRD);\r\n        }\r\n    });\r\n\r\n    static SCENE_LANDSCAPE_2 = new SceneImplHardcoded({\r\n        name: 'Landscape 2',\r\n        description: 'Boxed mode',\r\n        onCreated: function (sandGame) {\r\n            sandGame.setBoxedMode();\r\n\r\n            const water = sandGame.getBrushCollection().byCodeName('water');\r\n            const sand = sandGame.getBrushCollection().byCodeName('sand');\r\n            const soil = sandGame.getBrushCollection().byCodeName('soil');\r\n            const gravel = sandGame.getBrushCollection().byCodeName('gravel');\r\n\r\n            sandGame.layeredTemplate()\r\n                .layerSpline([[0, 20], [50, 15], [100, 10], [150, 10], [200, 10], [250, 10], [1250, 10]],\r\n                    true, Brushes.concat(gravel, BrushDefs.EFFECT_NOISE_LG))\r\n                .layerSpline([[0, 30], [25, 31], [50, 27], [100, 15], [150, 0], [200, 5], [220, 15], [300, 35], [330, 37],\r\n                        [370, 50], [400, 45], [500, 40], [1250, 40]],\r\n                    true, Brushes.concat(soil, BrushDefs.EFFECT_NOISE_LG), 30)\r\n                .layerSpline([[0, 0], [50, 0], [100, 10], [150, 10], [200, 9], [275, 0], [1250, 0]],\r\n                    true, sand, 5)\r\n                .layer(35, false, water)\r\n                .layer(36, false, Brushes.withIntensity(0.33, water))\r\n                .tool(150, -8, ToolDefs.FISH)\r\n                .tool(270, 20, ToolDefs.BUTTERFLY)\r\n                .tool(280, 15, ToolDefs.BUTTERFLY)\r\n                .grass()\r\n                .tree(16, 6)\r\n                .tree(28, 3, 70)\r\n                .tree(45, 5)\r\n                .tree(309, 1)\r\n                .tree(336, 4)\r\n                .tree(361, 0);\r\n        }\r\n    });\r\n\r\n    /** @type Scene */\r\n    static SCENE_FALLTHROUGH = new SceneImplHardcoded({\r\n        name: 'Fall-through',\r\n        description: 'Fall-through mode',\r\n        onCreated: function (sandGame) {\r\n            sandGame.setFallThroughMode();\r\n\r\n            const wall = sandGame.getBrushCollection().byCodeName('wall');\r\n            const water = sandGame.getBrushCollection().byCodeName('water');\r\n            const sand = sandGame.getBrushCollection().byCodeName('sand');\r\n\r\n            const graphics = sandGame.graphics();\r\n            const xo = Math.trunc((sandGame.getWidth() - 150) / 2 - 15);\r\n            const yo = Math.trunc((sandGame.getHeight() - 150) / 2);\r\n            graphics.drawRectangle(40 + xo, 20 + yo, 60 + xo, 40 + yo, water);\r\n            graphics.drawLine(30 + xo, 30 + yo, 30 + xo, 50 + yo, 5, wall, true);\r\n            graphics.drawLine(30 + xo, 50 + yo, 70 + xo, 80 + yo, 5, wall, true);\r\n            graphics.drawLine(65 + xo, 90 + yo, 100 + xo, 100 + yo, 5, wall, true);\r\n            graphics.drawLine(55 + xo, 140 + yo, 125 + xo, 140 + yo, 10, wall, false);\r\n            graphics.drawLine(55 + xo, 130 + yo, 55 + xo, 140 + yo, 10, wall, false);\r\n            graphics.drawLine(70 + xo, 125 + yo, 90 + xo, 125 + yo, 10, sand, false);\r\n            graphics.draw(120 + xo, 130 + yo, sand);\r\n            graphics.drawLine(150 + xo, 10 + yo, 80 + xo, 35 + yo, 5, wall, true);\r\n            graphics.drawLine(80 + xo, 35 + yo, 80 + xo, 15 + yo, 5, wall, true);\r\n        }\r\n    });\r\n\r\n    /** @type Scene */\r\n    static SCENE_PLATFORM = new SceneImplHardcoded({\r\n        name: 'Platform',\r\n        description: 'Erasing mode',\r\n        onCreated: function (sandGame) {\r\n            sandGame.setErasingMode();\r\n\r\n            const sand = sandGame.getBrushCollection().byCodeName('sand');\r\n            const wall = sandGame.getBrushCollection().byCodeName('wall');\r\n\r\n            sandGame.blockTemplate()\r\n                .withBlueprint([\r\n                    '          ',\r\n                    '          ',\r\n                    '        w ',\r\n                    '        w ',\r\n                    '          ',\r\n                    '          ',\r\n                    ' ssssssss ',\r\n                    '          ',\r\n                    '          ',\r\n                ])\r\n                .withBrushes({\r\n                    w: sand,\r\n                    s: wall\r\n                })\r\n                .paint();\r\n        }\r\n    });\r\n\r\n    static SCENES = {\r\n        empty: SceneDefs.SCENE_EMPTY,\r\n        landscape_1: SceneDefs.SCENE_LANDSCAPE_1,\r\n        landscape_2: SceneDefs.SCENE_LANDSCAPE_2,\r\n        fallthrough: SceneDefs.SCENE_FALLTHROUGH,\r\n        platform: SceneDefs.SCENE_PLATFORM\r\n    };\r\n}\r\n","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-04-27\r\n */\r\nexport default class Entities {\r\n\r\n    static bird(x = undefined, y = undefined) {\r\n        return { entity: 'bird', x: x, y: y };\r\n    }\r\n\r\n    static butterfly(x = undefined, y = undefined) {\r\n        return { entity: 'butterfly', x: x, y: y };\r\n    }\r\n\r\n    static fish(x = undefined, y = undefined) {\r\n        return { entity: 'fish', x: x, y: y };\r\n    }\r\n}\r\n","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\n/**\r\n * @interface\r\n *\r\n * @author Patrik Harag\r\n * @version 2023-08-19\r\n */\r\nexport default class Action {\r\n\r\n    /**\r\n     *\r\n     * @param controller {Controller}\r\n     * @returns void\r\n     */\r\n    performAction(controller) {\r\n        throw 'Not implemented';\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param func {function(controller:Controller):void}\r\n     * @returns {ActionAnonymous}\r\n     */\r\n    static create(func) {\r\n        return new ActionAnonymous(func);\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param def {boolean}\r\n     * @param func {function(controller:Controller,v:boolean):void}\r\n     * @returns {ActionAnonymous}\r\n     */\r\n    static createToggle(def, func) {\r\n        let state = def;\r\n        return new ActionAnonymous(function (c) {\r\n            state = !state;\r\n            func(c, state);\r\n        });\r\n    }\r\n}\r\n\r\nclass ActionAnonymous extends Action {\r\n    #func;\r\n\r\n    constructor(func) {\r\n        super();\r\n        this.#func = func;\r\n    }\r\n\r\n    performAction(controller) {\r\n        this.#func(controller);\r\n    }\r\n}\r\n","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport DomBuilder from \"../DomBuilder\";\r\nimport Resources from \"../../io/Resources\";\r\nimport Tools from \"../../core/tool/Tools\";\r\nimport Component from \"./Component\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-02-08\r\n */\r\nexport default class ComponentViewTemplateSelection extends Component {\r\n\r\n    #templateDefinitions;\r\n\r\n    constructor(templateDefinitions) {\r\n        super();\r\n        this.#templateDefinitions = templateDefinitions;\r\n    }\r\n\r\n    createNode(controller) {\r\n        let buttons = [];\r\n\r\n        for (const toolDefinition of this.#templateDefinitions) {\r\n            const name = toolDefinition.info.displayName;\r\n            let loadedTool = null;\r\n\r\n            let button = DomBuilder.button(name, { class: 'btn btn-light template-button', 'data-bs-dismiss': 'modal'}, () => {\r\n                if (loadedTool !== null) {\r\n\r\n                    const toolManager = controller.getToolManager();\r\n                    const revert = toolManager.createRevertAction();\r\n\r\n                    toolManager.setPrimaryTool(loadedTool);\r\n                    toolManager.setSecondaryTool(Tools.actionTool(revert));\r\n\r\n                } else {\r\n                    // this should not happen\r\n                }\r\n            });\r\n            if (toolDefinition.info.icon !== undefined) {\r\n                button.style.backgroundImage = `url(${ toolDefinition.info.icon.imageData })`;\r\n            }\r\n\r\n            buttons.push(button);\r\n\r\n            Resources.parseToolDefinition(toolDefinition).then(tool => {\r\n                loadedTool = tool;\r\n            }).catch(e => {\r\n                console.warn('Template loading failed: ' + e);\r\n            });\r\n        }\r\n\r\n        return DomBuilder.div({ class: 'sand-game-templates' }, buttons);\r\n    }\r\n}\r\n","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport DomBuilder from \"../DomBuilder\";\r\nimport Action from \"./Action\";\r\nimport ComponentViewTemplateSelection from \"../component/ComponentViewTemplateSelection\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-02-08\r\n */\r\nexport default class ActionDialogTemplateSelection extends Action {\r\n\r\n    #templateDefinitions;\r\n    #additionalInfo;\r\n\r\n    constructor(templateDefinitions, additionalInfo = null) {\r\n        super();\r\n        this.#templateDefinitions = templateDefinitions;\r\n        this.#additionalInfo = additionalInfo;\r\n    }\r\n\r\n    performAction(controller) {\r\n        let templatesComponent = new ComponentViewTemplateSelection(this.#templateDefinitions);\r\n\r\n        let dialog = DomBuilder.bootstrapDialogBuilder();\r\n        dialog.setHeaderContent('Templates');\r\n        dialog.setBodyContent(DomBuilder.div({ class: 'sand-game-component' }, [\r\n            DomBuilder.par(null, \"Select a template\"),\r\n            templatesComponent.createNode(controller),\r\n            this.#additionalInfo\r\n        ]));\r\n        dialog.addCloseButton('Close');\r\n        dialog.show(controller.getDialogAnchor());\r\n    }\r\n}\r\n","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport DomBuilder from \"../DomBuilder\";\r\nimport Component from \"./Component\";\r\nimport ActionDialogTemplateSelection from \"../action/ActionDialogTemplateSelection\";\r\nimport ToolDefs from \"../../def/ToolDefs\";\r\nimport TemplateSelectionFakeTool from \"../../core/tool/TemplateSelectionFakeTool\";\r\nimport GlobalActionTool from \"../../core/tool/GlobalActionTool\";\r\nimport SelectionFakeTool from \"../../core/tool/SelectionFakeTool\";\r\nimport Resources from \"../../io/Resources\";\r\nimport Tools from \"../../core/tool/Tools\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-05-25\r\n */\r\nexport default class ComponentViewTools extends Component {\r\n\r\n    /** @type Tool[] */\r\n    #tools;\r\n    /** @type boolean */\r\n    #importEnabled;\r\n\r\n    /**\r\n     * @param tools {Tool[]}\r\n     * @param importEnabled {boolean}\r\n     */\r\n    constructor(tools, importEnabled = false) {\r\n        super();\r\n        this.#tools = tools;\r\n        this.#importEnabled = importEnabled;\r\n    }\r\n\r\n    createNode(controller) {\r\n        let buttons = [];\r\n\r\n        const buttonType = 'btn-sand-game-tool';\r\n\r\n        const initButton = (button, tool) => {\r\n            button.addEventListener('click', () => {\r\n                this.#selectTool(tool, controller);\r\n            });\r\n\r\n            controller.getToolManager().addOnPrimaryToolChanged(newTool => {\r\n                if (newTool === tool) {\r\n                    button.classList.add('selected');\r\n                } else {\r\n                    button.classList.remove('selected');\r\n                }\r\n            });\r\n\r\n            // initial select\r\n            if (tool === controller.getToolManager().getPrimaryTool()) {\r\n                button.classList.add('selected');\r\n            }\r\n\r\n            controller.getToolManager().addOnInputDisabledChanged(disabled => {\r\n                button.disabled = disabled;\r\n            });\r\n        }\r\n\r\n        for (let tool of this.#tools) {\r\n            const info = tool.getInfo();\r\n            let codeName = info.getCodeName();\r\n            let badgeStyle = info.getBadgeStyle();\r\n\r\n            if (tool instanceof SelectionFakeTool) {\r\n\r\n                const ulContent = [];\r\n                for (const innerTool of tool.getTools()) {\r\n                    const innerInfo = innerTool.getInfo();\r\n                    let innerCodeName = innerInfo.getCodeName();\r\n                    let innerDisplayName = innerInfo.getDisplayName();\r\n                    let innerBadgeStyle = innerInfo.getBadgeStyle();\r\n\r\n                    const innerLabel = DomBuilder.span(innerDisplayName, {\r\n                        class: 'btn btn-secondary ' + buttonType + ' ' + codeName,\r\n                        style: innerBadgeStyle,\r\n                    })\r\n                    const innerToolAttributes = {\r\n                        class: 'dropdown-item',\r\n                    };\r\n                    const innerButton = DomBuilder.button(innerLabel, innerToolAttributes);\r\n                    initButton(innerButton, innerTool);\r\n                    ulContent.push(DomBuilder.element('li', null, innerButton));\r\n                }\r\n\r\n                const buttonContent = this.#createButtonContent(info);\r\n                const button = DomBuilder.div({ class: 'btn-group' }, [\r\n                    DomBuilder.button(buttonContent, {\r\n                        class: 'btn btn-secondary dropdown-toggle ' + buttonType + ' ' + codeName,\r\n                        style: badgeStyle,\r\n                        'data-bs-toggle': 'dropdown',\r\n                        'aria-expanded': 'false'\r\n                    }),\r\n                    DomBuilder.element('ul', {\r\n                        class: 'dropdown-menu ' + (ulContent.length > 10 ? 'sand-game-column-count-2' : '')\r\n                    }, ulContent)\r\n                ]);\r\n\r\n                buttons.push(button);\r\n\r\n            } else {\r\n                const attributes = {\r\n                    class: 'btn btn-secondary ' + buttonType + ' ' + codeName,\r\n                    style: badgeStyle\r\n                };\r\n                const buttonContent = this.#createButtonContent(info);\r\n                const button = DomBuilder.button(buttonContent, attributes);\r\n                initButton(button, tool);\r\n                buttons.push(button);\r\n            }\r\n        }\r\n\r\n        return DomBuilder.div({ class: 'sand-game-tools' }, buttons);\r\n    }\r\n\r\n    #selectTool(tool, controller) {\r\n        if (tool instanceof TemplateSelectionFakeTool) {\r\n            let additionalInfo = null;\r\n            if (this.#importEnabled) {\r\n                additionalInfo = DomBuilder.div(null, [\r\n                    DomBuilder.par(null, \"\"),\r\n                    DomBuilder.par(null, \"You can also create your own template using an image. See the Import button.\")\r\n                ]);\r\n            }\r\n            const templateDefinitions = tool.getTemplateDefinitions();\r\n            if (Array.isArray(templateDefinitions)) {\r\n                // multiple templates\r\n                const action = new ActionDialogTemplateSelection(templateDefinitions, additionalInfo);\r\n                action.performAction(controller);\r\n            } else {\r\n                // single template\r\n                Resources.parseToolDefinition(templateDefinitions).then(tool => {\r\n                    const toolManager = controller.getToolManager();\r\n                    const revert = toolManager.createRevertAction();\r\n                    toolManager.setPrimaryTool(tool);\r\n                    toolManager.setSecondaryTool(Tools.actionTool(revert));\r\n                }).catch(e => {\r\n                    console.warn('Template loading failed: ' + e);\r\n                });\r\n            }\r\n        } else if (tool instanceof GlobalActionTool) {\r\n            const handler = tool.getHandler();\r\n            const sandGame = controller.getSandGame();\r\n            if (sandGame !== null) {\r\n                handler(sandGame);\r\n            }\r\n        } else {\r\n            controller.getToolManager().setPrimaryTool(tool);\r\n            controller.getToolManager().setSecondaryTool(ToolDefs.ERASE);\r\n        }\r\n    }\r\n\r\n    #createButtonContent(info) {\r\n        let displayName = info.getDisplayName();\r\n        const svgIcon = info.getSvgIcon();\r\n        if (svgIcon !== undefined) {\r\n            return [ DomBuilder.create(svgIcon),  displayName ];\r\n        } else {\r\n            return displayName;\r\n        }\r\n    }\r\n}\r\n","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport Component from \"./Component\";\r\nimport DomBuilder from \"../DomBuilder\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-01-17\r\n */\r\nexport default class ComponentViewCanvasOverlayMarker extends Component {\r\n\r\n    /** @type Controller */\r\n    #controller;\r\n\r\n    #nodeOverlay;\r\n\r\n    #w;\r\n    #h;\r\n    #scale;\r\n\r\n    constructor(w, h, scale, controller) {\r\n        super();\r\n        this.#w = w;\r\n        this.#h = h;\r\n        this.#scale = scale;\r\n        const wPx = w / scale;\r\n        const hPx = h / scale;\r\n        this.#nodeOverlay = DomBuilder.div({\r\n            style: {\r\n                display: 'none',  // hidden by default\r\n                position: 'absolute',\r\n                left: '0',\r\n                top: '0',\r\n                width: `${wPx}px`,\r\n                height: `${hPx}px`\r\n            },\r\n            class: 'sand-game-canvas-overlay',\r\n            width: w + 'px',\r\n            height: h + 'px',\r\n        });\r\n        this.#controller = controller;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param overlay {SandGameOverlay}\r\n     */\r\n    register(overlay) {\r\n        const markers = overlay.getMarkers();\r\n        if (markers.length > 0) {\r\n            for (const marker of markers) {\r\n                this.#nodeOverlay.append(this.#createMarkerNode(marker));\r\n            }\r\n            this.#nodeOverlay.style.display = 'initial';\r\n        }\r\n\r\n        // future markers\r\n        overlay.addOnMarkerAdded((marker) => {\r\n            this.#nodeOverlay.append(this.#createMarkerNode(marker));\r\n            this.#nodeOverlay.style.display = 'initial';\r\n        });\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param marker {Marker}\r\n     * @returns {HTMLElement}\r\n     */\r\n    #createMarkerNode(marker) {\r\n        const config = marker.getConfig();\r\n\r\n        const [x1, y1, x2, y2] = marker.getPosition();\r\n        const rectangle = this.#createRectangle(x1, y1, x2, y2, config.label);\r\n        if (typeof config.style === 'object') {\r\n            for (const [key, value] of Object.entries(config.style)) {\r\n                rectangle.style[key] = value;\r\n            }\r\n        }\r\n        if (!marker.isVisible()) {\r\n            rectangle.style.display = 'none';\r\n        }\r\n        marker.addOnVisibleChanged((visible) => {\r\n            rectangle.style.display = visible ? 'initial' : 'none';\r\n        });\r\n        return rectangle;\r\n    }\r\n\r\n    #createRectangle(x1, y1, x2, y2, content = null) {\r\n        const xPx = x1 / this.#scale;\r\n        const yPx = y1 / this.#scale;\r\n        const wPx = (x2 - x1) / this.#scale;\r\n        const hPx = (y2 - y1) / this.#scale;\r\n\r\n        const attributes = {\r\n            class: 'sand-game-marker',\r\n            style: {\r\n                left: xPx + 'px',\r\n                top: yPx + 'px',\r\n                width: wPx + 'px',\r\n                height: hPx + 'px',\r\n                position: 'absolute',\r\n            }\r\n        };\r\n\r\n        return DomBuilder.div(attributes, content);\r\n    }\r\n\r\n    createNode(controller) {\r\n        return this.#nodeOverlay;\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport Component from \"./Component\";\r\nimport DomBuilder from \"../DomBuilder\";\r\nimport CursorDefinitionElementArea from \"../../core/tool/CursorDefinitionElementArea\";\r\nimport Renderer2D from \"../../core/rendering/Renderer2D\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-01-07\r\n */\r\nexport default class ComponentViewCanvasOverlayCursor extends Component {\r\n\r\n    /** @type Controller */\r\n    #controller;\r\n\r\n    #nodeOverlay;\r\n\r\n    /** @type {{node:any,width:number,height:number}|null} */\r\n    #cursor = null;\r\n\r\n    constructor(w, h, scale, controller) {\r\n        super();\r\n        const wPx = w / scale;\r\n        const hPx = h / scale;\r\n        this.#nodeOverlay = DomBuilder.div({\r\n            style: {\r\n                position: 'absolute',\r\n                left: '0',\r\n                top: '0',\r\n                width: `${wPx}px`,\r\n                height: `${hPx}px`\r\n            },\r\n            class: 'sand-game-canvas-overlay',\r\n            width: w + 'px',\r\n            height: h + 'px',\r\n        });\r\n        this.#controller = controller;\r\n    }\r\n\r\n    createNode(controller) {\r\n        return this.#nodeOverlay;\r\n    }\r\n\r\n    hideCursors() {\r\n        this.#nodeOverlay.innerHTML = '';\r\n        this.#cursor = null;\r\n    }\r\n\r\n    repaintRectangleSelection(lastX, lastY, x, y, scale) {\r\n        this.#nodeOverlay.innerHTML = '';\r\n\r\n        let xPx = Math.min(lastX, x) / scale;\r\n        let yPx = Math.min(lastY, y) / scale;\r\n        let wPx = Math.abs(x - lastX) / scale;\r\n        let hPx = Math.abs(y - lastY) / scale;\r\n\r\n        const selection = DomBuilder.div({\r\n            style: {\r\n                left: xPx + 'px',\r\n                top: yPx + 'px',\r\n                width: wPx + 'px',\r\n                height: hPx + 'px',\r\n                position: 'absolute',\r\n                outline: 'black 1px solid',\r\n                pointerEvents: 'none'\r\n            }\r\n        });\r\n        this.#nodeOverlay.append(selection);\r\n    }\r\n\r\n    repaintLineSelection(lastX, lastY, x, y, scale) {\r\n        this.#nodeOverlay.innerHTML = '';\r\n\r\n        const w = this.#controller.getCurrentWidthPoints();\r\n        const h = this.#controller.getCurrentHeightPoints();\r\n\r\n        const line = DomBuilder.create(`\r\n            <svg viewBox=\"0 0 ${w} ${h}\" xmlns=\"http://www.w3.org/2000/svg\">\r\n              <line x1=\"${lastX}\" y1=\"${lastY}\" x2=\"${x}\" y2=\"${y}\" stroke=\"black\" />\r\n            </svg>\r\n        `);\r\n        line.style.pointerEvents = 'none';\r\n        this.#nodeOverlay.append(line);\r\n    }\r\n\r\n    showCursor(x, y, scale, cursorDefinition) {\r\n        if (cursorDefinition instanceof CursorDefinitionElementArea) {\r\n            const wPx = Math.trunc(cursorDefinition.getWidth() / scale);\r\n            const hPx = Math.trunc(cursorDefinition.getHeight() / scale);\r\n\r\n            const node = DomBuilder.element('canvas', {\r\n                width: cursorDefinition.getWidth() + 'px',\r\n                height: cursorDefinition.getHeight() + 'px',\r\n                style: {\r\n                    width: `${wPx}px`,\r\n                    height: `${hPx}px`,\r\n                    outline: 'black 1px solid'\r\n                }\r\n            });\r\n\r\n            // render preview\r\n            node.style.imageRendering = 'pixelated';\r\n            Renderer2D.renderPreview(cursorDefinition.getElementArea(), node.getContext('2d'), 0xBB);\r\n\r\n            this.#cursor = {\r\n                width: wPx,\r\n                height: hPx,\r\n                node: node\r\n            };\r\n        } else {\r\n            return;\r\n        }\r\n\r\n        this.#cursor.node.style.position = 'absolute';\r\n        this.#cursor.node.style.pointerEvents = 'none';\r\n\r\n        this.moveCursor(x, y, scale);\r\n    }\r\n\r\n    hasCursor() {\r\n        return this.#cursor !== null;\r\n    }\r\n\r\n    moveCursor(x, y, scale) {\r\n        const cursor = this.#cursor;\r\n\r\n        const pxW = this.#controller.getCurrentWidthPoints() / scale;\r\n        const pxH = this.#controller.getCurrentHeightPoints() / scale;\r\n\r\n        const pxTop = y / scale - Math.trunc(cursor.height / 2);\r\n        const pxLeft = x / scale - Math.trunc(cursor.width / 2);\r\n\r\n        const UNSET = -1;  // expect border\r\n        const pxClipTop = pxTop < 0 ? -pxTop : UNSET;\r\n        const pxClipRight = pxLeft + cursor.width >= pxW ? pxLeft + cursor.width - pxW : UNSET;\r\n        const pxClipBottom = pxTop + cursor.height >= pxH ? pxTop + cursor.height - pxH : UNSET;\r\n        const pxClipLeft = pxLeft < 0 ? -pxLeft : UNSET;\r\n\r\n        cursor.node.style.top = pxTop + 'px';\r\n        cursor.node.style.left = pxLeft + 'px';\r\n        cursor.node.style.clipPath = `inset(${pxClipTop}px ${pxClipRight}px ${pxClipBottom}px ${pxClipLeft}px)`;\r\n\r\n        this.#nodeOverlay.innerHTML = '';\r\n        this.#nodeOverlay.append(cursor.node);\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport Component from \"./Component\";\r\nimport DomBuilder from \"../DomBuilder\";\r\n\r\nimport _ASSET_ICON_SQUARE from './assets/icon-square.svg'\r\nimport _ASSET_ICON_SQUARE_CHECK from './assets/icon-square-check.svg'\r\nimport _ASSET_ICON_SQUARE_DOTTED from './assets/icon-square-dotted.svg'\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-01-19\r\n */\r\nexport default class ComponentViewCanvasOverlayScenario extends Component {\r\n\r\n    /** @type Controller */\r\n    #controller;\r\n\r\n    #nodeOverlay;\r\n\r\n    #w;\r\n    #h;\r\n    #scale;\r\n\r\n    constructor(w, h, scale, controller) {\r\n        super();\r\n        this.#w = w;\r\n        this.#h = h;\r\n        this.#scale = scale;\r\n        const wPx = w / scale;\r\n        const hPx = h / scale;\r\n        this.#nodeOverlay = DomBuilder.div({\r\n            style: {\r\n                display: 'none',  // hidden by default\r\n                position: 'absolute',\r\n                left: '0',\r\n                top: '0',\r\n                width: `${wPx}px`,\r\n                height: `${hPx}px`,\r\n                pointerEvents: 'none'\r\n            },\r\n            class: 'sand-game-canvas-overlay',\r\n            width: w + 'px',\r\n            height: h + 'px',\r\n        });\r\n        this.#controller = controller;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param overlay {SandGameScenario}\r\n     */\r\n    register(overlay) {\r\n        let visible = false;\r\n        const addNode = (node) => {\r\n            this.#nodeOverlay.append(node);\r\n            if (!visible) {\r\n                visible = true;\r\n                this.#nodeOverlay.style.display = null;\r\n            }\r\n        };\r\n\r\n        // handles splashes\r\n        for (const splash of overlay.getSplashes()) {\r\n            addNode(this.#createSplashNode(splash));\r\n        }\r\n        overlay.addOnSplashAdded((splash) => {\r\n            addNode(this.#createSplashNode(splash));\r\n        });\r\n\r\n        // handle objectives\r\n        let objectiveParent = null;\r\n        let visibleNodes = 0;\r\n        const addObjective = (objective) => {\r\n            const node = this.#createObjectiveNode(objective);\r\n            if (objectiveParent === null) {\r\n                if (objective.isVisible()) {\r\n                    visibleNodes++;\r\n                }\r\n                objectiveParent = this.#createObjectivesListNode();\r\n                objectiveParent.style.display = (visibleNodes > 0) ? null : 'none';\r\n                addNode(objectiveParent);\r\n            }\r\n            objectiveParent.append(node);\r\n            objective.addOnVisibleChanged(visible => {\r\n                visibleNodes += (visible) ? 1 : -1;\r\n                objectiveParent.style.display = (visibleNodes > 0) ? null : 'none';\r\n            });\r\n        };\r\n        for (const objective of overlay.getObjectives()) {\r\n            addObjective(objective);\r\n        }\r\n        overlay.addOnObjectiveAdded((objective) => {\r\n            addObjective(objective);\r\n        });\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param splash {Splash}\r\n     * @returns {HTMLElement}\r\n     */\r\n    #createSplashNode(splash) {\r\n        let config = splash.getConfig();\r\n\r\n        let splashAttributes = {\r\n            class: 'sand-game-splash',\r\n            style: {\r\n                display: splash.isVisible() ? null : 'none'\r\n            }\r\n        };\r\n        Object.assign(splashAttributes.style, config.style);\r\n\r\n        let contentAttributes = {\r\n            class: 'sand-game-splash-content'\r\n        };\r\n\r\n        let footerAttributes = {\r\n            class: 'sand-game-splash-footer'\r\n        };\r\n\r\n        let splashNode = DomBuilder.div(splashAttributes, [\r\n            DomBuilder.div(contentAttributes, config.content),\r\n            DomBuilder.div(footerAttributes, config.buttons.filter(button => button !== null).map(button => {\r\n                let buttonNode;\r\n                if (typeof button.action === 'string') {\r\n                    buttonNode = DomBuilder.element('a', {\r\n                        href: button.action,\r\n                        class: button.class\r\n                    }, button.title);\r\n                } else if (typeof button.action === 'function') {\r\n                    buttonNode = DomBuilder.button(button.title, {\r\n                        class: button.class,\r\n                    }, () => button.action(splash));\r\n                } else {\r\n                    throw 'Button action type not supported: ' + (typeof button.action);\r\n                }\r\n\r\n                if (button.focus) {\r\n                    setTimeout(() => {\r\n                        buttonNode.focus({\r\n                            preventScroll: true\r\n                        });\r\n                    }, 0);\r\n                }\r\n                return buttonNode;\r\n            }))\r\n        ]);\r\n\r\n        splash.addOnVisibleChanged((visible) => {\r\n             splashNode.style.display = visible ? null : 'none';\r\n        });\r\n\r\n        return splashNode;\r\n    }\r\n\r\n    #createObjectivesListNode() {\r\n        return DomBuilder.div({ class: 'sand-game-objectives-list' }, null);\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param objective {Objective}\r\n     * @returns {HTMLElement}\r\n     */\r\n    #createObjectiveNode(objective) {\r\n        const iconNode = DomBuilder.span(null, { class: 'sand-game-objective-icon' });\r\n        if (objective.isVisible()) {\r\n            DomBuilder.setContent(iconNode, this.#createObjectiveIcon(objective));\r\n        }\r\n\r\n        const attributes = {\r\n            style: {\r\n                display: objective.isVisible() ? null : 'none'\r\n            }\r\n        }\r\n        const objectiveNode = DomBuilder.div(attributes, [\r\n            iconNode,\r\n            objective.getConfig().name\r\n        ]);\r\n\r\n        objective.addOnVisibleChanged((visible) => {\r\n            objectiveNode.style.display = visible ? null : 'none';\r\n            if (visible) {\r\n                DomBuilder.setContent(iconNode, this.#createObjectiveIcon(objective));\r\n            }\r\n        });\r\n\r\n        objective.addOnActiveChanged((active) => {\r\n            if (objective.isVisible()) {\r\n                DomBuilder.setContent(iconNode, this.#createObjectiveIcon(objective));\r\n            }\r\n        });\r\n\r\n        objective.addOnCompleted(() => {\r\n            if (objective.isVisible()) {\r\n                DomBuilder.setContent(iconNode, this.#createObjectiveIcon(objective));\r\n            }\r\n        });\r\n\r\n        return objectiveNode;\r\n    }\r\n\r\n    #createObjectiveIcon(objective) {\r\n        if (objective.isCompleted()) {\r\n            return DomBuilder.create(_ASSET_ICON_SQUARE_CHECK);\r\n        }\r\n        if (objective.isActive()) {\r\n            return DomBuilder.create(_ASSET_ICON_SQUARE);\r\n        }\r\n        return DomBuilder.create(_ASSET_ICON_SQUARE_DOTTED);\r\n    }\r\n\r\n    createNode(controller) {\r\n        return this.#nodeOverlay;\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport Component from \"./Component\";\r\nimport ComponentViewCanvasOverlayMarker from \"./ComponentViewCanvasOverlayMarker\";\r\nimport ComponentViewCanvasOverlayCursor from \"./ComponentViewCanvasOverlayCursor\";\r\nimport ComponentViewCanvasOverlayScenario from \"./ComponentViewCanvasOverlayScenario\";\r\nimport DomBuilder from \"../DomBuilder\";\r\nimport Analytics from \"../../Analytics\";\r\n\r\n/**\r\n *\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-05-25\r\n */\r\nexport default class ComponentViewCanvasInner extends Component {\r\n\r\n    /** @type Controller */\r\n    #controller;\r\n\r\n    #nodeCanvas;\r\n\r\n    /** @type ComponentViewCanvasOverlayMarker */\r\n    #markerOverlayComponent;\r\n    #nodeMarkerOverlay;\r\n\r\n    /** @type ComponentViewCanvasOverlayCursor */\r\n    #cursorOverlayComponent;\r\n    #nodeCursorOverlay;\r\n\r\n    /** @type ComponentViewCanvasOverlayScenario */\r\n    #scenarioOverlayComponent;\r\n    #nodeScenarioOverlay;\r\n\r\n    /**\r\n     * @param controller {Controller}\r\n     */\r\n    constructor(controller) {\r\n        super();\r\n        this.#controller = controller;\r\n\r\n        const w = this.#controller.getCurrentWidthPoints();\r\n        const h = this.#controller.getCurrentHeightPoints();\r\n        const scale = this.#controller.getCurrentScale();\r\n        this.#nodeCanvas = this.#createCanvas(w, h, scale);\r\n\r\n        this.#markerOverlayComponent = new ComponentViewCanvasOverlayMarker(w, h, scale, controller);\r\n        this.#nodeMarkerOverlay = this.#markerOverlayComponent.createNode();\r\n\r\n        this.#cursorOverlayComponent = new ComponentViewCanvasOverlayCursor(w, h, scale, controller);\r\n        this.#nodeCursorOverlay = this.#cursorOverlayComponent.createNode();\r\n\r\n        this.#scenarioOverlayComponent = new ComponentViewCanvasOverlayScenario(w, h, scale, controller);\r\n        this.#nodeScenarioOverlay = this.#scenarioOverlayComponent.createNode();\r\n    }\r\n\r\n    #createCanvas(w, h, scale) {\r\n        const wPx = w / scale;\r\n        const hPx = h / scale;\r\n        const canvas = DomBuilder.element('canvas', {\r\n            style: `position: relative; width: ${wPx}px; height: ${hPx}px;`,\r\n            class: 'sand-game-canvas',\r\n            width: w + 'px',\r\n            height: h + 'px'\r\n        });\r\n\r\n        // rendering style\r\n        canvas.style.imageRendering = this.#controller.getCanvasImageRenderingStyle();\r\n\r\n        return canvas;\r\n    }\r\n\r\n    createNode(controller) {\r\n        return DomBuilder.div({\r\n            style: 'position: relative;',\r\n            class: 'sand-game-canvas-component'\r\n        }, [\r\n            this.#nodeCanvas,\r\n            this.#nodeMarkerOverlay,\r\n            this.#nodeCursorOverlay,\r\n            this.#nodeScenarioOverlay,\r\n        ]);\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param sandGame {SandGame}\r\n     */\r\n    register(sandGame) {\r\n        this.#markerOverlayComponent.register(sandGame.overlay());\r\n        this.#scenarioOverlayComponent.register(sandGame.scenario());\r\n\r\n        this.#initMouseHandling(sandGame);\r\n    }\r\n\r\n    #initMouseHandling(sandGame) {\r\n        const domNode = this.#nodeCursorOverlay;\r\n        const scale = this.#controller.getCurrentScale();\r\n\r\n        const toolManager = this.#controller.getToolManager();\r\n\r\n        let getActualMousePosition = (e) => {\r\n            const rect = domNode.getBoundingClientRect();\r\n            const x = Math.max(0, Math.trunc((e.clientX - rect.left) * scale));\r\n            const y = Math.max(0, Math.trunc((e.clientY - rect.top) * scale));\r\n            return [x, y];\r\n        }\r\n\r\n        let lastX, lastY;\r\n        let lastTool = null;  // drawing is not active if null\r\n        let drag = false;\r\n        let ctrlPressed = false;\r\n        let shiftPressed = false;\r\n\r\n        let repeatingInterval = null;\r\n        const startRepeatingIfEnabled = (x, y, altKey) => {\r\n            if (lastTool.isRepeatingEnabled()) {\r\n                repeatingInterval = setInterval(() => {\r\n                    lastTool.applyPoint(x, y, sandGame.graphics(), altKey);\r\n                }, 80);\r\n            }\r\n        }\r\n        const cancelRepeatingIfNeeded = () => {\r\n            if (repeatingInterval !== null) {\r\n                clearInterval(repeatingInterval);\r\n                repeatingInterval = null;\r\n            }\r\n        };\r\n\r\n        // disable context menu\r\n        this.#nodeCursorOverlay.addEventListener('contextmenu', e => {\r\n            e.preventDefault();\r\n            return false;\r\n        });\r\n\r\n        domNode.addEventListener('mousedown', (e) => {\r\n            if (toolManager.isInputDisabled()) {\r\n                return;\r\n            }\r\n\r\n            const [x, y] = getActualMousePosition(e);\r\n            lastX = x;\r\n            lastY = y;\r\n            lastTool = null;\r\n            drag = false;\r\n            ctrlPressed = false;\r\n            shiftPressed = false;\r\n\r\n            if (e.buttons === 1) {\r\n                // primary button\r\n                lastTool = toolManager.getPrimaryTool();\r\n                Analytics.triggerFeatureUsed(Analytics.FEATURE_DRAW_PRIMARY);\r\n\r\n            } else if (e.buttons === 2) {\r\n                // secondary button\r\n                let primaryTool = toolManager.getPrimaryTool();\r\n                if (primaryTool.isSecondaryActionEnabled()) {\r\n                    // special secondary action\r\n\r\n                    primaryTool.applySecondaryAction(x, y, sandGame.graphics(), e.altKey);\r\n\r\n                    // hide cursors\r\n                    this.#cursorOverlayComponent.hideCursors();\r\n\r\n                    cancelRepeatingIfNeeded();\r\n\r\n                    return;\r\n                } else {\r\n                    lastTool = toolManager.getSecondaryTool();\r\n                    Analytics.triggerFeatureUsed(Analytics.FEATURE_DRAW_SECONDARY);\r\n                }\r\n            } else if (e.buttons === 4) {\r\n                // middle button\r\n                e.preventDefault();\r\n\r\n                if (!e.altKey && !e.ctrlKey && !e.shiftKey) {\r\n                    const tool = toolManager.getTertiaryTool();\r\n                    tool.applyPoint(x, y, sandGame.graphics(), false);\r\n                    Analytics.triggerFeatureUsed(Analytics.FEATURE_DRAW_TERTIARY);\r\n                    Analytics.triggerToolUsed(tool);\r\n                } else if (e.altKey && e.ctrlKey && e.shiftKey) {\r\n                    console.log('' + x + 'x' + y + ': ' + sandGame.debugElementAt(x, y));\r\n                }\r\n                return;\r\n            } else {\r\n                // mouse wheel, other combinations, etc.\r\n                return;\r\n            }\r\n\r\n            if (!e.ctrlKey && !e.shiftKey) {\r\n                lastTool.applyPoint(x, y, sandGame.graphics(), e.altKey);\r\n                Analytics.triggerToolUsed(lastTool);\r\n\r\n                // repeating when holding mouse down on a position\r\n                startRepeatingIfEnabled(x, y, e.altKey);\r\n\r\n                // show/recreate cursor\r\n                this.#cursorOverlayComponent.hideCursors();\r\n                const cursorDefinition = toolManager.getPrimaryTool().createCursor();\r\n                if (cursorDefinition !== null) {\r\n                    this.#cursorOverlayComponent.showCursor(x, y, scale, cursorDefinition);\r\n                }\r\n\r\n            } else if (e.ctrlKey && e.shiftKey) {\r\n                lastTool.applySpecial(x, y, sandGame.graphics(), e.altKey);\r\n                Analytics.triggerFeatureUsed(Analytics.FEATURE_DRAW_FLOOD);\r\n                Analytics.triggerToolUsed(lastTool);\r\n                lastTool = null;\r\n            } else {\r\n                if (e.ctrlKey && lastTool.isAreaModeEnabled()) {\r\n                    ctrlPressed = e.ctrlKey;\r\n                }\r\n                if (e.shiftKey && lastTool.isLineModeEnabled()) {\r\n                    shiftPressed = e.shiftKey;\r\n                }\r\n            }\r\n        });\r\n        domNode.addEventListener('mousemove', (e) => {\r\n            // cancel repeating\r\n            cancelRepeatingIfNeeded();\r\n\r\n            if (toolManager.isInputDisabled()) {\r\n                lastTool = null;\r\n                this.#cursorOverlayComponent.hideCursors();\r\n                return;\r\n            }\r\n\r\n            if (!ctrlPressed && !shiftPressed) {\r\n                // drawing while dragging...\r\n\r\n                // show / move cursor\r\n                if (this.#cursorOverlayComponent.hasCursor()) {\r\n                    const [x, y] = getActualMousePosition(e);\r\n                    this.#cursorOverlayComponent.moveCursor(x, y, scale);\r\n                } else {\r\n                    const cursorDefinition = toolManager.getPrimaryTool().createCursor();\r\n                    if (cursorDefinition !== null) {\r\n                        const [x, y] = getActualMousePosition(e);\r\n                        this.#cursorOverlayComponent.showCursor(x, y, scale, cursorDefinition);\r\n                    }\r\n                }\r\n\r\n                if (lastTool === null) {\r\n                    return;\r\n                }\r\n\r\n                const [x, y] = getActualMousePosition(e);\r\n\r\n                // drag action\r\n                if (!drag) {\r\n                    lastTool.onDragStart(lastX, lastY, sandGame.graphics(), e.altKey);\r\n                    drag = true;\r\n                }\r\n\r\n                // stroke action\r\n                lastTool.applyStroke(lastX, lastY, x, y, sandGame.graphics(), e.altKey);\r\n                Analytics.triggerToolUsed(lastTool);\r\n\r\n                // repeating when holding mouse down on a position\r\n                startRepeatingIfEnabled(x, y, e.altKey);\r\n\r\n                lastX = x;\r\n                lastY = y;\r\n\r\n                return;\r\n            }\r\n\r\n            if (lastTool === null) {\r\n                return;\r\n            }\r\n            if (ctrlPressed && shiftPressed) {\r\n                return;\r\n            }\r\n            if (ctrlPressed) {\r\n                const [x, y] = getActualMousePosition(e);\r\n                this.#cursorOverlayComponent.repaintRectangleSelection(lastX, lastY, x, y, scale);\r\n                return;\r\n            }\r\n            if (shiftPressed) {\r\n                const [x, y] = getActualMousePosition(e);\r\n                this.#cursorOverlayComponent.repaintLineSelection(lastX, lastY, x, y, scale);\r\n                return;\r\n            }\r\n        });\r\n        domNode.addEventListener('mouseup', (e) => {\r\n            // cancel repeating\r\n            cancelRepeatingIfNeeded();\r\n\r\n            if (toolManager.isInputDisabled()) {\r\n                return;\r\n            }\r\n\r\n            if (lastTool !== null) {\r\n                // click, dragging, rectangle or line\r\n                if (drag) {\r\n                    lastTool.onDragEnd(lastX, lastY, sandGame.graphics(), e.altKey);\r\n                    drag = false;\r\n                    if (!lastTool.hasCursor()) {\r\n                        this.#cursorOverlayComponent.hideCursors();\r\n                    }\r\n\r\n                } else if (ctrlPressed) {\r\n                    // rectangle\r\n                    const [x, y] = getActualMousePosition(e);\r\n                    let minX = Math.min(lastX, x);\r\n                    let minY = Math.min(lastY, y);\r\n                    let maxX = Math.max(lastX, x);\r\n                    let maxY = Math.max(lastY, y);\r\n                    lastTool.applyArea(minX, minY, maxX, maxY, sandGame.graphics(), e.altKey);\r\n                    this.#cursorOverlayComponent.hideCursors();\r\n\r\n                    Analytics.triggerFeatureUsed(Analytics.FEATURE_DRAW_RECT);\r\n                    Analytics.triggerToolUsed(lastTool);\r\n\r\n                } else if (shiftPressed) {\r\n                    // line\r\n                    const [x, y] = getActualMousePosition(e);\r\n                    lastTool.applyStroke(lastX, lastY, x, y, sandGame.graphics(), e.altKey);\r\n                    this.#cursorOverlayComponent.hideCursors();\r\n\r\n                    Analytics.triggerFeatureUsed(Analytics.FEATURE_DRAW_LINE);\r\n                    Analytics.triggerToolUsed(lastTool);\r\n                }\r\n                lastTool = null;\r\n                ctrlPressed = false;\r\n                shiftPressed = false;\r\n            }\r\n        });\r\n        domNode.addEventListener('mouseout', (e) => {\r\n            // disable drag\r\n            // lastTool = null;\r\n\r\n            // cancel repeating\r\n            cancelRepeatingIfNeeded();\r\n\r\n            // hide cursors\r\n            this.#cursorOverlayComponent.hideCursors();\r\n        });\r\n        domNode.addEventListener('mouseenter', (e) => {\r\n            if (lastTool !== null && e.buttons === 0) {\r\n                // mouse released outside...\r\n                lastTool = null;\r\n                this.#cursorOverlayComponent.hideCursors();\r\n                e.preventDefault();\r\n            }\r\n        });\r\n\r\n        // touch support\r\n\r\n        let getActualTouchPosition = (e) => {\r\n            let touch = e.touches[0];\r\n            return getActualMousePosition(touch);\r\n        }\r\n        domNode.addEventListener('touchstart', (e) => {\r\n            if (toolManager.isInputDisabled()) {\r\n                return;\r\n            }\r\n\r\n            const [x, y] = getActualTouchPosition(e);\r\n            lastX = x;\r\n            lastY = y;\r\n            lastTool = toolManager.getPrimaryTool();\r\n            lastTool.applyPoint(x, y, sandGame.graphics(), false);\r\n            Analytics.triggerFeatureUsed(Analytics.FEATURE_DRAW_PRIMARY);\r\n            Analytics.triggerToolUsed(lastTool);\r\n\r\n            e.preventDefault();\r\n        });\r\n        domNode.addEventListener('touchmove', (e) => {\r\n            if (toolManager.isInputDisabled()) {\r\n                lastTool = null;\r\n                return;\r\n            }\r\n\r\n            if (lastTool === null) {\r\n                return;\r\n            }\r\n            const [x, y] = getActualTouchPosition(e);\r\n            lastTool.applyStroke(lastX, lastY, x, y, sandGame.graphics(), false);\r\n            Analytics.triggerToolUsed(lastTool);\r\n            lastX = x;\r\n            lastY = y;\r\n\r\n            e.preventDefault();\r\n        });\r\n        domNode.addEventListener('touchend', (e) => {\r\n            lastTool = null;\r\n\r\n            e.preventDefault();\r\n        });\r\n    }\r\n\r\n    getCanvasNode() {\r\n        return this.#nodeCanvas;\r\n    }\r\n\r\n    setImageRenderingStyle(style) {\r\n        this.#nodeCanvas.style.imageRendering = style;\r\n    }\r\n\r\n    onInputDisabledChanged(disabled) {\r\n        this.#nodeCursorOverlay.style.cursor = disabled ? 'not-allowed' : null;\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport DomBuilder from \"../DomBuilder\";\r\nimport Component from \"./Component\";\r\nimport ComponentViewCanvasInner from \"./ComponentViewCanvasInner\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-01-15\r\n */\r\nexport default class ComponentViewCanvas extends Component {\r\n\r\n    /** @type {HTMLElement} */\r\n    #canvasHolderNode = DomBuilder.div({ class: 'sand-game-canvas-holder' });\r\n    /** @type {ComponentViewCanvasInner} */\r\n    #currentCanvas = null;\r\n\r\n    createNode(controller) {\r\n        controller.registerCanvasProvider({\r\n            initialize: () => {\r\n                this.#canvasHolderNode.innerHTML = '';\r\n\r\n                this.#currentCanvas = new ComponentViewCanvasInner(controller);\r\n                this.#canvasHolderNode.append(this.#currentCanvas.createNode(controller));\r\n                return this.#currentCanvas.getCanvasNode();\r\n            },\r\n            getCanvasNode: () => {\r\n                if (this.#currentCanvas !== null) {\r\n                    return this.#currentCanvas.getCanvasNode();\r\n                }\r\n                return null;\r\n            }\r\n        });\r\n\r\n        controller.addOnImageRenderingStyleChanged((imageRenderingStyle) => {\r\n            if (this.#currentCanvas !== null) {\r\n                this.#currentCanvas.setImageRenderingStyle(imageRenderingStyle)\r\n            }\r\n        });\r\n\r\n        controller.addOnInitialized((sandGame) => {\r\n            if (this.#currentCanvas === null) {\r\n                throw 'Illegal state: canvas is not initialized';\r\n            }\r\n\r\n            // register mouse handling and overlays\r\n            this.#currentCanvas.register(sandGame);\r\n        })\r\n\r\n        controller.addOnBeforeClosed(() => {\r\n            this.#currentCanvas = null;\r\n            this.#canvasHolderNode.innerHTML = '';\r\n        })\r\n\r\n        controller.getToolManager().addOnInputDisabledChanged(disabled => {\r\n            if (this.#currentCanvas !== null) {\r\n                this.#currentCanvas.onInputDisabledChanged(disabled);\r\n            }\r\n        });\r\n\r\n        return this.#canvasHolderNode;\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport DomBuilder from \"../DomBuilder\";\r\nimport Action from \"./Action\";\r\nimport Analytics from \"../../Analytics\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2023-08-19\r\n */\r\nexport default class ActionDialogChangeCanvasSize extends Action {\r\n\r\n    performAction(controller) {\r\n        let formBuilder = DomBuilder.bootstrapSimpleFormBuilder();\r\n        formBuilder.addInput('Width', 'width', '' + controller.getCurrentWidthPoints());\r\n        formBuilder.addInput('Height', 'height', '' + controller.getCurrentHeightPoints());\r\n        formBuilder.addInput('Scale', 'scale', '' + controller.getCurrentScale());\r\n\r\n        let dialog = DomBuilder.bootstrapDialogBuilder();\r\n        dialog.setHeaderContent('Change canvas size manually');\r\n        dialog.setBodyContent(formBuilder.createNode());\r\n        dialog.addSubmitButton('Submit', () => {\r\n            let data = formBuilder.getData();\r\n            let w = Number.parseInt(data['width']);\r\n            let h = Number.parseInt(data['height']);\r\n            let s = Number.parseFloat(data['scale']);\r\n            controller.changeCanvasSize(w, h, s);\r\n            Analytics.triggerFeatureUsed(Analytics.FEATURE_CANVAS_SIZE_CHANGE);\r\n        });\r\n        dialog.addCloseButton('Close');\r\n        dialog.show(controller.getDialogAnchor());\r\n    }\r\n}\r\n","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport DomBuilder from \"../DomBuilder\";\r\nimport Component from \"./Component\";\r\nimport Analytics from \"../../Analytics\";\r\n\r\nimport _ASSET_IMG_ELEMENT_SIZE_1 from './assets/element-size-1.png'\r\nimport _ASSET_IMG_ELEMENT_SIZE_2 from './assets/element-size-2.png'\r\nimport _ASSET_IMG_ELEMENT_SIZE_3 from './assets/element-size-3.png'\r\nimport _ASSET_IMG_ELEMENT_SIZE_4 from './assets/element-size-4.png'\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2023-12-22\r\n */\r\nexport default class ComponentViewElementSizeSelection extends Component {\r\n\r\n    static CLASS_SELECTED = 'selected-size';\r\n\r\n    static SIZES = [\r\n        { scale: 0.75,  image: _ASSET_IMG_ELEMENT_SIZE_1, description: 'Very small elements' },\r\n        { scale: 0.5,   image: _ASSET_IMG_ELEMENT_SIZE_2, description: 'Small elements' },\r\n        { scale: 0.375, image: _ASSET_IMG_ELEMENT_SIZE_3, description: 'Medium elements' },\r\n        { scale: 0.25,  image: _ASSET_IMG_ELEMENT_SIZE_4, description: 'Big elements' },\r\n    ];\r\n\r\n\r\n    #nodes = [];\r\n\r\n    #selected = null;\r\n    #selectedScale = null;\r\n\r\n    createNode(controller) {\r\n        for (let sizeDef of ComponentViewElementSizeSelection.SIZES) {\r\n            let node = this.#createSizeCard(sizeDef.scale, sizeDef.image, sizeDef.description);\r\n\r\n            // initial scale\r\n            if (sizeDef.scale === controller.getCurrentScale()) {\r\n                this.#mark(node, sizeDef.scale);\r\n            }\r\n\r\n            node.addEventListener('click', e => {\r\n                this.#select(node, sizeDef.scale, controller);\r\n            })\r\n\r\n            this.#nodes.push(node);\r\n        }\r\n\r\n        return DomBuilder.div(null, [\r\n            DomBuilder.par(null, \"Increasing the size of the elements will result in the top and right\" +\r\n                \" parts of the canvas being clipped.\"),\r\n            DomBuilder.par(null, \"Reducing the size of the elements will result in an expansion of\" +\r\n                \" the canvas in the upper and right parts.\"),\r\n            DomBuilder.par(null, \"Only the scale of the current scene and the initial setting for new\" +\r\n                \" scenes will be changed. Scene can be regenerated by clicking on the scene card.\"),\r\n\r\n            DomBuilder.div({ class: 'element-size-options' }, this.#nodes)\r\n        ]);\r\n    }\r\n\r\n    #select(node, newScale, controller) {\r\n        if (this.#selectedScale === newScale) {\r\n            return;  // already selected\r\n        }\r\n\r\n        // mark selected\r\n        if (this.#selected) {\r\n            this.#selected.classList.remove(ComponentViewElementSizeSelection.CLASS_SELECTED);\r\n        }\r\n        this.#mark(node, newScale);\r\n\r\n        // change scale\r\n        let w = Math.trunc(controller.getCurrentWidthPoints() / controller.getCurrentScale() * newScale);\r\n        let h = Math.trunc(controller.getCurrentHeightPoints() / controller.getCurrentScale() * newScale);\r\n        controller.changeCanvasSize(w, h, newScale);\r\n\r\n        Analytics.triggerFeatureUsed(Analytics.FEATURE_SWITCH_SCALE);\r\n    }\r\n\r\n    #mark(node, scale) {\r\n        node.classList.add(ComponentViewElementSizeSelection.CLASS_SELECTED);\r\n        this.#selected = node;\r\n        this.#selectedScale = scale;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param scale {number}\r\n     * @param image {string}\r\n     * @param description {string}\r\n     */\r\n    #createSizeCard(scale, image, description) {\r\n        return DomBuilder.div({ class: 'card' }, [\r\n            DomBuilder.element('img', { src: image, alt: description })\r\n        ]);\r\n    }\r\n}\r\n","var img = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHgAAABQCAYAAADSm7GJAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACHUlEQVR4Xu3WQW6EMBBEUSJx3jkMF55s4ogQG2zTxeDi/10ijdxTb5HME1k3b39BXgFsHsDmAWwewOYBbB7A5gFsHsDmAWwewOYBbB7A5gFsHsDmAWwewOYBbB7A5gFsHsCrlmV5r39+vV5f659HDOCftrjpd6MjAzzlcVOjIz8eeA83NTLyo4FrcFOjIj8WuAU3NSLyI4F7cFOjIT8O+AxuaiTkRwFH4KZGQX4McCRuagTkjwGvB1ePpMBN3R35I8DbwZUjbd9SpLz/bJcDlwZXjFR6S5Hi/oguBT4aPHKko7cURd4f1WXAtYNHjFT7lqKI+yO7BLh18DMjtb6l6Mz90cmBewfvGan3LUU99yuSAp8dvGWks28parlflQw4avCakaLeUlRzvzIJcPTgeyNFv6Vo73514cCqwXMjqd5SlLu/1Pp71X6mVCiwevD1SOq3FNUgb79XzWf2CgPeHqbqqndU7YGVvtveZ44KAS4dRvlyYEcb5j5T02ngo8MoX8+fmx7kU8C1h1G+nv1akbuBe46jmFqQu4DB/Xy1yM3A4N6nGuQmYHDv1xFyNTC4920PuQoY3PtXQj4EBneccsi7wOCO1xa5CAzuuK2Rs8Dgjl9C/gcMrk/Lsrz/AIPr1y8wuJ7N0wSuczO43v37J4u8Atg8gM0D2DyAzQPYPIDNA9g8gM0D2DyAzQPYPIDNA9g8gM0D2DyAzQPYvG9K/XJS29iPWwAAAABJRU5ErkJggg==\";\n  export default img;","var img = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHgAAABQCAYAAADSm7GJAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABSElEQVR4Xu3WQQ6EIBAFUUw8L4fxwjN78xedQBDLeksiYbAysc8mtPO+IBYDwxkYzsBwBoYzMJyB4QwMZ2A4A8MZGM7AcAaGMzCcgeEMDGdgOAPDGRjOwK2167p+97Wk937c13ZnYDgDwxkYzsBwnwtcHaiStHf3wetzgb/GwHAGhjMw3JLAaThJZg8s1XNHpDNm32PEksB6joHhDAxnYLjpgdPQUZX2VgeWtPcp6bdU7zHb9MDai4HhDAxnYLihwGmYmG3FGSuke6TBq/pc1VBg7c/AcAaGMzBcOXD6+GtM9Z2m56qDVzmw3snAcAaGMzBcDJw+6tpLapQGrxhYHAaGMzCcgeHO9LHWO6WW/oPhDAxnYDgDwxkYzsBwBoYzMJyB4QwMZ2A4A8MZGM7AcAaGMzCcgeEMDGdgOAPDGRjOwHAGhjMw3B/1T0cI5HMokgAAAABJRU5ErkJggg==\";\n  export default img;","var img = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHgAAABQCAYAAADSm7GJAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABGklEQVR4Xu3YMU7EMBQAUZBy3hwmF4Y+BforGcNO3itdOFZGLvyPD9KO+wItAscJHCdwnMBxAscJHCdwnMBxAscJHCdwnMBxAscJHCdwnMBxjw58XdfXfe3uPM/P+9o7eXTgJxA4TuA4geMEjhM4TuA4geO2Bt45WJh8a2Kyz6oz/4atgdlP4DiB4wSOEzhO4DiB4wSOWxZ4MhCYWLXPTpMz/9UwZFlg/ieB4wSOEzhO4DiB4wSOEzhuFHjykOdnq/7hqwOTUWDel8BxAscJHCdwnMBxAscJHHeseoCzx6u93OA4geMEjhM4TuA4geMEjhM4TuA4geMEjhM4TuA4geMEjhM4TuA4geMEjhM4TuA4geMEjhM4TuC4b6YQJX8pLssnAAAAAElFTkSuQmCC\";\n  export default img;","var img = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHgAAABQCAYAAADSm7GJAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA+ElEQVR4Xu3ZsQ3DMAwAwRjwvBpGCye9KgMq7LzvSnbiQxXPD2nnOqBF4DiB4wSOEzhO4DiB4wSOEzhO4DiB4wSOEzhO4LjXBZ5zftfZVWOMY5093esCv43AcQLHCRwncJzAcQLHCRwncJzAcQLHCRwncJzAcVuBd05v/2jnvXedGrcC83wCxwkcJ3CcwHECxwkcJ3CcwHECxwkcJ3CcwHECx507JzCuu2vPfnCcwHECxwkcJ3CcwHECxwkcJ3CcwHECxwkcJ3CcwHECxwkcJ3CcwHECxwkcJ3CcwHECxwkcJ3CcwHECxwkcJ3CcwHECxwkcJ3CcwHE/D68RYAgtpF0AAAAASUVORK5CYII=\";\n  export default img;","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport DomBuilder from \"../DomBuilder\";\r\nimport Action from \"./Action\";\r\nimport ActionDialogChangeCanvasSize from \"./ActionDialogChangeCanvasSize\";\r\nimport ComponentViewElementSizeSelection from \"../component/ComponentViewElementSizeSelection\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2023-08-19\r\n */\r\nexport default class ActionDialogChangeElementSize extends Action {\r\n\r\n    performAction(controller) {\r\n        let elementSizeComponent = new ComponentViewElementSizeSelection();\r\n\r\n        let dialog = DomBuilder.bootstrapDialogBuilder();\r\n        dialog.setHeaderContent('Adjust Scale');\r\n        dialog.setBodyContent(DomBuilder.div({ class: 'sand-game-component' }, [\r\n            elementSizeComponent.createNode(controller)\r\n        ]));\r\n        dialog.addSubmitButton(\"Set size manually\", () => {\r\n            new ActionDialogChangeCanvasSize().performAction(controller);\r\n        });\r\n        dialog.addCloseButton('Close');\r\n        dialog.show(controller.getDialogAnchor());\r\n    }\r\n}\r\n","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport Component from \"./Component\";\r\nimport DomBuilder from \"../DomBuilder\";\r\nimport ActionDialogChangeElementSize from \"../action/ActionDialogChangeElementSize\";\r\n\r\nimport _ASSET_SVG_ADJUST_SCALE from \"./assets/icon-adjust-scale.svg\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2023-08-19\r\n */\r\nexport default class ComponentButtonAdjustScale extends Component {\r\n\r\n    createNode(controller) {\r\n        return DomBuilder.button(DomBuilder.create(_ASSET_SVG_ADJUST_SCALE), {\r\n            class: 'btn btn-outline-secondary adjust-scale',\r\n            'aria-label': 'Adjust scale'\r\n        }, () => {\r\n            new ActionDialogChangeElementSize().performAction(controller);\r\n        });\r\n    }\r\n}\r\n","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport DomBuilder from \"../DomBuilder\";\r\nimport Component from \"./Component\";\r\nimport Analytics from \"../../Analytics\";\r\nimport SceneImplSnapshot from \"../../core/scene/SceneImplSnapshot\";\r\n\r\n// TODO: support external restart\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-05-08\r\n */\r\nexport default class ComponentViewSceneSelection extends Component {\r\n\r\n    static CLASS_SELECTED = 'selected-scene';\r\n    static CLASS_VISITED = 'visited-scene';\r\n\r\n\r\n    /** @type Controller */\r\n    #controller;\r\n\r\n    #ignoreOnBeforeNewSceneLoaded = false;\r\n\r\n    #scenes;\r\n    #initialSceneId;\r\n\r\n    #selected = null;\r\n    #selectedSceneId = null;\r\n\r\n    #closedScenes = new Map();\r\n\r\n    /**\r\n     * @param controller {Controller}\r\n     * @param scenes {Object<string,Scene>}}\r\n     * @param initialSceneId\r\n     */\r\n    constructor(controller, scenes, initialSceneId) {\r\n        super();\r\n        this.#controller = controller;\r\n        this.#scenes = scenes;\r\n        this.#initialSceneId = initialSceneId;\r\n\r\n        this.#controller.addOnBeforeNewSceneLoaded(() => {\r\n            if (!this.#ignoreOnBeforeNewSceneLoaded) {\r\n                this.#store();\r\n                this.#unselect();\r\n            }\r\n        });\r\n    }\r\n\r\n    createNode(controller) {\r\n        let content = DomBuilder.div({ class: 'scenes' }, []);\r\n\r\n        for (const [id, scene] of Object.entries(this.#scenes)) {\r\n            let label = DomBuilder.element('span', { class: 'scene-title' }, scene.name);\r\n            let node = DomBuilder.button(label, { class: 'btn btn-outline-secondary scene' }, () => {\r\n                this.#onSelect(id, node, scene);\r\n            });\r\n\r\n            // mark initial scene\r\n            if (id === this.#initialSceneId) {\r\n                this.#selected = node;\r\n                this.#selectedSceneId = id;\r\n                node.classList.add(ComponentViewSceneSelection.CLASS_SELECTED);\r\n                node.classList.add(ComponentViewSceneSelection.CLASS_VISITED);\r\n            }\r\n\r\n            content.append(node);\r\n        }\r\n\r\n        return content;\r\n    }\r\n\r\n    #onSelect(id, node, scene) {\r\n        if (this.#selected) {\r\n            if (this.#selectedSceneId === id) {\r\n                // already opened - rebuild scene\r\n                this.#rebuildConfirm(() => {\r\n                    this.#select(node, id, scene);\r\n                    Analytics.triggerFeatureUsed(Analytics.FEATURE_RESTART_SCENE);\r\n                });\r\n            } else {\r\n                // store snapshot of the old scene and open...\r\n                this.#store();\r\n                this.#select(node, id, scene);\r\n                Analytics.triggerFeatureUsed(Analytics.FEATURE_SWITCH_SCENE);\r\n            }\r\n        } else {\r\n            // open\r\n            this.#select(node, id, scene);\r\n            Analytics.triggerFeatureUsed(Analytics.FEATURE_SWITCH_SCENE);\r\n        }\r\n    }\r\n\r\n    #rebuildConfirm(onConfirm) {\r\n        let dialog = DomBuilder.bootstrapDialogBuilder();\r\n        dialog.setHeaderContent('Restart scene');\r\n        dialog.setBodyContent([\r\n            DomBuilder.par(null, \"Do you want to restart the scene?\")\r\n        ]);\r\n        dialog.addSubmitButton('Confirm', onConfirm);\r\n        dialog.addCloseButton('Close');\r\n        dialog.show(this.#controller.getDialogAnchor());\r\n    }\r\n\r\n    #select(node, id, scene) {\r\n        this.#unselect();\r\n\r\n        this.#selected = node;\r\n        this.#selectedSceneId = id;\r\n        node.classList.add(ComponentViewSceneSelection.CLASS_SELECTED);\r\n        node.classList.add(ComponentViewSceneSelection.CLASS_VISITED);\r\n\r\n        // restore or build scene\r\n        let snapshot = this.#closedScenes.get(id);\r\n        if (snapshot) {\r\n            this.#closedScenes.delete(id);\r\n\r\n            this.#ignoreOnBeforeNewSceneLoaded = true;\r\n            this.#controller.setInitialScene(scene);\r\n            this.#controller.openScene(new SceneImplSnapshot(snapshot));\r\n            this.#ignoreOnBeforeNewSceneLoaded = false;\r\n        } else {\r\n            this.#ignoreOnBeforeNewSceneLoaded = true;\r\n            this.#controller.setInitialScene(scene);\r\n            this.#controller.openScene(scene);\r\n            this.#ignoreOnBeforeNewSceneLoaded = false;\r\n        }\r\n    }\r\n\r\n    #unselect() {\r\n        if (this.#selected) {\r\n            this.#selected.classList.remove(ComponentViewSceneSelection.CLASS_SELECTED);\r\n        }\r\n        this.#selected = null;\r\n        this.#selectedSceneId = null;\r\n    }\r\n\r\n    #store() {\r\n        if (this.#selected) {\r\n            this.#closedScenes.set(this.#selectedSceneId, this.#controller.createSnapshot());\r\n        }\r\n    }\r\n}\r\n","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport DomBuilder from \"../DomBuilder\";\r\nimport Component from \"./Component\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-01-04\r\n */\r\nexport default class ComponentContainer extends Component {\r\n\r\n    #cssClass;\r\n    #components;\r\n\r\n    /**\r\n     *\r\n     * @param cssClass {string|null}\r\n     * @param components {Component[]}\r\n     */\r\n    constructor(cssClass, components) {\r\n        super();\r\n        this.#cssClass = cssClass;\r\n        this.#components = components;\r\n    }\r\n\r\n    createNode(controller) {\r\n        const content = DomBuilder.div({ class: this.#cssClass }, []);\r\n        for (let component of this.#components) {\r\n            if (component !== null) {\r\n                content.append(component.createNode(controller));\r\n            }\r\n        }\r\n        return content;\r\n    }\r\n}\r\n","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport Component from \"./Component\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-01-04\r\n */\r\nexport default class ComponentSimple extends Component {\r\n\r\n    #node;\r\n\r\n    /**\r\n     *\r\n     * @param node {HTMLElement}\r\n     */\r\n    constructor(node) {\r\n        super();\r\n        this.#node = node;\r\n    }\r\n\r\n    createNode(controller) {\r\n        return this.#node;\r\n    }\r\n}\r\n","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport Component from \"./Component\";\r\nimport DomBuilder from \"../DomBuilder\";\r\nimport Action from \"../action/Action\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2023-12-05\r\n */\r\nexport default class ComponentButton extends Component {\r\n\r\n    static CLASS_PRIMARY = 'btn-primary';\r\n    static CLASS_SECONDARY = 'btn-secondary';\r\n    static CLASS_INFO = 'btn-info';\r\n    static CLASS_SUCCESS = 'btn-success';\r\n    static CLASS_WARNING = 'btn-warning';\r\n    static CLASS_LIGHT = 'btn-light';\r\n\r\n    static CLASS_OUTLINE_PRIMARY = 'btn-outline-primary';\r\n    static CLASS_OUTLINE_SECONDARY = 'btn-outline-secondary';\r\n    static CLASS_OUTLINE_INFO = 'btn-outline-info';\r\n    static CLASS_OUTLINE_SUCCESS = 'btn-outline-success';\r\n    static CLASS_OUTLINE_WARNING = 'btn-outline-warning';\r\n    static CLASS_OUTLINE_LIGHT = 'btn-outline-light';\r\n\r\n\r\n    #label;\r\n    #action;\r\n    #cssClass;\r\n\r\n    /**\r\n     *\r\n     * @param label {string|HTMLElement|HTMLElement[]}\r\n     * @param cssClass {string|null}\r\n     * @param action {Action|function}\r\n     */\r\n    constructor(label, cssClass, action) {\r\n        super();\r\n        this.#label = label;\r\n        this.#action = (typeof action === \"function\" ? Action.create(action) : action);\r\n        this.#cssClass = (cssClass == null ? ComponentButton.CLASS_PRIMARY : cssClass);\r\n    }\r\n\r\n    createNode(controller) {\r\n        return DomBuilder.button(this.#label, { class: 'btn ' + this.#cssClass }, e => {\r\n            this.#action.performAction(controller);\r\n        });\r\n    }\r\n}\r\n","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport Action from \"../action/Action\";\r\nimport ComponentButton from \"./ComponentButton\";\r\nimport Analytics from \"../../Analytics\";\r\nimport DomBuilder from \"../DomBuilder\";\r\n\r\nimport _ASSET_SVG_PAUSE from \"./assets/icon-pause.svg\";\r\nimport _ASSET_SVG_PLAY from \"./assets/icon-play.svg\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-01-10\r\n */\r\nexport default class ComponentButtonStartStop extends ComponentButton {\r\n\r\n    constructor(cssClass) {\r\n        super('', cssClass, Action.create(controller => {\r\n            controller.switchStartStop();\r\n            Analytics.triggerFeatureUsed(Analytics.FEATURE_PAUSE);\r\n        }));\r\n    }\r\n\r\n    createNode(controller) {\r\n        const btn = super.createNode(controller);\r\n        DomBuilder.setContent(btn, [DomBuilder.create(_ASSET_SVG_PLAY), 'Start']);\r\n\r\n        controller.addOnStarted(() => {\r\n            DomBuilder.setContent(btn, [DomBuilder.create(_ASSET_SVG_PAUSE), 'Pause']);\r\n        });\r\n        controller.addOnStopped(() => {\r\n            DomBuilder.setContent(btn, [DomBuilder.create(_ASSET_SVG_PLAY), 'Start']);\r\n        });\r\n\r\n        return btn;\r\n    }\r\n}\r\n","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport Analytics from \"../../Analytics\";\r\nimport DomBuilder from \"../DomBuilder\";\r\nimport Processor from \"../../core/processing/Processor\";\r\nimport Component from \"./Component\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-03-23\r\n */\r\nexport default class ComponentStatusIndicator extends Component {\r\n\r\n    #additionalInfo;\r\n\r\n    constructor(additionalInfo = null) {\r\n        super();\r\n        this.#additionalInfo = additionalInfo;\r\n    }\r\n\r\n    createNode(controller) {\r\n        let currenStatus = '';\r\n\r\n        const nodeStatusLabel = DomBuilder.span('');\r\n        const nodeLabel = [\r\n            DomBuilder.span('Performance: ', { class: 'visible-on-big-screen-only' }),\r\n            nodeStatusLabel\r\n        ];\r\n\r\n        const node = DomBuilder.div({ class: 'btn-group' }, [\r\n            DomBuilder.element('button', {\r\n                type: 'button',\r\n                class: 'btn btn-link dropdown-toggle',\r\n                'data-bs-toggle': 'dropdown',\r\n                'aria-expanded': 'false'\r\n            }, nodeLabel),\r\n            DomBuilder.element('form', { class: 'dropdown-menu p-2' }, this.#createStatusContent(controller))\r\n        ]);\r\n        node.addEventListener('show.bs.dropdown', function () {\r\n            Analytics.triggerFeatureUsed(Analytics.FEATURE_STATUS_DISPLAYED);\r\n        });\r\n\r\n        let updateStatus = (node, status) => {\r\n            if (status !== currenStatus) {\r\n                nodeStatusLabel.textContent = (status.toUpperCase());\r\n                nodeStatusLabel.classList.remove('status-' + currenStatus);\r\n                nodeStatusLabel.classList.add('status-' + status);\r\n                currenStatus = status;\r\n            }\r\n        }\r\n\r\n        controller.addOnStopped(() => updateStatus(node, 'stopped'));\r\n        controller.addOnStarted(() => updateStatus(node, 'started'));\r\n        controller.addOnInitialized(sandGame => {\r\n            sandGame.addOnRendered(() => {\r\n                const ips = controller.getSandGame().getIterationsPerSecond();\r\n                if (ips === 0) {\r\n                    updateStatus(node, 'stopped');\r\n                    return;\r\n                }\r\n                if (ips > 105) {\r\n                    updateStatus(node, 'best');\r\n                    return;\r\n                }\r\n                if (ips > 80) {\r\n                    updateStatus(node, 'good');\r\n                    return;\r\n                }\r\n                if (ips > 50) {\r\n                    updateStatus(node, 'medium');\r\n                    return;\r\n                }\r\n                if (ips > 40) {\r\n                    updateStatus(node, 'low');\r\n                    return;\r\n                }\r\n                updateStatus(node, 'poor');\r\n            });\r\n        });\r\n\r\n        return node;\r\n    }\r\n\r\n    #createStatusContent(controller) {\r\n        const labelCPS = DomBuilder.span();\r\n        const labelFPS = DomBuilder.span();\r\n        controller.addOnInitialized(sandGame => {\r\n            sandGame.addOnRendered(() => {\r\n                const fps = controller.getSandGame().getFramesPerSecond();\r\n                const ips = controller.getSandGame().getIterationsPerSecond();\r\n                labelFPS.textContent = ' = ' + fps;\r\n                labelCPS.textContent = ' = ' + ips;\r\n            });\r\n        });\r\n\r\n        const labelCanvasSize = DomBuilder.span();\r\n        const updateCanvasSize = () => {\r\n            const w = controller.getCurrentWidthPoints();\r\n            const h = controller.getCurrentHeightPoints();\r\n            labelCanvasSize.textContent = ` = ${w.toLocaleString()}\\u00D7${h.toLocaleString()} = ${(w * h).toLocaleString()}`;\r\n        }\r\n        controller.addOnInitialized(() => {\r\n            updateCanvasSize();\r\n        });\r\n        updateCanvasSize();\r\n\r\n        return [\r\n            DomBuilder.span('Sand Game JS ' + controller.getVersion(), { style: 'font-weight: bold;' }),\r\n            DomBuilder.element('br'),\r\n\r\n            DomBuilder.span('Simulated elements'),\r\n            labelCanvasSize,\r\n            DomBuilder.element('br'),\r\n\r\n            DomBuilder.span('Simulation iterations /s'),\r\n            labelCPS,\r\n            DomBuilder.span(' (target: ' + Processor.OPT_CYCLES_PER_SECOND + ')', { style: 'color: lightgray;' }),\r\n            DomBuilder.element('br'),\r\n\r\n            DomBuilder.span('Rendered frames /s'),\r\n            labelFPS,\r\n            DomBuilder.span(' (target: ' + Processor.OPT_FRAMES_PER_SECOND + ')', { style: 'color: lightgray;' }),\r\n            DomBuilder.element('br'),\r\n\r\n            this.#additionalInfo\r\n        ];\r\n    }\r\n}\r\n","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport Action from \"./Action\";\r\nimport DomBuilder from \"../DomBuilder\";\r\nimport Analytics from \"../../Analytics\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-01-17\r\n */\r\nexport default class ActionRestart extends Action {\r\n\r\n    performAction(controller) {\r\n        let dialog = DomBuilder.bootstrapDialogBuilder();\r\n        dialog.setHeaderContent('Restart');\r\n        dialog.setBodyContent([\r\n            DomBuilder.par(null, \"Are you sure?\")\r\n        ]);\r\n        dialog.addSubmitButton('Restart', () => {\r\n            const scene = controller.getInitialScene();\r\n            controller.openScene(scene);\r\n            Analytics.triggerFeatureUsed(Analytics.FEATURE_RESTART_SCENE);\r\n        });\r\n        dialog.addCloseButton('Close');\r\n        dialog.show(controller.getDialogAnchor());\r\n    }\r\n}\r\n","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport ComponentButton from \"./ComponentButton\";\r\nimport DomBuilder from \"../DomBuilder\";\r\nimport ActionRestart from \"../action/ActionRestart\";\r\n\r\nimport _ASSET_SVG_RESTART from \"./assets/icon-reset.svg\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-01-17\r\n */\r\nexport default class ComponentButtonRestart extends ComponentButton {\r\n\r\n    constructor(cssClass) {\r\n        super('', cssClass, new ActionRestart());\r\n    }\r\n\r\n    createNode(controller) {\r\n        const btn = super.createNode(controller);\r\n        DomBuilder.setContent(btn, [DomBuilder.create(_ASSET_SVG_RESTART), 'Restart']);\r\n        return btn;\r\n    }\r\n}\r\n","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport Action from \"./Action\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2023-08-19\r\n */\r\nexport default class ActionIOImport extends Action {\r\n\r\n    performAction(controller) {\r\n        let input = document.createElement('input');\r\n        input.type = 'file';\r\n        input.onchange = e => {\r\n            controller.getIOManager().loadFromFiles(e.target.files);\r\n        }\r\n        input.click();\r\n    }\r\n}\r\n","(function(a,b){if(\"function\"==typeof define&&define.amd)define([],b);else if(\"undefined\"!=typeof exports)b();else{b(),a.FileSaver={exports:{}}.exports}})(this,function(){\"use strict\";function b(a,b){return\"undefined\"==typeof b?b={autoBom:!1}:\"object\"!=typeof b&&(console.warn(\"Deprecated: Expected third argument to be a object\"),b={autoBom:!b}),b.autoBom&&/^\\s*(?:text\\/\\S*|application\\/xml|\\S*\\/\\S*\\+xml)\\s*;.*charset\\s*=\\s*utf-8/i.test(a.type)?new Blob([\"\\uFEFF\",a],{type:a.type}):a}function c(a,b,c){var d=new XMLHttpRequest;d.open(\"GET\",a),d.responseType=\"blob\",d.onload=function(){g(d.response,b,c)},d.onerror=function(){console.error(\"could not download file\")},d.send()}function d(a){var b=new XMLHttpRequest;b.open(\"HEAD\",a,!1);try{b.send()}catch(a){}return 200<=b.status&&299>=b.status}function e(a){try{a.dispatchEvent(new MouseEvent(\"click\"))}catch(c){var b=document.createEvent(\"MouseEvents\");b.initMouseEvent(\"click\",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),a.dispatchEvent(b)}}var f=\"object\"==typeof window&&window.window===window?window:\"object\"==typeof self&&self.self===self?self:\"object\"==typeof global&&global.global===global?global:void 0,a=f.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),g=f.saveAs||(\"object\"!=typeof window||window!==f?function(){}:\"download\"in HTMLAnchorElement.prototype&&!a?function(b,g,h){var i=f.URL||f.webkitURL,j=document.createElement(\"a\");g=g||b.name||\"download\",j.download=g,j.rel=\"noopener\",\"string\"==typeof b?(j.href=b,j.origin===location.origin?e(j):d(j.href)?c(b,g,h):e(j,j.target=\"_blank\")):(j.href=i.createObjectURL(b),setTimeout(function(){i.revokeObjectURL(j.href)},4E4),setTimeout(function(){e(j)},0))}:\"msSaveOrOpenBlob\"in navigator?function(f,g,h){if(g=g||f.name||\"download\",\"string\"!=typeof f)navigator.msSaveOrOpenBlob(b(f,h),g);else if(d(f))c(f,g,h);else{var i=document.createElement(\"a\");i.href=f,i.target=\"_blank\",setTimeout(function(){e(i)})}}:function(b,d,e,g){if(g=g||open(\"\",\"_blank\"),g&&(g.document.title=g.document.body.innerText=\"downloading...\"),\"string\"==typeof b)return c(b,d,e);var h=\"application/octet-stream\"===b.type,i=/constructor/i.test(f.HTMLElement)||f.safari,j=/CriOS\\/[\\d]+/.test(navigator.userAgent);if((j||h&&i||a)&&\"undefined\"!=typeof FileReader){var k=new FileReader;k.onloadend=function(){var a=k.result;a=j?a:a.replace(/^data:[^;]*;/,\"data:attachment/file;\"),g?g.location.href=a:location=a,g=null},k.readAsDataURL(b)}else{var l=f.URL||f.webkitURL,m=l.createObjectURL(b);g?g.location=m:location.href=m,g=null,setTimeout(function(){l.revokeObjectURL(m)},4E4)}});f.saveAs=g.saveAs=g,\"undefined\"!=typeof module&&(module.exports=g)});\n\n//# sourceMappingURL=FileSaver.min.js.map","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport Action from \"./Action\";\r\nimport Analytics from \"../../Analytics\";\r\nimport Resources from \"../../io/Resources\";\r\nimport FileSaver from 'file-saver';\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2023-08-19\r\n */\r\nexport default class ActionIOExport extends Action {\r\n\r\n    performAction(controller) {\r\n        const snapshot = controller.createSnapshot();\r\n        const bytes = Resources.createResourceFromSnapshot(snapshot);\r\n        FileSaver.saveAs(new Blob([bytes]), this.#createFilename());\r\n        Analytics.triggerFeatureUsed(Analytics.FEATURE_IO_EXPORT);\r\n    }\r\n\r\n    #createFilename() {\r\n        let date = new Date().toISOString().slice(0, 10);\r\n        return `sand-game-js_${date}.sgjs`;\r\n    }\r\n}\r\n","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport Action from \"./Action\";\r\nimport DomBuilder from \"../DomBuilder\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-02-04\r\n */\r\nexport default class ActionReportProblem extends Action {\r\n\r\n    /** @type function(type:string,message:string,controller:Controller) */\r\n    #handler;\r\n\r\n    constructor(handler) {\r\n        super();\r\n        this.#handler = handler;\r\n    }\r\n\r\n    performAction(controller) {\r\n        let formBuilder = DomBuilder.bootstrapSimpleFormBuilder();\r\n        formBuilder.addTextArea('Message', 'message');\r\n\r\n        let dialog = DomBuilder.bootstrapDialogBuilder();\r\n        dialog.setHeaderContent('Report a problem');\r\n        dialog.setBodyContent(formBuilder.createNode());\r\n        dialog.addSubmitButton('Submit', () => {\r\n            let data = formBuilder.getData();\r\n            let message = data['message'];\r\n            if (message.trim() !== '') {\r\n                this.#handler(\"user\", message, controller);\r\n            }\r\n        });\r\n        dialog.addCloseButton('Close');\r\n        dialog.show(controller.getDialogAnchor());\r\n    }\r\n}\r\n","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport ComponentButton from \"./ComponentButton\";\r\nimport ActionReportProblem from \"../action/ActionReportProblem\";\r\nimport DomBuilder from \"../DomBuilder\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-03-23\r\n */\r\nexport default class ComponentButtonReport extends ComponentButton {\r\n\r\n    constructor(cssClass, errorReporter) {\r\n        const label = [\r\n            'Report',\r\n            DomBuilder.span(' a\\xa0problem', { class: 'visible-on-big-screen-only' })\r\n        ];\r\n        super(label, cssClass, new ActionReportProblem(errorReporter));\r\n    }\r\n}\r\n","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\n/**\r\n * @interface\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-04-27\r\n */\r\nexport default class Extension {\r\n\r\n    run() {\r\n        throw 'Not implemented'\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport Extension from \"./Extension\";\r\nimport ProcessorModuleGrass from \"../processing/ProcessorModuleGrass.js\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-04-27\r\n */\r\nexport default class ExtensionSpawnGrass extends Extension {\r\n\r\n    /** @type ElementArea */\r\n    #elementArea;\r\n    /** @type DeterministicRandom */\r\n    #random;\r\n    /** @type ProcessorContext */\r\n    #processorContext;\r\n\r\n    /**\r\n     *\r\n     * @param gameState {GameState}\r\n     */\r\n    constructor(gameState) {\r\n        super();\r\n        this.#elementArea = gameState.elementArea;\r\n        this.#random = gameState.random;\r\n        this.#processorContext = gameState.processorContext;\r\n    }\r\n\r\n    run() {\r\n        if (this.#processorContext.getIteration() % 3 === 0) {\r\n\r\n            const x = this.#random.nextInt(this.#elementArea.getWidth());\r\n            const y = this.#random.nextInt(this.#elementArea.getHeight() - 3) + 2;\r\n\r\n            if (ProcessorModuleGrass.canGrowUpHere(this.#elementArea, x, y)) {\r\n                const brush = this.#processorContext.getDefaults().getBrushGrass();\r\n                this.#elementArea.setElement(x, y, brush.apply(x, y, this.#random));\r\n                this.#processorContext.trigger(x, y);\r\n            }\r\n        }\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport Extension from \"./Extension\";\r\nimport ElementHead from \"../ElementHead.js\";\r\nimport Entities from \"../entity/Entities\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-05-26\r\n */\r\nexport default class ExtensionSpawnFish extends Extension {\r\n\r\n    /** @type ElementArea */\r\n    #elementArea;\r\n    /** @type DeterministicRandom */\r\n    #random;\r\n    /** @type ProcessorContext */\r\n    #processorContext;\r\n    /** @type EntityManager */\r\n    #entityManager;\r\n\r\n    /**\r\n     *\r\n     * @param gameState {GameState}\r\n     */\r\n    constructor(gameState) {\r\n        super();\r\n        this.#elementArea = gameState.elementArea;\r\n        this.#random = gameState.random;\r\n        this.#processorContext = gameState.processorContext;\r\n        this.#entityManager = gameState.entityManager;\r\n    }\r\n\r\n    run() {\r\n        if ((this.#processorContext.getIteration() + 200) % 1000 === 0) {\r\n            const fishCount = this.#entityManager.countEntities('fish');\r\n\r\n            if (fishCount >= 8) {\r\n                return;\r\n            }\r\n\r\n            const x = this.#random.nextInt(this.#elementArea.getWidth() - 20) + 10;\r\n            const y = this.#findSpawnY(this.#elementArea, x);\r\n            if (y !== null) {\r\n                this.#entityManager.addSerializedEntity(Entities.fish(x, y));\r\n                this.#processorContext.trigger(x, y);\r\n            }\r\n        }\r\n    }\r\n\r\n    #findSpawnY(elementArea, x) {\r\n        let waterCount = 0;\r\n\r\n        for (let y = 0; y < elementArea.getHeight(); y++) {\r\n            const elementHead = elementArea.getElementHead(x, y);\r\n            const typeClass = ElementHead.getTypeClass(elementHead);\r\n            if (typeClass === ElementHead.TYPE_AIR) {\r\n                waterCount = 0;\r\n            } else if (typeClass === ElementHead.TYPE_FLUID) {\r\n                if (ElementHead.getBehaviour(elementHead) === ElementHead.BEHAVIOUR_LIQUID\r\n                        && ElementHead.getSpecial(elementHead) === ElementHead.SPECIAL_LIQUID_WATER) {\r\n                    waterCount++;\r\n                }\r\n            } else if (typeClass === ElementHead.TYPE_POWDER || typeClass === ElementHead.TYPE_POWDER_WET) {\r\n                if (waterCount > 7 && this.#isSpaceAround(x, y - 1)) {\r\n                    return y - 1;\r\n                }\r\n                break;\r\n            }\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    #isSpaceAround(x, y) {\r\n        for (let dy = 0; dy < 6; dy++) {\r\n            for (let dx = -(dy + 1); dx < dy + 1; dx++) {\r\n                const ex = x + dx;\r\n                const ey = y - dy;\r\n                const elementHead = this.#elementArea.getElementHeadOrNull(ex, ey);\r\n                if (elementHead === null) {\r\n                    return false;\r\n                }\r\n                if (ElementHead.getTypeClass(elementHead) !== ElementHead.TYPE_FLUID) {\r\n                    return false;\r\n                }\r\n                if (ElementHead.getTemperature(elementHead) > 0) {\r\n                    return false;\r\n                }\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport Extension from \"./Extension\";\r\nimport ElementHead from \"../ElementHead.js\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-04-27\r\n */\r\nexport default class ExtensionSpawnTrees extends Extension {\r\n\r\n    /** @type ElementArea */\r\n    #elementArea;\r\n    /** @type DeterministicRandom */\r\n    #random;\r\n    /** @type ProcessorContext */\r\n    #processorContext;\r\n\r\n    /**\r\n     *\r\n     * @param gameState {GameState}\r\n     */\r\n    constructor(gameState) {\r\n        super();\r\n        this.#elementArea = gameState.elementArea;\r\n        this.#random = gameState.random;\r\n        this.#processorContext = gameState.processorContext;\r\n    }\r\n\r\n    run() {\r\n        const iteration = this.#processorContext.getIteration();\r\n        if (iteration > 1000 && iteration % 4 === 0) {\r\n\r\n            const x = this.#random.nextInt(this.#elementArea.getWidth() - 12) + 6;\r\n            const y = this.#random.nextInt(this.#elementArea.getHeight() - 16) + 15;\r\n\r\n            if (ExtensionSpawnTrees.couldGrowUpHere(this.#elementArea, x, y)) {\r\n                const brush = this.#processorContext.getDefaults().getBrushTree();\r\n                this.#elementArea.setElement(x, y, brush.apply(x, y, this.#random));\r\n                this.#processorContext.trigger(x, y);\r\n            }\r\n        }\r\n    }\r\n\r\n    static couldGrowUpHere(elementArea, x, y) {\r\n        if (x < 0 || y < 12) {\r\n            return false;\r\n        }\r\n        if (x > elementArea.getWidth() - 5 || y > elementArea.getHeight() - 2) {\r\n            return false;\r\n        }\r\n        let e1 = elementArea.getElementHead(x, y);\r\n        if (ElementHead.getBehaviour(e1) !== ElementHead.BEHAVIOUR_GRASS) {\r\n            return false;\r\n        }\r\n        if (ElementHead.getTemperature(e1) > 0) {\r\n            return false;\r\n        }\r\n        let e2 = elementArea.getElementHead(x, y + 1);\r\n        if (ElementHead.getBehaviour(e2) !== ElementHead.BEHAVIOUR_SOIL) {\r\n            return false;\r\n        }\r\n        if (ElementHead.getTemperature(e2) > 0) {\r\n            return false;\r\n        }\r\n\r\n        // check space directly above\r\n        for (let dy = 1; dy < 18; dy++) {\r\n            if (!ExtensionSpawnTrees.#isSpaceHere(elementArea, x, y - dy)) {\r\n                return false;\r\n            }\r\n        }\r\n\r\n        // check trees around\r\n        for (let dx = -15; dx < 15; dx++) {\r\n            if (ExtensionSpawnTrees.#isOtherThreeThere(elementArea, x + dx, y - 4)) {\r\n                return false;\r\n            }\r\n        }\r\n\r\n        // check space above - left & right\r\n        for (let dy = 10; dy < 15; dy++) {\r\n            if (!ExtensionSpawnTrees.#isSpaceHere(elementArea, x - 8, y - dy)) {\r\n                return false;\r\n            }\r\n            if (!ExtensionSpawnTrees.#isSpaceHere(elementArea, x + 8, y - dy)) {\r\n                return false;\r\n            }\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    static #isSpaceHere(elementArea, tx, ty) {\r\n        let targetElementHead = elementArea.getElementHead(tx, ty);\r\n        if (ElementHead.getTypeClass(targetElementHead) === ElementHead.TYPE_AIR) {\r\n            return true;\r\n        }\r\n        if (ElementHead.getBehaviour(targetElementHead) === ElementHead.BEHAVIOUR_GRASS) {\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    static #isOtherThreeThere(elementArea, tx, ty) {\r\n        let targetElementHead = elementArea.getElementHead(tx, ty);\r\n        let behaviour = ElementHead.getBehaviour(targetElementHead);\r\n        if (behaviour === ElementHead.BEHAVIOUR_TREE_TRUNK || behaviour === ElementHead.BEHAVIOUR_TREE) {\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport Extension from \"./Extension\";\r\nimport ElementHead from \"../ElementHead.js\";\r\nimport Entities from \"../entity/Entities\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-05-05\r\n */\r\nexport default class ExtensionSpawnButterflies extends Extension {\r\n\r\n    /** @type ElementArea */\r\n    #elementArea;\r\n    /** @type DeterministicRandom */\r\n    #random;\r\n    /** @type ProcessorContext */\r\n    #processorContext;\r\n    /** @type EntityManager */\r\n    #entityManager;\r\n\r\n    /**\r\n     *\r\n     * @param gameState {GameState}\r\n     */\r\n    constructor(gameState) {\r\n        super();\r\n        this.#elementArea = gameState.elementArea;\r\n        this.#random = gameState.random;\r\n        this.#processorContext = gameState.processorContext;\r\n        this.#entityManager = gameState.entityManager;\r\n    }\r\n\r\n    run() {\r\n        if ((this.#processorContext.getIteration() + 500) % 1000 === 0) {\r\n            const butterflyCount = this.#entityManager.countEntities('butterfly');\r\n\r\n            if (butterflyCount > 3) {\r\n                return;\r\n            }\r\n\r\n            const x = this.#random.nextInt(this.#elementArea.getWidth() - 20) + 10;\r\n            const y = this.#findSpawnY(this.#elementArea, x);\r\n            if (y !== null) {\r\n                this.#entityManager.addSerializedEntity(Entities.butterfly(x, y));\r\n                this.#processorContext.trigger(x, y);\r\n            }\r\n        }\r\n    }\r\n\r\n    #findSpawnY(elementArea, x) {\r\n        let airCount = 0;\r\n\r\n        for (let y = 0; y < elementArea.getHeight(); y++) {\r\n            const elementHead = elementArea.getElementHead(x, y);\r\n            if (ElementHead.getTypeClass(elementHead) === ElementHead.TYPE_AIR) {\r\n                airCount++;\r\n            } else if (ElementHead.getBehaviour(elementHead) === ElementHead.BEHAVIOUR_GRASS) {\r\n                if (airCount >= 15 && this.#isSpaceAround(x, y - 4)) {\r\n                    return y - 4;\r\n                }\r\n                break;\r\n            } else {\r\n                airCount = 0;\r\n            }\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    #isSpaceAround(x, y) {\r\n        for (let dy = -5; dy <= 2; dy++) {\r\n            for (let dx = -5; dx <= 5; dx++) {\r\n                const ex = x + dx;\r\n                const ey = y + dy;\r\n                const elementHead = this.#elementArea.getElementHeadOrNull(ex, ey);\r\n                if (elementHead === null) {\r\n                    return false;\r\n                }\r\n                if (ElementHead.getTypeClass(elementHead) !== ElementHead.TYPE_AIR) {\r\n                    return false;\r\n                }\r\n                if (ElementHead.getTemperature(elementHead) > 0) {\r\n                    return false;\r\n                }\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport Extension from \"./Extension\";\r\nimport ElementHead from \"../ElementHead.js\";\r\nimport Entities from \"../entity/Entities\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-05-05\r\n */\r\nexport default class ExtensionSpawnBirds extends Extension {\r\n\r\n    /** @type ElementArea */\r\n    #elementArea;\r\n    /** @type DeterministicRandom */\r\n    #random;\r\n    /** @type ProcessorContext */\r\n    #processorContext;\r\n    /** @type EntityManager */\r\n    #entityManager;\r\n\r\n    /**\r\n     *\r\n     * @param gameState {GameState}\r\n     */\r\n    constructor(gameState) {\r\n        super();\r\n        this.#elementArea = gameState.elementArea;\r\n        this.#random = gameState.random;\r\n        this.#processorContext = gameState.processorContext;\r\n        this.#entityManager = gameState.entityManager;\r\n    }\r\n\r\n    run() {\r\n        if ((this.#processorContext.getIteration() + 700) % 1000 === 0) {\r\n            const birdCount = this.#entityManager.countEntities('bird');\r\n\r\n            if (birdCount > 4) {\r\n                return;\r\n            }\r\n\r\n            const x = this.#random.nextInt(this.#elementArea.getWidth() - 20) + 10;\r\n            const y = this.#findSpawnY(this.#elementArea, x);\r\n            if (y !== null) {\r\n                this.#entityManager.addSerializedEntity(Entities.bird(x, y));\r\n                this.#processorContext.trigger(x, y);\r\n            }\r\n        }\r\n    }\r\n\r\n    #findSpawnY(elementArea, x) {\r\n        let airCount = 0;\r\n\r\n        for (let y = 0; y < elementArea.getHeight(); y++) {\r\n            const elementHead = elementArea.getElementHead(x, y);\r\n            if (ElementHead.getTypeClass(elementHead) === ElementHead.TYPE_AIR) {\r\n                airCount++;\r\n            } else if (ElementHead.getBehaviour(elementHead) === ElementHead.BEHAVIOUR_TREE_LEAF) {\r\n                if (airCount >= 15 && this.#isSpaceAround(x, y - 5)) {\r\n                    return y - 5;\r\n                }\r\n                break;\r\n            } else {\r\n                airCount = 0;\r\n            }\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    #isSpaceAround(x, y) {\r\n        for (let dy = -6; dy <= 2; dy++) {\r\n            for (let dx = -5; dx <= 5; dx++) {\r\n                const ex = x + dx;\r\n                const ey = y + dy;\r\n                const elementHead = this.#elementArea.getElementHeadOrNull(ex, ey);\r\n                if (elementHead === null) {\r\n                    return false;\r\n                }\r\n                if (ElementHead.getTypeClass(elementHead) !== ElementHead.TYPE_AIR) {\r\n                    return false;\r\n                }\r\n                if (ElementHead.getTemperature(elementHead) > 0) {\r\n                    return false;\r\n                }\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport Extension from \"./Extension\";\r\n\r\n/**\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-05-08\r\n */\r\nexport default class ExtensionGenWaypoints extends Extension {\r\n\r\n    /** @type GameState */\r\n    #gameState;\r\n\r\n    /**\r\n     *\r\n     * @param gameState {GameState}\r\n     */\r\n    constructor(gameState) {\r\n        super();\r\n        this.#gameState = gameState;\r\n    }\r\n\r\n    run() {\r\n        if ((this.#gameState.processorContext.getIteration() + 700) % 1000 === 0) {\r\n            this.#generateWaypoint('fish', 20, 5, 2);\r\n        }\r\n        if ((this.#gameState.processorContext.getIteration() + 800) % 1000 === 0) {\r\n            this.#generateWaypoint('butterfly', 20, 5, 4);\r\n        }\r\n        if ((this.#gameState.processorContext.getIteration() + 900) % 1000 === 0) {\r\n            this.#generateWaypoint('bird', 100, 50, 8);\r\n        }\r\n    }\r\n\r\n    #generateWaypoint(entityType, maxHorDiff, maxVerDiff, maxVar) {\r\n        const entities = this.#gameState.entityManager.getEntities().filter(e => e.getType() === entityType);\r\n        if (entities.length > 0) {\r\n            const random = this.#gameState.random;\r\n\r\n            let groups;\r\n            if (entities.length === 1) {\r\n                groups = [[entities[0].getX(), entities[0].getY(), entities]];\r\n            } else {\r\n                let k = entities.length === 2 ? 1 : 2;\r\n                if (random.next() < 0.2) {\r\n                    // break groups sometimes...\r\n                    k++;\r\n                }\r\n                groups = this.#kMeans(entities, k);\r\n            }\r\n\r\n            for (const [cx, cy, list] of groups) {\r\n                let wx = cx + random.nextInt(2 * maxHorDiff) - maxHorDiff;\r\n                let wy = cy + random.nextInt(2 * maxVerDiff) - maxVerDiff;\r\n\r\n                const maxWidth = this.#gameState.elementArea.getWidth();\r\n                wx = Math.abs(wx);\r\n                if (wx >= maxWidth) {\r\n                    wx = maxWidth - (wx - maxWidth);\r\n                }\r\n\r\n                const maxHeight = this.#gameState.elementArea.getHeight();\r\n                wy = Math.abs(wy);\r\n                if (wy >= maxHeight) {\r\n                    wy = maxHeight - (wy - maxHeight);\r\n                }\r\n\r\n                for (let entity of list) {\r\n                    if (typeof entity.assignWaypoint === 'function') {\r\n                        const wyy = wy + random.nextInt(2 * maxVar) - maxVar;\r\n                        const wxx = wx + random.nextInt(2 * maxVar) - maxVar;\r\n                        entity.assignWaypoint(wxx, wyy);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    #kMeans(entities, k) {\r\n        // Initialize centroids randomly\r\n        let centroids = entities.slice(0, k);\r\n\r\n        let assignment = new Array(entities.length);\r\n        let clusters = new Array(k);\r\n\r\n        while (true) {\r\n            // Assign each entity to the closest centroid\r\n            for (let i = 0; i < entities.length; i++) {\r\n                let minDistance = Infinity;\r\n                for (let j = 0; j < k; j++) {\r\n                    let dx = entities[i].getX() - centroids[j].getX();\r\n                    let dy = entities[i].getY() - centroids[j].getY();\r\n                    let distance = Math.sqrt(dx * dx + dy * dy);\r\n                    if (distance < minDistance) {\r\n                        minDistance = distance;\r\n                        assignment[i] = j;\r\n                    }\r\n                }\r\n            }\r\n\r\n            // Calculate new centroids\r\n            let newCentroids = new Array(k);\r\n            for (let i = 0; i < k; i++) {\r\n                clusters[i] = [];\r\n                let sumX = 0, sumY = 0, count = 0;\r\n                for (let j = 0; j < entities.length; j++) {\r\n                    if (assignment[j] === i) {\r\n                        sumX += entities[j].getX();\r\n                        sumY += entities[j].getY();\r\n                        count++;\r\n                        clusters[i].push(entities[j]);\r\n                    }\r\n                }\r\n                const cx = Math.round(sumX / count);\r\n                const cy = Math.round(sumY / count);\r\n                newCentroids[i] = { getX: () => cx, getY: () => cy };\r\n            }\r\n\r\n            // Check for convergence\r\n            let converged = true;\r\n            for (let i = 0; i < k; i++) {\r\n                if (centroids[i].getX() !== newCentroids[i].getX() || centroids[i].getY() !== newCentroids[i].getY()) {\r\n                    converged = false;\r\n                    break;\r\n                }\r\n            }\r\n\r\n            if (converged) {\r\n                break;\r\n            }\r\n\r\n            centroids = newCentroids;\r\n        }\r\n\r\n        // Return the result\r\n        let result = [];\r\n        for (let i = 0; i < k; i++) {\r\n            result.push([centroids[i].getX(), centroids[i].getY(), clusters[i]]);\r\n        }\r\n        return result;\r\n    }\r\n}","// Sand Game JS; Patrik Harag, https://harag.cz; all rights reserved\r\n\r\nimport SizeUtils from \"./gui/SizeUtils\";\r\nimport Analytics from \"./Analytics\";\r\nimport DomBuilder from \"./gui/DomBuilder\";\r\nimport Controller from \"./gui/Controller\";\r\nimport Brushes from \"./core/brush/Brushes\";\r\nimport BrushDefs from \"./def/BrushDefs\";\r\nimport Tool from \"./core/tool/Tool\";\r\nimport Tools from \"./core/tool/Tools\";\r\nimport ToolDefs from \"./def/ToolDefs\";\r\nimport PredicateDefs from \"./def/PredicateDefs\";\r\nimport Scenes from \"./core/scene/Scenes\";\r\nimport SceneDefs from \"./def/SceneDefs\";\r\nimport Entities from \"./core/entity/Entities\";\r\nimport ComponentViewTools from \"./gui/component/ComponentViewTools\";\r\nimport ComponentViewCanvas from \"./gui/component/ComponentViewCanvas\";\r\nimport ComponentButtonAdjustScale from \"./gui/component/ComponentButtonAdjustScale\";\r\nimport ComponentViewSceneSelection from \"./gui/component/ComponentViewSceneSelection\";\r\nimport ComponentContainer from \"./gui/component/ComponentContainer\";\r\nimport ComponentSimple from \"./gui/component/ComponentSimple\";\r\nimport ComponentButton from \"./gui/component/ComponentButton\";\r\nimport ComponentButtonStartStop from \"./gui/component/ComponentButtonStartStop\";\r\nimport ComponentStatusIndicator from \"./gui/component/ComponentStatusIndicator\";\r\nimport ComponentButtonRestart from \"./gui/component/ComponentButtonRestart\";\r\nimport ActionIOImport from \"./gui/action/ActionIOImport\";\r\nimport ActionIOExport from \"./gui/action/ActionIOExport\";\r\nimport ServiceToolManager from \"./gui/ServiceToolManager\";\r\nimport ComponentButtonReport from \"./gui/component/ComponentButtonReport\";\r\nimport Resources from \"./io/Resources\";\r\nimport GameDefaultsImpl from \"./def/GameDefaultsImpl\";\r\nimport ExtensionSpawnGrass from \"./core/extensions/ExtensionSpawnGrass\";\r\nimport ExtensionSpawnFish from \"./core/extensions/ExtensionSpawnFish\";\r\nimport ExtensionSpawnTrees from \"./core/extensions/ExtensionSpawnTrees\";\r\nimport ExtensionSpawnButterflies from \"./core/extensions/ExtensionSpawnButterflies\";\r\nimport ExtensionSpawnBirds from \"./core/extensions/ExtensionSpawnBirds\";\r\nimport ExtensionGenWaypoints from \"./core/extensions/ExtensionGenWaypoints\";\r\nimport RendererInitializerDefs from \"./def/RendererInitializerDefs\";\r\n\r\n// exported classes and constants (accessible as SandGameJS.XXX)\r\n\r\nexport { Brushes };\r\nexport { BrushDefs };\r\nexport { PredicateDefs };\r\nexport { Tools };\r\nexport { ToolDefs };\r\nexport { Entities };\r\nexport { Scenes };\r\nexport { SceneDefs };\r\nexport { Resources };\r\nexport { RendererInitializerDefs };\r\n\r\nexport const brushes = BrushDefs._LIST;\r\nexport const tools = ToolDefs._LIST;\r\n\r\n/**\r\n * Initialize Sand Game JS.\r\n *\r\n * @param root {HTMLElement}\r\n * @param config {{\r\n *     version: undefined|string,\r\n *     debug: undefined|boolean,\r\n *     canvas: undefined|{\r\n *         scale: undefined|number,\r\n *         maxWidthPx: undefined|number,\r\n *         maxHeightPx: undefined|number\r\n *     },\r\n *     autoStart: undefined|boolean,\r\n *     scene: undefined|string|{init:(function(SandGame, Controller):Promise<any>|any)},\r\n *     scenes: undefined|Scene[]|Object.<string,Scene>,\r\n *     extensions: undefined|Object.<string,boolean>,\r\n *     brushes: undefined|Object.<string,Brush>,\r\n *     tools: undefined|(string|Tool)[],\r\n *     primaryTool: undefined|string|Tool,\r\n *     secondaryTool: undefined|string|Tool,\r\n *     tertiaryTool: undefined|string|Tool,\r\n *     disableRestart: undefined|boolean,\r\n *     disableStartStop: undefined|boolean,\r\n *     disableImport: undefined|boolean,\r\n *     disableExport: undefined|boolean,\r\n *     disableSizeChange: undefined|boolean,\r\n *     disableSceneSelection: undefined|boolean,\r\n *     disableGlobalShortcuts: undefined|boolean,\r\n *     errorReporter: undefined|function(type:string,message:string,controller:Controller),\r\n * }}\r\n * @returns {Controller}\r\n *\r\n * @author Patrik Harag\r\n * @version 2024-05-19\r\n */\r\nexport function init(root, config) {\r\n    if (config === undefined) {\r\n        config = {};\r\n    }\r\n\r\n    let controller;\r\n\r\n    const {width, height, scale} = SizeUtils.determineOptimalSizes(root, config.canvas);\r\n\r\n    const init = {\r\n        scale: scale,\r\n        canvasWidthPx: width,\r\n        canvasHeightPx: height,\r\n        version: config.version\r\n    };\r\n\r\n    const enableDebug = config.debug === true;\r\n    const enableAutoStart = config.autoStart === undefined || config.autoStart === true;\r\n    const enableRestart = !(config.disableRestart === true);\r\n    const enableStartStop = !(config.disableStartStop === true);\r\n    const enableImport = !(config.disableImport === true);\r\n    const enableExport = !(config.disableExport === true);\r\n    const enableSizeChange = !(config.disableSizeChange === true);\r\n    const enableSceneSelection = !(config.disableSceneSelection === true);\r\n    const enableGlobalShortcuts = !(config.disableGlobalShortcuts === true);\r\n    const enableUserErrorReporting = config.errorReporter !== undefined;\r\n\r\n    const errorReporter = config.errorReporter;\r\n\r\n    // resolve processor defaults - brushes & extensions\r\n\r\n    let brushes;\r\n    if (typeof config.brushes === 'object') {\r\n        brushes = config.brushes;\r\n    } else if (config.brushes === undefined) {\r\n        brushes = undefined\r\n    } else {\r\n        throw \"config.brushes - wrong type, expected object\";\r\n    }\r\n\r\n    let extensions;\r\n    if (typeof config.extensions === 'object') {\r\n        extensions = config.extensions;\r\n    } else if (config.extensions === undefined) {\r\n        extensions = {\r\n            spawnFish: true,\r\n            spawnGrass: true,\r\n            spawnTrees: true,\r\n            spawnButterflies: true,\r\n            spawnBirds: true,\r\n            generateWaypoints: true,\r\n        };\r\n    } else {\r\n        throw \"config.extensions - wrong type, expected object\";\r\n    }\r\n\r\n    const extensionsFactory = (gameState) => {\r\n        const array = [];\r\n        if (extensions.spawnFish === true) {\r\n            array.push(new ExtensionSpawnFish(gameState));\r\n        }\r\n        if (extensions.spawnGrass === true) {\r\n            array.push(new ExtensionSpawnGrass(gameState));\r\n        }\r\n        if (extensions.spawnTrees === true) {\r\n            array.push(new ExtensionSpawnTrees(gameState));\r\n        }\r\n        if (extensions.spawnButterflies === true) {\r\n            array.push(new ExtensionSpawnButterflies(gameState));\r\n        }\r\n        if (extensions.spawnBirds === true) {\r\n            array.push(new ExtensionSpawnBirds(gameState));\r\n        }\r\n        if (extensions.generateWaypoints === true) {\r\n            array.push(new ExtensionGenWaypoints(gameState));\r\n        }\r\n        return array;\r\n    };\r\n\r\n    const defaults = new GameDefaultsImpl(brushes, extensionsFactory);\r\n\r\n    // resolve scene list\r\n\r\n    let scenes;\r\n    let customScenes;\r\n    if (Array.isArray(config.scenes)) {\r\n        scenes = {};\r\n        for (let i = 0; i < config.scenes.length; i++) {\r\n            scenes['scene_' + i] = config.scenes[i];\r\n        }\r\n        customScenes = true;\r\n    } else if (typeof config.scenes === \"object\") {\r\n        scenes = config.scenes;\r\n        customScenes = true;\r\n    } else {\r\n        // build-in scenes\r\n        scenes = SceneDefs.SCENES;\r\n        customScenes = false;\r\n    }\r\n\r\n    // resolve current scene\r\n\r\n    let scene;\r\n    let sceneName;\r\n    if (typeof config.scene === 'string') {\r\n        // from scene list\r\n        sceneName = config.scene;\r\n        scene = scenes[sceneName];\r\n        if (scene === undefined) {\r\n            throw 'Scene not found: ' + sceneName;\r\n        }\r\n    } else if (typeof config.scene === 'object') {\r\n        // custom scene\r\n        sceneName = 'n/a';\r\n        const sceneFunc = (typeof config.scene.init === 'function')\r\n            ? (sandGame) => config.scene.init(sandGame, controller)\r\n            : () => {};\r\n        scene = Scenes.custom('n/a', sceneFunc);\r\n    } else {\r\n        // default scene\r\n        if (customScenes) {\r\n            // select first\r\n            sceneName = Object.keys(scenes)[0];\r\n            scene = Object.values(scenes)[0];\r\n        } else {\r\n            if (enableDebug) {\r\n                sceneName = 'landscape_1';  // always the same\r\n            } else {\r\n                sceneName = (Math.random() > 0.1) ? 'landscape_1' : 'landscape_2';\r\n            }\r\n            scene = scenes[sceneName];\r\n        }\r\n    }\r\n\r\n    // resolve tools\r\n\r\n    function resolveTool(t, defaultTool = null) {\r\n        if (typeof t === 'string') {\r\n            let tool = ToolDefs.byCodeName(t);\r\n            if (tool !== null) {\r\n                return tool;\r\n            } else if (enableDebug) {\r\n                throw 'Tool not found: ' + t;\r\n            }\r\n            return defaultTool;\r\n        } else if (typeof t === 'object' && t instanceof Tool) {\r\n            return t;\r\n        } else {\r\n            if (enableDebug) {\r\n                throw 'Unexpected tool type';\r\n            }\r\n            return defaultTool;\r\n        }\r\n    }\r\n\r\n    let tools;\r\n    if (Array.isArray(config.tools)) {\r\n        tools = [];\r\n        for (let t of config.tools) {\r\n            let tool = resolveTool(t, null);\r\n            if (tool !== null) {\r\n                tools.push(tool);\r\n            }\r\n        }\r\n    } else {\r\n        tools = Tools.grouping(ToolDefs.DEFAULT_TOOLS, ToolDefs.DEFAULT_CATEGORY_DEFINITIONS);\r\n    }\r\n\r\n    let primaryTool;\r\n    if (config.primaryTool === undefined || (primaryTool = resolveTool(config.primaryTool)) === null) {\r\n        primaryTool = ToolDefs.SAND;\r\n    }\r\n\r\n    let secondaryTool;\r\n    if (config.secondaryTool === undefined || (secondaryTool = resolveTool(config.secondaryTool)) === null) {\r\n        secondaryTool = ToolDefs.ERASE;\r\n    }\r\n\r\n    let tertiaryTool;\r\n    if (config.tertiaryTool === undefined || (tertiaryTool = resolveTool(config.tertiaryTool)) === null) {\r\n        tertiaryTool = ToolDefs.METEOR;\r\n    }\r\n\r\n    // init controller\r\n\r\n    const dialogAnchorNode = DomBuilder.div({ class: 'sand-game-dialog-anchor sand-game-component' });\r\n    document.body.prepend(dialogAnchorNode);\r\n    const toolManager = new ServiceToolManager(primaryTool, secondaryTool, tertiaryTool);\r\n    controller = new Controller(init, dialogAnchorNode, toolManager, defaults);\r\n\r\n    // init error reporting\r\n\r\n    if (errorReporter !== undefined) {\r\n        controller.addOnFailure((type, message) => errorReporter(type, message, controller));\r\n    }\r\n\r\n    // init components\r\n\r\n    const mainComponent = new ComponentContainer('sand-game-component', [\r\n        new ComponentViewTools(tools, enableImport),\r\n        new ComponentViewCanvas(),\r\n        new ComponentContainer('sand-game-options', [\r\n            new ComponentContainer('sand-game-options-left', [\r\n                (enableImport) ? new ComponentButton('Import', ComponentButton.CLASS_LIGHT, new ActionIOImport()) : null,\r\n                (enableExport) ? new ComponentButton('Export', ComponentButton.CLASS_LIGHT, new ActionIOExport()) : null,\r\n                (enableRestart && !enableSceneSelection) ? new ComponentButtonRestart(ComponentButton.CLASS_LIGHT) : null,\r\n                (enableStartStop) ? new ComponentButtonStartStop(ComponentButton.CLASS_LIGHT) : null,\r\n                new ComponentStatusIndicator((enableSizeChange)\r\n                        ? DomBuilder.element('span', null, [DomBuilder.element('br'), 'Tip: adjust scale if needed'])\r\n                        : null),\r\n            ]),\r\n            new ComponentContainer('sand-game-options-right', [\r\n                (enableUserErrorReporting) ? new ComponentButtonReport(ComponentButton.CLASS_LIGHT, errorReporter) : null,\r\n            ]),\r\n        ]),\r\n        new ComponentContainer('sand-game-views', [\r\n            (enableSizeChange || enableSceneSelection) ? new ComponentContainer(null, [\r\n                (enableSizeChange) ? new ComponentButtonAdjustScale() : null,\r\n                (enableSceneSelection) ? new ComponentSimple(DomBuilder.span('Scenes', { class: 'scenes-label' })) : null,\r\n                (enableSceneSelection) ? new ComponentViewSceneSelection(controller, scenes, sceneName) : null,\r\n            ]) : null,\r\n            (enableDebug && window.SandGameJS_ModuleDev !== undefined) ? SandGameJS_ModuleDev.createComponent() : null,\r\n        ])\r\n    ]);\r\n\r\n    // build HTML nodes and start\r\n\r\n    const node = mainComponent.createNode(controller);\r\n    root.innerHTML = '';\r\n    root.append(node);\r\n\r\n    controller.setup(scene);\r\n    if (enableImport) {\r\n        controller.getIOManager().initFileDragAndDrop(node);\r\n    }\r\n    if (enableGlobalShortcuts) {\r\n        controller.enableGlobalShortcuts();\r\n    }\r\n    if (enableAutoStart) {\r\n        controller.start();\r\n    }\r\n\r\n    Analytics.triggerFeatureUsed(Analytics.FEATURE_APP_INITIALIZED);\r\n\r\n    return controller;\r\n}"],"names":["SizeUtils","determineSize","root","maxWidthPx","maxHeightPx","parentWidth","window","innerWidth","clientWidth","width","Math","min","height","trunc","innerHeight","determineMaxNumberOfPoints","navigator","maxTouchPoints","document","documentElement","screen","determineOptimalScale","maxPoints","countPointsWithScale","scale","determineOptimalSizes","parentNode","canvasConfig","undefined","scaleOverride","Element","elementHead","elementTail","constructor","this","ElementHead","static","of","type8","behaviour8","modifiers8","temperature","value","typeClass","typeModifiers","type8Powder","momentum","sliding","direction","type8Fluid","type8Solid","bodyId","extendedNeighbourhood","behaviour","special","heatModIndex","getType","getTypeClass","getTypeModifierPowderSliding","getTypeModifierPowderDirection","getTypeModifierPowderMomentum","getTypeModifierSolidNeighbourhoodType","getTypeModifierSolidBodyId","getBehaviour","getSpecial","getHeatModIndex","getTemperature","setType","type","setTypeClass","setTypeModifierPowderSliding","val","setTypeModifierPowderDirection","setTypeModifierPowderMomentum","setTypeModifierSolidNeighbourhoodType","setTypeModifierSolidBodyId","setBehaviour","setSpecial","setHeatModIndex","setTemperature","Array","HEAT_MODS_COUNT","defHeatMods","i","conductiveIndex","heatLossChanceTo10000","flammableChanceTo10000","selfIgnitionChanceTo10000","flameHeat","burnDownChanceTo10000","meltingTemperature","meltingHMI","hardeningTemperature","hardeningHMI","array","HEAT_MODS","hmiToConductiveIndex","hmiToHeatLossChanceTo10000","hmiToFlammableChanceTo10000","hmiToSelfIgnitionChanceTo10000","hmiToFlameHeat","hmiToBurnDownChanceTo10000","hmiToMeltingTemperature","hmiToMeltingHMI","hmiToHardeningTemperature","hmiToHardeningHMI","DeterministicRandom","next","seed","t","imul","last","nextInt","max","getState","Brush","apply","x","y","random","oldElement","RandomBrush","list","super","length","DEFAULT","RandomElementBrush","elements","AbstractEffectBrush","innerBrush","_retrieveElement","ElementTail","r","g","b","blurType","BLUR_TYPE_NONE","heatEffect","burntLevel","getColorRed","getColorGreen","getColorBlue","getBlurType","getBurntLevel","getHeatEffect","setColor","setBlurType","setBurntLevel","ColorBrush","element","newElementTail","ColorPaletteRandomBrush","palette","split","map","line","Number","Assets","asImageData","base64","maxWidth","maxHeight","Promise","resolve","reject","image","Image","onload","canvas","createElement","w","h","imageWidth","imageHeight","wScale","hScale","countSize","context","getContext","drawImage","imageData","getImageData","onerror","src","e","ColorTextureBrush","then","cx","index","red","data","green","blue","F2","sqrt","G2","fastFloor","floor","grad2","Float64Array","createNoise2D","perm","tableSize","p","Uint8Array","aux","buildPermutationTable","permGrad2x","v","permGrad2y","n0","n1","n2","s","j","x0","y0","i1","j1","x1","y1","x2","y2","ii","jj","t0","gi0","t1","gi1","t2","gi2","VisualEffects","isVisualBurnApplicable","TYPE_FLUID","TYPE_POWDER_FLOATING","visualBurn","force","maxBurntLevel","newTail","newBurntLevel","appliedForce","divisor","visualNoiseProvider","isArray","instances","PerlinNoiseVisualEffect","noise2D","noise2DInstances","visualNoise","factor","threshold","nr","ng","nb","nose2D","alpha","visualNoiseCombined","coefficientList","result","instance","ColorNoiseBrush","coefficients","noise","c","ColorMovingPaletteBrush","stepSize","current","ColorRandomize","maxDiff","CustomBrush","func","CountingBrush","predicate","counterPositives","counterTotal","NULL_REDICATE","getPositives","getTotal","reset","PredicateDefs","and","predicateA","predicateB","or","not","TYPE_AIR","TYPE_EFFECT","TYPE_GAS","BEHAVIOUR_LIQUID","TYPE_POWDER","TYPE_POWDER_WET","IS_POWDER","BEHAVIOUR_SOIL","TYPE_STATIC","BEHAVIOUR_ENTITY","BEHAVIOUR_GRASS","BEHAVIOUR_TREE","BEHAVIOUR_TREE_LEAF","BEHAVIOUR_TREE_TRUNK","BEHAVIOUR_TREE_ROOT","MeltingBrush","FIELD_TEMPERATURE_SIZE","newElementHead","BLUR_TYPE_1","SolidBodyBrush","solidBodyId","newType","ExtinguishedBrush","BEHAVIOUR_FIRE_SOURCE","BEHAVIOUR_NONE","Brushes","parsePalette","string","filter","trim","counting","custom","hasBrushes","item","color","colorTexture","colorPaletteRandom","colorPaletteCyclic","ColorPaletteCyclicBrush","colorRandomize","colorNoise","withIntensity","intensity","brush","gentle","conditional","IS_AIR","temperatureOrBrush","concat","first","second","firstResult","secondResult","join","brushes","molten","extinguished","toSolidBody","ToolInfo","info","derive","derivedInfo","Object","assign","getCategory","category","getDisplayName","displayName","getCodeName","codeName","getBadgeStyle","badgeStyle","getSvgIcon","icon","svg","CursorDefinition","getWidth","getHeight","Tool","NOT_DEFINED","getInfo","hasCursor","createCursor","isRepeatingEnabled","applyPoint","graphics","altModifier","isLineModeEnabled","onDragStart","onDragEnd","applyStroke","isAreaModeEnabled","applyArea","applySpecial","isSecondaryActionEnabled","applySecondaryAction","RoundBrushTool","size","getBrush","currentBrush","drawLine","drawRectangle","floodFill","RoundBrushToolForSolidBody","toSolidBodyBrush","IS_STATIC","drag","dragBuffer","ex","ey","draw","push","PointBrushTool","points","aldModifier","dx","dy","MeteorTool","meteor","meteorFromLeft","meteorFromRight","diffSlope4","ElementArea","create","defaultElement","bufferHeads","DataView","ArrayBuffer","bufferTails","setElement","from","dataHeads","dataTails","isValidPosition","setElementHeadAndTail","byteOffset","setUint32","LITTLE_ENDIAN","setElementHead","setElementTail","getElement","getUint32","getElementHead","getElementHeadOrNull","getElementTail","getElementTailOrNull","swap","elementHead2","elementTail2","getDataHeads","buffer","getDataTails","CursorDefinitionElementArea","elementArea","getElementArea","InsertElementAreaTool","asElementArea","scene","createElementArea","DEFAULT_W","DEFAULT_H","TRANSPARENT_ELEMENT","serializedEntities","onInsertHandler","offsetX","offsetY","tx","ty","serializedEntity","serializedClone","entities","insertEntity","InsertRandomSceneTool","scenes","currentTool","initRandomTool","serializedEntitiesOrNull","createEntities","ActionTool","handler","PositionedElement","FloodFillPainter","neighbourhood","NEIGHBOURHOOD_VON_NEUMANN","createPattern","NEIGHBOURHOOD_SOLID_BODY","paint","pattern","matcher","normalize","pointSet","Set","queue","point","has","add","tryAdd","NEIGHBOURHOOD_MOORE","pop","equals","CopyUtils","copyNonSolidElements","graphicsCommands","replacementElement","elementTypeClass","canBeCopiedAsNonSolidElement","copySolidBodies","maxArea","newElements","copySolidBody","newElement","solidBodyElements","collectingBrush","solidBodyElement","copyEntities","entity","getAt","isActive","extractedSerializedEntity","extractedElements","extract","trimmed","minX","MAX_VALUE","maxX","MIN_VALUE","minY","maxY","MoveTool","solidBodyMaxArea","insertScene","createInsertToolAt","copySingleElementsAt","getDefaults","getDefaultElement","entitiesElements","createInsertTool","copyElements","abs","empty","SelectionFakeTool","tools","getTools","TemplateSelectionFakeTool","templateDefinitions","getTemplateDefinitions","GlobalActionTool","getHandler","ProcessorContext","getIteration","isFallThroughEnabled","isErasingEnabled","trigger","triggerSolidCreated","GameState","processorContext","entityManager","InsertEntityTool","entityFactory","nextEntity","createEntity","tmpElementArea","tmpRandom","tmpProcessorContext","gameState","serialized","serialize","countMaxBoundaries","centerX","centerY","Tools","roundBrushTool","roundBrushToolForSolidBody","pointBrushTool","multiPointBrushTool","meteorTool","insertScenesTool","actionTool","globalActionTool","moveTool","templateSelectionTool","selectionTool","insertEntityTool","grouping","categoryDefinitions","groups","selections","tool","selection","groupedTools","group","categoryDefinition","StructureDefs","_ASSET_TREE_TRUNK_TEMPLATES","_ASSET_TREE_CELL_TEMPLATES","BrushDefs","BLUR_TYPE_BACKGROUND","HMI_CONDUCTIVE_1","HEAT_EFFECT_2","HMI_WOOD_LIKE","HEAT_EFFECT_1","SPECIAL_LIQUID_HEAVY_MOLTEN","HMI_METAL","HEAT_EFFECT_3","METAL","HMI_CONDUCTIVE_2","HMI_COAL","HMI_THERMITE","SPECIAL_LIQUID_WATER","HMI_CONDUCTIVE_3","HEAT_EFFECT_NONE","SPECIAL_LIQUID_LIGHT_OIL","HMI_OIL","HMI_GRASS_LIKE","_ASSET_PALETTE_TREE_WOOD_DARK","treeType","TREE_TRUNK_TEMPLATES","HMI_LEAF_LIKE","BEHAVIOUR_FIRE","FIRE_ELEMENT_HEAD","BEHAVIOUR_METEOR","modifiedElementHead","none","NONE","air","AIR","ash","ASH","sand","SAND","soil","SOIL","gravel","GRAVEL","wall","WALL","rock","ROCK","wood","WOOD","brick","BRICK","metal","metal_molten","METAL_MOLTEN","water","WATER","steam","STEAM","oil","OIL","grass","GRASS","tree","TREE","tree_wood","TREE_WOOD","tree_wood_dark","TREE_WOOD_DARK","tree_leaf","TREE_LEAF_LIGHTER","tree_leaf_dark","TREE_LEAF_DARKER","tree_root","TREE_ROOT","fire","FIRE","METEOR","meteor_l","METEOR_FROM_LEFT","meteor_r","METEOR_FROM_RIGHT","effect_temp_0","EFFECT_TEMP_0","effect_temp_127","EFFECT_TEMP_127","effect_temp_200","EFFECT_TEMP_200","effect_temp_255","EFFECT_TEMP_255","effect_burnt","EFFECT_BURNT","effect_wet","EFFECT_WET","effect_molten","EFFECT_MOLTEN","effect_extinguished","EFFECT_EXTINGUISH","byCodeName","_LIST","TemplateDefs","action","actions","randomFlipHorizontally","randomFlipVertically","StateDefinition","createStateTransition","stateFrom","stateTo","transitions","ax","ay","bx","by","createStateTransitionTable","states","stateTransitions","createCyclic","state","masks","StateMask","getStates","getStatesCount","getMasks","getTransitions","getMinX","getMaxX","getMinY","getMaxY","matches","EntityUtils","isElementFallingHeavy","isElementLight","isElementWater","isElementEntity","Entity","getX","getY","initialize","performBeforeProcessing","performAfterProcessing","rx","ry","StateBasedAbstractEntity","_elementArea","_random","_processorContext","_stateDefinition","_brush","_areaBoundary","_type","_iteration","_x","_y","_waypoint","_state","_stuck","stateDefinition","iteration","stuck","_checkIsSpace","assignWaypoint","unassignWaypoint","_incrementState","allowed","dx1","dy1","dx2","dy2","_checkIsSpaceAt","_moveRandom","visionExtra","xChange","yChange","_move","_moveInWaypointDirection","newPos","countNewPosition","nx","ny","relocate","yy","xx","mask","_moveForced","countNewForcedPosition","targetElementHead","sortedPoints","sort","a","_kill","positionedElements","StateBasedBirdLikeEntity","isFalling","retIsActive","retIsFalling","doCheckState","heavyElementsAbove","totalTemperature","MAX_AVG_TEMPERATURE","MAX_STUCK_COUNT","StateBasedFishLikeEntity","heavyElementAbove","lightElementsAbove","waterElementsAbove","lightElementsBelow","waterElementsBelow","elementHeadOrNull","EntityFactories","birdFactory","BIRD_STATES","BIRD_BRUSH","butterflyFactory","BUTTERFLY_STATES","BUTTERFLY_BRUSH","fishFactory","FISH_STATES","FISH_BRUSH","findFactoryByEntityType","ToolDefs","DEFAULT_CATEGORY_DEFINITIONS","CATEGORY_POWDER","backgroundColor","CATEGORY_FLUIDS","CATEGORY_SOLIDS","CATEGORY_EFFECTS","CATEGORY_NONE","DEFAULT_SIZE","sg","flipVertically","flipHorizontally","COAL","THERMITE","ROCK_SM","ROCK_MD","ROCK_LG","ERASE","MOVE","ROCK_TEMPLATES_SM","ROCK_TEMPLATES_MD","ROCK_TEMPLATES_LG","EFFECT_TEMP_MINUS","EFFECT_TEMP_PLUS","EFFECT_TEMP_PLUS2","CATEGORY_BIOLOGICAL","FLIP_HORIZONTALLY","FLIP_VERTICALLY","DEFAULT_TOOLS","BIRD","BUTTERFLY","FISH","Analytics","triggerToolUsed","name","feature","triggerFeatureUsed","USED_FEATURES","report","app_sand_game_js_feature","properties","gtag","EVENT_NAME","console","warn","DomBuilder","addContent","content","textContent","Node","appendChild","insertAdjacentText","setContent","innerHTML","putAttributes","attributes","key","setAttribute","style","html","template","firstElementChild","div","par","span","text","link","href","addEventListener","button","label","bootstrapAlertInfo","bodyContent","alertDiv","class","role","append","bootstrapCard","headerContent","card","bootstrapCardCollapsable","title","collapsed","id","bootstrapInitTooltip","node","bootstrap","error","old","Tooltip","dispose","bootstrapSwitchButton","checked","switchInput","control","for","bootstrapToggleButton","labelContent","buttonClass","nodeInput","nodeLabel","bootstrapTableBuilder","BootstrapTable","bootstrapDialogBuilder","BootstrapDialog","bootstrapToastBuilder","BootstrapToast","bootstrapSimpleFormBuilder","BootstrapSimpleForm","tableBody","addRow","row","addRowBefore","insertBefore","firstChild","createNode","table","tableResponsive","persistent","additionalStyle","headerNode","bodyNode","footerNodeChildren","dialog","dialogBootstrap","setPersistent","setSizeLarge","setSizeExtraLarge","setHeaderContent","setBodyContent","addCloseButton","buttonText","addSubmitButton","addButton","show","dialogAnchor","tabindex","Modal","removeChild","hide","toast","toastBootstrap","dataDelay","setDelay","milliseconds","toastAttributes","wrapper","Toast","formFields","submitButton","addTextArea","initialValue","rows","input","addInput","getData","form","formField","Counter","currentValue","lastValue","start","tick","currentTimeMillis","getValue","clear","EntityPositionLookup","Map","get","set","EntityManager","positionLookupCache","addSerializedEntity","autoInitialize","deserialize","factory","toDelete","active","splice","serializeEntities","countEntities","count","getEntities","GameDefaults","getExtensionsFactory","getBrushCollection","getBrushWater","getBrushSteam","getBrushGrass","getBrushTree","getBrushTreeWood","getBrushTreeWoodDark","getBrushTreeRoot","getBrushTreeLeaf","getBrushTreeLeafDark","getBrushFire","getBrushAsh","getTreeTrunkTemplates","getTreeLeafClusterTemplates","ProcessorModuleSolidBody","elementAreaOverlay","moved","reusableLowerBorderMinY","Uint16Array","onSolidCreated","NEWLY_CREATED_PAINT_ID","onNextIteration","fill","behaviourSolid","paintId","currentPaintId","originalCount","upperBorderStack","lowerBorderStack","lowerBorderMin","discoverBoundaries","bodyFallthrough","shadowClone","extendUpperBoundaries","borderCount","borderCountCanMove","determineCanMove","bodyMove","bodyPush","bodyDestroy","elementHeadOld","elementTailOld","reuseElement","reuseFluid","triggerPowderElement","distance","f","exp","elementHeadUnder","typeUnder","modified","removePrevious","applied","lowerBorderMinY","extendedCount","columnLowerBorderMinY","nextPaintId","reusableWorkStack","Uint32Stack","reusableUpperBorderStack","reusableLowerBorderStack","stack","discoverNeighbour","oldMin","targetPaintId","QUEUED_PAINT_ID","Uint32Array","newArray","clone","ProcessorModuleEntity","behaviourEntity","ProcessorModuleFire","createFireElementHead","createFireElementTail","behaviourFire","newTemperature","countNewTemperature","FIRE_MIN_TEMPERATURE","elementHeadAbove","couldBeReplacedByFire","fireEffect","currentTemperature","getTemperatureAt","otherTemperature","flammableChance","ignite","behaviourFireSource","burnDownChange","oldTemperature","ashElement","modifiedAshElementHead","modifiedAshElementTail","flags","fireSourceEffect","actualTemperature","CircleIterator","iterate","blueprint","char","charAt","ProcessorModuleMeteor","behaviourMeteor","spawnFire","move","newSpecial","DIRECTION_FROM_TOP","DIRECTION_FROM_LEFT","DIRECTION_FROM_RIGHT","canMove","explode","BLUEPRINT_4","level","HEAT","BLUEPRINT_9","heat","EXPLOSION_MAX_HEAT_LVL_8","EXPLOSION_MAX_HEAT_LVL_9","EXPLOSION_MAX_HEAT_VARIANCE","targetElementTail","ProcessorModuleGrass","canGrowUpHere","e1","MAX_TEMPERATURE","e2","e3","spawnHere","offset","behaviourGrass","visualEffectForce","above1","typeAbove1","growIndex","above2","ProcessorModuleTree","NOISE","levelsToGrow","FIELD_SPECIAL_SIZE","treeModule","treeGrow","targetElement","treeRootGrow","trunkTreeTemplates","leafClusterTemplates","behaviourTree","MAX_TREE_TEMPERATURE","OPT_CYCLES_PER_SECOND","trunkTemplateId","treeCheckStatus","leafClusterIdRndSalt","treeCreateOrGetSeed","levelGrown","parallelBranches","entries","grow","increment","modifiedTail","cleanupBranches","branch","templateX","templateY","nodeType","currentElementHead","currentElementBehaviour","TYPE_LEAF","LEAF_NOISE","TYPE_TRUNK","trunkGrow","TRUNK_NOISE","treeSetSeed","TYPE_BRANCH","branchGrow","rnd","leafClusterId","leafCluster","leafBrush","TYPE_ROOT","newParallelEntries","carrierElementHead","maxStage","lastStage","currentStage","entriesCount","treeWoodBrush","behaviourTreeRoot","treeRootHardenSurroundingElements","targetX","targetY","doGrow","modifiedHead","behaviourTreeLeaf","vitality","MAX_LEAF_TEMPERATURE","dryLeaf","directions","randomDirection","sourceX","sourceY","sourceElementHead","destX","destY","step","destElementHead","whiteBackground","ProcessorModuleLiquid","behaviourLiquid","behaviourSubtypeWater","behaviourSubtypeLightOil","behaviourSubtypeHeavyMolten","testBehaviourLiquid","testBehaviourSubtypeWater","testBehaviourSubtypeLightOil","testBehaviourSubtypeHeavyMolten","RET_FLAG_ACTIVE","RET_FLAG_SKIP_TEMP","skipTemperature","testMoveHeavyFluid","testMoveLightFluid","targetHead","targetTail","FIRST_HEAVY","FIRST_LIGHT","Processor","chunkSize","horChunkCount","verChunkCount","activeChunks","changedChunks","chunkLastFullTest","fallThroughEnabled","erasingEnabled","defaults","rndChunkOrder","rndChunkXRnd","rndChunkXOrder","moduleSolidBody","moduleEntity","moduleLiquid","moduleFire","moduleMeteor","moduleGrass","moduleTree","extensions","sceneMetadata","ceil","rndDataRandom","generateArrayOfOrderData","RANDOM_DATA_COUNT","generateArrayOfRandomData","shuffle","iterations","arrayLength","generateOrderData","generateRandomData","setFallThroughEnabled","enabled","setErasingEnabled","addExtension","extension","chunkIndex","getActiveChunks","getChangedChunks","cleanChangedChunks","temperatureProcessingMod","temperatureProcessingMod3Y","temperatureProcessingMod3X","cy","cyTop","cyBottom","chunkOrder","fullChunkLoop","chunkActiveElements","idx","chunkXOder","activeElements","processTemperature","nextPoint","fastTest","lastFullTest","fullTest","run","my","testPoint","mx","testMovingBehaviour","testMove","performMovingBehaviour","temperatureRelatedActivity","temp","tryHardening","heatLoss","newTemp","targetTemp","newTargetTemp","chanceToIgnite","findHardeningSupport","isHardeningSupport","wake","asMomentumMoveInMillion","directionX","elementType2","elementType1","elementHeadWithAbsorbedFluid","elementHead1","nextElementHead","asMomentumWakeupInMillion","Renderer","render","RendererInitializer","getContextType","Marker","config","visible","onVisibleChanged","getPosition","getConfig","isVisible","setVisible","addOnVisibleChanged","SandGameGraphics","triggerFunction","aX","aY","bX","bY","brushOrElement","supportNegativeCoordinates","drawRectangleWH","round","consumer","maxLevel","BLUEPRINT_3","d","lineAlgorithm","moveX","moveY","diff","drawShape","shape","replace","elementTarget","elementReplacement","halfHeight","yd","halfWidth","xd","insertElementArea","SandGameEntities","SandGameOverlay","markers","onMarkerAdded","createRectangle","marker","createRectangleWH","getMarkers","m","addOnMarkerAdded","Splash","Objective","onActiveChanged","completed","onCompletedChanged","setActive","addOnActiveChanged","isCompleted","setCompleted","addOnCompleted","SandGameScenario","splashes","onSplashAdded","objectives","onObjectiveAdded","statusCompleted","onStatusCompleted","createSplash","splash","getSplashes","addOnSplashAdded","createObjective","objective","getObjectives","addOnObjectiveAdded","FEATURE_SCENARIO_COMPLETED","addOnStatusCompleted","Snapshot","metadata","SnapshotMetadata","formatVersion","appVersion","created","TemplateBlockPainter","MAX_SAFE_INTEGER","verticalAlign","withBlueprint","withBrushes","withMaxHeight","align","ww","hh","verticalOffset","swapRows","k","l","TemplateLayeredPainter","lastLevel","layer","constant","relative","shuffleWithLevelBelow","layerFunction","layerSpline","xs","ys","spline","ks","getNaturalKs","n","A","zerosMat","i_max","solve","getIndexBefore","target","low","high","mid","at","layerPerlin","levels","levelConfig","noise2d","to","relativeY","SandGame","framesCounter","iterationsCounter","processor","renderer","processorIntervalHandle","rendererIntervalHandle","onRendered","onRenderingFailed","onProcessed","overlay","scenario","gameDefaults","rendererInitializer","initExtensions","initObjectives","activeObjectives","updateActiveObjectives","o","checkHandler","extensionsFactory","startProcessing","interval","setInterval","doProcessing","startRendering","OPT_FRAMES_PER_SECOND","doRendering","stopProcessing","clearInterval","stopRendering","Date","now","blockTemplate","layeredTemplate","setBoxedMode","setFallThroughMode","setErasingMode","addOnProcessed","addOnRendered","addOnRenderingFailed","getFramesPerSecond","getIterationsPerSecond","getChunkSize","createSnapshot","CURRENT_FORMAT_VERSION","getTime","snapshot","debugElementAt","toHex","toString","padStart","hex","json","body","structure","JSON","stringify","replaceAll","substring","Scene","prefWidth","prefHeight","createSandGame","executeOnOpened","sandGame","SceneImplTmpResize","oldWidth","oldHeight","oldMetadata","oldElementArea","oldSerializedEntities","newElementArea","newSandGame","ServiceToolManager","primaryTool","secondaryTool","tertiaryTool","onPrimaryToolChanged","inputDisabled","onInputDisabledChanged","setPrimaryTool","setSecondaryTool","setTertiaryTool","getPrimaryTool","getSecondaryTool","getTertiaryTool","addOnPrimaryToolChanged","isInputDisabled","addOnInputDisabledChanged","setInputDisabled","disabled","createRevertAction","oldPrimary","oldSecondary","oldTertiary","SceneImplSnapshot","u8","u16","u32","fleb","fdeb","clim","freb","eb","_a","fl","revfl","_b","fd","revfd","rev","hMap","cd","mb","co","le","rvb","sv","r_1","flt","fdt","flm","flrm","fdm","fdrm","bits","bits16","shft","slc","BYTES_PER_ELEMENT","subarray","ec","err","ind","msg","nt","Error","code","captureStackTrace","inflt","dat","buf","st","sl","noBuf","noSt","cbuf","bl","nbuf","final","pos","bt","lm","dm","lbt","dbt","tbts","hLit","hcLen","tl","ldt","clt","clb","clbmsk","clm","lt","dt","lms","dms","lpos","sym","dsym","end","wbits","wbits16","hTree","slice","et","i0","i2","maxSym","tr","mbt","ln","lft","cst","i2_1","i2_2","i2_3","lc","cl","cli","cln","cls","clen","cf","wfblk","out","wblk","syms","lf","df","li","bs","dlt","mlb","ddt","mdb","_c","lclt","nlc","_d","lcdt","ndc","lcfreq","_e","lct","mlcb","nlcc","ll","dl","flen","ftlen","dtlen","llm","lcts","it","clct","len","dst","deo","crct","Int32Array","crc","cr","dopt","opt","pre","post","lvl","plvl","lst","msk_1","prev","head","bs1_1","bs2_1","hsh","lc_1","wi","hv","imod","pimod","rem","ch_1","dif","maxn","maxd","ml","nl","mmd","md","ti","lin","din","dflt","mem","log","mrg","b2","b4","b8","wbytes","deflateSync","opts","inflateSync","fltn","op","te","TextEncoder","td","TextDecoder","decode","stream","strToU8","str","latin1","ar_1","charCodeAt","encode","ar","ai","strFromU8","String","fromCharCode","dutf8","slzh","zh","z","fnl","fn","es","z64e","sc","su","off","exfl","wzh","u","ce","extra","col","exl","os","flag","compression","mtime","getFullYear","getMonth","getDate","getHours","getMinutes","getSeconds","attrs","exf","zipSync","files","tot","file","com","comment","ms","oe","cdl","badd","wzf","ResourceSnapshot","createZip","parse","zip","parseJson","fileName","metadataJson","METADATA_JSON_NAME","LEGACY_METADATA_JSON_NAME","dataRaw","byteLength","dataRawHeads","dataRawTails","convertToV2","convertToV4","convertToV5","convertToV6","convertToV7","oldType","flammableType","flameHeatType","burnableType","conductivityType","SceneImplModFlip","original","SceneImplTemplate","ResourceUtils","loadImageData","objectUrl","asObjectUrl","arrayBufferView","blob","Blob","URL","webkitURL","createObjectURL","createSceneFromImageTemplate","getImageTypeOrNull","filename","toLowerCase","endsWith","ResourceTool","parseImageTemplate","parseRandomTemplate","items","parseImageData","thresholdPar","parseInt","brushPar","imageDataPar","imageFilePar","imageFile","Resources","createResourceFromSnapshot","parseZipResource","ze","fltr","c_2","no","originalSize","unzipSync","parseJsonResource","JSON_RESOURCE_TYPE_FIELD","parseToolDefinition","Component","controller","ComponentFormTemplate","thresholdValue","materialValue","materialBrush","creatMaterialFormGroup","createThresholdSliderFormGroup","createMaxWidthFormGroup","createMaxHeightFormGroup","slider","toolInfo","codename","labelAttributes","getThresholdValue","getMaterialBrush","getMaxWidth","getMaxHeight","ServiceIO","templateForm","initFileDragAndDrop","domNode","forEach","eventName","preventDefault","stopPropagation","classList","remove","loadFromFiles","dataTransfer","reader","FileReader","readerEvent","loadFromArrayBuffer","readAsArrayBuffer","imageTypeOrNull","loadImageTemplate","resource","importResource","catch","handleError","imageType","handleImageTemplate","importImageTemplate","getDialogAnchor","pasteScene","FEATURE_IO_IMAGE_TEMPLATE","importScene","toolManager","getToolManager","revert","FEATURE_IO_IMPORT","openScene","Renderer2D","renderPreview","createImageData","dataIndex","putImageData","mode","triggeredChunks","blur","canBeBlurred","triggerChunk","triggerChunks","setMode","triggered","changed","includeRowUnder","chunkIndexUnder","renderChunk","renderPixel","pixelIndex","blurBehaviour","isWhite","RendererInitializer2D","RendererWebGL","timeStartMs","gl","temperaturePaletteData","temperaturePaletteSize","blurProgram","loadProgram","blurProgramLocationTime","getUniformLocation","blurProgramLocationElementHeads","blurProgramLocationElementTails","blurProgramLocationBlur","blurProgramLocationTemperaturePalette","mergeProgram","mergeProgramLocationElementHeads","mergeProgramLocationElementTails","mergeProgramLocationBlur","mergeProgramLocationTemperaturePalette","positions","vertBuffer","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","Float32Array","STATIC_DRAW","enableVertexAttribArray","vertexAttribPointer","FLOAT","createTextureAndFrameBuffer","textureId","motionBlurData","motionBlurTexture","createTexture","activeTexture","bindTexture","TEXTURE_2D","texParameteri","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","TEXTURE_MIN_FILTER","NEAREST","TEXTURE_MAG_FILTER","texImage2D","RGBA","UNSIGNED_BYTE","motionBlurFrameBuffer","createFramebuffer","bindFramebuffer","FRAMEBUFFER","framebufferTexture2D","COLOR_ATTACHMENT0","motionBlurFrameBuffer1","TEXTURE2","motionBlurFrameBuffer2","TEXTURE3","elementHeadsTexture","TEXTURE0","elementTailsTexture","TEXTURE1","temperaturePaletteTexture","TEXTURE4","blurTextureIndex","elementHeads","elementTails","useProgram","uniform1f","uniform1i","drawArrays","TRIANGLES","vertexShader","fragmentShader","program","createProgram","attachShader","loadShader","VERTEX_SHADER","bindAttribLocation","FRAGMENT_SHADER","linkProgram","getProgramParameter","LINK_STATUS","isContextLost","getProgramInfoLog","shaderSource","shaderType","shader","createShader","compileShader","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","colors","RenderingWebGLException","getError","RendererInitializerWebGL","RendererInitializerDefs","canvas2d","renderingMode","canvasWebGL","BrushCollection","getExtraBrushes","BrushCollectionImpl","extraBrushes","GameDefaultsImpl","brushCollection","brushWater","brushSteam","brushGrass","brushTree","brushTreeWood","brushTreeWoodDark","brushTreeLeaf","brushTreeLeafDark","brushTreeRoot","brushFire","brushAsh","resolveBrush","TREE_CLUSTER_TEMPLATES","Controller","init","canvasWidthPx","canvasHeightPx","currentWidthPoints","currentHeightPoints","currentScale","imageRendering","onImageRenderingStyleChanged","simulationEnabled","initialScene","serviceToolManager","serviceIO","canvasProvider","getVersion","version","registerCanvasProvider","getInitialScene","setInitialScene","setup","toFixed","initializeContext","promise","reportSeriousFailure","onInitialized","onStarted","setTimeout","cause","restartAfterInitializationRendererFailure","contextType","initializeContextAs","reportFirstRenderingFailure","FEATURE_RENDERER_FALLBACK","canvasDomNode","contextId","contextLossHandled","restartAfterRenderingFailure","close","onBeforeClosed","enableGlobalShortcuts","onkeydown","ctrlKey","altKey","shiftKey","switchStartStop","prompt","timeBefore","elapsedMs","getSandGame","getCanvas","getCanvasNode","onBeforeNewSceneLoaded","onStopped","onFailure","addOnInitialized","addOnBeforeNewSceneLoaded","addOnBeforeClosed","addOnStarted","addOnStopped","addOnFailure","message","fullMessage","getCurrentScale","getCurrentWidthPoints","getCurrentHeightPoints","changeCanvasSize","setRendererInitializer","initializer","getRendererInitializer","setCanvasImageRenderingStyle","getCanvasImageRenderingStyle","addOnImageRenderingStyleChanged","getIOManager","SceneImplHardcoded","description","onCreated","onOpened","Scenes","SceneDefs","async","layeredPainter","EFFECT_NOISE_LG","CABIN","SAND_CASTLE","xo","yo","SCENE_EMPTY","landscape_1","SCENE_LANDSCAPE_1","landscape_2","SCENE_LANDSCAPE_2","fallthrough","SCENE_FALLTHROUGH","platform","SCENE_PLATFORM","Entities","bird","butterfly","fish","Action","performAction","ActionAnonymous","createToggle","def","ComponentViewTemplateSelection","buttons","toolDefinition","loadedTool","backgroundImage","ActionDialogTemplateSelection","additionalInfo","templatesComponent","ComponentViewTools","importEnabled","buttonType","initButton","selectTool","newTool","ulContent","innerTool","innerInfo","innerDisplayName","innerBadgeStyle","innerLabel","innerToolAttributes","innerButton","buttonContent","createButtonContent","svgIcon","ComponentViewCanvasOverlayMarker","nodeOverlay","wPx","hPx","display","position","left","top","register","createMarkerNode","rectangle","ComponentViewCanvasOverlayCursor","cursor","hideCursors","repaintRectangleSelection","lastX","lastY","xPx","yPx","outline","pointerEvents","repaintLineSelection","showCursor","cursorDefinition","moveCursor","pxW","pxH","pxTop","pxLeft","pxClipTop","pxClipRight","pxClipBottom","pxClipLeft","clipPath","ComponentViewCanvasOverlayScenario","addNode","createSplashNode","objectiveParent","visibleNodes","addObjective","createObjectiveNode","createObjectivesListNode","splashAttributes","splashNode","buttonNode","focus","preventScroll","iconNode","createObjectiveIcon","objectiveNode","ComponentViewCanvasInner","nodeCanvas","markerOverlayComponent","nodeMarkerOverlay","cursorOverlayComponent","nodeCursorOverlay","scenarioOverlayComponent","nodeScenarioOverlay","createCanvas","initMouseHandling","getActualMousePosition","rect","getBoundingClientRect","clientX","clientY","lastTool","ctrlPressed","shiftPressed","repeatingInterval","startRepeatingIfEnabled","cancelRepeatingIfNeeded","FEATURE_DRAW_PRIMARY","FEATURE_DRAW_TERTIARY","FEATURE_DRAW_SECONDARY","FEATURE_DRAW_FLOOD","FEATURE_DRAW_RECT","FEATURE_DRAW_LINE","getActualTouchPosition","touch","touches","setImageRenderingStyle","ComponentViewCanvas","canvasHolderNode","currentCanvas","imageRenderingStyle","ActionDialogChangeCanvasSize","formBuilder","parseFloat","FEATURE_CANVAS_SIZE_CHANGE","ComponentViewElementSizeSelection","nodes","selected","selectedScale","sizeDef","SIZES","createSizeCard","mark","select","newScale","CLASS_SELECTED","FEATURE_SWITCH_SCALE","alt","ActionDialogChangeElementSize","elementSizeComponent","ComponentButtonAdjustScale","ComponentViewSceneSelection","ignoreOnBeforeNewSceneLoaded","initialSceneId","selectedSceneId","closedScenes","store","unselect","onSelect","CLASS_VISITED","rebuildConfirm","FEATURE_RESTART_SCENE","FEATURE_SWITCH_SCENE","onConfirm","delete","ComponentContainer","cssClass","components","component","ComponentSimple","ComponentButton","CLASS_PRIMARY","ComponentButtonStartStop","FEATURE_PAUSE","btn","_ASSET_SVG_PLAY","ComponentStatusIndicator","currenStatus","nodeStatusLabel","createStatusContent","FEATURE_STATUS_DISPLAYED","updateStatus","status","toUpperCase","ips","labelCPS","labelFPS","fps","labelCanvasSize","updateCanvasSize","toLocaleString","ActionRestart","ComponentButtonRestart","ActionIOImport","onchange","click","autoBom","test","XMLHttpRequest","open","responseType","response","send","dispatchEvent","MouseEvent","createEvent","initMouseEvent","self","global","userAgent","saveAs","HTMLAnchorElement","prototype","download","rel","origin","location","revokeObjectURL","msSaveOrOpenBlob","innerText","HTMLElement","safari","onloadend","readAsDataURL","module","exports","ActionIOExport","bytes","FileSaver","createFilename","FEATURE_IO_EXPORT","toISOString","ActionReportProblem","ComponentButtonReport","errorReporter","Extension","ExtensionSpawnGrass","ExtensionSpawnFish","findSpawnY","waterCount","isSpaceAround","ExtensionSpawnTrees","couldGrowUpHere","isSpaceHere","isOtherThreeThere","ExtensionSpawnButterflies","airCount","ExtensionSpawnBirds","ExtensionGenWaypoints","generateWaypoint","entityType","maxHorDiff","maxVerDiff","maxVar","kMeans","wx","wy","wyy","wxx","centroids","assignment","clusters","minDistance","Infinity","newCentroids","sumX","sumY","converged","enableDebug","debug","enableAutoStart","autoStart","enableRestart","disableRestart","enableStartStop","disableStartStop","enableImport","disableImport","enableExport","disableExport","enableSizeChange","disableSizeChange","enableSceneSelection","disableSceneSelection","disableGlobalShortcuts","enableUserErrorReporting","spawnFish","spawnGrass","spawnTrees","spawnButterflies","spawnBirds","generateWaypoints","customScenes","sceneName","SCENES","sceneFunc","keys","values","resolveTool","defaultTool","dialogAnchorNode","prepend","CLASS_LIGHT","SandGameJS_ModuleDev","createComponent","FEATURE_APP_INITIALIZED"],"mappings":"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"}